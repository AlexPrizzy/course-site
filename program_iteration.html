<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />




<title>Iteration</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/readable.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-45631879-2', 'auto');
  ga('send', 'pageview');

</script>


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>


<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>


</head>

<body>

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
button.code-folding-btn:focus {
  outline: none;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 66px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 71px;
  margin-top: -71px;
}

.section h2 {
  padding-top: 71px;
  margin-top: -71px;
}
.section h3 {
  padding-top: 71px;
  margin-top: -71px;
}
.section h4 {
  padding-top: 71px;
  margin-top: -71px;
}
.section h5 {
  padding-top: 71px;
  margin-top: -71px;
}
.section h6 {
  padding-top: 71px;
  margin-top: -71px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>


<div class="container-fluid main-container">

<!-- tabsets -->
<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});
</script>

<!-- code folding -->




<script>
$(document).ready(function ()  {

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_').toLowerCase();
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}


.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
  padding-left: 25px;
  text-indent: 0;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>

<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row-fluid">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Computing for the Social Sciences</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">Home</a>
</li>
<li>
  <a href="faq.html">FAQ</a>
</li>
<li>
  <a href="syllabus.html">Syllabus</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">Iteration</h1>

</div>


<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(tidyverse)
<span class="kw">set.seed</span>(<span class="dv">1234</span>)
<span class="kw">theme_set</span>(<span class="kw">theme_minimal</span>())</code></pre></div>
<div id="writing-for-loops" class="section level1">
<h1>Writing <code>for</code> loops</h1>
<p>Functions are one method of reducing duplication in your code. Another tool for reducing duplication is <strong>iteration</strong>, which lets you do the same thing to multiple inputs.</p>
<div id="example-for-loop" class="section level2">
<h2>Example for loop</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">df &lt;-<span class="st"> </span><span class="kw">tibble</span>(
  <span class="dt">a =</span> <span class="kw">rnorm</span>(<span class="dv">10</span>),
  <span class="dt">b =</span> <span class="kw">rnorm</span>(<span class="dv">10</span>),
  <span class="dt">c =</span> <span class="kw">rnorm</span>(<span class="dv">10</span>),
  <span class="dt">d =</span> <span class="kw">rnorm</span>(<span class="dv">10</span>)
)</code></pre></div>
<p>Let’s say we want to compute the median for each column.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">median</span>(df<span class="op">$</span>a)</code></pre></div>
<pre><code>## [1] -0.5555419</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">median</span>(df<span class="op">$</span>b)</code></pre></div>
<pre><code>## [1] -0.4941011</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">median</span>(df<span class="op">$</span>c)</code></pre></div>
<pre><code>## [1] -0.4656169</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">median</span>(df<span class="op">$</span>d)</code></pre></div>
<pre><code>## [1] -0.605349</code></pre>
<p>Boo! We’ve copied-and-pasted <code>median()</code> three times. We don’t want to do that. Instead, we can use a <code>for</code> loop:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">output &lt;-<span class="st"> </span><span class="kw">vector</span>(<span class="dt">mode =</span> <span class="st">&quot;double&quot;</span>, <span class="dt">length =</span> <span class="kw">ncol</span>(df))
<span class="cf">for</span> (i <span class="cf">in</span> <span class="kw">seq_along</span>(df)) {
  output[[i]] &lt;-<span class="st"> </span><span class="kw">median</span>(df[[i]])
}
output</code></pre></div>
<pre><code>## [1] -0.5555419 -0.4941011 -0.4656169 -0.6053490</code></pre>
<p>Let’s review the three components of every <code>for</code> loop.</p>
<div id="output" class="section level4">
<h4>Output</h4>
<p><code>output &lt;- vector(&quot;double&quot;, length(x))</code></p>
<p>Before you start a loop, you need to create an empty vector to store the output of the loop. Preallocating space for your output is much more efficient than creating space as you move through the loop. The <code>vector()</code> function allows you to create an empty vector of any type. The first argument <code>mode</code> defines the type of vector (“logical”, “integer”, “double”, “character”, etc.) and the second argument <code>length</code> defines the length of the vector.</p>
<p>Numeric vectors are initialized to <code>0</code>, logical vectors are initialized to <code>FALSE</code>, character vectors are initialized to <code>&quot;&quot;</code>, and list elements to <code>NULL</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">vector</span>(<span class="dt">mode =</span> <span class="st">&quot;double&quot;</span>, <span class="dt">length =</span> <span class="kw">ncol</span>(df))</code></pre></div>
<pre><code>## [1] 0 0 0 0</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">vector</span>(<span class="dt">mode =</span> <span class="st">&quot;logical&quot;</span>, <span class="dt">length =</span> <span class="kw">ncol</span>(df))</code></pre></div>
<pre><code>## [1] FALSE FALSE FALSE FALSE</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">vector</span>(<span class="dt">mode =</span> <span class="st">&quot;character&quot;</span>, <span class="dt">length =</span> <span class="kw">ncol</span>(df))</code></pre></div>
<pre><code>## [1] &quot;&quot; &quot;&quot; &quot;&quot; &quot;&quot;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">vector</span>(<span class="dt">mode =</span> <span class="st">&quot;list&quot;</span>, <span class="dt">length =</span> <span class="kw">ncol</span>(df))</code></pre></div>
<pre><code>## [[1]]
## NULL
## 
## [[2]]
## NULL
## 
## [[3]]
## NULL
## 
## [[4]]
## NULL</code></pre>
</div>
<div id="sequence" class="section level4">
<h4>Sequence</h4>
<p><code>i in seq_along(df)</code></p>
<p>This component determines what to loop over. During each iteration through the <code>for</code> loop, a new value will be assigned to <code>i</code> based on the the defined sequence. Here, the sequence is <code>seq_along(df)</code> which creates a numeric vector for a sequence of numbers beginning at 1 and continuing until it reaches the length of <code>df</code> (the length here is the number of columns in <code>df</code>).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">seq_along</span>(df)</code></pre></div>
<pre><code>## [1] 1 2 3 4</code></pre>
</div>
<div id="body" class="section level4">
<h4>Body</h4>
<p><code>output[[i]] &lt;- median(df[[i]])</code></p>
<p>This is the code that actually performs the desired calculations. It runs multiple times for every value of <code>i</code>. We use <code>[[</code> notation to reference each column of <code>df</code> and store it in the appropriate element in <code>output</code>.</p>
</div>
</div>
<div id="why-we-preallocate-space-for-the-output" class="section level2">
<h2>Why we preallocate space for the output</h2>
<p>If you don’t preallocate space for the output, each time the <code>for</code> loop iterates, it makes a copy of the output and appends the new value at the end. Copying data takes time and memory. If the output is preallocated space, the loop simply fills in the slots with the correct values.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">x &lt;-<span class="st"> </span><span class="kw">rnorm</span>(<span class="dv">1000</span>, <span class="dt">mean =</span> <span class="dv">0</span>, <span class="dt">sd =</span> <span class="dv">1</span>)
<span class="kw">str</span>(x)</code></pre></div>
<pre><code>##  num [1:1000] 1.449 -1.069 -0.855 -0.281 -0.994 ...</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># load microbenchmark library to time code</span>
<span class="kw">library</span>(microbenchmark)

<span class="kw">microbenchmark</span>(
  <span class="co"># don&#39;t preallocate</span>
  <span class="st">`</span><span class="dt">No preallocation</span><span class="st">`</span> =<span class="st"> </span>{
    output &lt;-<span class="st"> </span><span class="kw">vector</span>(<span class="st">&quot;numeric&quot;</span>, <span class="dv">0</span>)
    
    <span class="cf">for</span> (i <span class="cf">in</span> <span class="kw">seq_along</span>(x)) {
      output &lt;-<span class="st"> </span><span class="kw">c</span>(output, x[[i]] <span class="op">+</span><span class="st"> </span><span class="dv">1</span>)
    }
  },
  <span class="co"># preallocate</span>
  <span class="st">`</span><span class="dt">Preallocation</span><span class="st">`</span> =<span class="st"> </span>{
    output &lt;-<span class="st"> </span><span class="kw">vector</span>(<span class="st">&quot;numeric&quot;</span>, <span class="kw">length</span>(x))
    
    <span class="cf">for</span> (i <span class="cf">in</span> <span class="kw">seq_along</span>(x)) {
      output[[i]] &lt;-<span class="st"> </span>x[[i]] <span class="op">+</span><span class="st"> </span><span class="dv">1</span>
    }
  }) <span class="op">%&gt;%</span>
<span class="st">  </span>autoplot <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_y_log10</span>(<span class="dt">breaks =</span> <span class="kw">c</span>(<span class="dv">2</span>, <span class="dv">4</span>, <span class="dv">8</span>, <span class="dv">16</span>, <span class="dv">32</span>)) <span class="op">+</span>
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">y =</span> <span class="st">&quot;Time [milliseconds]&quot;</span>)</code></pre></div>
<pre><code>## Scale for &#39;y&#39; is already present. Adding another scale for &#39;y&#39;, which
## will replace the existing scale.</code></pre>
<p><img src="program_iteration_files/figure-html/preallocate-1.png" width="672" /></p>
<p>Here, preallocating space for the vector cuts the computation time by a factor of 3.</p>
</div>
<div id="exercise-write-a-for-loop" class="section level2">
<h2>Exercise: write a <code>for</code> loop</h2>
<div id="mean-of-columns-in-mtcars" class="section level3">
<h3>Mean of columns in <code>mtcars</code></h3>
<p>Write a <code>for</code> loop that calculates the arithmetic mean for every column in <code>mtcars</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">as_tibble</span>(mtcars)</code></pre></div>
<pre><code>## # A tibble: 32 x 11
##      mpg   cyl  disp    hp  drat    wt  qsec    vs    am  gear  carb
##  * &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
##  1  21.0     6 160.0   110  3.90 2.620 16.46     0     1     4     4
##  2  21.0     6 160.0   110  3.90 2.875 17.02     0     1     4     4
##  3  22.8     4 108.0    93  3.85 2.320 18.61     1     1     4     1
##  4  21.4     6 258.0   110  3.08 3.215 19.44     1     0     3     1
##  5  18.7     8 360.0   175  3.15 3.440 17.02     0     0     3     2
##  6  18.1     6 225.0   105  2.76 3.460 20.22     1     0     3     1
##  7  14.3     8 360.0   245  3.21 3.570 15.84     0     0     3     4
##  8  24.4     4 146.7    62  3.69 3.190 20.00     1     0     4     2
##  9  22.8     4 140.8    95  3.92 3.150 22.90     1     0     4     2
## 10  19.2     6 167.6   123  3.92 3.440 18.30     1     0     4     4
## # ... with 22 more rows</code></pre>
<p>Before you write the <code>for</code> loop, identify the three components you need:</p>
<ul>
<li>Output</li>
<li>Sequence</li>
<li>Body</li>
</ul>
<details> <summary>Click for the solution</summary>
<p>
<ul>
<li>Output - a numeric vector of length 11</li>
<li>Sequence - <code>i in seq_along(mtcars)</code></li>
<li>Body - calculate the <code>mean()</code> of the <span class="math inline">\(i\)</span>th column, store the new value as the <span class="math inline">\(i\)</span>th element of the vector <code>output</code></li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">output &lt;-<span class="st"> </span><span class="kw">vector</span>(<span class="st">&quot;numeric&quot;</span>, <span class="kw">ncol</span>(mtcars))

<span class="cf">for</span>(i <span class="cf">in</span> <span class="kw">seq_along</span>(mtcars)){
  output[[i]] &lt;-<span class="st"> </span><span class="kw">mean</span>(mtcars[[i]], <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)
}

output</code></pre></div>
<pre><code>##  [1]  20.090625   6.187500 230.721875 146.687500   3.596563   3.217250
##  [7]  17.848750   0.437500   0.406250   3.687500   2.812500</code></pre>
</p>
<p></details></p>
</div>
<div id="maximum-value-in-each-column-of-diamonds" class="section level3">
<h3>Maximum value in each column of <code>diamonds</code></h3>
<p>Write a <code>for</code> loop that calculates the maximum value in each column of <code>diamonds</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">diamonds</code></pre></div>
<pre><code>## # A tibble: 53,940 x 10
##    carat       cut color clarity depth table price     x     y     z
##    &lt;dbl&gt;     &lt;ord&gt; &lt;ord&gt;   &lt;ord&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
##  1  0.23     Ideal     E     SI2  61.5    55   326  3.95  3.98  2.43
##  2  0.21   Premium     E     SI1  59.8    61   326  3.89  3.84  2.31
##  3  0.23      Good     E     VS1  56.9    65   327  4.05  4.07  2.31
##  4  0.29   Premium     I     VS2  62.4    58   334  4.20  4.23  2.63
##  5  0.31      Good     J     SI2  63.3    58   335  4.34  4.35  2.75
##  6  0.24 Very Good     J    VVS2  62.8    57   336  3.94  3.96  2.48
##  7  0.24 Very Good     I    VVS1  62.3    57   336  3.95  3.98  2.47
##  8  0.26 Very Good     H     SI1  61.9    55   337  4.07  4.11  2.53
##  9  0.22      Fair     E     VS2  65.1    61   337  3.87  3.78  2.49
## 10  0.23 Very Good     H     VS1  59.4    61   338  4.00  4.05  2.39
## # ... with 53,930 more rows</code></pre>
<p>Before you write the <code>for</code> loop, identify the three components you need:</p>
<ul>
<li>Output</li>
<li>Sequence</li>
<li>Body</li>
</ul>
<details> <summary>Click for the solution</summary>
<p>
<ul>
<li>Output - a vector of length 10</li>
<li>Sequence - <code>i in seq_along(diamonds)</code></li>
<li>Body - get the maximum value of the <span class="math inline">\(i\)</span>th column of the data frame <code>diamonds</code>, store the new value as the <span class="math inline">\(i\)</span>th element of the list <code>output</code></li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">output &lt;-<span class="st"> </span><span class="kw">vector</span>(<span class="st">&quot;numeric&quot;</span>, <span class="kw">ncol</span>(diamonds))

<span class="cf">for</span>(i <span class="cf">in</span> <span class="kw">seq_along</span>(diamonds)){
  output[i] &lt;-<span class="st"> </span><span class="kw">max</span>(diamonds[[i]])
}

output</code></pre></div>
<pre><code>##  [1]     5.01     5.00     7.00     8.00    79.00    95.00 18823.00
##  [8]    10.74    58.90    31.80</code></pre>
<p>To preserve the name attributes from <code>diamonds</code>, use the <code>names()</code> function to extract the names of each column in <code>diamonds</code> and apply them as the names to the <code>output</code> vector:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># get the names of the columns in diamonds</span>
<span class="kw">names</span>(diamonds)</code></pre></div>
<pre><code>##  [1] &quot;carat&quot;   &quot;cut&quot;     &quot;color&quot;   &quot;clarity&quot; &quot;depth&quot;   &quot;table&quot;   &quot;price&quot;  
##  [8] &quot;x&quot;       &quot;y&quot;       &quot;z&quot;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># assign the names of the diamonds columns to output</span>
<span class="kw">names</span>(output) &lt;-<span class="st"> </span><span class="kw">names</span>(diamonds)
output</code></pre></div>
<pre><code>##    carat      cut    color  clarity    depth    table    price        x 
##     5.01     5.00     7.00     8.00    79.00    95.00 18823.00    10.74 
##        y        z 
##    58.90    31.80</code></pre>
<blockquote>
<p>Notice that all the columns have a maximum value, even the apparently text-based columns. This is because <code>cut</code>, <code>color</code>, and <code>clarity</code> are all stored as factor columns. Remember that <a href="http://r4ds.had.co.nz/vectors.html#factors-1">factor vectors are built on top of integers</a>, so the underlying values are numeric. As a result we can apply <code>max()</code> to a factor vector and still retrieve a (partially) meaningful result.</p>
</blockquote>
</p>
<p></details></p>
</div>
</div>
</div>
<div id="map-functions" class="section level1">
<h1>Map functions</h1>
<p>You will frequently need to iterate over vectors or data frames, perform an operation on each element, and save the results somewhere. <code>for</code> loops are not the devil. At first, they may seem more intuitive to use because you are explicitly identifying each component of the process. However the downside is that they focus on a lot of non-essential stuff. You have to track the value on which you are iterating, you need to explicitly create a vector to store the output, you have to assign the output of each iteration to the appropriate element in the output vector, etc.</p>
<p><code>tidyverse</code> is all about focusing on <strong>verbs</strong>, not <strong>nouns</strong>. That is, focus on the operation being performed (e.g. <code>mean()</code>, <code>median()</code>, <code>max()</code>), not all the extra code needed to make the operation work. The <code>purrr</code> library provides a family of functions that mirrors <code>for</code> loops. They:</p>
<ul>
<li>Loop over a vector</li>
<li>Do something to each element</li>
<li>Save the results</li>
</ul>
<p>There is one function for each type of output:</p>
<ul>
<li><code>map()</code> makes a list.</li>
<li><code>map_lgl()</code> makes a logical vector.</li>
<li><code>map_int()</code> makes an integer vector.</li>
<li><code>map_dbl()</code> makes a double vector.</li>
<li><code>map_chr()</code> makes a character vector.</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">map_dbl</span>(df, mean)</code></pre></div>
<pre><code>##          a          b          c          d 
## -0.3831574 -0.1181707 -0.3879468 -0.7661931</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">map_dbl</span>(df, median)</code></pre></div>
<pre><code>##          a          b          c          d 
## -0.5555419 -0.4941011 -0.4656169 -0.6053490</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">map_dbl</span>(df, sd)</code></pre></div>
<pre><code>##         a         b         c         d 
## 0.9957875 1.0673376 0.6660013 0.8942458</code></pre>
<p>Just like all of our functions in the <code>tidyverse</code>, the first argument is always the data object, and the second argument is the function to be applied. Additional arguments for the function to be applied can be specified like this:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">map_dbl</span>(df, mean, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)</code></pre></div>
<pre><code>##          a          b          c          d 
## -0.3831574 -0.1181707 -0.3879468 -0.7661931</code></pre>
<p>Or data can be piped:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">df <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">map_dbl</span>(mean, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)</code></pre></div>
<pre><code>##          a          b          c          d 
## -0.3831574 -0.1181707 -0.3879468 -0.7661931</code></pre>
<div id="exercise-rewrite-our-for-loops-using-a-map-function" class="section level2">
<h2>Exercise: rewrite our <code>for</code> loops using a <code>map()</code> function</h2>
<div id="mean-of-columns-in-mtcars-1" class="section level3">
<h3>Mean of columns in <code>mtcars</code></h3>
<p>Write a <code>map()</code> function that calculates the arithmetic mean for every column in <code>mtcars</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">as_tibble</span>(mtcars)</code></pre></div>
<pre><code>## # A tibble: 32 x 11
##      mpg   cyl  disp    hp  drat    wt  qsec    vs    am  gear  carb
##  * &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
##  1  21.0     6 160.0   110  3.90 2.620 16.46     0     1     4     4
##  2  21.0     6 160.0   110  3.90 2.875 17.02     0     1     4     4
##  3  22.8     4 108.0    93  3.85 2.320 18.61     1     1     4     1
##  4  21.4     6 258.0   110  3.08 3.215 19.44     1     0     3     1
##  5  18.7     8 360.0   175  3.15 3.440 17.02     0     0     3     2
##  6  18.1     6 225.0   105  2.76 3.460 20.22     1     0     3     1
##  7  14.3     8 360.0   245  3.21 3.570 15.84     0     0     3     4
##  8  24.4     4 146.7    62  3.69 3.190 20.00     1     0     4     2
##  9  22.8     4 140.8    95  3.92 3.150 22.90     1     0     4     2
## 10  19.2     6 167.6   123  3.92 3.440 18.30     1     0     4     4
## # ... with 22 more rows</code></pre>
<details> <summary>Click for the solution</summary>
<p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">map_dbl</span>(mtcars, mean)</code></pre></div>
<pre><code>##        mpg        cyl       disp         hp       drat         wt 
##  20.090625   6.187500 230.721875 146.687500   3.596563   3.217250 
##       qsec         vs         am       gear       carb 
##  17.848750   0.437500   0.406250   3.687500   2.812500</code></pre>
</p>
<p></details></p>
</div>
<div id="maximum-value-in-each-column-of-diamonds-1" class="section level3">
<h3>Maximum value in each column of <code>diamonds</code></h3>
<p>Write a <code>map()</code> function that calculates the maximum value in each column of <code>diamonds</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">diamonds</code></pre></div>
<pre><code>## # A tibble: 53,940 x 10
##    carat       cut color clarity depth table price     x     y     z
##    &lt;dbl&gt;     &lt;ord&gt; &lt;ord&gt;   &lt;ord&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
##  1  0.23     Ideal     E     SI2  61.5    55   326  3.95  3.98  2.43
##  2  0.21   Premium     E     SI1  59.8    61   326  3.89  3.84  2.31
##  3  0.23      Good     E     VS1  56.9    65   327  4.05  4.07  2.31
##  4  0.29   Premium     I     VS2  62.4    58   334  4.20  4.23  2.63
##  5  0.31      Good     J     SI2  63.3    58   335  4.34  4.35  2.75
##  6  0.24 Very Good     J    VVS2  62.8    57   336  3.94  3.96  2.48
##  7  0.24 Very Good     I    VVS1  62.3    57   336  3.95  3.98  2.47
##  8  0.26 Very Good     H     SI1  61.9    55   337  4.07  4.11  2.53
##  9  0.22      Fair     E     VS2  65.1    61   337  3.87  3.78  2.49
## 10  0.23 Very Good     H     VS1  59.4    61   338  4.00  4.05  2.39
## # ... with 53,930 more rows</code></pre>
<details> <summary>Click for the solution</summary>
<p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">map_dbl</span>(diamonds, max)</code></pre></div>
<pre><code>##    carat      cut    color  clarity    depth    table    price        x 
##     5.01     5.00     7.00     8.00    79.00    95.00 18823.00    10.74 
##        y        z 
##    58.90    31.80</code></pre>
</p>
<p></details></p>
</div>
</div>
</div>
<div id="scoped-verbs" class="section level1">
<h1>Scoped verbs</h1>
<p>Frequently when working with data frames you may wish to apply a specific function to multiple columns. For instance, calculating the average value of each column in <code>mtcars</code>. If we wanted to calculate the average of a single column, it would be pretty simple using just <code>tidyverse</code> functions:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">mtcars <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summarize</span>(<span class="dt">mpg =</span> <span class="kw">mean</span>(mpg))</code></pre></div>
<pre><code>##        mpg
## 1 20.09062</code></pre>
<p>If we want to calculate the mean for all of them, we’d have to duplicate this code many times over:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">mtcars <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summarize</span>(<span class="dt">mpg =</span> <span class="kw">mean</span>(mpg),
            <span class="dt">cyl =</span> <span class="kw">mean</span>(cyl),
            <span class="dt">disp =</span> <span class="kw">mean</span>(disp),
            <span class="dt">hp =</span> <span class="kw">mean</span>(hp),
            <span class="dt">drat =</span> <span class="kw">mean</span>(drat),
            <span class="dt">wt =</span> <span class="kw">mean</span>(wt),
            <span class="dt">qsec =</span> <span class="kw">mean</span>(qsec),
            <span class="dt">vs =</span> <span class="kw">mean</span>(vs),
            <span class="dt">am =</span> <span class="kw">mean</span>(am),
            <span class="dt">gear =</span> <span class="kw">mean</span>(gear),
            <span class="dt">carb =</span> <span class="kw">mean</span>(carb))</code></pre></div>
<pre><code>##        mpg    cyl     disp       hp     drat      wt     qsec     vs
## 1 20.09062 6.1875 230.7219 146.6875 3.596563 3.21725 17.84875 0.4375
##        am   gear   carb
## 1 0.40625 3.6875 2.8125</code></pre>
<p>But this is very repetitive and prone to mistakes - I cannot tell you how many typos I originally had in this code when I first wrote it. We’ve seen how to use loops and <code>map()</code> functions to solve this task - let’s check out one final method: <strong>scoped verbs</strong>.</p>
<p>Scoped verbs allow you to use standard <strong>verbs</strong> (or functions) in <code>dplyr</code> that affect multiple variables at once:</p>
<ul>
<li><code>_if</code> allows you to pick variables based on a predicate function like <code>is.numeric()</code> or <code>is.character()</code></li>
<li><code>_at</code> allows you to pick variables using the same syntax as <code>select()</code></li>
<li><code>_all</code> operates on all variables</li>
</ul>
<div id="summarize" class="section level2">
<h2>summarize</h2>
<div id="summarize_all" class="section level3">
<h3><code>summarize_all()</code></h3>
<p><code>summarize_all()</code> takes a tibble and a function and applies that function to each column:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">summarize_all</span>(mtcars, mean)</code></pre></div>
<pre><code>##        mpg    cyl     disp       hp     drat      wt     qsec     vs
## 1 20.09062 6.1875 230.7219 146.6875 3.596563 3.21725 17.84875 0.4375
##        am   gear   carb
## 1 0.40625 3.6875 2.8125</code></pre>
<p>If you want to apply multiple summaries, use the <code>funs()</code> helper:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">summarize_all</span>(mtcars, <span class="kw">funs</span>(min, max))</code></pre></div>
<pre><code>##   mpg_min cyl_min disp_min hp_min drat_min wt_min qsec_min vs_min am_min
## 1    10.4       4     71.1     52     2.76  1.513     14.5      0      0
##   gear_min carb_min mpg_max cyl_max disp_max hp_max drat_max wt_max
## 1        3        1    33.9       8      472    335     4.93  5.424
##   qsec_max vs_max am_max gear_max carb_max
## 1     22.9      1      1        5        8</code></pre>
<p>And as always, you could combine this with <code>group_by()</code> to calculate group-level summary statistics:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">mtcars <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(gear) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summarize_all</span>(mean)</code></pre></div>
<pre><code>## # A tibble: 3 x 11
##    gear      mpg      cyl     disp       hp     drat       wt   qsec
##   &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;  &lt;dbl&gt;
## 1     3 16.10667 7.466667 326.3000 176.1333 3.132667 3.892600 17.692
## 2     4 24.53333 4.666667 123.0167  89.5000 4.043333 2.616667 18.965
## 3     5 21.38000 6.000000 202.4800 195.6000 3.916000 2.632600 15.640
## # ... with 3 more variables: vs &lt;dbl&gt;, am &lt;dbl&gt;, carb &lt;dbl&gt;</code></pre>
</div>
<div id="summarize_at" class="section level3">
<h3><code>summarize_at()</code></h3>
<p><code>summarize_at()</code> allows you to pick columns in the same way as <code>select()</code>, that is, based on their names. There is one small difference: you need to wrap the complete selection with the <code>vars()</code> helper (this avoids ambiguity).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">summarize_at</span>(mtcars, <span class="kw">vars</span>(<span class="op">-</span>mpg), mean)</code></pre></div>
<pre><code>##      cyl     disp       hp     drat      wt     qsec     vs      am   gear
## 1 6.1875 230.7219 146.6875 3.596563 3.21725 17.84875 0.4375 0.40625 3.6875
##     carb
## 1 2.8125</code></pre>
<p>By default, the newly created columns have the shortest names needed to uniquely identify the output.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">summarize_at</span>(mtcars, <span class="kw">vars</span>(mpg), <span class="kw">funs</span>(min, max))</code></pre></div>
<pre><code>##    min  max
## 1 10.4 33.9</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">summarize_at</span>(mtcars, <span class="kw">vars</span>(mpg, wt), min)</code></pre></div>
<pre><code>##    mpg    wt
## 1 10.4 1.513</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">summarize_at</span>(mtcars, <span class="kw">vars</span>(<span class="op">-</span>mpg), <span class="kw">funs</span>(min, max))</code></pre></div>
<pre><code>##   cyl_min disp_min hp_min drat_min wt_min qsec_min vs_min am_min gear_min
## 1       4     71.1     52     2.76  1.513     14.5      0      0        3
##   carb_min cyl_max disp_max hp_max drat_max wt_max qsec_max vs_max am_max
## 1        1       8      472    335     4.93  5.424     22.9      1      1
##   gear_max carb_max
## 1        5        8</code></pre>
</div>
<div id="summarize_if" class="section level3">
<h3><code>summarize_if()</code></h3>
<p><code>summarize_at()</code> allows you to pick variables to summarize based on their name, whereas <code>summarize_if()</code> allows you to pick variables to summarize based on some property of the column. Typically this is their type because you want to (e.g.) apply a numeric summary function only to numeric columns:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">starwars</code></pre></div>
<pre><code>## # A tibble: 87 x 13
##                  name height  mass    hair_color  skin_color eye_color
##                 &lt;chr&gt;  &lt;int&gt; &lt;dbl&gt;         &lt;chr&gt;       &lt;chr&gt;     &lt;chr&gt;
##  1     Luke Skywalker    172    77         blond        fair      blue
##  2              C-3PO    167    75          &lt;NA&gt;        gold    yellow
##  3              R2-D2     96    32          &lt;NA&gt; white, blue       red
##  4        Darth Vader    202   136          none       white    yellow
##  5        Leia Organa    150    49         brown       light     brown
##  6          Owen Lars    178   120   brown, grey       light      blue
##  7 Beru Whitesun lars    165    75         brown       light      blue
##  8              R5-D4     97    32          &lt;NA&gt;  white, red       red
##  9  Biggs Darklighter    183    84         black       light     brown
## 10     Obi-Wan Kenobi    182    77 auburn, white        fair blue-gray
## # ... with 77 more rows, and 7 more variables: birth_year &lt;dbl&gt;,
## #   gender &lt;chr&gt;, homeworld &lt;chr&gt;, species &lt;chr&gt;, films &lt;list&gt;,
## #   vehicles &lt;list&gt;, starships &lt;list&gt;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">starwars <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(species) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summarize_if</span>(is.numeric, mean, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)</code></pre></div>
<pre><code>## # A tibble: 38 x 4
##      species   height   mass birth_year
##        &lt;chr&gt;    &lt;dbl&gt;  &lt;dbl&gt;      &lt;dbl&gt;
##  1    Aleena  79.0000  15.00        NaN
##  2  Besalisk 198.0000 102.00        NaN
##  3    Cerean 198.0000  82.00   92.00000
##  4  Chagrian 196.0000    NaN        NaN
##  5  Clawdite 168.0000  55.00        NaN
##  6     Droid 140.0000  69.75   53.33333
##  7       Dug 112.0000  40.00        NaN
##  8      Ewok  88.0000  20.00    8.00000
##  9 Geonosian 183.0000  80.00        NaN
## 10    Gungan 208.6667  74.00   52.00000
## # ... with 28 more rows</code></pre>
<p>(Note that <code>na.rm = TRUE</code> is passed on to <code>mean()</code> in the same way as in <code>purrr::map()</code>.)</p>
</div>
</div>
<div id="mutate" class="section level2">
<h2>Mutate</h2>
<p><code>mutate_all()</code>, <code>mutate_if()</code> and <code>mutate_at()</code> work in a similar way to their summarize equivalents.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">mutate_all</span>(mtcars, log10)</code></pre></div>
<pre><code>##         mpg       cyl     disp       hp      drat        wt     qsec   vs
## 1  1.322219 0.7781513 2.204120 2.041393 0.5910646 0.4183013 1.216430 -Inf
## 2  1.322219 0.7781513 2.204120 2.041393 0.5910646 0.4586378 1.230960 -Inf
## 3  1.357935 0.6020600 2.033424 1.968483 0.5854607 0.3654880 1.269746    0
## 4  1.330414 0.7781513 2.411620 2.041393 0.4885507 0.5071810 1.288696    0
## 5  1.271842 0.9030900 2.556303 2.243038 0.4983106 0.5365584 1.230960 -Inf
## 6  1.257679 0.7781513 2.352183 2.021189 0.4409091 0.5390761 1.305781    0
## 7  1.155336 0.9030900 2.556303 2.389166 0.5065050 0.5526682 1.199755 -Inf
## 8  1.387390 0.6020600 2.166430 1.792392 0.5670264 0.5037907 1.301030    0
## 9  1.357935 0.6020600 2.148603 1.977724 0.5932861 0.4983106 1.359835    0
## 10 1.283301 0.7781513 2.224274 2.089905 0.5932861 0.5365584 1.262451    0
## 11 1.250420 0.7781513 2.224274 2.089905 0.5932861 0.5365584 1.276462    0
## 12 1.214844 0.9030900 2.440594 2.255273 0.4871384 0.6095944 1.240549 -Inf
## 13 1.238046 0.9030900 2.440594 2.255273 0.4871384 0.5717088 1.245513 -Inf
## 14 1.181844 0.9030900 2.440594 2.255273 0.4871384 0.5774918 1.255273 -Inf
## 15 1.017033 0.9030900 2.673942 2.311754 0.4668676 0.7201593 1.254790 -Inf
## 16 1.017033 0.9030900 2.662758 2.332438 0.4771213 0.7343197 1.250908 -Inf
## 17 1.167317 0.9030900 2.643453 2.361728 0.5092025 0.7279477 1.241048 -Inf
## 18 1.510545 0.6020600 1.895975 1.819544 0.6106602 0.3424227 1.289366    0
## 19 1.482874 0.6020600 1.879096 1.716003 0.6928469 0.2081725 1.267641    0
## 20 1.530200 0.6020600 1.851870 1.812913 0.6253125 0.2636361 1.298853    0
## 21 1.332438 0.6020600 2.079543 1.986772 0.5682017 0.3918169 1.301247    0
## 22 1.190332 0.9030900 2.502427 2.176091 0.4409091 0.5465427 1.227115 -Inf
## 23 1.181844 0.9030900 2.482874 2.176091 0.4983106 0.5359267 1.238046 -Inf
## 24 1.123852 0.9030900 2.544068 2.389166 0.5717088 0.5843312 1.187803 -Inf
## 25 1.283301 0.9030900 2.602060 2.243038 0.4885507 0.5848963 1.231724 -Inf
## 26 1.436163 0.6020600 1.897627 1.819544 0.6106602 0.2866810 1.276462    0
## 27 1.414973 0.6020600 2.080266 1.959041 0.6464037 0.3304138 1.222716 -Inf
## 28 1.482874 0.6020600 1.978181 2.053078 0.5763414 0.1798389 1.227887    0
## 29 1.198657 0.9030900 2.545307 2.421604 0.6253125 0.5010593 1.161368 -Inf
## 30 1.294466 0.7781513 2.161368 2.243038 0.5587086 0.4424798 1.190332 -Inf
## 31 1.176091 0.9030900 2.478566 2.525045 0.5490033 0.5526682 1.164353 -Inf
## 32 1.330414 0.6020600 2.082785 2.037426 0.6138418 0.4440448 1.269513    0
##      am      gear      carb
## 1     0 0.6020600 0.6020600
## 2     0 0.6020600 0.6020600
## 3     0 0.6020600 0.0000000
## 4  -Inf 0.4771213 0.0000000
## 5  -Inf 0.4771213 0.3010300
## 6  -Inf 0.4771213 0.0000000
## 7  -Inf 0.4771213 0.6020600
## 8  -Inf 0.6020600 0.3010300
## 9  -Inf 0.6020600 0.3010300
## 10 -Inf 0.6020600 0.6020600
## 11 -Inf 0.6020600 0.6020600
## 12 -Inf 0.4771213 0.4771213
## 13 -Inf 0.4771213 0.4771213
## 14 -Inf 0.4771213 0.4771213
## 15 -Inf 0.4771213 0.6020600
## 16 -Inf 0.4771213 0.6020600
## 17 -Inf 0.4771213 0.6020600
## 18    0 0.6020600 0.0000000
## 19    0 0.6020600 0.3010300
## 20    0 0.6020600 0.0000000
## 21 -Inf 0.4771213 0.0000000
## 22 -Inf 0.4771213 0.3010300
## 23 -Inf 0.4771213 0.3010300
## 24 -Inf 0.4771213 0.6020600
## 25 -Inf 0.4771213 0.3010300
## 26    0 0.6020600 0.0000000
## 27    0 0.6989700 0.3010300
## 28    0 0.6989700 0.3010300
## 29    0 0.6989700 0.6020600
## 30    0 0.6989700 0.7781513
## 31    0 0.6989700 0.9030900
## 32    0 0.6020600 0.3010300</code></pre>
</div>
<div id="filter" class="section level2">
<h2>Filter</h2>
<p><code>filter_all()</code> is the most useful of the three <code>filter()</code> variants. You use it conjunction with <code>all_vars()</code> or <code>any_vars()</code> depending on whether or not you want rows where all variables meet the criterion, or where just one variable meets it.</p>
<p>It’s particularly useful finding missing values:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(nycflights13)

<span class="co"># Rows where any value is missing</span>
<span class="kw">filter_all</span>(weather, <span class="kw">any_vars</span>(<span class="kw">is.na</span>(.)))</code></pre></div>
<pre><code>## # A tibble: 3,109 x 15
##    origin  year month   day  hour  temp  dewp humid wind_dir wind_speed
##     &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt; &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;      &lt;dbl&gt;
##  1    EWR  2013     1     1    17 39.20 28.40 64.93      270   16.11092
##  2    EWR  2013     1     1    18 39.20 28.40 64.93      330   14.96014
##  3    EWR  2013     1     3    16 30.92 14.00 49.01       NA    4.60312
##  4    EWR  2013     1     6    10 33.80 30.20 86.49      210    4.60312
##  5    EWR  2013     1     6    12 33.80 32.00 93.03      220    9.20624
##  6    EWR  2013     1     6    13 35.60 32.00 86.59      240    8.05546
##  7    EWR  2013     1     6    14 35.60 32.00 86.59      230    8.05546
##  8    EWR  2013     1     6    15 37.40 30.20 74.98      250   11.50780
##  9    EWR  2013     1    11    17 44.96 35.96 70.52       NA    4.60312
## 10    EWR  2013     1    11    21 46.40 39.20 75.84       90    4.60312
## # ... with 3,099 more rows, and 5 more variables: wind_gust &lt;dbl&gt;,
## #   precip &lt;dbl&gt;, pressure &lt;dbl&gt;, visib &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Rows where all wind variables are missing</span>
<span class="kw">filter_at</span>(weather, <span class="kw">vars</span>(<span class="kw">starts_with</span>(<span class="st">&quot;wind&quot;</span>)), <span class="kw">all_vars</span>(<span class="kw">is.na</span>(.)))</code></pre></div>
<pre><code>## # A tibble: 3 x 15
##   origin  year month   day  hour  temp  dewp humid wind_dir wind_speed
##    &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt; &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;      &lt;dbl&gt;
## 1    EWR  2013     3    27    21 51.98 19.04 27.02       NA         NA
## 2    JFK  2013     7     4    10 73.04 71.06 93.52       NA         NA
## 3    JFK  2013     7    20    10 80.96 71.06 71.92       NA         NA
## # ... with 5 more variables: wind_gust &lt;dbl&gt;, precip &lt;dbl&gt;,
## #   pressure &lt;dbl&gt;, visib &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
</div>
</div>
<div id="acknowledgments" class="section level1 toc-ignore">
<h1>Acknowledgments</h1>
<ul>
<li>Scoped verbs based on <a href="https://dcl-2017-04.github.io/curriculum/manip-scoped.html">Scoped verbs by the Data Challenge Lab</a></li>
</ul>
</div>
<div id="session-info" class="section level1 toc-ignore">
<h1>Session Info</h1>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">devtools<span class="op">::</span><span class="kw">session_info</span>()</code></pre></div>
<pre><code>## Session info -------------------------------------------------------------</code></pre>
<pre><code>##  setting  value                       
##  version  R version 3.4.1 (2017-06-30)
##  system   x86_64, darwin15.6.0        
##  ui       X11                         
##  language (EN)                        
##  collate  en_US.UTF-8                 
##  tz       America/Chicago             
##  date     2017-10-17</code></pre>
<pre><code>## Packages -----------------------------------------------------------------</code></pre>
<pre><code>##  package        * version    date      
##  assertthat       0.2.0      2017-04-11
##  backports        1.1.0      2017-05-22
##  base           * 3.4.1      2017-07-07
##  bindr            0.1        2016-11-13
##  bindrcpp       * 0.2        2017-06-17
##  boxes            0.0.0.9000 2017-07-19
##  broom            0.4.2      2017-08-09
##  cellranger       1.1.0      2016-07-27
##  clisymbols       1.2.0      2017-05-21
##  codetools        0.2-15     2016-10-05
##  colorspace       1.3-2      2016-12-14
##  compiler         3.4.1      2017-07-07
##  crayon           1.3.4      2017-10-03
##  datasets       * 3.4.1      2017-07-07
##  devtools         1.13.3     2017-08-02
##  digest           0.6.12     2017-01-27
##  dplyr          * 0.7.4.9000 2017-10-03
##  evaluate         0.10.1     2017-06-24
##  forcats        * 0.2.0      2017-01-23
##  foreign          0.8-69     2017-06-22
##  ggplot2        * 2.2.1      2016-12-30
##  glue             1.1.1      2017-06-21
##  graphics       * 3.4.1      2017-07-07
##  grDevices      * 3.4.1      2017-07-07
##  grid             3.4.1      2017-07-07
##  gtable           0.2.0      2016-02-26
##  haven            1.1.0      2017-07-09
##  hms              0.3        2016-11-22
##  htmltools        0.3.6      2017-04-28
##  httr             1.3.1      2017-08-20
##  jsonlite         1.5        2017-06-01
##  knitr            1.17       2017-08-10
##  lattice          0.20-35    2017-03-25
##  lazyeval         0.2.0      2016-06-12
##  lubridate        1.6.0      2016-09-13
##  magrittr         1.5        2014-11-22
##  memoise          1.1.0      2017-04-21
##  methods        * 3.4.1      2017-07-07
##  microbenchmark * 1.4-2.1    2015-11-25
##  mnormt           1.5-5      2016-10-15
##  modelr           0.1.1      2017-08-10
##  munsell          0.4.3      2016-02-13
##  nlme             3.1-131    2017-02-06
##  nycflights13   * 0.2.2      2017-01-27
##  parallel         3.4.1      2017-07-07
##  pkgconfig        2.0.1      2017-03-21
##  plyr             1.8.4      2016-06-08
##  psych            1.7.5      2017-05-03
##  purrr          * 0.2.3      2017-08-02
##  R6               2.2.2      2017-06-17
##  Rcpp             0.12.13    2017-09-28
##  readr          * 1.1.1      2017-05-16
##  readxl           1.0.0      2017-04-18
##  reshape2         1.4.2      2016-10-22
##  rlang            0.1.2      2017-08-09
##  rmarkdown        1.6        2017-06-15
##  rprojroot        1.2        2017-01-16
##  rstudioapi       0.6        2016-06-27
##  rvest            0.3.2      2016-06-17
##  scales           0.4.1      2016-11-09
##  stats          * 3.4.1      2017-07-07
##  stringi          1.1.5      2017-04-07
##  stringr        * 1.2.0      2017-02-18
##  tibble         * 1.3.4      2017-08-22
##  tidyr          * 0.7.0      2017-08-16
##  tidyverse      * 1.1.1.9000 2017-07-19
##  tools            3.4.1      2017-07-07
##  utils          * 3.4.1      2017-07-07
##  withr            2.0.0      2017-07-28
##  xml2             1.1.1      2017-01-24
##  yaml             2.1.14     2016-11-12
##  source                              
##  CRAN (R 3.4.0)                      
##  CRAN (R 3.4.0)                      
##  local                               
##  CRAN (R 3.4.0)                      
##  CRAN (R 3.4.0)                      
##  Github (r-pkgs/boxes@03098dc)       
##  local                               
##  CRAN (R 3.4.0)                      
##  cran (@1.2.0)                       
##  CRAN (R 3.4.1)                      
##  CRAN (R 3.4.0)                      
##  local                               
##  Github (gaborcsardi/crayon@b5221ab) 
##  local                               
##  CRAN (R 3.4.1)                      
##  CRAN (R 3.4.0)                      
##  Github (tidyverse/dplyr@1a0730a)    
##  CRAN (R 3.4.1)                      
##  CRAN (R 3.4.0)                      
##  CRAN (R 3.4.1)                      
##  CRAN (R 3.4.0)                      
##  CRAN (R 3.4.1)                      
##  local                               
##  local                               
##  local                               
##  CRAN (R 3.4.0)                      
##  CRAN (R 3.4.1)                      
##  CRAN (R 3.4.0)                      
##  CRAN (R 3.4.0)                      
##  CRAN (R 3.4.1)                      
##  CRAN (R 3.4.0)                      
##  cran (@1.17)                        
##  CRAN (R 3.4.1)                      
##  CRAN (R 3.4.0)                      
##  CRAN (R 3.4.0)                      
##  CRAN (R 3.4.0)                      
##  CRAN (R 3.4.0)                      
##  local                               
##  CRAN (R 3.4.0)                      
##  CRAN (R 3.4.0)                      
##  local                               
##  CRAN (R 3.4.0)                      
##  CRAN (R 3.4.1)                      
##  CRAN (R 3.4.0)                      
##  local                               
##  CRAN (R 3.4.0)                      
##  CRAN (R 3.4.0)                      
##  CRAN (R 3.4.1)                      
##  CRAN (R 3.4.1)                      
##  CRAN (R 3.4.0)                      
##  cran (@0.12.13)                     
##  CRAN (R 3.4.0)                      
##  CRAN (R 3.4.0)                      
##  CRAN (R 3.4.0)                      
##  CRAN (R 3.4.1)                      
##  CRAN (R 3.4.0)                      
##  CRAN (R 3.4.0)                      
##  CRAN (R 3.4.0)                      
##  CRAN (R 3.4.0)                      
##  CRAN (R 3.4.0)                      
##  local                               
##  CRAN (R 3.4.0)                      
##  CRAN (R 3.4.0)                      
##  CRAN (R 3.4.1)                      
##  CRAN (R 3.4.1)                      
##  Github (tidyverse/tidyverse@a028619)
##  local                               
##  local                               
##  CRAN (R 3.4.1)                      
##  CRAN (R 3.4.0)                      
##  CRAN (R 3.4.0)</code></pre>
</div>

<p>This work is licensed under the  <a href="http://creativecommons.org/licenses/by-nc/4.0/">CC BY-NC 4.0 Creative Commons License</a>.</p>


</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
