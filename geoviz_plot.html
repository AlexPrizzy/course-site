<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />




<title>Drawing vector maps with ggplot2 and sf</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/readable.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<script src="site_libs/navigation-1.1/codefolding.js"></script>
<script src="site_libs/navigation-1.1/sourceembed.js"></script>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-45631879-2"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-45631879-2');
</script>


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' || rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>


<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
#rmd-source-code {
  display: none;
}
</style>


</head>

<body>

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 66px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 71px;
  margin-top: -71px;
}
.section h2 {
  padding-top: 71px;
  margin-top: -71px;
}
.section h3 {
  padding-top: 71px;
  margin-top: -71px;
}
.section h4 {
  padding-top: 71px;
  margin-top: -71px;
}
.section h5 {
  padding-top: 71px;
  margin-top: -71px;
}
.section h6 {
  padding-top: 71px;
  margin-top: -71px;
}
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #ffffff;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>

<div class="container-fluid main-container">

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open')
  });
});
</script>

<!-- code folding -->
<style type="text/css">
.code-folding-btn { margin-bottom: 4px; }
</style>
<script>
$(document).ready(function () {
  window.initializeSourceEmbed("geoviz_plot.Rmd");
});
</script>



<script>
$(document).ready(function ()  {

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_').toLowerCase();
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}


.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
  padding-left: 25px;
  text-indent: 0;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>

<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row-fluid">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Computing for the Social Sciences</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">Home</a>
</li>
<li>
  <a href="faq.html">FAQ</a>
</li>
<li>
  <a href="syllabus.html">Syllabus</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">

<div class="btn-group pull-right">
<button type="button" class="btn btn-default btn-xs dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span>Code</span> <span class="caret"></span></button>
<ul class="dropdown-menu" style="min-width: 50px;">
<li><a id="rmd-download-source" href="#">Download Rmd</a></li>
</ul>
</div>



<h1 class="title toc-ignore">Drawing vector maps with <code>ggplot2</code> and <code>sf</code></h1>

</div>


<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(tidyverse)
<span class="kw">library</span>(sf)

<span class="kw">options</span>(<span class="dt">digits =</span> <span class="dv">3</span>)
<span class="kw">set.seed</span>(<span class="dv">1234</span>)
<span class="kw">theme_set</span>(<span class="kw">theme_minimal</span>())</code></pre></div>
<p>Unlike <a href="geoviz_ggmap.html">raster image maps</a>, vector maps require you to obtain <a href="geoviz_import_data.html">spatial data files</a> which contain detailed information necessary to draw all the components of a map (e.g. points, lines, polygons). Once you successfully import that data into R, <code>ggplot2</code> works with simple features data frames to easily generate geospatial visualizations using all the core elements and approaches of <code>ggplot()</code>.</p>
<div id="import-usa-state-boundaries" class="section level1">
<h1>Import USA state boundaries</h1>
<p>First we will import a spatial data file containing the boundaries of all 50 states in the United States<a href="#fn1" class="footnoteRef" id="fnref1"><sup>1</sup></a> using <code>sf::st_read()</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">usa &lt;-<span class="st"> </span><span class="kw">st_read</span>(<span class="st">&quot;data/census_bureau/cb_2013_us_state_20m/cb_2013_us_state_20m.shp&quot;</span>)</code></pre></div>
<pre><code>## Reading layer `cb_2013_us_state_20m&#39; from data source `/Users/soltoffbc/Projects/Computing for Social Sciences/uc-cfss.github.io/data/census_bureau/cb_2013_us_state_20m/cb_2013_us_state_20m.shp&#39; using driver `ESRI Shapefile&#39;
## Simple feature collection with 52 features and 9 fields
## geometry type:  MULTIPOLYGON
## dimension:      XY
## bbox:           xmin: -179 ymin: 17.9 xmax: 180 ymax: 71.4
## epsg (SRID):    4269
## proj4string:    +proj=longlat +datum=NAD83 +no_defs</code></pre>
</div>
<div id="draw-the-boundaries" class="section level1">
<h1>Draw the boundaries</h1>
<p><code>ggplot2</code> contains a geometric object specifically for simple feature objects called <code>geom_sf()</code>. This works reasonably well when you need to draw <strong>polygons</strong>, like our state boundaries. Support for simple features in <code>ggplot2</code> is under active development, so you may not find adequate support for plotting line or point features. To draw the map, we pass the simple features data frame as the <code>data</code> argument.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(<span class="dt">data =</span> usa) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_sf</span>()</code></pre></div>
<p><img src="geoviz_plot_files/figure-html/geom-sf-1.png" width="672" /></p>
<p>Because simple features data frames are standardized with the <code>geometry</code> column always containing information on the geographic coordinates of the features, we do not need to specify additional parameters for <code>aes()</code>. Notice a problem with the map above: it wastes a lot of space. This is caused by the presence of Alaska and Hawaii in the dataset. The Aleutian Islands cross the the 180th meridian, requiring the map to show the Eastern hemisphere. Likewise, Hawaii is substantially distant from the continental United States.</p>
<div id="plot-a-subset-of-a-map" class="section level2">
<h2>Plot a subset of a map</h2>
<p>One solution is to plot just the lower 48 states. That is, exclude Alaska and Hawaii, as well as DC and Puerto Rico.<a href="#fn2" class="footnoteRef" id="fnref2"><sup>2</sup></a> Because simple features data frames contain one row per feature and in this example a feature is defined as a state, we can use <code>filter()</code> from <code>dplyr</code> to exclude these four states/territories.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">(usa_<span class="dv">48</span> &lt;-<span class="st"> </span>usa <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(<span class="op">!</span>(NAME <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Alaska&quot;</span>, <span class="st">&quot;District of Columbia&quot;</span>, <span class="st">&quot;Hawaii&quot;</span>, <span class="st">&quot;Puerto Rico&quot;</span>))))</code></pre></div>
<pre><code>## Simple feature collection with 48 features and 9 fields
## geometry type:  MULTIPOLYGON
## dimension:      XY
## bbox:           xmin: -125 ymin: 24.5 xmax: -66.9 ymax: 49.4
## epsg (SRID):    4269
## proj4string:    +proj=longlat +datum=NAD83 +no_defs
## First 10 features:
##    STATEFP  STATENS    AFFGEOID GEOID STUSPS        NAME LSAD    ALAND
## 1       01 01779775 0400000US01    01     AL     Alabama   00 1.31e+11
## 2       05 00068085 0400000US05    05     AR    Arkansas   00 1.35e+11
## 3       06 01779778 0400000US06    06     CA  California   00 4.03e+11
## 4       09 01779780 0400000US09    09     CT Connecticut   00 1.25e+10
## 5       12 00294478 0400000US12    12     FL     Florida   00 1.39e+11
## 6       13 01705317 0400000US13    13     GA     Georgia   00 1.49e+11
## 7       16 01779783 0400000US16    16     ID       Idaho   00 2.14e+11
## 8       17 01779784 0400000US17    17     IL    Illinois   00 1.44e+11
## 9       18 00448508 0400000US18    18     IN     Indiana   00 9.28e+10
## 10      20 00481813 0400000US20    20     KS      Kansas   00 2.12e+11
##      AWATER                       geometry
## 1  4.59e+09 MULTIPOLYGON (((-88.3 30.2,...
## 2  2.96e+09 MULTIPOLYGON (((-94.6 36.5,...
## 3  2.05e+10 MULTIPOLYGON (((-119 33.5, ...
## 4  1.82e+09 MULTIPOLYGON (((-73.7 41.1,...
## 5  3.14e+10 MULTIPOLYGON (((-80.7 24.9,...
## 6  4.95e+09 MULTIPOLYGON (((-85.6 35, -...
## 7  2.40e+09 MULTIPOLYGON (((-117 44.4, ...
## 8  6.20e+09 MULTIPOLYGON (((-91.5 40.2,...
## 9  1.54e+09 MULTIPOLYGON (((-88.1 37.9,...
## 10 1.35e+09 MULTIPOLYGON (((-102 40, -1...</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(<span class="dt">data =</span> usa_<span class="dv">48</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_sf</span>()</code></pre></div>
<p><img src="geoviz_plot_files/figure-html/usa-subset-1.png" width="672" /></p>
<p>Since the map is a <code>ggplot()</code> object, it can easily be modified like any other <code>ggplot()</code> graph. We could change the color of the map and the borders:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(<span class="dt">data =</span> usa_<span class="dv">48</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_sf</span>(<span class="dt">fill =</span> <span class="st">&quot;palegreen&quot;</span>, <span class="dt">color =</span> <span class="st">&quot;black&quot;</span>)</code></pre></div>
<p><img src="geoviz_plot_files/figure-html/usa-fill-1.png" width="672" /></p>
</div>
<div id="fiftystater" class="section level2">
<h2><code>fiftystater</code></h2>
<p>Rather than excluding them entirely, most maps of the United States place Alaska and Hawaii as <strong>insets</strong> to the south of California. Until recently, in R this was an extremely tedious task that required manually changing the latitude and longitude coordinates for these states to place them in the correct location. Fortunately several packages are now available that have already done the work for you. <a href="https://github.com/hrbrmstr/albersusa"><code>albersusa</code></a> includes the <code>usa_sf()</code> function which returns a simple features data frame which contains adjusted coordinates for Alaska and Hawaii to plot them with the mainland. It can be installed from GitHub using <code>devtools::install_github(&quot;hrbrmstr/albersusa&quot;)</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(albersusa)
<span class="kw">usa_sf</span>()</code></pre></div>
<pre><code>## Simple feature collection with 51 features and 13 fields
## geometry type:  MULTIPOLYGON
## dimension:      XY
## bbox:           xmin: -125 ymin: 20.6 xmax: -66.9 ymax: 49.4
## epsg (SRID):    4326
## proj4string:    +proj=longlat +datum=WGS84 +no_defs
## First 10 features:
##         geo_id fips_state                 name lsad census_area iso_3166_2
## 1  0400000US04         04              Arizona           113594         AZ
## 2  0400000US05         05             Arkansas            52035         AR
## 3  0400000US06         06           California           155779         CA
## 4  0400000US08         08             Colorado           103642         CO
## 5  0400000US09         09          Connecticut             4842         CT
## 6  0400000US11         11 District of Columbia               61         DC
## 7  0400000US13         13              Georgia            57513         GA
## 8  0400000US17         17             Illinois            55519         IL
## 9  0400000US18         18              Indiana            35826         IN
## 10 0400000US22         22            Louisiana            43204         LA
##      census pop_estimataes_base pop_2010 pop_2011 pop_2012 pop_2013
## 1   6392017             6392310  6411999  6472867  6556236  6634997
## 2   2915918             2915958  2922297  2938430  2949300  2958765
## 3  37253956            37254503 37336011 37701901 38062780 38431393
## 4   5029196             5029324  5048575  5119661  5191709  5272086
## 5   3574097             3574096  3579345  3590537  3594362  3599341
## 6    601723              601767   605210   620427   635040   649111
## 7   9687653             9688681  9714464  9813201  9919000  9994759
## 8  12830632            12831587 12840097 12858725 12873763 12890552
## 9   6483802             6484192  6490308  6516560  6537632  6570713
## 10  4533372             4533479  4545581  4575972  4604744  4629284
##    pop_2014                       geometry
## 1   6731484 MULTIPOLYGON (((-113 37, -1...
## 2   2966369 MULTIPOLYGON (((-94 33, -94...
## 3  38802500 MULTIPOLYGON (((-120 34, -1...
## 4   5355866 MULTIPOLYGON (((-107 41, -1...
## 5   3596677 MULTIPOLYGON (((-72.4 42, -...
## 6    658893 MULTIPOLYGON (((-77 38.8, -...
## 7  10097343 MULTIPOLYGON (((-84.8 35, -...
## 8  12880580 MULTIPOLYGON (((-89.4 42.5,...
## 9   6596855 MULTIPOLYGON (((-84.8 40.4,...
## 10  4649676 MULTIPOLYGON (((-88.9 29.8,...</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(<span class="dt">data =</span> <span class="kw">usa_sf</span>()) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_sf</span>()</code></pre></div>
<p><img src="geoviz_plot_files/figure-html/albersusa-1.png" width="672" /></p>
</div>
</div>
<div id="add-data-to-the-map" class="section level1">
<h1>Add data to the map</h1>
<p>Region boundaries serve as the background in geospatial data visualization - so now we need to add data. Some types of geographic data (points and symbols) are overlaid on top of the boundaries, whereas other data (fill) are incorporated into the region layer itself.</p>
<div id="points" class="section level2">
<h2>Points</h2>
<p>Let’s use our <code>usa_48</code> map data to add some points. The <code>airports</code> data frame in the <code>nycflights13</code> package includes geographic info on airports in the United States.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(nycflights13)
airports</code></pre></div>
<pre><code>## # A tibble: 1,458 x 8
##    faa   name                   lat    lon   alt    tz dst   tzone        
##    &lt;chr&gt; &lt;chr&gt;                &lt;dbl&gt;  &lt;dbl&gt; &lt;int&gt; &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;        
##  1 04G   Lansdowne Airport     41.1  -80.6  1044    -5 A     America/New_…
##  2 06A   Moton Field Municip…  32.5  -85.7   264    -6 A     America/Chic…
##  3 06C   Schaumburg Regional   42.0  -88.1   801    -6 A     America/Chic…
##  4 06N   Randall Airport       41.4  -74.4   523    -5 A     America/New_…
##  5 09J   Jekyll Island Airpo…  31.1  -81.4    11    -5 A     America/New_…
##  6 0A9   Elizabethton Munici…  36.4  -82.2  1593    -5 A     America/New_…
##  7 0G6   Williams County Air…  41.5  -84.5   730    -5 A     America/New_…
##  8 0G7   Finger Lakes Region…  42.9  -76.8   492    -5 A     America/New_…
##  9 0P2   Shoestring Aviation…  39.8  -76.6  1000    -5 U     America/New_…
## 10 0S9   Jefferson County In…  48.1 -123.    108    -8 A     America/Los_…
## # ... with 1,448 more rows</code></pre>
<p>Each airport has it’s geographic location encoded through <code>lat</code> and <code>lon</code>. To draw these points on the map, basically we draw a scatterplot with <code>x = lon</code> and <code>y = lat</code>. In fact we could simply do that:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(airports, <span class="kw">aes</span>(lon, lat)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>()</code></pre></div>
<p><img src="geoviz_plot_files/figure-html/scatter-1.png" width="672" /></p>
<p>Let’s overlay it with the mapped state borders:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(<span class="dt">data =</span> usa_<span class="dv">48</span>) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_sf</span>() <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">data =</span> airports, <span class="kw">aes</span>(<span class="dt">x =</span> lon, <span class="dt">y =</span> lat), <span class="dt">shape =</span> <span class="dv">1</span>)</code></pre></div>
<p><img src="geoviz_plot_files/figure-html/flights-usa-1.png" width="672" /></p>
<p>Slight problem. We have airports listed outside of the continental United States. There are a couple ways to rectify this. Unfortunately <code>airports</code> does not include a variable identifying state so the <code>filter()</code> operation is not that simple. The easiest solution is to crop the limits of the graph using <code>coord_sf()</code> to only show the mainland:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(<span class="dt">data =</span> usa_<span class="dv">48</span>) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_sf</span>() <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">data =</span> airports, <span class="kw">aes</span>(<span class="dt">x =</span> lon, <span class="dt">y =</span> lat), <span class="dt">shape =</span> <span class="dv">1</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">coord_sf</span>(<span class="dt">xlim =</span> <span class="kw">c</span>(<span class="op">-</span><span class="dv">130</span>, <span class="op">-</span><span class="dv">60</span>),
           <span class="dt">ylim =</span> <span class="kw">c</span>(<span class="dv">20</span>, <span class="dv">50</span>))</code></pre></div>
<p><img src="geoviz_plot_files/figure-html/crop-1.png" width="672" /></p>
<p>Alternatively, we can use <code>st_as_sf()</code> to convert <code>airports</code> to a simple features data frame.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">airports_sf &lt;-<span class="st"> </span><span class="kw">st_as_sf</span>(airports, <span class="dt">coords =</span> <span class="kw">c</span>(<span class="st">&quot;lon&quot;</span>, <span class="st">&quot;lat&quot;</span>))
<span class="kw">st_crs</span>(airports_sf) &lt;-<span class="st"> </span><span class="dv">4326</span>   <span class="co"># set the coordinate reference system</span>
airports_sf</code></pre></div>
<pre><code>## Simple feature collection with 1458 features and 6 fields
## geometry type:  POINT
## dimension:      XY
## bbox:           xmin: -177 ymin: 19.7 xmax: 174 ymax: 72.3
## epsg (SRID):    4326
## proj4string:    +proj=longlat +datum=WGS84 +no_defs
## # A tibble: 1,458 x 7
##    faa   name              alt    tz dst   tzone                  geometry
##    &lt;chr&gt; &lt;chr&gt;           &lt;int&gt; &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;               &lt;POINT [°]&gt;
##  1 04G   Lansdowne Airp…  1044    -5 A     America/N…         (-80.6 41.1)
##  2 06A   Moton Field Mu…   264    -6 A     America/C…         (-85.7 32.5)
##  3 06C   Schaumburg Reg…   801    -6 A     America/C…           (-88.1 42)
##  4 06N   Randall Airport   523    -5 A     America/N…         (-74.4 41.4)
##  5 09J   Jekyll Island …    11    -5 A     America/N…         (-81.4 31.1)
##  6 0A9   Elizabethton M…  1593    -5 A     America/N…         (-82.2 36.4)
##  7 0G6   Williams Count…   730    -5 A     America/N…         (-84.5 41.5)
##  8 0G7   Finger Lakes R…   492    -5 A     America/N…         (-76.8 42.9)
##  9 0P2   Shoestring Avi…  1000    -5 U     America/N…         (-76.6 39.8)
## 10 0S9   Jefferson Coun…   108    -8 A     America/L…          (-123 48.1)
## # ... with 1,448 more rows</code></pre>
<p><code>coords</code> tells <code>st_as_sf()</code> which columns contain the geographic coordinates of each airport. To graph the points on the map, we use a second <code>geom_sf()</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>() <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_sf</span>(<span class="dt">data =</span> usa_<span class="dv">48</span>) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_sf</span>(<span class="dt">data =</span> airports_sf, <span class="dt">shape =</span> <span class="dv">1</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">coord_sf</span>(<span class="dt">xlim =</span> <span class="kw">c</span>(<span class="op">-</span><span class="dv">130</span>, <span class="op">-</span><span class="dv">60</span>),
           <span class="dt">ylim =</span> <span class="kw">c</span>(<span class="dv">20</span>, <span class="dv">50</span>))</code></pre></div>
<p><img src="geoviz_plot_files/figure-html/flights-sf-plot-1.png" width="672" /></p>
</div>
<div id="symbols" class="section level2">
<h2>Symbols</h2>
<p>We can change the size or type of symbols on the map. For instance, we can draw a <strong>bubble plot</strong> (also known as a <strong>proportional symbol map</strong>) and encode the altitude of the airport through the size channel:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(<span class="dt">data =</span> usa_<span class="dv">48</span>) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_sf</span>() <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">data =</span> airports, <span class="kw">aes</span>(<span class="dt">x =</span> lon, <span class="dt">y =</span> lat, <span class="dt">size =</span> alt),
             <span class="dt">fill =</span> <span class="st">&quot;grey&quot;</span>, <span class="dt">color =</span> <span class="st">&quot;black&quot;</span>, <span class="dt">alpha =</span> .<span class="dv">2</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">coord_sf</span>(<span class="dt">xlim =</span> <span class="kw">c</span>(<span class="op">-</span><span class="dv">130</span>, <span class="op">-</span><span class="dv">60</span>),
           <span class="dt">ylim =</span> <span class="kw">c</span>(<span class="dv">20</span>, <span class="dv">50</span>)) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_size_area</span>(<span class="dt">guide =</span> <span class="ot">FALSE</span>)</code></pre></div>
<p><img src="geoviz_plot_files/figure-html/airport-alt-1.png" width="672" /></p>
<p>Circle area is proportional to the airport’s altitude (in feet). Or we could scale it based on the number of arriving flights in <code>flights</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">airports_n &lt;-<span class="st"> </span>flights <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">count</span>(dest) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">left_join</span>(airports, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;dest&quot;</span> =<span class="st"> &quot;faa&quot;</span>))

<span class="kw">ggplot</span>(<span class="dt">data =</span> usa_<span class="dv">48</span>) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_sf</span>() <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">data =</span> airports_n, <span class="kw">aes</span>(<span class="dt">x =</span> lon, <span class="dt">y =</span> lat, <span class="dt">size =</span> n),
             <span class="dt">fill =</span> <span class="st">&quot;grey&quot;</span>, <span class="dt">color =</span> <span class="st">&quot;black&quot;</span>, <span class="dt">alpha =</span> .<span class="dv">2</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">coord_sf</span>(<span class="dt">xlim =</span> <span class="kw">c</span>(<span class="op">-</span><span class="dv">130</span>, <span class="op">-</span><span class="dv">60</span>),
           <span class="dt">ylim =</span> <span class="kw">c</span>(<span class="dv">20</span>, <span class="dv">50</span>)) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_size_area</span>(<span class="dt">guide =</span> <span class="ot">FALSE</span>)</code></pre></div>
<p><img src="geoviz_plot_files/figure-html/airport-dest-1.png" width="672" /></p>
<blockquote>
<p><code>airports</code> contains a list of virtually all commercial airports in the United States. However <code>flights</code> only contains data on flights departing from New York City airports (JFK, LaGuardia, or Newark) and only services a few airports around the country.</p>
</blockquote>
</div>
<div id="fill-choropleths" class="section level2">
<h2>Fill (choropleths)</h2>
<p><strong>Choropleth maps</strong> encode information by assigning shades of colors to defined areas on a map (e.g. countries, states, counties, zip codes). There are lots of ways to tweak and customize these graphs, which is generally a good idea because remember that color is one of the harder-to-decode channels.</p>
<p>We will continue to use the <code>usa_48</code> simple features data frame and draw a choropleth for the number of foreign-born individuals in each state. We get those files from the <code>census_bureau</code> folder. Let’s also normalize our measure by the total population to get the rate of foreign-born individuals in the population:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">(fb_state &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">&quot;data/census_bureau/ACS_13_5YR_B05012_state/ACS_13_5YR_B05012.csv&quot;</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">rate =</span> HD01_VD03 <span class="op">/</span><span class="st"> </span>HD01_VD01))</code></pre></div>
<pre><code>## # A tibble: 51 x 10
##    GEO.id GEO.id2 `GEO.display-la… HD01_VD01 HD02_VD01 HD01_VD02 HD02_VD02
##    &lt;chr&gt;  &lt;chr&gt;   &lt;chr&gt;                &lt;int&gt; &lt;chr&gt;         &lt;int&gt;     &lt;int&gt;
##  1 04000… 01      Alabama            4799277 &lt;NA&gt;        4631045      2881
##  2 04000… 02      Alaska              720316 &lt;NA&gt;         669941      1262
##  3 04000… 04      Arizona            6479703 &lt;NA&gt;        5609835      7725
##  4 04000… 05      Arkansas           2933369 &lt;NA&gt;        2799972      2568
##  5 04000… 06      California        37659181 &lt;NA&gt;       27483342     30666
##  6 04000… 08      Colorado           5119329 &lt;NA&gt;        4623809      5778
##  7 04000… 09      Connecticut        3583561 &lt;NA&gt;        3096374      5553
##  8 04000… 10      Delaware            908446 &lt;NA&gt;         831683      2039
##  9 04000… 11      District of Col…    619371 &lt;NA&gt;         534142      2017
## 10 04000… 12      Florida           19091156 &lt;NA&gt;       15392410     16848
## # ... with 41 more rows, and 3 more variables: HD01_VD03 &lt;int&gt;,
## #   HD02_VD03 &lt;int&gt;, rate &lt;dbl&gt;</code></pre>
<div id="join-the-data" class="section level3">
<h3>Join the data</h3>
<p>Now that we have our data, we want to draw it on the map. <code>fb_state</code> contains one row per state, as does <code>usa_48</code>. Since there is a one-to-one match between the data frames, we join the data frames together first, then use that single data frame to draw the map. This differs from the approach above for drawing points because a point feature is not the same thing as a polygon feature. That is, there were more airports then there were states. Because the spatial data is stored in a data frame with one row per state, all we need to do is merge the data frames together on a column that uniquely identifies each row in each data frame.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">(usa_fb &lt;-<span class="st"> </span>usa_<span class="dv">48</span> <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">left_join</span>(fb_state, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;STATEFP&quot;</span> =<span class="st"> &quot;GEO.id2&quot;</span>)))</code></pre></div>
<pre><code>## Simple feature collection with 48 features and 18 fields
## geometry type:  MULTIPOLYGON
## dimension:      XY
## bbox:           xmin: -125 ymin: 24.5 xmax: -66.9 ymax: 49.4
## epsg (SRID):    4269
## proj4string:    +proj=longlat +datum=NAD83 +no_defs
## First 10 features:
##    STATEFP  STATENS    AFFGEOID GEOID STUSPS        NAME LSAD    ALAND
## 1       01 01779775 0400000US01    01     AL     Alabama   00 1.31e+11
## 2       05 00068085 0400000US05    05     AR    Arkansas   00 1.35e+11
## 3       06 01779778 0400000US06    06     CA  California   00 4.03e+11
## 4       09 01779780 0400000US09    09     CT Connecticut   00 1.25e+10
## 5       12 00294478 0400000US12    12     FL     Florida   00 1.39e+11
## 6       13 01705317 0400000US13    13     GA     Georgia   00 1.49e+11
## 7       16 01779783 0400000US16    16     ID       Idaho   00 2.14e+11
## 8       17 01779784 0400000US17    17     IL    Illinois   00 1.44e+11
## 9       18 00448508 0400000US18    18     IN     Indiana   00 9.28e+10
## 10      20 00481813 0400000US20    20     KS      Kansas   00 2.12e+11
##      AWATER      GEO.id GEO.display-label HD01_VD01 HD02_VD01 HD01_VD02
## 1  4.59e+09 0400000US01           Alabama   4799277      &lt;NA&gt;   4631045
## 2  2.96e+09 0400000US05          Arkansas   2933369      &lt;NA&gt;   2799972
## 3  2.05e+10 0400000US06        California  37659181      &lt;NA&gt;  27483342
## 4  1.82e+09 0400000US09       Connecticut   3583561      &lt;NA&gt;   3096374
## 5  3.14e+10 0400000US12           Florida  19091156      &lt;NA&gt;  15392410
## 6  4.95e+09 0400000US13           Georgia   9810417      &lt;NA&gt;   8859747
## 7  2.40e+09 0400000US16             Idaho   1583364      &lt;NA&gt;   1489560
## 8  6.20e+09 0400000US17          Illinois  12848554      &lt;NA&gt;  11073828
## 9  1.54e+09 0400000US18           Indiana   6514861      &lt;NA&gt;   6206801
## 10 1.35e+09 0400000US20            Kansas   2868107      &lt;NA&gt;   2677007
##    HD02_VD02 HD01_VD03 HD02_VD03   rate                       geometry
## 1       2881    168232      2881 0.0351 MULTIPOLYGON (((-88.3 30.2,...
## 2       2568    133397      2568 0.0455 MULTIPOLYGON (((-94.6 36.5,...
## 3      30666  10175839     30666 0.2702 MULTIPOLYGON (((-119 33.5, ...
## 4       5553    487187      5553 0.1360 MULTIPOLYGON (((-73.7 41.1,...
## 5      16848   3698746     16848 0.1937 MULTIPOLYGON (((-80.7 24.9,...
## 6       7988    950670      7988 0.0969 MULTIPOLYGON (((-85.6 35, -...
## 7       2528     93804      2528 0.0592 MULTIPOLYGON (((-117 44.4, ...
## 8      10091   1774726     10093 0.1381 MULTIPOLYGON (((-91.5 40.2,...
## 9       4499    308060      4500 0.0473 MULTIPOLYGON (((-88.1 37.9,...
## 10      3095    191100      3100 0.0666 MULTIPOLYGON (((-102 40, -1...</code></pre>
</div>
<div id="draw-the-map" class="section level3">
<h3>Draw the map</h3>
<p>With the newly combined data frame, use <code>geom_sf()</code> and define the <code>fill</code> aesthetic based on the column in <code>usa_fb</code> you want to visualize.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(<span class="dt">data =</span> usa_fb) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_sf</span>(<span class="kw">aes</span>(<span class="dt">fill =</span> rate))</code></pre></div>
<p><img src="geoviz_plot_files/figure-html/geom-map-state-1.png" width="672" /></p>
</div>
<div id="bin-data-to-discrete-intervals" class="section level3">
<h3>Bin data to discrete intervals</h3>
<p>When creating a heatmap with a continuous variable, one must decide whether to keep the variable as continuous or collapse it into a series of bins with discrete colors. While keep the variable continuous is technically more precise, <a href="https://www.perceptualedge.com/articles/visual_business_intelligence/heatmaps_to_bin_or_not.pdf">the human eye cannot usually distinguish between two colors which are very similar to one another.</a> By converting the variable to a discrete variable, you easily distinguish between the different levels. If you decide to convert a continuous variable to a discrete variable, you will need to decide how to do this. While <code>cut()</code> is a base R function for converting continuous variables into discrete values, <code>ggplot2</code> offers two functions that explicitly define how we want to bin the numeric vector (column).</p>
<p><code>cut_interval()</code> makes <code>n</code> groups with equal range:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">usa_fb <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">rate_cut =</span> <span class="kw">cut_interval</span>(rate, <span class="dv">6</span>)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ggplot</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_sf</span>(<span class="kw">aes</span>(<span class="dt">fill =</span> rate_cut))</code></pre></div>
<p><img src="geoviz_plot_files/figure-html/cut-interval-1.png" width="672" /></p>
<p>Whereas <code>cut_number()</code> makes <code>n</code> groups with (approximately) equal numbers of observations:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">usa_fb <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">rate_cut =</span> <span class="kw">cut_number</span>(rate, <span class="dv">6</span>)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ggplot</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_sf</span>(<span class="kw">aes</span>(<span class="dt">fill =</span> rate_cut))</code></pre></div>
<p><img src="geoviz_plot_files/figure-html/cut-number-1.png" width="672" /></p>
<blockquote>
<p>See <a href="https://gis.stackexchange.com/questions/86668/should-i-use-a-discrete-or-continuous-scale-for-coloring-a-chloropleth">this StackOverflow thread</a> for a more in-depth discussion on the merits of bucketizing a continuous variable and whether to use <code>cut_interval()</code> or <code>cut_number()</code>.</p>
</blockquote>
</div>
</div>
</div>
<div id="changing-map-projection" class="section level1">
<h1>Changing map projection</h1>
<iframe width="560" height="315" src="https://www.youtube.com/embed/vVX-PrBRtTY?rel=0" frameborder="0" allowfullscreen>
</iframe>
<div class="figure">
<img src="https://imgs.xkcd.com/comics/mercator_projection.png" alt="Mercator Projection" />
<p class="caption"><a href="https://xkcd.com/2082/">Mercator Projection</a></p>
</div>
<p>Representing portions of the globe on a flat surface can be challenging. Depending on how you project the map, you can distort or emphasize certain features of the map. Fortunately, <code>ggplot()</code> includes the <code>coord_sf()</code> function which allows us to easily implement different projection methods. In order to implement coordinate transformations, you need to know the <strong>coordinate reference system</strong> that defines the projection method. The “easiest” approach is to provide what is known as the <code>proj4string</code> that defines the projection method. <a href="https://proj4.org/">PROJ4</a> is a generic coordinate transformation software that allows you to convert between projection methods. If you get really into geospatial analysis and visualization, it is helpful to learn this system.</p>
<p>For our purposes here, <code>proj4string</code> is a character string in R that defines the coordinate system and includes parameters specific to a given coordinate transformation. PROJ4 includes <a href="https://proj4.org/operations/projections/index.html">some documentation on common projection methods</a> that can get you started. Some projection methods are relatively simple and require just the name of the projection, like for a <a href="https://proj4.org/operations/projections/merc.html">Mercator projection</a> (<code>&quot;+proj=merc&quot;</code>):</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">map_proj_base &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> usa_<span class="dv">48</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_sf</span>()</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">map_proj_base <span class="op">+</span>
<span class="st">  </span><span class="kw">coord_sf</span>(<span class="dt">crs =</span> <span class="st">&quot;+proj=merc&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">ggtitle</span>(<span class="st">&quot;Mercator projection&quot;</span>)</code></pre></div>
<p><img src="geoviz_plot_files/figure-html/mercator-1.png" width="672" /></p>
<p>Other coordinate systems require specification of the <strong>standard lines</strong>, or lines that define areas of the surface of the map that are tangent to the globe. These include <a href="http://spatialreference.org/ref/sr-org/gall-peters-orthographic-projection/proj4/">Gall-Peters</a>, <a href="https://proj4.org/operations/projections/aea.html">Albers equal-area</a>, and <a href="https://proj4.org/operations/projections/laea.html">Lambert azimuthal</a>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">map_proj_base <span class="op">+</span>
<span class="st">  </span><span class="kw">coord_sf</span>(<span class="dt">crs =</span> <span class="st">&quot;+proj=cea +lon_0=0 +lat_ts=45&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">ggtitle</span>(<span class="st">&quot;Gall-Peters projection&quot;</span>)</code></pre></div>
<p><img src="geoviz_plot_files/figure-html/projection-rest-1.png" width="672" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">map_proj_base <span class="op">+</span>
<span class="st">  </span><span class="kw">coord_sf</span>(<span class="dt">crs =</span> <span class="st">&quot;+proj=aea +lat_1=25 +lat_2=50 +lon_0=-100&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">ggtitle</span>(<span class="st">&quot;Albers equal-area projection&quot;</span>)</code></pre></div>
<p><img src="geoviz_plot_files/figure-html/projection-rest-2.png" width="672" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">map_proj_base <span class="op">+</span>
<span class="st">  </span><span class="kw">coord_sf</span>(<span class="dt">crs =</span> <span class="st">&quot;+proj=laea +lat_0=35 +lon_0=-100&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">ggtitle</span>(<span class="st">&quot;Lambert azimuthal projection&quot;</span>)</code></pre></div>
<p><img src="geoviz_plot_files/figure-html/projection-rest-3.png" width="672" /></p>
</div>
<div id="session-info" class="section level1 toc-ignore">
<h1>Session Info</h1>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">devtools<span class="op">::</span><span class="kw">session_info</span>()</code></pre></div>
<pre><code>## ─ Session info ──────────────────────────────────────────────────────────
##  setting  value                       
##  version  R version 3.5.2 (2018-12-20)
##  os       macOS Mojave 10.14.3        
##  system   x86_64, darwin15.6.0        
##  ui       X11                         
##  language (EN)                        
##  collate  en_US.UTF-8                 
##  ctype    en_US.UTF-8                 
##  tz       America/Chicago             
##  date     2019-02-26                  
## 
## ─ Packages ──────────────────────────────────────────────────────────────
##  package      * version    date       lib
##  albersusa    * 0.3.1      2019-02-26 [1]
##  assertthat     0.2.0      2017-04-11 [2]
##  backports      1.1.3      2018-12-14 [2]
##  base64enc      0.1-3      2015-07-28 [2]
##  bindr          0.1.1      2018-03-13 [2]
##  bindrcpp     * 0.2.2      2018-03-29 [1]
##  broom          0.5.1      2018-12-05 [2]
##  callr          3.1.1      2018-12-21 [2]
##  cellranger     1.1.0      2016-07-27 [2]
##  class          7.3-15     2019-01-01 [2]
##  classInt       0.3-1      2018-12-18 [2]
##  cli            1.0.1      2018-09-25 [1]
##  codetools      0.2-16     2018-12-24 [2]
##  colorspace     1.4-0      2019-01-13 [2]
##  crayon         1.3.4      2017-09-16 [2]
##  DBI            1.0.0      2018-05-02 [2]
##  desc           1.2.0      2018-05-01 [2]
##  devtools       2.0.1      2018-10-26 [1]
##  digest         0.6.18     2018-10-10 [1]
##  dplyr        * 0.8.0.1    2019-02-15 [1]
##  e1071          1.7-0.1    2019-01-21 [1]
##  evaluate       0.13       2019-02-12 [2]
##  fiftystater  * 1.0.1      2016-11-14 [2]
##  forcats      * 0.4.0      2019-02-17 [2]
##  foreign        0.8-71     2018-07-20 [2]
##  fs             1.2.6      2018-08-23 [1]
##  generics       0.0.2      2018-11-29 [1]
##  ggplot2      * 3.1.0      2018-10-25 [1]
##  glue           1.3.0      2018-07-17 [2]
##  gtable         0.2.0      2016-02-26 [2]
##  haven          2.1.0      2019-02-19 [2]
##  hms            0.4.2      2018-03-10 [2]
##  htmltools      0.3.6      2017-04-28 [1]
##  httr           1.4.0      2018-12-11 [2]
##  jsonlite       1.6        2018-12-07 [2]
##  knitr          1.21       2018-12-10 [2]
##  lattice        0.20-38    2018-11-04 [2]
##  lazyeval       0.2.1      2017-10-29 [2]
##  lubridate      1.7.4      2018-04-11 [2]
##  magrittr       1.5        2014-11-22 [2]
##  maptools       0.9-5      2019-02-18 [1]
##  memoise        1.1.0      2017-04-21 [2]
##  modelr         0.1.4      2019-02-18 [2]
##  munsell        0.5.0      2018-06-12 [2]
##  nlme           3.1-137    2018-04-07 [2]
##  nycflights13 * 1.0.0      2018-06-26 [2]
##  pillar         1.3.1      2018-12-15 [2]
##  pkgbuild       1.0.2      2018-10-16 [1]
##  pkgconfig      2.0.2      2018-08-16 [2]
##  pkgload        1.0.2      2018-10-29 [1]
##  plyr           1.8.4      2016-06-08 [2]
##  prettyunits    1.0.2      2015-07-13 [2]
##  processx       3.2.1      2018-12-05 [2]
##  ps             1.3.0      2018-12-21 [2]
##  purrr        * 0.3.0      2019-01-27 [2]
##  R6             2.4.0      2019-02-14 [1]
##  Rcpp           1.0.0      2018-11-07 [1]
##  readr        * 1.3.1      2018-12-21 [2]
##  readxl         1.3.0      2019-02-15 [2]
##  remotes        2.0.2      2018-10-30 [1]
##  rgdal          1.3-9      2019-02-21 [1]
##  rgeos          0.4-2      2018-11-08 [1]
##  rlang          0.3.1      2019-01-08 [1]
##  rmarkdown      1.11       2018-12-08 [2]
##  rprojroot      1.3-2      2018-01-03 [2]
##  rstudioapi     0.9.0      2019-01-09 [1]
##  rvest          0.3.2      2016-06-17 [2]
##  scales         1.0.0      2018-08-09 [1]
##  sessioninfo    1.1.1      2018-11-05 [1]
##  sf           * 0.7-3      2019-02-21 [1]
##  sp             1.3-1      2018-06-05 [2]
##  stringi        1.3.1      2019-02-13 [1]
##  stringr      * 1.4.0      2019-02-10 [1]
##  testthat       2.0.1      2018-10-13 [2]
##  tibble       * 2.0.1      2019-01-12 [2]
##  tidyr        * 0.8.2.9000 2019-02-11 [1]
##  tidyselect     0.2.5      2018-10-11 [1]
##  tidyverse    * 1.2.1      2017-11-14 [2]
##  units          0.6-2      2018-12-05 [1]
##  usethis        1.4.0      2018-08-14 [1]
##  withr          2.1.2      2018-03-15 [2]
##  xfun           0.5        2019-02-20 [1]
##  xml2           1.2.0      2018-01-24 [2]
##  yaml           2.2.0      2018-07-25 [2]
##  source                             
##  Github (hrbrmstr/albersusa@5b933bf)
##  CRAN (R 3.5.0)                     
##  CRAN (R 3.5.0)                     
##  CRAN (R 3.5.0)                     
##  CRAN (R 3.5.0)                     
##  CRAN (R 3.5.0)                     
##  CRAN (R 3.5.0)                     
##  CRAN (R 3.5.0)                     
##  CRAN (R 3.5.0)                     
##  CRAN (R 3.5.2)                     
##  CRAN (R 3.5.0)                     
##  CRAN (R 3.5.0)                     
##  CRAN (R 3.5.2)                     
##  CRAN (R 3.5.2)                     
##  CRAN (R 3.5.0)                     
##  CRAN (R 3.5.0)                     
##  CRAN (R 3.5.0)                     
##  CRAN (R 3.5.1)                     
##  CRAN (R 3.5.0)                     
##  CRAN (R 3.5.2)                     
##  CRAN (R 3.5.2)                     
##  CRAN (R 3.5.2)                     
##  CRAN (R 3.5.0)                     
##  CRAN (R 3.5.2)                     
##  CRAN (R 3.5.2)                     
##  CRAN (R 3.5.0)                     
##  CRAN (R 3.5.0)                     
##  CRAN (R 3.5.0)                     
##  CRAN (R 3.5.0)                     
##  CRAN (R 3.5.0)                     
##  CRAN (R 3.5.2)                     
##  CRAN (R 3.5.0)                     
##  CRAN (R 3.5.0)                     
##  CRAN (R 3.5.0)                     
##  CRAN (R 3.5.0)                     
##  CRAN (R 3.5.1)                     
##  CRAN (R 3.5.2)                     
##  CRAN (R 3.5.0)                     
##  CRAN (R 3.5.0)                     
##  CRAN (R 3.5.0)                     
##  CRAN (R 3.5.2)                     
##  CRAN (R 3.5.0)                     
##  CRAN (R 3.5.2)                     
##  CRAN (R 3.5.0)                     
##  CRAN (R 3.5.2)                     
##  CRAN (R 3.5.0)                     
##  CRAN (R 3.5.0)                     
##  CRAN (R 3.5.0)                     
##  CRAN (R 3.5.1)                     
##  CRAN (R 3.5.0)                     
##  CRAN (R 3.5.0)                     
##  CRAN (R 3.5.0)                     
##  CRAN (R 3.5.0)                     
##  CRAN (R 3.5.0)                     
##  CRAN (R 3.5.2)                     
##  CRAN (R 3.5.2)                     
##  CRAN (R 3.5.0)                     
##  CRAN (R 3.5.0)                     
##  CRAN (R 3.5.2)                     
##  CRAN (R 3.5.0)                     
##  CRAN (R 3.5.2)                     
##  CRAN (R 3.5.0)                     
##  CRAN (R 3.5.2)                     
##  CRAN (R 3.5.0)                     
##  CRAN (R 3.5.0)                     
##  CRAN (R 3.5.2)                     
##  CRAN (R 3.5.0)                     
##  CRAN (R 3.5.0)                     
##  CRAN (R 3.5.0)                     
##  CRAN (R 3.5.2)                     
##  CRAN (R 3.5.0)                     
##  CRAN (R 3.5.2)                     
##  CRAN (R 3.5.2)                     
##  CRAN (R 3.5.0)                     
##  CRAN (R 3.5.2)                     
##  Github (tidyverse/tidyr@0b27690)   
##  CRAN (R 3.5.0)                     
##  CRAN (R 3.5.0)                     
##  CRAN (R 3.5.0)                     
##  CRAN (R 3.5.0)                     
##  CRAN (R 3.5.0)                     
##  CRAN (R 3.5.2)                     
##  CRAN (R 3.5.0)                     
##  CRAN (R 3.5.0)                     
## 
## [1] /Users/soltoffbc/Library/R/3.5/library
## [2] /Library/Frameworks/R.framework/Versions/3.5/Resources/library</code></pre>
</div>
<div class="footnotes">
<hr />
<ol>
<li id="fn1"><p>Plus the District of Columbia and Puerto Rico<a href="#fnref1">↩</a></p></li>
<li id="fn2"><p>Issues of political sovereignty aside, these entities are frequently excluded from maps depending on the data to be incorporated. You can always choose to leave them in the map.<a href="#fnref2">↩</a></p></li>
</ol>
</div>

<div id="rmd-source-code">LS0tCnRpdGxlOiAiRHJhd2luZyB2ZWN0b3IgbWFwcyB3aXRoIGBnZ3Bsb3QyYCBhbmQgYHNmYCIKb3V0cHV0OgogIGh0bWxfZG9jdW1lbnQ6CiAgICB0b2M6IHRydWUKICAgIHRvY19mbG9hdDogdHJ1ZQotLS0KCmBgYHtyIHNldHVwLCBpbmNsdWRlID0gRkFMU0V9CmtuaXRyOjpvcHRzX2NodW5rJHNldChjYWNoZSA9IFRSVUUsIHdhcm5pbmcgPSBGQUxTRSwgbWVzc2FnZSA9IEZBTFNFKQpgYGAKCmBgYHtyIHBhY2thZ2VzLCBjYWNoZSA9IEZBTFNFLCBtZXNzYWdlID0gRkFMU0V9CmxpYnJhcnkodGlkeXZlcnNlKQpsaWJyYXJ5KHNmKQoKb3B0aW9ucyhkaWdpdHMgPSAzKQpzZXQuc2VlZCgxMjM0KQp0aGVtZV9zZXQodGhlbWVfbWluaW1hbCgpKQpgYGAKClVubGlrZSBbcmFzdGVyIGltYWdlIG1hcHNdKGdlb3Zpel9nZ21hcC5odG1sKSwgdmVjdG9yIG1hcHMgcmVxdWlyZSB5b3UgdG8gb2J0YWluIFtzcGF0aWFsIGRhdGEgZmlsZXNdKGdlb3Zpel9pbXBvcnRfZGF0YS5odG1sKSB3aGljaCBjb250YWluIGRldGFpbGVkIGluZm9ybWF0aW9uIG5lY2Vzc2FyeSB0byBkcmF3IGFsbCB0aGUgY29tcG9uZW50cyBvZiBhIG1hcCAoZS5nLiBwb2ludHMsIGxpbmVzLCBwb2x5Z29ucykuIE9uY2UgeW91IHN1Y2Nlc3NmdWxseSBpbXBvcnQgdGhhdCBkYXRhIGludG8gUiwgYGdncGxvdDJgIHdvcmtzIHdpdGggc2ltcGxlIGZlYXR1cmVzIGRhdGEgZnJhbWVzIHRvIGVhc2lseSBnZW5lcmF0ZSBnZW9zcGF0aWFsIHZpc3VhbGl6YXRpb25zIHVzaW5nIGFsbCB0aGUgY29yZSBlbGVtZW50cyBhbmQgYXBwcm9hY2hlcyBvZiBgZ2dwbG90KClgLgoKIyBJbXBvcnQgVVNBIHN0YXRlIGJvdW5kYXJpZXMKCkZpcnN0IHdlIHdpbGwgaW1wb3J0IGEgc3BhdGlhbCBkYXRhIGZpbGUgY29udGFpbmluZyB0aGUgYm91bmRhcmllcyBvZiBhbGwgNTAgc3RhdGVzIGluIHRoZSBVbml0ZWQgU3RhdGVzXltQbHVzIHRoZSBEaXN0cmljdCBvZiBDb2x1bWJpYSBhbmQgUHVlcnRvIFJpY29dIHVzaW5nIGBzZjo6c3RfcmVhZCgpYDoKCmBgYHtyIGltcG9ydC11c2F9CnVzYSA8LSBzdF9yZWFkKCJkYXRhL2NlbnN1c19idXJlYXUvY2JfMjAxM191c19zdGF0ZV8yMG0vY2JfMjAxM191c19zdGF0ZV8yMG0uc2hwIikKYGBgCgojIERyYXcgdGhlIGJvdW5kYXJpZXMKCmBnZ3Bsb3QyYCBjb250YWlucyBhIGdlb21ldHJpYyBvYmplY3Qgc3BlY2lmaWNhbGx5IGZvciBzaW1wbGUgZmVhdHVyZSBvYmplY3RzIGNhbGxlZCBgZ2VvbV9zZigpYC4gVGhpcyB3b3JrcyByZWFzb25hYmx5IHdlbGwgd2hlbiB5b3UgbmVlZCB0byBkcmF3ICoqcG9seWdvbnMqKiwgbGlrZSBvdXIgc3RhdGUgYm91bmRhcmllcy4gU3VwcG9ydCBmb3Igc2ltcGxlIGZlYXR1cmVzIGluIGBnZ3Bsb3QyYCBpcyB1bmRlciBhY3RpdmUgZGV2ZWxvcG1lbnQsIHNvIHlvdSBtYXkgbm90IGZpbmQgYWRlcXVhdGUgc3VwcG9ydCBmb3IgcGxvdHRpbmcgbGluZSBvciBwb2ludCBmZWF0dXJlcy4gVG8gZHJhdyB0aGUgbWFwLCB3ZSBwYXNzIHRoZSBzaW1wbGUgZmVhdHVyZXMgZGF0YSBmcmFtZSBhcyB0aGUgYGRhdGFgIGFyZ3VtZW50LgoKYGBge3IgZ2VvbS1zZn0KZ2dwbG90KGRhdGEgPSB1c2EpICsKICBnZW9tX3NmKCkKYGBgCgpCZWNhdXNlIHNpbXBsZSBmZWF0dXJlcyBkYXRhIGZyYW1lcyBhcmUgc3RhbmRhcmRpemVkIHdpdGggdGhlIGBnZW9tZXRyeWAgY29sdW1uIGFsd2F5cyBjb250YWluaW5nIGluZm9ybWF0aW9uIG9uIHRoZSBnZW9ncmFwaGljIGNvb3JkaW5hdGVzIG9mIHRoZSBmZWF0dXJlcywgd2UgZG8gbm90IG5lZWQgdG8gc3BlY2lmeSBhZGRpdGlvbmFsIHBhcmFtZXRlcnMgZm9yIGBhZXMoKWAuIE5vdGljZSBhIHByb2JsZW0gd2l0aCB0aGUgbWFwIGFib3ZlOiBpdCB3YXN0ZXMgYSBsb3Qgb2Ygc3BhY2UuIFRoaXMgaXMgY2F1c2VkIGJ5IHRoZSBwcmVzZW5jZSBvZiBBbGFza2EgYW5kIEhhd2FpaSBpbiB0aGUgZGF0YXNldC4gVGhlIEFsZXV0aWFuIElzbGFuZHMgY3Jvc3MgdGhlIHRoZSAxODB0aCBtZXJpZGlhbiwgcmVxdWlyaW5nIHRoZSBtYXAgdG8gc2hvdyB0aGUgRWFzdGVybiBoZW1pc3BoZXJlLiBMaWtld2lzZSwgSGF3YWlpIGlzIHN1YnN0YW50aWFsbHkgZGlzdGFudCBmcm9tIHRoZSBjb250aW5lbnRhbCBVbml0ZWQgU3RhdGVzLgoKIyMgUGxvdCBhIHN1YnNldCBvZiBhIG1hcAoKT25lIHNvbHV0aW9uIGlzIHRvIHBsb3QganVzdCB0aGUgbG93ZXIgNDggc3RhdGVzLiBUaGF0IGlzLCBleGNsdWRlIEFsYXNrYSBhbmQgSGF3YWlpLCBhcyB3ZWxsIGFzIERDIGFuZCBQdWVydG8gUmljby5eW0lzc3VlcyBvZiBwb2xpdGljYWwgc292ZXJlaWdudHkgYXNpZGUsIHRoZXNlIGVudGl0aWVzIGFyZSBmcmVxdWVudGx5IGV4Y2x1ZGVkIGZyb20gbWFwcyBkZXBlbmRpbmcgb24gdGhlIGRhdGEgdG8gYmUgaW5jb3Jwb3JhdGVkLiBZb3UgY2FuIGFsd2F5cyBjaG9vc2UgdG8gbGVhdmUgdGhlbSBpbiB0aGUgbWFwLl0gQmVjYXVzZSBzaW1wbGUgZmVhdHVyZXMgZGF0YSBmcmFtZXMgY29udGFpbiBvbmUgcm93IHBlciBmZWF0dXJlIGFuZCBpbiB0aGlzIGV4YW1wbGUgYSBmZWF0dXJlIGlzIGRlZmluZWQgYXMgYSBzdGF0ZSwgd2UgY2FuIHVzZSBgZmlsdGVyKClgIGZyb20gYGRwbHlyYCB0byBleGNsdWRlIHRoZXNlIGZvdXIgc3RhdGVzL3RlcnJpdG9yaWVzLgoKYGBge3IgdXNhLXN1YnNldH0KKHVzYV80OCA8LSB1c2EgJT4lCiAgZmlsdGVyKCEoTkFNRSAlaW4lIGMoIkFsYXNrYSIsICJEaXN0cmljdCBvZiBDb2x1bWJpYSIsICJIYXdhaWkiLCAiUHVlcnRvIFJpY28iKSkpKQoKZ2dwbG90KGRhdGEgPSB1c2FfNDgpICsKICBnZW9tX3NmKCkKYGBgCgpTaW5jZSB0aGUgbWFwIGlzIGEgYGdncGxvdCgpYCBvYmplY3QsIGl0IGNhbiBlYXNpbHkgYmUgbW9kaWZpZWQgbGlrZSBhbnkgb3RoZXIgYGdncGxvdCgpYCBncmFwaC4gV2UgY291bGQgY2hhbmdlIHRoZSBjb2xvciBvZiB0aGUgbWFwIGFuZCB0aGUgYm9yZGVyczoKCmBgYHtyIHVzYS1maWxsfQpnZ3Bsb3QoZGF0YSA9IHVzYV80OCkgKwogIGdlb21fc2YoZmlsbCA9ICJwYWxlZ3JlZW4iLCBjb2xvciA9ICJibGFjayIpCmBgYAoKIyMgYGZpZnR5c3RhdGVyYAoKUmF0aGVyIHRoYW4gZXhjbHVkaW5nIHRoZW0gZW50aXJlbHksIG1vc3QgbWFwcyBvZiB0aGUgVW5pdGVkIFN0YXRlcyBwbGFjZSBBbGFza2EgYW5kIEhhd2FpaSBhcyAqKmluc2V0cyoqIHRvIHRoZSBzb3V0aCBvZiBDYWxpZm9ybmlhLiBVbnRpbCByZWNlbnRseSwgaW4gUiB0aGlzIHdhcyBhbiBleHRyZW1lbHkgdGVkaW91cyB0YXNrIHRoYXQgcmVxdWlyZWQgbWFudWFsbHkgY2hhbmdpbmcgdGhlIGxhdGl0dWRlIGFuZCBsb25naXR1ZGUgY29vcmRpbmF0ZXMgZm9yIHRoZXNlIHN0YXRlcyB0byBwbGFjZSB0aGVtIGluIHRoZSBjb3JyZWN0IGxvY2F0aW9uLiBGb3J0dW5hdGVseSBzZXZlcmFsIHBhY2thZ2VzIGFyZSBub3cgYXZhaWxhYmxlIHRoYXQgaGF2ZSBhbHJlYWR5IGRvbmUgdGhlIHdvcmsgZm9yIHlvdS4gW2BhbGJlcnN1c2FgXShodHRwczovL2dpdGh1Yi5jb20vaHJicm1zdHIvYWxiZXJzdXNhKSBpbmNsdWRlcyB0aGUgYHVzYV9zZigpYCBmdW5jdGlvbiB3aGljaCByZXR1cm5zIGEgc2ltcGxlIGZlYXR1cmVzIGRhdGEgZnJhbWUgd2hpY2ggY29udGFpbnMgYWRqdXN0ZWQgY29vcmRpbmF0ZXMgZm9yIEFsYXNrYSBhbmQgSGF3YWlpIHRvIHBsb3QgdGhlbSB3aXRoIHRoZSBtYWlubGFuZC4gSXQgY2FuIGJlIGluc3RhbGxlZCBmcm9tIEdpdEh1YiB1c2luZyBgZGV2dG9vbHM6Omluc3RhbGxfZ2l0aHViKCJocmJybXN0ci9hbGJlcnN1c2EiKWAuCgpgYGB7ciBhbGJlcnN1c2F9CmxpYnJhcnkoYWxiZXJzdXNhKQp1c2Ffc2YoKQoKZ2dwbG90KGRhdGEgPSB1c2Ffc2YoKSkgKwogIGdlb21fc2YoKQpgYGAKCiMgQWRkIGRhdGEgdG8gdGhlIG1hcAoKUmVnaW9uIGJvdW5kYXJpZXMgc2VydmUgYXMgdGhlIGJhY2tncm91bmQgaW4gZ2Vvc3BhdGlhbCBkYXRhIHZpc3VhbGl6YXRpb24gLSBzbyBub3cgd2UgbmVlZCB0byBhZGQgZGF0YS4gU29tZSB0eXBlcyBvZiBnZW9ncmFwaGljIGRhdGEgKHBvaW50cyBhbmQgc3ltYm9scykgYXJlIG92ZXJsYWlkIG9uIHRvcCBvZiB0aGUgYm91bmRhcmllcywgd2hlcmVhcyBvdGhlciBkYXRhIChmaWxsKSBhcmUgaW5jb3Jwb3JhdGVkIGludG8gdGhlIHJlZ2lvbiBsYXllciBpdHNlbGYuCgojIyBQb2ludHMKCkxldCdzIHVzZSBvdXIgYHVzYV80OGAgbWFwIGRhdGEgdG8gYWRkIHNvbWUgcG9pbnRzLiBUaGUgYGFpcnBvcnRzYCBkYXRhIGZyYW1lIGluIHRoZSBgbnljZmxpZ2h0czEzYCBwYWNrYWdlIGluY2x1ZGVzIGdlb2dyYXBoaWMgaW5mbyBvbiBhaXJwb3J0cyBpbiB0aGUgVW5pdGVkIFN0YXRlcy4KCmBgYHtyIG55Y2ZsaWdodHN9CmxpYnJhcnkobnljZmxpZ2h0czEzKQphaXJwb3J0cwpgYGAKCkVhY2ggYWlycG9ydCBoYXMgaXQncyBnZW9ncmFwaGljIGxvY2F0aW9uIGVuY29kZWQgdGhyb3VnaCBgbGF0YCBhbmQgYGxvbmAuIFRvIGRyYXcgdGhlc2UgcG9pbnRzIG9uIHRoZSBtYXAsIGJhc2ljYWxseSB3ZSBkcmF3IGEgc2NhdHRlcnBsb3Qgd2l0aCBgeCA9IGxvbmAgYW5kIGB5ID0gbGF0YC4gSW4gZmFjdCB3ZSBjb3VsZCBzaW1wbHkgZG8gdGhhdDoKCmBgYHtyIHNjYXR0ZXJ9CmdncGxvdChhaXJwb3J0cywgYWVzKGxvbiwgbGF0KSkgKwogIGdlb21fcG9pbnQoKQpgYGAKCkxldCdzIG92ZXJsYXkgaXQgd2l0aCB0aGUgbWFwcGVkIHN0YXRlIGJvcmRlcnM6CgpgYGB7ciBmbGlnaHRzLXVzYX0KZ2dwbG90KGRhdGEgPSB1c2FfNDgpICsgCiAgZ2VvbV9zZigpICsgCiAgZ2VvbV9wb2ludChkYXRhID0gYWlycG9ydHMsIGFlcyh4ID0gbG9uLCB5ID0gbGF0KSwgc2hhcGUgPSAxKQpgYGAKClNsaWdodCBwcm9ibGVtLiBXZSBoYXZlIGFpcnBvcnRzIGxpc3RlZCBvdXRzaWRlIG9mIHRoZSBjb250aW5lbnRhbCBVbml0ZWQgU3RhdGVzLiBUaGVyZSBhcmUgYSBjb3VwbGUgd2F5cyB0byByZWN0aWZ5IHRoaXMuIFVuZm9ydHVuYXRlbHkgYGFpcnBvcnRzYCBkb2VzIG5vdCBpbmNsdWRlIGEgdmFyaWFibGUgaWRlbnRpZnlpbmcgc3RhdGUgc28gdGhlIGBmaWx0ZXIoKWAgb3BlcmF0aW9uIGlzIG5vdCB0aGF0IHNpbXBsZS4gVGhlIGVhc2llc3Qgc29sdXRpb24gaXMgdG8gY3JvcCB0aGUgbGltaXRzIG9mIHRoZSBncmFwaCB1c2luZyBgY29vcmRfc2YoKWAgdG8gb25seSBzaG93IHRoZSBtYWlubGFuZDoKCmBgYHtyIGNyb3B9CmdncGxvdChkYXRhID0gdXNhXzQ4KSArIAogIGdlb21fc2YoKSArIAogIGdlb21fcG9pbnQoZGF0YSA9IGFpcnBvcnRzLCBhZXMoeCA9IGxvbiwgeSA9IGxhdCksIHNoYXBlID0gMSkgKwogIGNvb3JkX3NmKHhsaW0gPSBjKC0xMzAsIC02MCksCiAgICAgICAgICAgeWxpbSA9IGMoMjAsIDUwKSkKYGBgCgpBbHRlcm5hdGl2ZWx5LCB3ZSBjYW4gdXNlIGBzdF9hc19zZigpYCB0byBjb252ZXJ0IGBhaXJwb3J0c2AgdG8gYSBzaW1wbGUgZmVhdHVyZXMgZGF0YSBmcmFtZS4KCmBgYHtyIGZsaWdodHMtc2Z9CmFpcnBvcnRzX3NmIDwtIHN0X2FzX3NmKGFpcnBvcnRzLCBjb29yZHMgPSBjKCJsb24iLCAibGF0IikpCnN0X2NycyhhaXJwb3J0c19zZikgPC0gNDMyNiAgICMgc2V0IHRoZSBjb29yZGluYXRlIHJlZmVyZW5jZSBzeXN0ZW0KYWlycG9ydHNfc2YKYGBgCgpgY29vcmRzYCB0ZWxscyBgc3RfYXNfc2YoKWAgd2hpY2ggY29sdW1ucyBjb250YWluIHRoZSBnZW9ncmFwaGljIGNvb3JkaW5hdGVzIG9mIGVhY2ggYWlycG9ydC4gVG8gZ3JhcGggdGhlIHBvaW50cyBvbiB0aGUgbWFwLCB3ZSB1c2UgYSBzZWNvbmQgYGdlb21fc2YoKWA6CgpgYGB7ciBmbGlnaHRzLXNmLXBsb3R9CmdncGxvdCgpICsgCiAgZ2VvbV9zZihkYXRhID0gdXNhXzQ4KSArIAogIGdlb21fc2YoZGF0YSA9IGFpcnBvcnRzX3NmLCBzaGFwZSA9IDEpICsKICBjb29yZF9zZih4bGltID0gYygtMTMwLCAtNjApLAogICAgICAgICAgIHlsaW0gPSBjKDIwLCA1MCkpCmBgYAoKIyMgU3ltYm9scwoKV2UgY2FuIGNoYW5nZSB0aGUgc2l6ZSBvciB0eXBlIG9mIHN5bWJvbHMgb24gdGhlIG1hcC4gRm9yIGluc3RhbmNlLCB3ZSBjYW4gZHJhdyBhICoqYnViYmxlIHBsb3QqKiAoYWxzbyBrbm93biBhcyBhICoqcHJvcG9ydGlvbmFsIHN5bWJvbCBtYXAqKikgYW5kIGVuY29kZSB0aGUgYWx0aXR1ZGUgb2YgdGhlIGFpcnBvcnQgdGhyb3VnaCB0aGUgc2l6ZSBjaGFubmVsOgoKYGBge3IgYWlycG9ydC1hbHR9CmdncGxvdChkYXRhID0gdXNhXzQ4KSArIAogIGdlb21fc2YoKSArIAogIGdlb21fcG9pbnQoZGF0YSA9IGFpcnBvcnRzLCBhZXMoeCA9IGxvbiwgeSA9IGxhdCwgc2l6ZSA9IGFsdCksCiAgICAgICAgICAgICBmaWxsID0gImdyZXkiLCBjb2xvciA9ICJibGFjayIsIGFscGhhID0gLjIpICsKICBjb29yZF9zZih4bGltID0gYygtMTMwLCAtNjApLAogICAgICAgICAgIHlsaW0gPSBjKDIwLCA1MCkpICsKICBzY2FsZV9zaXplX2FyZWEoZ3VpZGUgPSBGQUxTRSkKYGBgCgpDaXJjbGUgYXJlYSBpcyBwcm9wb3J0aW9uYWwgdG8gdGhlIGFpcnBvcnQncyBhbHRpdHVkZSAoaW4gZmVldCkuIE9yIHdlIGNvdWxkIHNjYWxlIGl0IGJhc2VkIG9uIHRoZSBudW1iZXIgb2YgYXJyaXZpbmcgZmxpZ2h0cyBpbiBgZmxpZ2h0c2A6CgpgYGB7ciBhaXJwb3J0LWRlc3R9CmFpcnBvcnRzX24gPC0gZmxpZ2h0cyAlPiUKICBjb3VudChkZXN0KSAlPiUKICBsZWZ0X2pvaW4oYWlycG9ydHMsIGJ5ID0gYygiZGVzdCIgPSAiZmFhIikpCgpnZ3Bsb3QoZGF0YSA9IHVzYV80OCkgKyAKICBnZW9tX3NmKCkgKyAKICBnZW9tX3BvaW50KGRhdGEgPSBhaXJwb3J0c19uLCBhZXMoeCA9IGxvbiwgeSA9IGxhdCwgc2l6ZSA9IG4pLAogICAgICAgICAgICAgZmlsbCA9ICJncmV5IiwgY29sb3IgPSAiYmxhY2siLCBhbHBoYSA9IC4yKSArCiAgY29vcmRfc2YoeGxpbSA9IGMoLTEzMCwgLTYwKSwKICAgICAgICAgICB5bGltID0gYygyMCwgNTApKSArCiAgc2NhbGVfc2l6ZV9hcmVhKGd1aWRlID0gRkFMU0UpCmBgYAoKPiBgYWlycG9ydHNgIGNvbnRhaW5zIGEgbGlzdCBvZiB2aXJ0dWFsbHkgYWxsIGNvbW1lcmNpYWwgYWlycG9ydHMgaW4gdGhlIFVuaXRlZCBTdGF0ZXMuIEhvd2V2ZXIgYGZsaWdodHNgIG9ubHkgY29udGFpbnMgZGF0YSBvbiBmbGlnaHRzIGRlcGFydGluZyBmcm9tIE5ldyBZb3JrIENpdHkgYWlycG9ydHMgKEpGSywgTGFHdWFyZGlhLCBvciBOZXdhcmspIGFuZCBvbmx5IHNlcnZpY2VzIGEgZmV3IGFpcnBvcnRzIGFyb3VuZCB0aGUgY291bnRyeS4KCiMjIEZpbGwgKGNob3JvcGxldGhzKQoKKipDaG9yb3BsZXRoIG1hcHMqKiBlbmNvZGUgaW5mb3JtYXRpb24gYnkgYXNzaWduaW5nIHNoYWRlcyBvZiBjb2xvcnMgdG8gZGVmaW5lZCBhcmVhcyBvbiBhIG1hcCAoZS5nLiBjb3VudHJpZXMsIHN0YXRlcywgY291bnRpZXMsIHppcCBjb2RlcykuIFRoZXJlIGFyZSBsb3RzIG9mIHdheXMgdG8gdHdlYWsgYW5kIGN1c3RvbWl6ZSB0aGVzZSBncmFwaHMsIHdoaWNoIGlzIGdlbmVyYWxseSBhIGdvb2QgaWRlYSBiZWNhdXNlIHJlbWVtYmVyIHRoYXQgY29sb3IgaXMgb25lIG9mIHRoZSBoYXJkZXItdG8tZGVjb2RlIGNoYW5uZWxzLgoKV2Ugd2lsbCBjb250aW51ZSB0byB1c2UgdGhlIGB1c2FfNDhgIHNpbXBsZSBmZWF0dXJlcyBkYXRhIGZyYW1lIGFuZCBkcmF3IGEgY2hvcm9wbGV0aCBmb3IgdGhlIG51bWJlciBvZiBmb3JlaWduLWJvcm4gaW5kaXZpZHVhbHMgaW4gZWFjaCBzdGF0ZS4gV2UgZ2V0IHRob3NlIGZpbGVzIGZyb20gdGhlIGBjZW5zdXNfYnVyZWF1YCBmb2xkZXIuIExldCdzIGFsc28gbm9ybWFsaXplIG91ciBtZWFzdXJlIGJ5IHRoZSB0b3RhbCBwb3B1bGF0aW9uIHRvIGdldCB0aGUgcmF0ZSBvZiBmb3JlaWduLWJvcm4gaW5kaXZpZHVhbHMgaW4gdGhlIHBvcHVsYXRpb246CgpgYGB7ciBpbXBvcnQtZm9yZWlnbn0KKGZiX3N0YXRlIDwtIHJlYWRfY3N2KCJkYXRhL2NlbnN1c19idXJlYXUvQUNTXzEzXzVZUl9CMDUwMTJfc3RhdGUvQUNTXzEzXzVZUl9CMDUwMTIuY3N2IikgJT4lCiAgbXV0YXRlKHJhdGUgPSBIRDAxX1ZEMDMgLyBIRDAxX1ZEMDEpKQpgYGAKCiMjIyBKb2luIHRoZSBkYXRhCgpOb3cgdGhhdCB3ZSBoYXZlIG91ciBkYXRhLCB3ZSB3YW50IHRvIGRyYXcgaXQgb24gdGhlIG1hcC4gYGZiX3N0YXRlYCBjb250YWlucyBvbmUgcm93IHBlciBzdGF0ZSwgYXMgZG9lcyBgdXNhXzQ4YC4gU2luY2UgdGhlcmUgaXMgYSBvbmUtdG8tb25lIG1hdGNoIGJldHdlZW4gdGhlIGRhdGEgZnJhbWVzLCB3ZSBqb2luIHRoZSBkYXRhIGZyYW1lcyB0b2dldGhlciBmaXJzdCwgdGhlbiB1c2UgdGhhdCBzaW5nbGUgZGF0YSBmcmFtZSB0byBkcmF3IHRoZSBtYXAuIFRoaXMgZGlmZmVycyBmcm9tIHRoZSBhcHByb2FjaCBhYm92ZSBmb3IgZHJhd2luZyBwb2ludHMgYmVjYXVzZSBhIHBvaW50IGZlYXR1cmUgaXMgbm90IHRoZSBzYW1lIHRoaW5nIGFzIGEgcG9seWdvbiBmZWF0dXJlLiBUaGF0IGlzLCB0aGVyZSB3ZXJlIG1vcmUgYWlycG9ydHMgdGhlbiB0aGVyZSB3ZXJlIHN0YXRlcy4gQmVjYXVzZSB0aGUgc3BhdGlhbCBkYXRhIGlzIHN0b3JlZCBpbiBhIGRhdGEgZnJhbWUgd2l0aCBvbmUgcm93IHBlciBzdGF0ZSwgYWxsIHdlIG5lZWQgdG8gZG8gaXMgbWVyZ2UgdGhlIGRhdGEgZnJhbWVzIHRvZ2V0aGVyIG9uIGEgY29sdW1uIHRoYXQgdW5pcXVlbHkgaWRlbnRpZmllcyBlYWNoIHJvdyBpbiBlYWNoIGRhdGEgZnJhbWUuCgpgYGB7ciB1c2EtZm9yZWlnbi1qb2lufQoodXNhX2ZiIDwtIHVzYV80OCAlPiUKICBsZWZ0X2pvaW4oZmJfc3RhdGUsIGJ5ID0gYygiU1RBVEVGUCIgPSAiR0VPLmlkMiIpKSkKYGBgCgojIyMgRHJhdyB0aGUgbWFwCgpXaXRoIHRoZSBuZXdseSBjb21iaW5lZCBkYXRhIGZyYW1lLCB1c2UgYGdlb21fc2YoKWAgYW5kIGRlZmluZSB0aGUgYGZpbGxgIGFlc3RoZXRpYyBiYXNlZCBvbiB0aGUgY29sdW1uIGluIGB1c2FfZmJgIHlvdSB3YW50IHRvIHZpc3VhbGl6ZS4KCmBgYHtyIGdlb20tbWFwLXN0YXRlfQpnZ3Bsb3QoZGF0YSA9IHVzYV9mYikgKwogIGdlb21fc2YoYWVzKGZpbGwgPSByYXRlKSkKYGBgCgojIyMgQmluIGRhdGEgdG8gZGlzY3JldGUgaW50ZXJ2YWxzCgpXaGVuIGNyZWF0aW5nIGEgaGVhdG1hcCB3aXRoIGEgY29udGludW91cyB2YXJpYWJsZSwgb25lIG11c3QgZGVjaWRlIHdoZXRoZXIgdG8ga2VlcCB0aGUgdmFyaWFibGUgYXMgY29udGludW91cyBvciBjb2xsYXBzZSBpdCBpbnRvIGEgc2VyaWVzIG9mIGJpbnMgd2l0aCBkaXNjcmV0ZSBjb2xvcnMuIFdoaWxlIGtlZXAgdGhlIHZhcmlhYmxlIGNvbnRpbnVvdXMgaXMgdGVjaG5pY2FsbHkgbW9yZSBwcmVjaXNlLCBbdGhlIGh1bWFuIGV5ZSBjYW5ub3QgdXN1YWxseSBkaXN0aW5ndWlzaCBiZXR3ZWVuIHR3byBjb2xvcnMgd2hpY2ggYXJlIHZlcnkgc2ltaWxhciB0byBvbmUgYW5vdGhlci5dKGh0dHBzOi8vd3d3LnBlcmNlcHR1YWxlZGdlLmNvbS9hcnRpY2xlcy92aXN1YWxfYnVzaW5lc3NfaW50ZWxsaWdlbmNlL2hlYXRtYXBzX3RvX2Jpbl9vcl9ub3QucGRmKSBCeSBjb252ZXJ0aW5nIHRoZSB2YXJpYWJsZSB0byBhIGRpc2NyZXRlIHZhcmlhYmxlLCB5b3UgZWFzaWx5IGRpc3Rpbmd1aXNoIGJldHdlZW4gdGhlIGRpZmZlcmVudCBsZXZlbHMuIElmIHlvdSBkZWNpZGUgdG8gY29udmVydCBhIGNvbnRpbnVvdXMgdmFyaWFibGUgdG8gYSBkaXNjcmV0ZSB2YXJpYWJsZSwgeW91IHdpbGwgbmVlZCB0byBkZWNpZGUgaG93IHRvIGRvIHRoaXMuIFdoaWxlIGBjdXQoKWAgaXMgYSBiYXNlIFIgZnVuY3Rpb24gZm9yIGNvbnZlcnRpbmcgY29udGludW91cyB2YXJpYWJsZXMgaW50byBkaXNjcmV0ZSB2YWx1ZXMsIGBnZ3Bsb3QyYCBvZmZlcnMgdHdvIGZ1bmN0aW9ucyB0aGF0IGV4cGxpY2l0bHkgZGVmaW5lIGhvdyB3ZSB3YW50IHRvIGJpbiB0aGUgbnVtZXJpYyB2ZWN0b3IgKGNvbHVtbikuCgpgY3V0X2ludGVydmFsKClgIG1ha2VzIGBuYCBncm91cHMgd2l0aCBlcXVhbCByYW5nZToKCmBgYHtyIGN1dC1pbnRlcnZhbH0KdXNhX2ZiICU+JQogIG11dGF0ZShyYXRlX2N1dCA9IGN1dF9pbnRlcnZhbChyYXRlLCA2KSkgJT4lCiAgZ2dwbG90KCkgKwogIGdlb21fc2YoYWVzKGZpbGwgPSByYXRlX2N1dCkpCmBgYAoKV2hlcmVhcyBgY3V0X251bWJlcigpYCBtYWtlcyBgbmAgZ3JvdXBzIHdpdGggKGFwcHJveGltYXRlbHkpIGVxdWFsIG51bWJlcnMgb2Ygb2JzZXJ2YXRpb25zOgoKYGBge3IgY3V0LW51bWJlcn0KdXNhX2ZiICU+JQogIG11dGF0ZShyYXRlX2N1dCA9IGN1dF9udW1iZXIocmF0ZSwgNikpICU+JQogIGdncGxvdCgpICsKICBnZW9tX3NmKGFlcyhmaWxsID0gcmF0ZV9jdXQpKQpgYGAKCj4gU2VlIFt0aGlzIFN0YWNrT3ZlcmZsb3cgdGhyZWFkXShodHRwczovL2dpcy5zdGFja2V4Y2hhbmdlLmNvbS9xdWVzdGlvbnMvODY2Njgvc2hvdWxkLWktdXNlLWEtZGlzY3JldGUtb3ItY29udGludW91cy1zY2FsZS1mb3ItY29sb3JpbmctYS1jaGxvcm9wbGV0aCkgZm9yIGEgbW9yZSBpbi1kZXB0aCBkaXNjdXNzaW9uIG9uIHRoZSBtZXJpdHMgb2YgYnVja2V0aXppbmcgYSBjb250aW51b3VzIHZhcmlhYmxlIGFuZCB3aGV0aGVyIHRvIHVzZSBgY3V0X2ludGVydmFsKClgIG9yIGBjdXRfbnVtYmVyKClgLgoKIyBDaGFuZ2luZyBtYXAgcHJvamVjdGlvbgoKPGlmcmFtZSB3aWR0aD0iNTYwIiBoZWlnaHQ9IjMxNSIgc3JjPSJodHRwczovL3d3dy55b3V0dWJlLmNvbS9lbWJlZC92VlgtUHJCUnRUWT9yZWw9MCIgZnJhbWVib3JkZXI9IjAiIGFsbG93ZnVsbHNjcmVlbj48L2lmcmFtZT4KCiFbW01lcmNhdG9yIFByb2plY3Rpb25dKGh0dHBzOi8veGtjZC5jb20vMjA4Mi8pXShodHRwczovL2ltZ3MueGtjZC5jb20vY29taWNzL21lcmNhdG9yX3Byb2plY3Rpb24ucG5nKQoKUmVwcmVzZW50aW5nIHBvcnRpb25zIG9mIHRoZSBnbG9iZSBvbiBhIGZsYXQgc3VyZmFjZSBjYW4gYmUgY2hhbGxlbmdpbmcuIERlcGVuZGluZyBvbiBob3cgeW91IHByb2plY3QgdGhlIG1hcCwgeW91IGNhbiBkaXN0b3J0IG9yIGVtcGhhc2l6ZSBjZXJ0YWluIGZlYXR1cmVzIG9mIHRoZSBtYXAuIEZvcnR1bmF0ZWx5LCBgZ2dwbG90KClgIGluY2x1ZGVzIHRoZSBgY29vcmRfc2YoKWAgZnVuY3Rpb24gd2hpY2ggYWxsb3dzIHVzIHRvIGVhc2lseSBpbXBsZW1lbnQgZGlmZmVyZW50IHByb2plY3Rpb24gbWV0aG9kcy4gSW4gb3JkZXIgdG8gaW1wbGVtZW50IGNvb3JkaW5hdGUgdHJhbnNmb3JtYXRpb25zLCB5b3UgbmVlZCB0byBrbm93IHRoZSAqKmNvb3JkaW5hdGUgcmVmZXJlbmNlIHN5c3RlbSoqIHRoYXQgZGVmaW5lcyB0aGUgcHJvamVjdGlvbiBtZXRob2QuIFRoZSAiZWFzaWVzdCIgYXBwcm9hY2ggaXMgdG8gcHJvdmlkZSB3aGF0IGlzIGtub3duIGFzIHRoZSBgcHJvajRzdHJpbmdgIHRoYXQgZGVmaW5lcyB0aGUgcHJvamVjdGlvbiBtZXRob2QuIFtQUk9KNF0oaHR0cHM6Ly9wcm9qNC5vcmcvKSBpcyBhIGdlbmVyaWMgY29vcmRpbmF0ZSB0cmFuc2Zvcm1hdGlvbiBzb2Z0d2FyZSB0aGF0IGFsbG93cyB5b3UgdG8gY29udmVydCBiZXR3ZWVuIHByb2plY3Rpb24gbWV0aG9kcy4gSWYgeW91IGdldCByZWFsbHkgaW50byBnZW9zcGF0aWFsIGFuYWx5c2lzIGFuZCB2aXN1YWxpemF0aW9uLCBpdCBpcyBoZWxwZnVsIHRvIGxlYXJuIHRoaXMgc3lzdGVtLgoKRm9yIG91ciBwdXJwb3NlcyBoZXJlLCBgcHJvajRzdHJpbmdgIGlzIGEgY2hhcmFjdGVyIHN0cmluZyBpbiBSIHRoYXQgZGVmaW5lcyB0aGUgY29vcmRpbmF0ZSBzeXN0ZW0gYW5kIGluY2x1ZGVzIHBhcmFtZXRlcnMgc3BlY2lmaWMgdG8gYSBnaXZlbiBjb29yZGluYXRlIHRyYW5zZm9ybWF0aW9uLiBQUk9KNCBpbmNsdWRlcyBbc29tZSBkb2N1bWVudGF0aW9uIG9uIGNvbW1vbiBwcm9qZWN0aW9uIG1ldGhvZHNdKGh0dHBzOi8vcHJvajQub3JnL29wZXJhdGlvbnMvcHJvamVjdGlvbnMvaW5kZXguaHRtbCkgdGhhdCBjYW4gZ2V0IHlvdSBzdGFydGVkLiBTb21lIHByb2plY3Rpb24gbWV0aG9kcyBhcmUgcmVsYXRpdmVseSBzaW1wbGUgYW5kIHJlcXVpcmUganVzdCB0aGUgbmFtZSBvZiB0aGUgcHJvamVjdGlvbiwgbGlrZSBmb3IgYSBbTWVyY2F0b3IgcHJvamVjdGlvbl0oaHR0cHM6Ly9wcm9qNC5vcmcvb3BlcmF0aW9ucy9wcm9qZWN0aW9ucy9tZXJjLmh0bWwpIChgIitwcm9qPW1lcmMiYCk6CgpgYGB7ciBwcm9qZWN0aW9uc30KbWFwX3Byb2pfYmFzZSA8LSBnZ3Bsb3QoZGF0YSA9IHVzYV80OCkgKwogIGdlb21fc2YoKQpgYGAKCmBgYHtyIG1lcmNhdG9yfQptYXBfcHJval9iYXNlICsKICBjb29yZF9zZihjcnMgPSAiK3Byb2o9bWVyYyIpICsKICBnZ3RpdGxlKCJNZXJjYXRvciBwcm9qZWN0aW9uIikKYGBgCgpPdGhlciBjb29yZGluYXRlIHN5c3RlbXMgcmVxdWlyZSBzcGVjaWZpY2F0aW9uIG9mIHRoZSAqKnN0YW5kYXJkIGxpbmVzKiosIG9yIGxpbmVzIHRoYXQgZGVmaW5lIGFyZWFzIG9mIHRoZSBzdXJmYWNlIG9mIHRoZSBtYXAgdGhhdCBhcmUgdGFuZ2VudCB0byB0aGUgZ2xvYmUuIFRoZXNlIGluY2x1ZGUgW0dhbGwtUGV0ZXJzXShodHRwOi8vc3BhdGlhbHJlZmVyZW5jZS5vcmcvcmVmL3NyLW9yZy9nYWxsLXBldGVycy1vcnRob2dyYXBoaWMtcHJvamVjdGlvbi9wcm9qNC8pLCBbQWxiZXJzIGVxdWFsLWFyZWFdKGh0dHBzOi8vcHJvajQub3JnL29wZXJhdGlvbnMvcHJvamVjdGlvbnMvYWVhLmh0bWwpLCBhbmQgW0xhbWJlcnQgYXppbXV0aGFsXShodHRwczovL3Byb2o0Lm9yZy9vcGVyYXRpb25zL3Byb2plY3Rpb25zL2xhZWEuaHRtbCkuCgpgYGB7ciBwcm9qZWN0aW9uLXJlc3R9Cm1hcF9wcm9qX2Jhc2UgKwogIGNvb3JkX3NmKGNycyA9ICIrcHJvaj1jZWEgK2xvbl8wPTAgK2xhdF90cz00NSIpICsKICBnZ3RpdGxlKCJHYWxsLVBldGVycyBwcm9qZWN0aW9uIikKCm1hcF9wcm9qX2Jhc2UgKwogIGNvb3JkX3NmKGNycyA9ICIrcHJvaj1hZWEgK2xhdF8xPTI1ICtsYXRfMj01MCArbG9uXzA9LTEwMCIpICsKICBnZ3RpdGxlKCJBbGJlcnMgZXF1YWwtYXJlYSBwcm9qZWN0aW9uIikKCm1hcF9wcm9qX2Jhc2UgKwogIGNvb3JkX3NmKGNycyA9ICIrcHJvaj1sYWVhICtsYXRfMD0zNSArbG9uXzA9LTEwMCIpICsKICBnZ3RpdGxlKCJMYW1iZXJ0IGF6aW11dGhhbCBwcm9qZWN0aW9uIikKYGBgCgojIFNlc3Npb24gSW5mbyB7LnRvYy1pZ25vcmV9CgpgYGB7ciBjaGlsZD0nX3Nlc3Npb25pbmZvLlJtZCd9CmBgYAo=</div>
<p>This work is licensed under the  <a href="http://creativecommons.org/licenses/by-nc/4.0/">CC BY-NC 4.0 Creative Commons License</a>.</p>


</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
