<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />




<title>Getting data from the web: scraping</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/readable.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-45631879-2', 'auto');
  ga('send', 'pageview');

</script>


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>


<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>


</head>

<body>

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
button.code-folding-btn:focus {
  outline: none;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 66px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 71px;
  margin-top: -71px;
}

.section h2 {
  padding-top: 71px;
  margin-top: -71px;
}
.section h3 {
  padding-top: 71px;
  margin-top: -71px;
}
.section h4 {
  padding-top: 71px;
  margin-top: -71px;
}
.section h5 {
  padding-top: 71px;
  margin-top: -71px;
}
.section h6 {
  padding-top: 71px;
  margin-top: -71px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>


<div class="container-fluid main-container">

<!-- tabsets -->
<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});
</script>

<!-- code folding -->




<script>
$(document).ready(function ()  {

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_').toLowerCase();
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}


.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
  padding-left: 25px;
  text-indent: 0;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>

<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row-fluid">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Computing for the Social Sciences</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">Home</a>
</li>
<li>
  <a href="faq.html">FAQ</a>
</li>
<li>
  <a href="syllabus.html">Syllabus</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">Getting data from the web: scraping</h1>

</div>


<div id="objectives" class="section level1">
<h1>Objectives</h1>
<ul>
<li>Identify methods for writing functions to interact with APIs</li>
<li>Define JSON and XML data structure and how to convert them to data frames</li>
<li>Define CSS selectors and practice writing selectors to extract information from web pages</li>
<li>Write a script to extract data on wineries in Ithaca, NY using <code>rvest</code> and the Selector Gadget</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(tidyverse)
<span class="kw">library</span>(stringr)
<span class="kw">library</span>(knitr)
<span class="kw">library</span>(curl)
<span class="kw">library</span>(jsonlite)
<span class="kw">library</span>(XML)
<span class="kw">library</span>(httr)
<span class="kw">library</span>(rvest)
<span class="kw">library</span>(ggmap)

<span class="kw">theme_set</span>(<span class="kw">theme_minimal</span>())</code></pre></div>
</div>
<div id="interacting-with-an-api" class="section level1">
<h1>Interacting with an API</h1>
<p>On Monday we experimented with several packages that “wrapped” APIs. That is, they handled the creation of the request and the formatting of the output. Today we’re going to look at (part of) what these functions were doing.</p>
<p>First we’re going to examine the structure of API requests via the <a href="http://www.omdbapi.com/">Open Movie Database</a>. OMDb is very similar to IMDB, except it has a nice, simple API. We can go to the website, input some search parameters, and obtain both the XML query and the response from it.</p>
<div id="exercise---determine-the-shape-of-an-api-request" class="section level2">
<h2>Exercise - determine the shape of an API request</h2>
<p>You can play around with the parameters on the OMDB website, and look at the resulting API call and the query you get back:</p>
<div class="figure">
<img src="images/ombd.png" />

</div>
<p>Let’s experiment with different values of the <code>title</code> and <code>year</code> fields. Notice the pattern in the request. For example for Title = Interstellar and Year = 2014, we get:</p>
<pre class="http"><code>http://www.omdbapi.com/?t=Interstellar&amp;y=2014&amp;plot=short&amp;r=xml</code></pre>
<p>Try pasting this link into the browser. Also experiment with <code>json</code> and <code>xml</code></p>
<p>How can we create this request in R?</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">request &lt;-<span class="st"> </span><span class="kw">str_c</span>(<span class="st">&quot;http://www.omdbapi.com/?t=&quot;</span>, <span class="st">&quot;Interstellar&quot;</span>, <span class="st">&quot;&amp;&quot;</span>, <span class="st">&quot;y=&quot;</span>, <span class="st">&quot;2014&quot;</span>, <span class="st">&quot;&amp;&quot;</span>, <span class="st">&quot;plot=&quot;</span>, <span class="st">&quot;short&quot;</span>, <span class="st">&quot;&amp;&quot;</span>, <span class="st">&quot;r=&quot;</span>, <span class="st">&quot;xml&quot;</span>)
request</code></pre></div>
<pre><code>## [1] &quot;http://www.omdbapi.com/?t=Interstellar&amp;y=2014&amp;plot=short&amp;r=xml&quot;</code></pre>
<p>It works, but it’s a bit ungainly. Lets try to abstract that into a function:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">omdb &lt;-<span class="st"> </span>function(Title, Year, Plot, Format){
  baseurl &lt;-<span class="st"> &quot;http://www.omdbapi.com/?&quot;</span>
  params &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;t=&quot;</span>, <span class="st">&quot;y=&quot;</span>, <span class="st">&quot;plot=&quot;</span>, <span class="st">&quot;r=&quot;</span>)
  values &lt;-<span class="st"> </span><span class="kw">c</span>(Title, Year, Plot, Format)
  param_values &lt;-<span class="st"> </span><span class="kw">map2_chr</span>(params, values, str_c)
  args &lt;-<span class="st"> </span><span class="kw">str_c</span>(param_values, <span class="dt">collapse =</span> <span class="st">&quot;&amp;&quot;</span>)
  <span class="kw">str_c</span>(baseurl, args)
}

<span class="kw">omdb</span>(<span class="st">&quot;Interstellar&quot;</span>, <span class="st">&quot;2014&quot;</span>, <span class="st">&quot;short&quot;</span>, <span class="st">&quot;xml&quot;</span>)</code></pre></div>
<pre><code>## [1] &quot;http://www.omdbapi.com/?t=Interstellar&amp;y=2014&amp;plot=short&amp;r=xml&quot;</code></pre>
<p>Now we have a handy function that returns the API query. We can paste in the link, but we can also obtain data from within R:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">request_interstellar &lt;-<span class="st"> </span><span class="kw">omdb</span>(<span class="st">&quot;Interstellar&quot;</span>, <span class="st">&quot;2014&quot;</span>, <span class="st">&quot;short&quot;</span>, <span class="st">&quot;xml&quot;</span>)
con &lt;-<span class="st"> </span><span class="kw">curl</span>(request_interstellar)
answer_xml &lt;-<span class="st"> </span><span class="kw">readLines</span>(con)</code></pre></div>
<pre><code>## Warning in readLines(con): incomplete final line found on &#39;http://
## www.omdbapi.com/?t=Interstellar&amp;y=2014&amp;plot=short&amp;r=xml&#39;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">close</span>(con)
answer_xml</code></pre></div>
<pre><code>## [1] &quot;&lt;?xml version=\&quot;1.0\&quot; encoding=\&quot;UTF-8\&quot;?&gt;&lt;root response=\&quot;True\&quot;&gt;&lt;movie title=\&quot;Interstellar\&quot; year=\&quot;2014\&quot; rated=\&quot;PG-13\&quot; released=\&quot;07 Nov 2014\&quot; runtime=\&quot;169 min\&quot; genre=\&quot;Adventure, Drama, Sci-Fi\&quot; director=\&quot;Christopher Nolan\&quot; writer=\&quot;Jonathan Nolan, Christopher Nolan\&quot; actors=\&quot;Ellen Burstyn, Matthew McConaughey, Mackenzie Foy, John Lithgow\&quot; plot=\&quot;A team of explorers travel through a wormhole in space in an attempt to ensure humanity&#39;s survival.\&quot; language=\&quot;English\&quot; country=\&quot;USA, UK\&quot; awards=\&quot;Won 1 Oscar. Another 40 wins &amp;amp; 135 nominations.\&quot; poster=\&quot;https://images-na.ssl-images-amazon.com/images/M/MV5BMjIxNTU4MzY4MF5BMl5BanBnXkFtZTgwMzM4ODI3MjE@._V1_SX300.jpg\&quot; metascore=\&quot;74\&quot; imdbRating=\&quot;8.6\&quot; imdbVotes=\&quot;1,006,066\&quot; imdbID=\&quot;tt0816692\&quot; type=\&quot;movie\&quot;/&gt;&lt;/root&gt;&quot;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">request_interstellar &lt;-<span class="st"> </span><span class="kw">omdb</span>(<span class="st">&quot;Interstellar&quot;</span>, <span class="st">&quot;2014&quot;</span>, <span class="st">&quot;short&quot;</span>, <span class="st">&quot;json&quot;</span>)
con &lt;-<span class="st"> </span><span class="kw">curl</span>(request_interstellar)
answer_json &lt;-<span class="st"> </span><span class="kw">readLines</span>(con)
<span class="kw">close</span>(con)
answer_json %&gt;%<span class="st"> </span>
<span class="st">  </span><span class="kw">prettify</span>()</code></pre></div>
<pre><code>## {
##     &quot;Title&quot;: &quot;Interstellar&quot;,
##     &quot;Year&quot;: &quot;2014&quot;,
##     &quot;Rated&quot;: &quot;PG-13&quot;,
##     &quot;Released&quot;: &quot;07 Nov 2014&quot;,
##     &quot;Runtime&quot;: &quot;169 min&quot;,
##     &quot;Genre&quot;: &quot;Adventure, Drama, Sci-Fi&quot;,
##     &quot;Director&quot;: &quot;Christopher Nolan&quot;,
##     &quot;Writer&quot;: &quot;Jonathan Nolan, Christopher Nolan&quot;,
##     &quot;Actors&quot;: &quot;Ellen Burstyn, Matthew McConaughey, Mackenzie Foy, John Lithgow&quot;,
##     &quot;Plot&quot;: &quot;A team of explorers travel through a wormhole in space in an attempt to ensure humanity&#39;s survival.&quot;,
##     &quot;Language&quot;: &quot;English&quot;,
##     &quot;Country&quot;: &quot;USA, UK&quot;,
##     &quot;Awards&quot;: &quot;Won 1 Oscar. Another 40 wins &amp; 135 nominations.&quot;,
##     &quot;Poster&quot;: &quot;https://images-na.ssl-images-amazon.com/images/M/MV5BMjIxNTU4MzY4MF5BMl5BanBnXkFtZTgwMzM4ODI3MjE@._V1_SX300.jpg&quot;,
##     &quot;Metascore&quot;: &quot;74&quot;,
##     &quot;imdbRating&quot;: &quot;8.6&quot;,
##     &quot;imdbVotes&quot;: &quot;1,006,066&quot;,
##     &quot;imdbID&quot;: &quot;tt0816692&quot;,
##     &quot;Type&quot;: &quot;movie&quot;,
##     &quot;Response&quot;: &quot;True&quot;
## }
## </code></pre>
<p>We have a form of data that is obviously structured. What is it?</p>
</div>
</div>
<div id="intro-to-json-and-xml" class="section level1">
<h1>Intro to JSON and XML</h1>
<p>These are the two common languages of web services: <strong>J</strong>ava<strong>S</strong>cript <strong>O</strong>bject <strong>N</strong>otation and e<strong>X</strong>tensible <strong>M</strong>arkup <strong>L</strong>anguage.</p>
<p>Here’s an example of JSON: from <a href="https://zapier.com/learn/apis/chapter-3-data-formats/">this wonderful site</a></p>
<div class="sourceCode"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span class="op">{</span>
  <span class="st">&quot;crust&quot;</span><span class="op">:</span> <span class="st">&quot;original&quot;</span><span class="op">,</span>
  <span class="st">&quot;toppings&quot;</span><span class="op">:</span> [<span class="st">&quot;cheese&quot;</span><span class="op">,</span> <span class="st">&quot;pepperoni&quot;</span><span class="op">,</span> <span class="st">&quot;garlic&quot;</span>]<span class="op">,</span>
  <span class="st">&quot;status&quot;</span><span class="op">:</span> <span class="st">&quot;cooking&quot;</span><span class="op">,</span>
  <span class="st">&quot;customer&quot;</span><span class="op">:</span> <span class="op">{</span>
    <span class="st">&quot;name&quot;</span><span class="op">:</span> <span class="st">&quot;Brian&quot;</span><span class="op">,</span>
    <span class="st">&quot;phone&quot;</span><span class="op">:</span> <span class="st">&quot;573-111-1111&quot;</span>
  <span class="op">}</span>
<span class="op">}</span></code></pre></div>
<p>And here is XML:</p>
<div class="sourceCode"><pre class="sourceCode xml"><code class="sourceCode xml"><span class="kw">&lt;order&gt;</span>
    <span class="kw">&lt;crust&gt;</span>original<span class="kw">&lt;/crust&gt;</span>
    <span class="kw">&lt;toppings&gt;</span>
        <span class="kw">&lt;topping&gt;</span>cheese<span class="kw">&lt;/topping&gt;</span>
        <span class="kw">&lt;topping&gt;</span>pepperoni<span class="kw">&lt;/topping&gt;</span>
        <span class="kw">&lt;topping&gt;</span>garlic<span class="kw">&lt;/topping&gt;</span>
    <span class="kw">&lt;/toppings&gt;</span>
    <span class="kw">&lt;status&gt;</span>cooking<span class="kw">&lt;/status&gt;</span>
<span class="kw">&lt;/order&gt;</span></code></pre></div>
<p>You can see that both of these data structures are quite easy to read. They are “self-describing”. In other words, they tell you how they are meant to be read.</p>
<p>There are easy means of taking these data types and creating R objects. Our JSON response above can be parsed using <code>jsonlite::fromJSON()</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">answer_json %&gt;%<span class="st"> </span>
<span class="st">  </span><span class="kw">fromJSON</span>()</code></pre></div>
<pre><code>## $Title
## [1] &quot;Interstellar&quot;
## 
## $Year
## [1] &quot;2014&quot;
## 
## $Rated
## [1] &quot;PG-13&quot;
## 
## $Released
## [1] &quot;07 Nov 2014&quot;
## 
## $Runtime
## [1] &quot;169 min&quot;
## 
## $Genre
## [1] &quot;Adventure, Drama, Sci-Fi&quot;
## 
## $Director
## [1] &quot;Christopher Nolan&quot;
## 
## $Writer
## [1] &quot;Jonathan Nolan, Christopher Nolan&quot;
## 
## $Actors
## [1] &quot;Ellen Burstyn, Matthew McConaughey, Mackenzie Foy, John Lithgow&quot;
## 
## $Plot
## [1] &quot;A team of explorers travel through a wormhole in space in an attempt to ensure humanity&#39;s survival.&quot;
## 
## $Language
## [1] &quot;English&quot;
## 
## $Country
## [1] &quot;USA, UK&quot;
## 
## $Awards
## [1] &quot;Won 1 Oscar. Another 40 wins &amp; 135 nominations.&quot;
## 
## $Poster
## [1] &quot;https://images-na.ssl-images-amazon.com/images/M/MV5BMjIxNTU4MzY4MF5BMl5BanBnXkFtZTgwMzM4ODI3MjE@._V1_SX300.jpg&quot;
## 
## $Metascore
## [1] &quot;74&quot;
## 
## $imdbRating
## [1] &quot;8.6&quot;
## 
## $imdbVotes
## [1] &quot;1,006,066&quot;
## 
## $imdbID
## [1] &quot;tt0816692&quot;
## 
## $Type
## [1] &quot;movie&quot;
## 
## $Response
## [1] &quot;True&quot;</code></pre>
<p>The output is a named list! A familiar and friendly R structure. Because data frames are lists, and because this list has no nested lists-within-lists, we can coerce it very simply:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">answer_json %&gt;%<span class="st"> </span>
<span class="st">  </span><span class="kw">fromJSON</span>() %&gt;%<span class="st"> </span>
<span class="st">  </span><span class="kw">as_tibble</span>()</code></pre></div>
<pre><code>## # A tibble: 1 × 20
##          Title  Year Rated    Released Runtime                    Genre
##          &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;       &lt;chr&gt;   &lt;chr&gt;                    &lt;chr&gt;
## 1 Interstellar  2014 PG-13 07 Nov 2014 169 min Adventure, Drama, Sci-Fi
## # ... with 14 more variables: Director &lt;chr&gt;, Writer &lt;chr&gt;, Actors &lt;chr&gt;,
## #   Plot &lt;chr&gt;, Language &lt;chr&gt;, Country &lt;chr&gt;, Awards &lt;chr&gt;, Poster &lt;chr&gt;,
## #   Metascore &lt;chr&gt;, imdbRating &lt;chr&gt;, imdbVotes &lt;chr&gt;, imdbID &lt;chr&gt;,
## #   Type &lt;chr&gt;, Response &lt;chr&gt;</code></pre>
<p>A similar process exists for XML formats:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ans_xml_parsed &lt;-<span class="st"> </span><span class="kw">xmlParse</span>(answer_xml)
ans_xml_parsed</code></pre></div>
<pre><code>## &lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
## &lt;root response=&quot;True&quot;&gt;
##   &lt;movie title=&quot;Interstellar&quot; year=&quot;2014&quot; rated=&quot;PG-13&quot; released=&quot;07 Nov 2014&quot; runtime=&quot;169 min&quot; genre=&quot;Adventure, Drama, Sci-Fi&quot; director=&quot;Christopher Nolan&quot; writer=&quot;Jonathan Nolan, Christopher Nolan&quot; actors=&quot;Ellen Burstyn, Matthew McConaughey, Mackenzie Foy, John Lithgow&quot; plot=&quot;A team of explorers travel through a wormhole in space in an attempt to ensure humanity&#39;s survival.&quot; language=&quot;English&quot; country=&quot;USA, UK&quot; awards=&quot;Won 1 Oscar. Another 40 wins &amp;amp; 135 nominations.&quot; poster=&quot;https://images-na.ssl-images-amazon.com/images/M/MV5BMjIxNTU4MzY4MF5BMl5BanBnXkFtZTgwMzM4ODI3MjE@._V1_SX300.jpg&quot; metascore=&quot;74&quot; imdbRating=&quot;8.6&quot; imdbVotes=&quot;1,006,066&quot; imdbID=&quot;tt0816692&quot; type=&quot;movie&quot;/&gt;
## &lt;/root&gt;
## </code></pre>
<p>Not exactly the response we were hoping for! This shows us some of the XML document’s structure:</p>
<ul>
<li>a <code>&lt;root&gt;</code> node with a single child, <code>&lt;movie&gt;</code>.</li>
<li>the information we want is all stored as attributes</li>
</ul>
<p>From <a href="http://link.springer.com.proxy.uchicago.edu/book/10.1007%2F978-1-4614-7900-0">Nolan and Lang 2014</a>:</p>
<blockquote>
<p>The <code>xmlRoot()</code> function returns an object of class <code>XMLInternalElementNode</code>. This is a regular XML node and not specific to the root node, i.e., all XML nodes will appear in R with this class or a more specific class. An object of class XMLInternalElementNode has four fields: name, attributes, children and value, which we access with the methods xmlName(), xmlAttrs(), xmlChildren(), and xmlValue()</p>
</blockquote>
<table>
<thead>
<tr class="header">
<th align="center">field</th>
<th align="center">method</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center">name</td>
<td align="center"><code>xmlName()</code></td>
</tr>
<tr class="even">
<td align="center">attributes</td>
<td align="center"><code>xmlAttrs()</code></td>
</tr>
<tr class="odd">
<td align="center">children</td>
<td align="center"><code>xmlChildren()</code></td>
</tr>
<tr class="even">
<td align="center">value</td>
<td align="center"><code>xmlValue()</code></td>
</tr>
</tbody>
</table>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ans_xml_parsed_root &lt;-<span class="st"> </span><span class="kw">xmlRoot</span>(ans_xml_parsed)[[<span class="st">&quot;movie&quot;</span>]]  <span class="co"># could also use [[1]]</span>
ans_xml_parsed_root</code></pre></div>
<pre><code>## &lt;movie title=&quot;Interstellar&quot; year=&quot;2014&quot; rated=&quot;PG-13&quot; released=&quot;07 Nov 2014&quot; runtime=&quot;169 min&quot; genre=&quot;Adventure, Drama, Sci-Fi&quot; director=&quot;Christopher Nolan&quot; writer=&quot;Jonathan Nolan, Christopher Nolan&quot; actors=&quot;Ellen Burstyn, Matthew McConaughey, Mackenzie Foy, John Lithgow&quot; plot=&quot;A team of explorers travel through a wormhole in space in an attempt to ensure humanity&#39;s survival.&quot; language=&quot;English&quot; country=&quot;USA, UK&quot; awards=&quot;Won 1 Oscar. Another 40 wins &amp;amp; 135 nominations.&quot; poster=&quot;https://images-na.ssl-images-amazon.com/images/M/MV5BMjIxNTU4MzY4MF5BMl5BanBnXkFtZTgwMzM4ODI3MjE@._V1_SX300.jpg&quot; metascore=&quot;74&quot; imdbRating=&quot;8.6&quot; imdbVotes=&quot;1,006,066&quot; imdbID=&quot;tt0816692&quot; type=&quot;movie&quot;/&gt;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ans_xml_attrs &lt;-<span class="st"> </span><span class="kw">xmlAttrs</span>(ans_xml_parsed_root)
ans_xml_attrs</code></pre></div>
<pre><code>##                                                                                                             title 
##                                                                                                    &quot;Interstellar&quot; 
##                                                                                                              year 
##                                                                                                            &quot;2014&quot; 
##                                                                                                             rated 
##                                                                                                           &quot;PG-13&quot; 
##                                                                                                          released 
##                                                                                                     &quot;07 Nov 2014&quot; 
##                                                                                                           runtime 
##                                                                                                         &quot;169 min&quot; 
##                                                                                                             genre 
##                                                                                        &quot;Adventure, Drama, Sci-Fi&quot; 
##                                                                                                          director 
##                                                                                               &quot;Christopher Nolan&quot; 
##                                                                                                            writer 
##                                                                               &quot;Jonathan Nolan, Christopher Nolan&quot; 
##                                                                                                            actors 
##                                                 &quot;Ellen Burstyn, Matthew McConaughey, Mackenzie Foy, John Lithgow&quot; 
##                                                                                                              plot 
##             &quot;A team of explorers travel through a wormhole in space in an attempt to ensure humanity&#39;s survival.&quot; 
##                                                                                                          language 
##                                                                                                         &quot;English&quot; 
##                                                                                                           country 
##                                                                                                         &quot;USA, UK&quot; 
##                                                                                                            awards 
##                                                                 &quot;Won 1 Oscar. Another 40 wins &amp; 135 nominations.&quot; 
##                                                                                                            poster 
## &quot;https://images-na.ssl-images-amazon.com/images/M/MV5BMjIxNTU4MzY4MF5BMl5BanBnXkFtZTgwMzM4ODI3MjE@._V1_SX300.jpg&quot; 
##                                                                                                         metascore 
##                                                                                                              &quot;74&quot; 
##                                                                                                        imdbRating 
##                                                                                                             &quot;8.6&quot; 
##                                                                                                         imdbVotes 
##                                                                                                       &quot;1,006,066&quot; 
##                                                                                                            imdbID 
##                                                                                                       &quot;tt0816692&quot; 
##                                                                                                              type 
##                                                                                                           &quot;movie&quot;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ans_xml_attrs %&gt;%
<span class="st">  </span><span class="kw">t</span>() %&gt;%
<span class="st">  </span><span class="kw">as_tibble</span>()</code></pre></div>
<pre><code>## # A tibble: 1 × 19
##          title  year rated    released runtime                    genre
##          &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;       &lt;chr&gt;   &lt;chr&gt;                    &lt;chr&gt;
## 1 Interstellar  2014 PG-13 07 Nov 2014 169 min Adventure, Drama, Sci-Fi
## # ... with 13 more variables: director &lt;chr&gt;, writer &lt;chr&gt;, actors &lt;chr&gt;,
## #   plot &lt;chr&gt;, language &lt;chr&gt;, country &lt;chr&gt;, awards &lt;chr&gt;, poster &lt;chr&gt;,
## #   metascore &lt;chr&gt;, imdbRating &lt;chr&gt;, imdbVotes &lt;chr&gt;, imdbID &lt;chr&gt;,
## #   type &lt;chr&gt;</code></pre>
</div>
<div id="introducing-the-easy-way-httr" class="section level1">
<h1>Introducing the easy way: <code>httr</code></h1>
<p><code>httr</code> is yet another star in the hadleyverse, this one designed to facilitate all things HTTP from within R. This includes the major HTTP verbs, which are:<a href="#fn1" class="footnoteRef" id="fnref1"><sup>1</sup></a></p>
<ul>
<li><strong>GET</strong>: fetch an existing resource. The URL contains all the necessary information the server needs to locate and return the resource.</li>
<li><strong>POST</strong>: create a new resource. POST requests usually carry a payload that specifies the data for the new resource.</li>
<li><strong>PUT</strong>: update an existing resource. The payload may contain the updated data for the resource.</li>
<li><strong>DELETE</strong>: delete an existing resource.</li>
</ul>
<p>HTTP is the foundation for APIs; understanding how it works is the key to interacting with all the diverse APIs out there. An excellent beginning resource for APIs (including HTTP basics) is <a href="https://zapier.com/learn/apis/">this simple guide</a></p>
<p><code>httr</code> also facilitates a variety of <strong>authentication</strong> protocols.</p>
<p><code>httr</code> contains one function for every HTTP verb. The functions have the same names as the verbs (e.g. <code>GET()</code>, <code>POST()</code>). They have more informative outputs than simply using <code>curl</code>, and come with some nice convenience functions for working with the output:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">interstellar_json &lt;-<span class="st"> </span><span class="kw">omdb</span>(<span class="st">&quot;Interstellar&quot;</span>, <span class="st">&quot;2014&quot;</span>, <span class="st">&quot;short&quot;</span>, <span class="st">&quot;json&quot;</span>)
response_json &lt;-<span class="st"> </span><span class="kw">GET</span>(interstellar_json)
<span class="kw">content</span>(response_json, <span class="dt">as =</span> <span class="st">&quot;parsed&quot;</span>, <span class="dt">type =</span> <span class="st">&quot;application/json&quot;</span>)</code></pre></div>
<pre><code>## $Title
## [1] &quot;Interstellar&quot;
## 
## $Year
## [1] &quot;2014&quot;
## 
## $Rated
## [1] &quot;PG-13&quot;
## 
## $Released
## [1] &quot;07 Nov 2014&quot;
## 
## $Runtime
## [1] &quot;169 min&quot;
## 
## $Genre
## [1] &quot;Adventure, Drama, Sci-Fi&quot;
## 
## $Director
## [1] &quot;Christopher Nolan&quot;
## 
## $Writer
## [1] &quot;Jonathan Nolan, Christopher Nolan&quot;
## 
## $Actors
## [1] &quot;Ellen Burstyn, Matthew McConaughey, Mackenzie Foy, John Lithgow&quot;
## 
## $Plot
## [1] &quot;A team of explorers travel through a wormhole in space in an attempt to ensure humanity&#39;s survival.&quot;
## 
## $Language
## [1] &quot;English&quot;
## 
## $Country
## [1] &quot;USA, UK&quot;
## 
## $Awards
## [1] &quot;Won 1 Oscar. Another 40 wins &amp; 135 nominations.&quot;
## 
## $Poster
## [1] &quot;https://images-na.ssl-images-amazon.com/images/M/MV5BMjIxNTU4MzY4MF5BMl5BanBnXkFtZTgwMzM4ODI3MjE@._V1_SX300.jpg&quot;
## 
## $Metascore
## [1] &quot;74&quot;
## 
## $imdbRating
## [1] &quot;8.6&quot;
## 
## $imdbVotes
## [1] &quot;1,006,066&quot;
## 
## $imdbID
## [1] &quot;tt0816692&quot;
## 
## $Type
## [1] &quot;movie&quot;
## 
## $Response
## [1] &quot;True&quot;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">interstellar_xml &lt;-<span class="st"> </span><span class="kw">omdb</span>(<span class="st">&quot;Interstellar&quot;</span>, <span class="st">&quot;2014&quot;</span>, <span class="st">&quot;short&quot;</span>, <span class="st">&quot;xml&quot;</span>)
response_xml &lt;-<span class="st"> </span><span class="kw">GET</span>(interstellar_xml)
<span class="kw">content</span>(response_xml, <span class="dt">as =</span> <span class="st">&quot;parsed&quot;</span>)</code></pre></div>
<pre><code>## {xml_document}
## &lt;root response=&quot;True&quot;&gt;
## [1] &lt;movie title=&quot;Interstellar&quot; year=&quot;2014&quot; rated=&quot;PG-13&quot; released=&quot;07 N ...</code></pre>
<p>In addition, <code>httr</code> gives us access to lots of useful information about the quality of our response. For example, the header:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">headers</span>(response_xml)</code></pre></div>
<pre><code>## $date
## [1] &quot;Thu, 16 Feb 2017 22:37:52 GMT&quot;
## 
## $`content-type`
## [1] &quot;text/xml; charset=utf-8&quot;
## 
## $`transfer-encoding`
## [1] &quot;chunked&quot;
## 
## $connection
## [1] &quot;keep-alive&quot;
## 
## $`cache-control`
## [1] &quot;public, max-age=86400&quot;
## 
## $expires
## [1] &quot;Fri, 17 Feb 2017 22:37:52 GMT&quot;
## 
## $`last-modified`
## [1] &quot;Thu, 16 Feb 2017 22:34:47 GMT&quot;
## 
## $vary
## [1] &quot;Accept-Encoding&quot;
## 
## $`x-aspnet-version`
## [1] &quot;4.0.30319&quot;
## 
## $`x-powered-by`
## [1] &quot;ASP.NET&quot;
## 
## $`access-control-allow-origin`
## [1] &quot;*&quot;
## 
## $`cf-cache-status`
## [1] &quot;HIT&quot;
## 
## $server
## [1] &quot;cloudflare-nginx&quot;
## 
## $`cf-ray`
## [1] &quot;33247c9287e75570-ORD&quot;
## 
## $`content-encoding`
## [1] &quot;gzip&quot;
## 
## attr(,&quot;class&quot;)
## [1] &quot;insensitive&quot; &quot;list&quot;</code></pre>
<p>And also a handy means to extract specifically the HTTP status code:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">status_code</span>(response_xml)</code></pre></div>
<pre><code>## [1] 200</code></pre>
<table>
<thead>
<tr class="header">
<th>Code<a href="#fn2" class="footnoteRef" id="fnref2"><sup>2</sup></a></th>
<th>Status</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1xx</td>
<td>Informational</td>
</tr>
<tr class="even">
<td>2xx</td>
<td>Success</td>
</tr>
<tr class="odd">
<td>3xx</td>
<td>Redirection</td>
</tr>
<tr class="even">
<td>4xx</td>
<td>Client error (you did something wrong)</td>
</tr>
<tr class="odd">
<td>5xx</td>
<td>Server error (server did something wrong)</td>
</tr>
</tbody>
</table>
<ul>
<li><a href="https://www.flickr.com/photos/girliemac/sets/72157628409467125">(Perhaps a more intuitive, cat-based explanation of error codes)</a></li>
</ul>
<p>In fact, we didn’t need to create <code>omdb()</code> at all! <code>httr</code> provides a straightforward means of making an http request:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">the_martian &lt;-<span class="st"> </span><span class="kw">GET</span>(<span class="st">&quot;http://www.omdbapi.com/?&quot;</span>, <span class="dt">query =</span> <span class="kw">list</span>(<span class="dt">t =</span> <span class="st">&quot;The Martian&quot;</span>, <span class="dt">y =</span> <span class="dv">2015</span>, <span class="dt">plot =</span> <span class="st">&quot;short&quot;</span>, <span class="dt">r =</span> <span class="st">&quot;json&quot;</span>))

<span class="kw">content</span>(the_martian)</code></pre></div>
<pre><code>## $Title
## [1] &quot;The Martian&quot;
## 
## $Year
## [1] &quot;2015&quot;
## 
## $Rated
## [1] &quot;PG-13&quot;
## 
## $Released
## [1] &quot;02 Oct 2015&quot;
## 
## $Runtime
## [1] &quot;144 min&quot;
## 
## $Genre
## [1] &quot;Adventure, Drama, Sci-Fi&quot;
## 
## $Director
## [1] &quot;Ridley Scott&quot;
## 
## $Writer
## [1] &quot;Drew Goddard (screenplay), Andy Weir (book)&quot;
## 
## $Actors
## [1] &quot;Matt Damon, Jessica Chastain, Kristen Wiig, Jeff Daniels&quot;
## 
## $Plot
## [1] &quot;An astronaut becomes stranded on Mars after his team assume him dead, and must rely on his ingenuity to find a way to signal to Earth that he is alive.&quot;
## 
## $Language
## [1] &quot;English, Mandarin&quot;
## 
## $Country
## [1] &quot;USA, UK&quot;
## 
## $Awards
## [1] &quot;Nominated for 7 Oscars. Another 34 wins &amp; 180 nominations.&quot;
## 
## $Poster
## [1] &quot;https://images-na.ssl-images-amazon.com/images/M/MV5BMTc2MTQ3MDA1Nl5BMl5BanBnXkFtZTgwODA3OTI4NjE@._V1_SX300.jpg&quot;
## 
## $Metascore
## [1] &quot;80&quot;
## 
## $imdbRating
## [1] &quot;8.0&quot;
## 
## $imdbVotes
## [1] &quot;534,183&quot;
## 
## $imdbID
## [1] &quot;tt3659388&quot;
## 
## $Type
## [1] &quot;movie&quot;
## 
## $Response
## [1] &quot;True&quot;</code></pre>
<p>We get the same answer as before! With <code>httr</code>, we are able to pass in the named arguments to the API call as a named list. We are also able to use spaces in movie names - <code>httr</code> encodes these in the URL before making the GET request.</p>
<p>The documentation for <code>httr</code> includes two useful vignettes:</p>
<ul>
<li><a href="https://cran.r-project.org/web/packages/httr/vignettes/quickstart.html"><code>httr</code> quickstart guide</a> - summarizes all the basic <code>httr</code> functions like above</li>
<li><a href="https://cran.r-project.org/web/packages/httr/vignettes/api-packages.html">Best practices for writing an API package</a> - document outlining the key issues involved in writing API wrappers in R</li>
</ul>
<div id="applying-httr-to-the-microsoft-emotion-api" class="section level2">
<h2>Applying <code>httr</code> to the Microsoft Emotion API</h2>
<p>APIs can be used in conjunction with cloud computing and deep learning platforms that cannot be deployed on a local machine. Consider the <a href="https://azure.microsoft.com/en-us/services/cognitive-services/emotion/">Microsoft Emotion API</a>:</p>
<blockquote>
<p>The Emotion API takes a facial expression in an image as an input, and returns the confidence across a set of emotions for each face in the image, as well as bounding box for the face, using the Face API. If a user has already called the Face API, they can submit the face rectangle as an optional input. The emotions detected are anger, contempt, disgust, fear, happiness, neutral, sadness, and surprise. These emotions are understood to be cross-culturally and universally communicated with particular facial expressions.</p>
</blockquote>
<p>Here is how we can use R and the <code>httr</code> package to send a request to the Microsoft Emotion API to analyze a video and retrieve the results.<a href="#fn3" class="footnoteRef" id="fnref3"><sup>3</sup></a> As our sample video, we’ll use <a href="https://www.dropbox.com/s/zfmaswf8s9c58om/blog2.mp4?dl=1%27">a sample five minute video clip</a> from the third 2016 U.S. presidential debate between Donald J. Trump and Hillary Clinton.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Set an endpoint for Emotion in Video API with &quot;perFrame&quot; output</span>
apiUrl &lt;-<span class="st"> &quot;https://api.projectoxford.ai/emotion/v1.0/recognizeInVideo?outputStyle=perFrame&quot;</span>

<span class="co"># Set URL for accessing the video</span>
urlVideo &lt;-<span class="st"> &quot;https://www.dropbox.com/s/zfmaswf8s9c58om/blog2.mp4?dl=1&quot;</span>

<span class="co"># Request Microsoft AI start processing the video via POST</span>
faceEMO &lt;-<span class="st"> </span>httr::<span class="kw">POST</span>(
  <span class="dt">url =</span> apiUrl,
  <span class="kw">content_type</span>(<span class="st">&quot;application/json&quot;</span>),
  <span class="kw">add_headers</span>(<span class="dt">.headers =</span> <span class="kw">c</span>(<span class="st">&quot;Ocp-Apim-Subscription-Key&quot;</span> =<span class="st"> </span><span class="kw">getOption</span>(<span class="st">&quot;emotion_api&quot;</span>))),
  <span class="dt">body =</span> <span class="kw">list</span>(<span class="dt">url =</span> urlVideo),
  <span class="dt">encode =</span> <span class="st">&quot;json&quot;</span>
)

<span class="co"># url to access the operation</span>
operationLocation &lt;-<span class="st"> </span><span class="kw">headers</span>(faceEMO)[[<span class="st">&quot;operation-location&quot;</span>]]

<span class="co"># it can take awhile to process a long video</span>
<span class="co"># use a while loop to wait for the processing to finish</span>
<span class="co"># and retrieve the results</span>
while(<span class="ot">TRUE</span>){
  <span class="co"># retrieve results and extract content</span>
  ret &lt;-<span class="st"> </span><span class="kw">GET</span>(operationLocation,
             <span class="kw">add_headers</span>(<span class="dt">.headers =</span> <span class="kw">c</span>(<span class="st">&quot;Ocp-Apim-Subscription-Key&quot;</span> =<span class="st"> </span><span class="kw">getOption</span>(<span class="st">&quot;emotion_api&quot;</span>))))
  
  con &lt;-<span class="st"> </span><span class="kw">content</span>(ret)
  
  <span class="co"># if the process is still running, print the progress and continue waiting</span>
  if(<span class="kw">is.null</span>(con$status)){
    <span class="kw">warning</span>(<span class="st">&quot;Connection Error, retry after 1 minute&quot;</span>)
    <span class="kw">Sys.sleep</span>(<span class="dv">60</span>)
  } else if (con$status ==<span class="st"> &quot;Running&quot;</span> |<span class="st"> </span>con$status ==<span class="st"> &quot;Uploading&quot;</span>){
    <span class="kw">cat</span>(<span class="kw">paste0</span>(<span class="st">&quot;status &quot;</span>, con$status, <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>))
    <span class="kw">cat</span>(<span class="kw">paste0</span>(<span class="st">&quot;progress &quot;</span>, con$progress, <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>))
    <span class="kw">Sys.sleep</span>(<span class="dv">60</span>)
  } else {
    <span class="co"># once the process is done, exit the loop</span>
    <span class="kw">cat</span>(<span class="kw">paste0</span>(<span class="st">&quot;status &quot;</span>, con$status, <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>))
    break()
  }
}

<span class="co"># extract data from the results</span>
data &lt;-<span class="st"> </span>(con$processingResult %&gt;%
<span class="st">           </span><span class="kw">fromJSON</span>())$fragments

<span class="co"># data$events is list of events that has a data.frame column,</span>
<span class="co"># so it has to be flattened using a series of map functions</span>
data$events &lt;-<span class="st"> </span><span class="kw">map</span>(data$events, ~<span class="st"> </span>.x %&gt;%
<span class="st">    </span><span class="kw">map</span>(flatten) %&gt;%
<span class="st">    </span><span class="kw">bind_rows</span>()
)

<span class="co"># print results</span>
data

<span class="co"># clean up and save</span>
emotion &lt;-<span class="st"> </span>data %&gt;%
<span class="st">  </span>as_tibble %&gt;%
<span class="st">  </span><span class="co"># unnest the list of data frames</span>
<span class="st">  </span><span class="kw">unnest</span>(events) %&gt;%
<span class="st">  </span><span class="co"># remove the moderator</span>
<span class="st">  </span><span class="kw">filter</span>(id !=<span class="st"> </span><span class="dv">2</span>) %&gt;%
<span class="st">  </span><span class="co"># create a row id variable, use same row id for each set of speakers</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">row_id =</span> <span class="kw">ceiling</span>(<span class="kw">row_number</span>() /<span class="st"> </span><span class="dv">2</span>)) %&gt;%
<span class="st">  </span><span class="co"># convert from wide to long, one row for each id-emotion</span>
<span class="st">  </span><span class="kw">gather</span>(key, value, <span class="kw">starts_with</span>(<span class="st">&quot;scores&quot;</span>)) %&gt;%
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">key =</span> <span class="kw">str_replace</span>(key, <span class="st">&quot;scores.&quot;</span>, <span class="st">&quot;&quot;</span>),
         <span class="dt">id =</span> <span class="kw">recode</span>(id, <span class="st">`</span><span class="dt">0</span><span class="st">`</span> =<span class="st"> &quot;Trump&quot;</span>,
                     <span class="st">`</span><span class="dt">1</span><span class="st">`</span> =<span class="st"> &quot;Clinton&quot;</span>)) %&gt;%
<span class="st">  </span><span class="co"># remove neutral expressions and write to disk</span>
<span class="st">  </span><span class="kw">filter</span>(key !=<span class="st"> &quot;neutral&quot;</span>) %&gt;%
<span class="st">  </span><span class="kw">write_rds</span>(<span class="st">&quot;data/debate_emotion.rds&quot;</span>)</code></pre></div>
<p>This script requires you to <a href="https://azure.microsoft.com/en-us/try/cognitive-services/my-apis/">create your own API key</a> for the Microsoft Emotion API and would take about an hour to process the video and retrieve the results. Instead, you can just use the prepped data frame stored in the <code>rcfss</code> package.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># already run the API and stored the data frame in the rcfss package</span>
<span class="kw">data</span>(<span class="st">&quot;emotion&quot;</span>, <span class="dt">package =</span> <span class="st">&quot;rcfss&quot;</span>)
emotion</code></pre></div>
<pre><code>## # A tibble: 128,688 x 11
##    start duration interval      id        x        y    width   height
##    &lt;int&gt;    &lt;int&gt;    &lt;int&gt;   &lt;chr&gt;    &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;
##  1     0    60060     1001   Trump 0.185417 0.218519 0.153125 0.272222
##  2     0    60060     1001 Clinton 0.717708 0.296296 0.138542 0.246296
##  3     0    60060     1001   Trump 0.184375 0.216667 0.155208 0.275926
##  4     0    60060     1001 Clinton 0.714583 0.283333 0.139583 0.248148
##  5     0    60060     1001   Trump 0.184375 0.216667 0.155208 0.275926
##  6     0    60060     1001 Clinton 0.712500 0.275926 0.139583 0.248148
##  7     0    60060     1001   Trump 0.184375 0.216667 0.155208 0.275926
##  8     0    60060     1001 Clinton 0.711458 0.274074 0.139583 0.248148
##  9     0    60060     1001   Trump 0.184375 0.216667 0.155208 0.275926
## 10     0    60060     1001 Clinton 0.708333 0.264815 0.141667 0.251852
## # ... with 128,678 more rows, and 3 more variables: row_id &lt;dbl&gt;,
## #   key &lt;chr&gt;, value &lt;dbl&gt;</code></pre>
<blockquote>
<p>See <code>?emotion</code> for more documentation on the variables.</p>
</blockquote>
<p>What could we do with this information? A simple analysis would be to visualize the emotions of each candidate over time:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(emotion, <span class="kw">aes</span>(row_id, value, <span class="dt">color =</span> key)) +
<span class="st">  </span><span class="kw">facet_wrap</span>(~<span class="st"> </span>id, <span class="dt">nrow =</span> <span class="dv">2</span>) +
<span class="st">  </span><span class="kw">geom_smooth</span>(<span class="dt">se =</span> <span class="ot">FALSE</span>) +
<span class="st">  </span><span class="kw">scale_color_brewer</span>(<span class="dt">type =</span> <span class="st">&quot;qual&quot;</span>) +
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;Candidate emotions during final 2016 U.S. presidential debate&quot;</span>,
       <span class="dt">subtitle =</span> <span class="st">&quot;Five-minute sample&quot;</span>,
       <span class="dt">x =</span> <span class="st">&quot;Frame&quot;</span>,
       <span class="dt">y =</span> <span class="st">&quot;Probability of emotion&quot;</span>,
       <span class="dt">color =</span> <span class="st">&quot;Emotion&quot;</span>)</code></pre></div>
<pre><code>## `geom_smooth()` using method = &#39;gam&#39; and formula &#39;y ~ s(x, bs = &quot;cs&quot;)&#39;</code></pre>
<p><img src="webdata002_scraping_files/figure-html/emotion-viz-1.png" width="672" /></p>
<p>Hillary Clinton’s facial expressions are marked predominantly by happiness, whereas Donald Trump’s facial expressions are mostly sad.<a href="#fn4" class="footnoteRef" id="fnref4"><sup>4</sup></a></p>
</div>
</div>
<div id="scraping" class="section level1">
<h1>Scraping</h1>
<p>What if data is present on a website, but isn’t provided in an API at all? It is possible to grab that information too. How easy that is to do depends a lot on the quality of the website that we are using.</p>
<p>HTML is a structured way of displaying information. It is very similar in structure to XML (in fact many modern html sites are actually XHTML5, <a href="http://www.w3.org/TR/html5/the-xhtml-syntax.html">which is also valid XML</a>)</p>
<div class="figure">
<img src="http://imgs.xkcd.com/comics/tags.png" alt="tags" />
<p class="caption"><a href="https://xkcd.com/1144/">tags</a></p>
</div>
<div id="example-of-html-code" class="section level2">
<h2>Example of HTML code</h2>
<p>Source: <a href="http://help.websiteos.com/websiteos/example_of_a_simple_html_page.htm">Example of a simple HTML page</a></p>
<div class="sourceCode"><pre class="sourceCode html"><code class="sourceCode html"><span class="kw">&lt;HTML&gt;</span>
<span class="kw">&lt;HEAD&gt;</span>
  <span class="kw">&lt;TITLE&gt;</span>Your Title Here<span class="kw">&lt;/TITLE&gt;</span>
<span class="kw">&lt;/HEAD&gt;</span>

<span class="kw">&lt;BODY</span><span class="ot"> BGCOLOR=</span><span class="st">&quot;FFFFFF&quot;</span><span class="kw">&gt;</span>
<span class="kw">&lt;CENTER&gt;&lt;IMG</span><span class="ot"> SRC=</span><span class="st">&quot;clouds.jpg&quot;</span><span class="ot"> ALIGN=</span><span class="st">&quot;BOTTOM&quot;</span><span class="kw">&gt;</span> <span class="kw">&lt;/CENTER&gt;</span>
<span class="kw">&lt;HR&gt;</span>
<span class="kw">&lt;a</span><span class="ot"> href=</span><span class="st">&quot;http://somegreatsite.com&quot;</span><span class="kw">&gt;</span>Link Name<span class="kw">&lt;/a&gt;</span> is a link to another nifty site
<span class="kw">&lt;H1&gt;</span>This is a Header<span class="kw">&lt;/H1&gt;</span>
<span class="kw">&lt;H2&gt;</span>This is a Medium Header<span class="kw">&lt;/H2&gt;</span>
Send me mail at <span class="kw">&lt;a</span><span class="ot"> href=</span><span class="st">&quot;mailto:support@yourcompany.com&quot;</span><span class="kw">&gt;</span> support@yourcompany.com<span class="kw">&lt;/a&gt;</span>.
<span class="kw">&lt;P&gt;</span> This is a new paragraph!
<span class="kw">&lt;P&gt;</span> <span class="kw">&lt;B&gt;</span>This is a new paragraph!<span class="kw">&lt;/B&gt;</span>
<span class="kw">&lt;BR&gt;</span> <span class="kw">&lt;B&gt;&lt;I&gt;</span>This is a new sentence without a paragraph break, in bold italics.<span class="kw">&lt;/I&gt;&lt;/B&gt;</span>
<span class="kw">&lt;HR&gt;</span>
<span class="kw">&lt;/BODY&gt;</span>
<span class="kw">&lt;/HTML&gt;</span></code></pre></div>
<div class="figure">
<img src="images/example_html.jpg" alt="Rendered example HTML" />
<p class="caption">Rendered example HTML</p>
</div>
</div>
<div id="install-your-equipment" class="section level2">
<h2>Install your equipment</h2>
<ul>
<li><code>rvest</code> - <code>devtools::install_github(&quot;hadley/rvest&quot;)</code></li>
<li>SelectorGadget - <a href="http://selectorgadget.com/">Install in your browser</a></li>
</ul>
</div>
<div id="practice-css-selectors" class="section level2">
<h2>Practice CSS selectors</h2>
<p>Before we go any further, <a href="http://flukeout.github.io">let’s play a game together!</a></p>
</div>
<div id="obtain-a-table" class="section level2">
<h2>Obtain a table</h2>
<p>Let’s make a simple HTML table and then parse it!</p>
<ul>
<li>make a new, empty project</li>
<li>make a totally empty .Rmd file called <code>GapminderHead.Rmd</code></li>
<li>copy this into the body:</li>
</ul>
<pre><code>---
output: html_document
---

```{r echo=FALSE, results=&#39;asis&#39;} #delete this comment
library(gapminder)
knitr::kable(head(gapminder))
```</code></pre>
<p><strong>remember to delete the comment</strong></p>
<p>Then knit the document and click “View in Browser”. It should look like this:</p>
<div class="figure">
<img src="webdata-supp/gapminderhead.png" alt="gm" />
<p class="caption">gm</p>
</div>
<p>We have created a simple html table with the head of gapminder in it! We can get our data back by parsing this table into a dataframe again. Extracting data from html is called “scraping”, and it is done with the R package <code>rvest</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">read_html</span>(<span class="st">&quot;GapminderHead.html&quot;</span>) %&gt;%
<span class="st">  </span><span class="kw">html_table</span>()</code></pre></div>
<pre><code>## [[1]]
##       country continent year lifeExp      pop gdpPercap
## 1 Afghanistan      Asia 1952  28.801  8425333  779.4453
## 2 Afghanistan      Asia 1957  30.332  9240934  820.8530
## 3 Afghanistan      Asia 1962  31.997 10267083  853.1007
## 4 Afghanistan      Asia 1967  34.020 11537966  836.1971
## 5 Afghanistan      Asia 1972  36.088 13079460  739.9811
## 6 Afghanistan      Asia 1977  38.438 14880372  786.1134</code></pre>
</div>
<div id="scraping-via-css-selectors" class="section level2">
<h2>Scraping via CSS selectors</h2>
<p>Let’s practice scraping websites using our newfound abilities! Here is a <a href="http://www.visitithaca.com/attractions/wineries.html">list of wineries in Ithaca, NY</a>.</p>
<div id="extract-names" class="section level3">
<h3>Extract names</h3>
<p>First let’s download and store the HTML content.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">wineries &lt;-<span class="st"> </span><span class="kw">read_html</span>(<span class="st">&quot;http://www.visitithaca.com/attractions/wineries.html&quot;</span>)</code></pre></div>
<p>Now let’s extract the names and store them. To pick out the names, scroll down to the list of wineries and use the Selector Gadget to click on one of the winery names on the main page. Once you only have the winery names selected, you should see that the names are embedded in hyperlink tags (<code>&lt;a href...</code>) and it has a class of <code>indSearchListingTitle</code>. We can use <code>html_nodes</code> to extract this information and <code>html_text</code> to remove the extraneous HTML tags.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">fnames &lt;-<span class="st"> </span>wineries %&gt;%
<span class="st">  </span><span class="kw">html_nodes</span>(<span class="st">&quot;.indSearchListingTitle a&quot;</span>) %&gt;%
<span class="st">  </span><span class="kw">html_text</span>()
<span class="kw">head</span>(fnames)</code></pre></div>
<pre><code>## [1] &quot;Izzo White Barn Winery&quot;                  
## [2] &quot;Ports of New York&quot;                       
## [3] &quot;Swedish Hill Vineyard&quot;                   
## [4] &quot;Frontenac Point Vineyard &amp; Estate Winery&quot;
## [5] &quot;Six Mile Creek Vineyards&quot;                
## [6] &quot;Americana Vineyards &amp; Crystal Lake Cafe&quot;</code></pre>
</div>
<div id="extract-addresses" class="section level3">
<h3>Extract addresses</h3>
<p>The address is trickier. Using the select tool you’ll see that the details are stored in the <code>indMetaInfoWrapper</code> class, but also includes things like phone numbers. We just want the addresses, so use the Selector Gadget to only include addresses.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">faddress &lt;-<span class="st"> </span>wineries %&gt;%
<span class="st">  </span><span class="kw">html_nodes</span>(<span class="st">&quot;.indMetaWrapper:nth-child(1) .indMetaInfoWrapper&quot;</span>) %&gt;%
<span class="st">  </span><span class="kw">html_text</span>()
<span class="kw">head</span>(faddress)</code></pre></div>
<pre><code>## [1] &quot;\r\n              6634 Cayuga Rd., Cayuga, NY 13034\r\n              \r\n            &quot;               
## [2] &quot;\r\n              815 Taber St, Ithaca, NY 14850\r\n              \r\n            &quot;                  
## [3] &quot;\r\n              on the Cayuga Lake Wine Trail, Romulus, NY 14541\r\n              \r\n            &quot;
## [4] &quot;\r\n              9501 Rt. 89, Trumansburg, NY 14886\r\n              \r\n            &quot;              
## [5] &quot;\r\n              on the Cayuga Lake Wine Trail, Ithaca, NY 14850\r\n              \r\n            &quot; 
## [6] &quot;\r\n              4367 E. Covert Rd., Interlaken, NY 14847\r\n              \r\n            &quot;</code></pre>
<div id="clean-up-the-addresses" class="section level4">
<h4>Clean up the addresses</h4>
<p>The code on this website is a little inconsistent – sometimes the winery name is first and sometimes it’s preceded by something like “on the Cayuga Lake Wine Trail” so let’s do a little final cleanup.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">to_remove &lt;-<span class="st"> </span><span class="kw">str_c</span>(<span class="kw">c</span>(<span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>, <span class="st">&quot;^</span><span class="ch">\\</span><span class="st">s+|</span><span class="ch">\\</span><span class="st">s+$&quot;</span>, <span class="st">&quot;on the Cayuga Lake Wine Trail, &quot;</span>, <span class="st">&quot;Cayuga Lake Wine Trail, &quot;</span>, <span class="st">&quot;on the Cayuga Wine Trail, &quot;</span>,  <span class="st">&quot;on the Finger Lakes Beer Trail, &quot;</span>), <span class="dt">collapse =</span> <span class="st">&quot;|&quot;</span>)

faddress &lt;-<span class="st"> </span><span class="kw">str_replace_all</span>(faddress, to_remove, <span class="st">&quot;&quot;</span>)

<span class="kw">head</span>(faddress)</code></pre></div>
<pre><code>## [1] &quot;6634 Cayuga Rd., Cayuga, NY 13034&quot;       
## [2] &quot;815 Taber St, Ithaca, NY 14850&quot;          
## [3] &quot;Romulus, NY 14541&quot;                       
## [4] &quot;9501 Rt. 89, Trumansburg, NY 14886&quot;      
## [5] &quot;Ithaca, NY 14850&quot;                        
## [6] &quot;4367 E. Covert Rd., Interlaken, NY 14847&quot;</code></pre>
</div>
</div>
<div id="combine-with-an-api-to-geocode-the-addresses" class="section level3">
<h3>Combine with an API to geocode the addresses</h3>
<p>The package <code>ggmap</code> has a nice geocode function that we’ll use to extract coordinates.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">geocodes &lt;-<span class="st"> </span><span class="kw">geocode</span>(faddress, <span class="dt">output =</span> <span class="st">&quot;latlona&quot;</span>)
<span class="kw">head</span>(geocodes)</code></pre></div>
<pre><code>##         lon      lat                                     address
## 1 -76.70582 42.94002       6634 cayuga rd, cayuga, ny 13034, usa
## 2 -76.51510 42.43866         815 taber st, ithaca, ny 14850, usa
## 3 -76.83404 42.75255                      romulus, ny 14541, usa
## 4 -76.64552 42.56580      9501 ny-89, trumansburg, ny 14886, usa
## 5 -76.50188 42.44396                             ithaca, ny, usa
## 6 -76.67485 42.57722 4367 e covert rd, interlaken, ny 14847, usa</code></pre>
</div>
<div id="pull-it-all-together" class="section level3">
<h3>Pull it all together</h3>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">full &lt;-<span class="st"> </span><span class="kw">data_frame</span>(<span class="dt">name =</span> fnames) %&gt;%
<span class="st">  </span><span class="kw">bind_cols</span>(geocodes) %&gt;%
<span class="st">  </span><span class="co"># is it a winery or cidery?</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">category =</span> <span class="kw">ifelse</span>(<span class="kw">str_detect</span>(name, <span class="st">&quot;Winery&quot;</span>), <span class="st">&quot;Winery&quot;</span>, <span class="st">&quot;Cidery&quot;</span>))

<span class="kw">kable</span>(full)</code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">name</th>
<th align="right">lon</th>
<th align="right">lat</th>
<th align="left">address</th>
<th align="left">category</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Izzo White Barn Winery</td>
<td align="right">-76.70582</td>
<td align="right">42.94002</td>
<td align="left">6634 cayuga rd, cayuga, ny 13034, usa</td>
<td align="left">Winery</td>
</tr>
<tr class="even">
<td align="left">Ports of New York</td>
<td align="right">-76.51510</td>
<td align="right">42.43866</td>
<td align="left">815 taber st, ithaca, ny 14850, usa</td>
<td align="left">Cidery</td>
</tr>
<tr class="odd">
<td align="left">Swedish Hill Vineyard</td>
<td align="right">-76.83404</td>
<td align="right">42.75255</td>
<td align="left">romulus, ny 14541, usa</td>
<td align="left">Cidery</td>
</tr>
<tr class="even">
<td align="left">Frontenac Point Vineyard &amp; Estate Winery</td>
<td align="right">-76.64552</td>
<td align="right">42.56580</td>
<td align="left">9501 ny-89, trumansburg, ny 14886, usa</td>
<td align="left">Winery</td>
</tr>
<tr class="odd">
<td align="left">Six Mile Creek Vineyards</td>
<td align="right">-76.50188</td>
<td align="right">42.44396</td>
<td align="left">ithaca, ny, usa</td>
<td align="left">Cidery</td>
</tr>
<tr class="even">
<td align="left">Americana Vineyards &amp; Crystal Lake Cafe</td>
<td align="right">-76.67485</td>
<td align="right">42.57722</td>
<td align="left">4367 e covert rd, interlaken, ny 14847, usa</td>
<td align="left">Cidery</td>
</tr>
<tr class="odd">
<td align="left">Knapp Winery &amp; Vineyard Restaurant</td>
<td align="right">-76.83404</td>
<td align="right">42.75255</td>
<td align="left">romulus, ny 14541, usa</td>
<td align="left">Winery</td>
</tr>
<tr class="even">
<td align="left">Finger Lakes Cider House</td>
<td align="right">-76.70140</td>
<td align="right">42.60650</td>
<td align="left">4017 hickok rd, interlaken, ny 14847, usa</td>
<td align="left">Cidery</td>
</tr>
<tr class="odd">
<td align="left">Treleaven by King Ferry Winery</td>
<td align="right">-76.63443</td>
<td align="right">42.65034</td>
<td align="left">658 lake rd, king ferry, ny 13081, usa</td>
<td align="left">Winery</td>
</tr>
<tr class="even">
<td align="left">Eleven Lakes Winery</td>
<td align="right">-76.74876</td>
<td align="right">42.85320</td>
<td align="left">3550 ny-89, seneca falls, ny 13148, usa</td>
<td align="left">Winery</td>
</tr>
<tr class="odd">
<td align="left">Montezuma Winery &amp; Hidden Marsh Distillery</td>
<td align="right">-76.79662</td>
<td align="right">42.91062</td>
<td align="left">seneca falls, ny 13148, usa</td>
<td align="left">Winery</td>
</tr>
<tr class="even">
<td align="left">Buttonwood Grove Winery</td>
<td align="right">-76.83404</td>
<td align="right">42.75255</td>
<td align="left">romulus, ny 14541, usa</td>
<td align="left">Winery</td>
</tr>
<tr class="odd">
<td align="left">Varick Winery &amp; Vineyard</td>
<td align="right">-76.83404</td>
<td align="right">42.75255</td>
<td align="left">romulus, ny 14541, usa</td>
<td align="left">Winery</td>
</tr>
<tr class="even">
<td align="left">Goose Watch Winery</td>
<td align="right">-76.83404</td>
<td align="right">42.75255</td>
<td align="left">romulus, ny 14541, usa</td>
<td align="left">Winery</td>
</tr>
<tr class="odd">
<td align="left">Cayuga Ridge Estates Winery</td>
<td align="right">-76.82301</td>
<td align="right">42.67646</td>
<td align="left">ovid, ny 14521, usa</td>
<td align="left">Winery</td>
</tr>
<tr class="even">
<td align="left">Heart and Hands Winery</td>
<td align="right">-76.69293</td>
<td align="right">42.83970</td>
<td align="left">ny-90, new york, usa</td>
<td align="left">Winery</td>
</tr>
<tr class="odd">
<td align="left">Bellwether Hard Cider / Bellwether Wine Cellars</td>
<td align="right">-76.66606</td>
<td align="right">42.54229</td>
<td align="left">trumansburg, ny 14886, usa</td>
<td align="left">Cidery</td>
</tr>
<tr class="even">
<td align="left">Lucas Vineyards</td>
<td align="right">-76.71015</td>
<td align="right">42.62787</td>
<td align="left">3862 county rd 150, interlaken, ny 14847, usa</td>
<td align="left">Cidery</td>
</tr>
<tr class="odd">
<td align="left">Long Point Winery</td>
<td align="right">-76.70245</td>
<td align="right">42.75396</td>
<td align="left">aurora, ny 13026, usa</td>
<td align="left">Winery</td>
</tr>
<tr class="even">
<td align="left">Chateau Dusseau Winery</td>
<td align="right">-76.46788</td>
<td align="right">42.63096</td>
<td align="left">locke, ny 13092, usa</td>
<td align="left">Winery</td>
</tr>
<tr class="odd">
<td align="left">Dills Run Winery</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="left">NA</td>
<td align="left">Winery</td>
</tr>
<tr class="even">
<td align="left">Hosmer Winery</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="left">NA</td>
<td align="left">Winery</td>
</tr>
<tr class="odd">
<td align="left">Sheldrake Point Vineyard</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="left">NA</td>
<td align="left">Cidery</td>
</tr>
<tr class="even">
<td align="left">Cayuga Lake Wine Trail</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="left">NA</td>
<td align="left">Cidery</td>
</tr>
<tr class="odd">
<td align="left">Thirsty Owl Wine Company</td>
<td align="right">-76.82301</td>
<td align="right">42.67646</td>
<td align="left">ovid, ny 14521, usa</td>
<td align="left">Cidery</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div id="random-observations-on-scraping" class="section level1">
<h1>Random observations on scraping</h1>
<ul>
<li>Make sure you’ve obtained ONLY what you want! Scroll over the whole page to ensure that selectorgadget hasn’t found too many things</li>
<li>If you are having trouble parsing, try selecting a smaller subset of the thing you are seeking (i.e. being more precise)</li>
<li><strong>MOST IMPORTANT</strong> - confirm that there is NO R package and NO API before you spend hours scraping when the API was right here</li>
</ul>
</div>
<div id="acknowledgments" class="section level1 toc-ignore">
<h1>Acknowledgments</h1>
<ul>
<li>This page is derived in part from <a href="http://stat545.com">“UBC STAT 545A and 547M”</a>, licensed under the <a href="https://creativecommons.org/licenses/by-nc/3.0/">CC BY-NC 3.0 Creative Commons License</a>.</li>
<li>This page is derived in part from <a href="http://zevross.com/blog/2015/05/19/scrape-website-data-with-the-new-r-package-rvest/">“Scrape website data with the new R package <code>rvest</code> (+ a postscript on interacting with web pages with <code>RSelenium</code>)”</a>.</li>
</ul>
</div>
<div id="session-info" class="section level1 toc-ignore">
<h1>Session Info</h1>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">devtools::<span class="kw">session_info</span>()</code></pre></div>
<pre><code>## Session info -------------------------------------------------------------</code></pre>
<pre><code>##  setting  value                       
##  version  R version 3.3.3 (2017-03-06)
##  system   x86_64, darwin13.4.0        
##  ui       X11                         
##  language (EN)                        
##  collate  en_US.UTF-8                 
##  tz       America/Chicago             
##  date     2017-06-14</code></pre>
<pre><code>## Packages -----------------------------------------------------------------</code></pre>
<pre><code>##  package     * version    date       source                            
##  assertthat    0.2.0      2017-04-11 cran (@0.2.0)                     
##  backports     1.1.0      2017-05-22 CRAN (R 3.3.2)                    
##  base        * 3.3.3      2017-03-07 local                             
##  bitops        1.0-6      2013-08-17 CRAN (R 3.3.0)                    
##  broom         0.4.2      2017-02-13 CRAN (R 3.3.2)                    
##  cellranger    1.1.0      2016-07-27 CRAN (R 3.3.0)                    
##  colorspace    1.3-2      2016-12-14 CRAN (R 3.3.2)                    
##  curl        * 2.6        2017-04-27 CRAN (R 3.3.2)                    
##  datasets    * 3.3.3      2017-03-07 local                             
##  devtools      1.13.2     2017-06-02 CRAN (R 3.3.2)                    
##  digest        0.6.12     2017-01-27 CRAN (R 3.3.2)                    
##  dplyr       * 0.7.0      2017-06-09 cran (@0.7.0)                     
##  evaluate      0.10       2016-10-11 CRAN (R 3.3.0)                    
##  forcats       0.2.0      2017-01-23 CRAN (R 3.3.2)                    
##  foreign       0.8-68     2017-04-24 CRAN (R 3.3.2)                    
##  geosphere     1.5-5      2016-06-15 CRAN (R 3.3.0)                    
##  ggmap       * 2.7        2016-12-07 Github (dkahle/ggmap@c6b7579)     
##  ggplot2     * 2.2.1.9000 2017-06-13 Github (tidyverse/ggplot2@eedaa81)
##  glue          1.0.0      2017-04-17 cran (@1.0.0)                     
##  graphics    * 3.3.3      2017-03-07 local                             
##  grDevices   * 3.3.3      2017-03-07 local                             
##  grid          3.3.3      2017-03-07 local                             
##  gtable        0.2.0      2016-02-26 CRAN (R 3.3.0)                    
##  haven         1.0.0      2016-09-23 cran (@1.0.0)                     
##  hms           0.3        2016-11-22 CRAN (R 3.3.2)                    
##  htmltools     0.3.6      2017-04-28 cran (@0.3.6)                     
##  httr        * 1.2.1      2016-07-03 CRAN (R 3.3.0)                    
##  jpeg          0.1-8      2014-01-23 cran (@0.1-8)                     
##  jsonlite    * 1.5        2017-06-01 cran (@1.5)                       
##  knitr       * 1.16       2017-05-18 CRAN (R 3.3.2)                    
##  lattice       0.20-35    2017-03-25 CRAN (R 3.3.2)                    
##  lazyeval      0.2.0      2016-06-12 CRAN (R 3.3.0)                    
##  lubridate     1.6.0      2016-09-13 CRAN (R 3.3.0)                    
##  magrittr      1.5        2014-11-22 CRAN (R 3.3.0)                    
##  mapproj       1.2-5      2017-06-08 CRAN (R 3.3.2)                    
##  maps          3.2.0      2017-06-08 CRAN (R 3.3.2)                    
##  memoise       1.1.0      2017-04-21 CRAN (R 3.3.2)                    
##  methods     * 3.3.3      2017-03-07 local                             
##  mnormt        1.5-5      2016-10-15 CRAN (R 3.3.0)                    
##  modelr        0.1.0      2016-08-31 CRAN (R 3.3.0)                    
##  munsell       0.4.3      2016-02-13 CRAN (R 3.3.0)                    
##  nlme          3.1-131    2017-02-06 CRAN (R 3.3.3)                    
##  parallel      3.3.3      2017-03-07 local                             
##  plyr          1.8.4      2016-06-08 CRAN (R 3.3.0)                    
##  png           0.1-7      2013-12-03 cran (@0.1-7)                     
##  proto         1.0.0      2016-10-29 CRAN (R 3.3.0)                    
##  psych         1.7.5      2017-05-03 CRAN (R 3.3.3)                    
##  purrr       * 0.2.2.2    2017-05-11 CRAN (R 3.3.3)                    
##  R6            2.2.1      2017-05-10 CRAN (R 3.3.2)                    
##  Rcpp          0.12.11    2017-05-22 CRAN (R 3.3.2)                    
##  readr       * 1.1.1      2017-05-16 CRAN (R 3.3.2)                    
##  readxl        1.0.0      2017-04-18 CRAN (R 3.3.2)                    
##  reshape2      1.4.2      2016-10-22 CRAN (R 3.3.0)                    
##  RgoogleMaps   1.4.1      2016-09-18 cran (@1.4.1)                     
##  rjson         0.2.15     2014-11-03 cran (@0.2.15)                    
##  rlang         0.1.1.9000 2017-06-13 Github (hadley/rlang@7f53e56)     
##  rmarkdown     1.5        2017-04-26 CRAN (R 3.3.2)                    
##  rprojroot     1.2        2017-01-16 CRAN (R 3.3.2)                    
##  rvest       * 0.3.2      2016-06-17 CRAN (R 3.3.0)                    
##  scales        0.4.1      2016-11-09 CRAN (R 3.3.1)                    
##  sp            1.2-4      2016-12-22 CRAN (R 3.3.2)                    
##  stats       * 3.3.3      2017-03-07 local                             
##  stringi       1.1.5      2017-04-07 CRAN (R 3.3.2)                    
##  stringr     * 1.2.0      2017-02-18 CRAN (R 3.3.2)                    
##  tibble      * 1.3.3      2017-05-28 cran (@1.3.3)                     
##  tidyr       * 0.6.3      2017-05-15 CRAN (R 3.3.2)                    
##  tidyverse   * 1.1.1      2017-01-27 CRAN (R 3.3.2)                    
##  tools         3.3.3      2017-03-07 local                             
##  utils       * 3.3.3      2017-03-07 local                             
##  withr         1.0.2      2016-06-20 CRAN (R 3.3.0)                    
##  XML         * 3.98-1.7   2017-05-03 CRAN (R 3.3.2)                    
##  xml2        * 1.1.1      2017-01-24 CRAN (R 3.3.2)                    
##  yaml          2.1.14     2016-11-12 cran (@2.1.14)</code></pre>
</div>
<div class="footnotes">
<hr />
<ol>
<li id="fn1"><p><a href="http://www.jmarshall.com/easy/http/">Source: HTTP made really easy</a><a href="#fnref1">↩</a></p></li>
<li id="fn2"><p><a href="http://www.restapitutorial.com/httpstatuscodes.html">HTTP Status Codes</a><a href="#fnref2">↩</a></p></li>
<li id="fn3"><p>Based on <a href="https://blog.exploratory.io/analyzing-emotions-using-facial-expressions-in-video-with-microsoft-ai-and-r-8f7585dd0780">Analyzing Emotions using Facial Expressions in Video with Microsoft AI and R</a>, which is itself based on the original post <a href="https://benheubl.github.io/data%20analysis/fr/">How to apply face recognition API technology to data journalism with R and python</a>, which served as the basis for <a href="http://www.economist.com/blogs/graphicdetail/2016/10/daily-chart-12">The many debate faces of Donald Trump and Hillary Clinton</a>.<a href="#fnref3">↩</a></p></li>
<li id="fn4"><p>Not exactly predictive of the election results.<a href="#fnref4">↩</a></p></li>
</ol>
</div>

<p>This work is licensed under the  <a href="http://creativecommons.org/licenses/by-nc/4.0/">CC BY-NC 4.0 Creative Commons License</a>.</p>


</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
