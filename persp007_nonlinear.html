<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />


<meta name="author" content="MACS 30100 - Perspectives on Computational Modeling" />


<title>Statistical learning: moving beyond linearity</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/readable.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<script src="site_libs/navigation-1.1/codefolding.js"></script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-45631879-2', 'auto');
  ga('send', 'pageview');

</script>


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
div.sourceCode {
  overflow-x: visible;
}
</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>


<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>


</head>

<body>

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
button.code-folding-btn:focus {
  outline: none;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 66px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 71px;
  margin-top: -71px;
}

.section h2 {
  padding-top: 71px;
  margin-top: -71px;
}
.section h3 {
  padding-top: 71px;
  margin-top: -71px;
}
.section h4 {
  padding-top: 71px;
  margin-top: -71px;
}
.section h5 {
  padding-top: 71px;
  margin-top: -71px;
}
.section h6 {
  padding-top: 71px;
  margin-top: -71px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>


<div class="container-fluid main-container">

<!-- tabsets -->
<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});
</script>

<!-- code folding -->
<style type="text/css">
.code-folding-btn { margin-bottom: 4px; }
</style>
<script>
$(document).ready(function () {
  window.initializeCodeFolding("hide" === "show");
});
</script>




<script>
$(document).ready(function ()  {

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_').toLowerCase();
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}


.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
  padding-left: 25px;
  text-indent: 0;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>

<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row-fluid">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Computing for the Social Sciences</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">Home</a>
</li>
<li>
  <a href="faq.html">FAQ</a>
</li>
<li>
  <a href="syllabus.html">Syllabus</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">

<div class="btn-group pull-right">
<button type="button" class="btn btn-default btn-xs dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span>Code</span> <span class="caret"></span></button>
<ul class="dropdown-menu" style="min-width: 50px;">
<li><a id="rmd-show-all-code" href="#">Show All Code</a></li>
<li><a id="rmd-hide-all-code" href="#">Hide All Code</a></li>
</ul>
</div>



<h1 class="title toc-ignore">Statistical learning: moving beyond linearity</h1>
<h4 class="author"><em>MACS 30100 - Perspectives on Computational Modeling</em></h4>

</div>


<div id="objectives" class="section level1">
<h1>Objectives</h1>
<ul>
<li>Identify reasons for relaxing the linearity assumption of linear models</li>
<li>Introduce monotonic transformations</li>
<li>Introduce step functions</li>
<li>Demonstrate regression and smoothing splines</li>
<li>Review local regression</li>
<li>Explain generalized additive models for regression and classification</li>
<li>Practice interpreting estimated parameters in multiple variable models</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(tidyverse)
<span class="kw">library</span>(modelr)
<span class="kw">library</span>(broom)
<span class="kw">library</span>(rcfss)
<span class="kw">library</span>(titanic)
<span class="kw">library</span>(knitr)
<span class="kw">library</span>(splines)
<span class="kw">library</span>(ISLR)
<span class="kw">library</span>(lattice)
<span class="kw">library</span>(gam)

<span class="kw">set.seed</span>(<span class="dv">1234</span>)
<span class="kw">options</span>(<span class="dt">digits =</span> <span class="dv">3</span>)
<span class="kw">theme_set</span>(<span class="kw">theme_minimal</span>())</code></pre></div>
</div>
<div id="linearity-in-linear-models" class="section level1">
<h1>Linearity in linear models</h1>
<p>Linear models are a commonly used statistical learning method because they are intuitive and easy to interpret. The drawback is that in order to create that intuitiveness and interpretability, linear models also make strong assumptions of a <strong>linear relationship</strong> between the predictor(s) and response variable. It is an approximation, and in the real-world most relationships are not strictly linear. We could turn to more advanced statistical learning methods such as decision trees and support vector machines which do not impose a linear assumption, however conducting inference using those methods is more difficult. Instead, we would like to relax the linearity assumption while still maintaining the interpretability of linear models.</p>
<div id="when-to-relax-the-assumption" class="section level2">
<h2>When to relax the assumption</h2>
<div id="non-linearity-of-the-data" class="section level3">
<h3>Non-linearity of the data</h3>
<p>Linear regression models assume the relationship between predictors and the response variable is a straight line. Here I simulate the data generating process:</p>
<p><span class="math display">\[Y = 2 + 3X + \epsilon\]</span></p>
<p>where <span class="math inline">\(\epsilon\)</span> is random error distributed normally <span class="math inline">\(N(0,3)\)</span>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">sim_linear &lt;-<span class="st"> </span><span class="kw">data_frame</span>(<span class="dt">x =</span> <span class="kw">runif</span>(<span class="dv">100</span>, <span class="dv">0</span>, <span class="dv">10</span>),
                         <span class="dt">y =</span> <span class="dv">2</span> +<span class="st"> </span><span class="dv">3</span> *<span class="st"> </span>x +<span class="st"> </span><span class="kw">rnorm</span>(<span class="dv">100</span>, <span class="dv">0</span>, <span class="dv">3</span>))
sim_linear_mod &lt;-<span class="st"> </span><span class="kw">glm</span>(y ~<span class="st"> </span>x, <span class="dt">data =</span> sim_linear)

<span class="kw">ggplot</span>(sim_linear, <span class="kw">aes</span>(x, y)) +
<span class="st">  </span><span class="kw">geom_point</span>() +
<span class="st">  </span><span class="kw">geom_smooth</span>(<span class="dt">method =</span> <span class="st">&quot;lm&quot;</span>) +
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;Linear model for a linear relationship&quot;</span>)</code></pre></div>
<p><img src="persp007_nonlinear_files/figure-html/sim-linear-1.png" width="672" /></p>
<p>When this assumption holds, the <strong>residuals</strong> of the observations should be distributed normally with an expected error <span class="math inline">\(E(\epsilon) = 0\)</span> and not be correlated with the fitted values.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">sim_linear_pred &lt;-<span class="st"> </span>sim_linear %&gt;%
<span class="st">  </span><span class="kw">add_predictions</span>(sim_linear_mod) %&gt;%
<span class="st">  </span><span class="kw">add_residuals</span>(sim_linear_mod)

<span class="co"># distribution of residuals</span>
<span class="kw">ggplot</span>(sim_linear_pred, <span class="kw">aes</span>(resid)) +
<span class="st">  </span><span class="kw">geom_histogram</span>(<span class="kw">aes</span>(<span class="dt">y =</span> ..density..)) +
<span class="st">  </span><span class="kw">stat_function</span>(<span class="dt">fun =</span> dnorm,
                <span class="dt">args =</span> <span class="kw">list</span>(<span class="dt">mean =</span> <span class="kw">mean</span>(sim_linear_pred$resid),
                            <span class="dt">sd =</span> <span class="kw">sd</span>(sim_linear_pred$resid))) +
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;Linear model for a linear relationship&quot;</span>,
       <span class="dt">x =</span> <span class="st">&quot;Residuals&quot;</span>)</code></pre></div>
<p><img src="persp007_nonlinear_files/figure-html/sim-linear-resid-1.png" width="672" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># predicted vs. residuals</span>
<span class="kw">ggplot</span>(sim_linear_pred, <span class="kw">aes</span>(pred, resid)) +
<span class="st">  </span><span class="kw">geom_point</span>() +
<span class="st">  </span><span class="kw">geom_smooth</span>(<span class="dt">se =</span> <span class="ot">FALSE</span>) +
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;Linear model for a linear relationship&quot;</span>,
       <span class="dt">x =</span> <span class="st">&quot;Predicted values&quot;</span>,
       <span class="dt">y =</span> <span class="st">&quot;Residuals&quot;</span>)</code></pre></div>
<p><img src="persp007_nonlinear_files/figure-html/sim-linear-resid-2.png" width="672" /></p>
<p>Inferences we draw from the model will be accurate and the accuracy of the model will be high.</p>
<p>However if the relationship is not actually linear, then we should see a discernable pattern in the residuals plot. Now I simulate a data generating process:</p>
<p><span class="math display">\[Y = 2 + 3X + 2X^2 + \epsilon\]</span></p>
<p>with the same distribution of <span class="math inline">\(\epsilon\)</span> and fit a linear model to the data:</p>
<p><span class="math display">\[\hat{Y} = \hat{\beta}_0 + \hat{\beta}_1 X + \epsilon\]</span></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">sim_nonlinear &lt;-<span class="st"> </span><span class="kw">data_frame</span>(<span class="dt">x =</span> <span class="kw">runif</span>(<span class="dv">100</span>, <span class="dv">0</span>, <span class="dv">10</span>),
                         <span class="dt">y =</span> <span class="dv">2</span> +<span class="st"> </span><span class="dv">3</span> *<span class="st"> </span>x +<span class="st"> </span><span class="dv">2</span> *<span class="st"> </span>x^<span class="dv">2</span> +<span class="st"> </span><span class="kw">rnorm</span>(<span class="dv">100</span>, <span class="dv">0</span>, <span class="dv">3</span>))
sim_nonlinear_mod &lt;-<span class="st"> </span><span class="kw">glm</span>(y ~<span class="st"> </span>x, <span class="dt">data =</span> sim_nonlinear)

<span class="kw">ggplot</span>(sim_nonlinear, <span class="kw">aes</span>(x, y)) +
<span class="st">  </span><span class="kw">geom_point</span>() +
<span class="st">  </span><span class="kw">geom_smooth</span>(<span class="dt">method =</span> <span class="st">&quot;lm&quot;</span>) +
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;Linear model for a non-linear relationship&quot;</span>)</code></pre></div>
<p><img src="persp007_nonlinear_files/figure-html/sim-nonlinear-1.png" width="672" /></p>
<p>Now that the assumption no longer holds true, we see a distinct polynomial relationship between the predicted values <span class="math inline">\(\hat{y}_i\)</span> and the residuals <span class="math inline">\((y_i - \hat{y}_i)^2\)</span>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">sim_nonlinear_pred &lt;-<span class="st"> </span>sim_nonlinear %&gt;%
<span class="st">  </span><span class="kw">add_predictions</span>(sim_nonlinear_mod) %&gt;%
<span class="st">  </span><span class="kw">add_residuals</span>(sim_nonlinear_mod)

<span class="co"># distribution of residuals</span>
<span class="kw">ggplot</span>(sim_nonlinear_pred, <span class="kw">aes</span>(resid)) +
<span class="st">  </span><span class="kw">geom_histogram</span>(<span class="kw">aes</span>(<span class="dt">y =</span> ..density..)) +
<span class="st">  </span><span class="kw">stat_function</span>(<span class="dt">fun =</span> dnorm,
                <span class="dt">args =</span> <span class="kw">list</span>(<span class="dt">mean =</span> <span class="kw">mean</span>(sim_nonlinear_pred$resid),
                            <span class="dt">sd =</span> <span class="kw">sd</span>(sim_nonlinear_pred$resid))) +
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;Linear model for a non-linear relationship&quot;</span>,
       <span class="dt">x =</span> <span class="st">&quot;Residuals&quot;</span>)</code></pre></div>
<p><img src="persp007_nonlinear_files/figure-html/sim-nonlinear-resid-1.png" width="672" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># predicted vs. residuals</span>
<span class="kw">ggplot</span>(sim_nonlinear_pred, <span class="kw">aes</span>(pred, resid)) +
<span class="st">  </span><span class="kw">geom_point</span>() +
<span class="st">  </span><span class="kw">geom_smooth</span>(<span class="dt">se =</span> <span class="ot">FALSE</span>) +
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;Linear model for a non-linear relationship&quot;</span>,
       <span class="dt">x =</span> <span class="st">&quot;Predicted values&quot;</span>,
       <span class="dt">y =</span> <span class="st">&quot;Residuals&quot;</span>)</code></pre></div>
<p><img src="persp007_nonlinear_files/figure-html/sim-nonlinear-resid-2.png" width="672" /></p>
<p>If we want to draw accurate inferences from the model, we need to relax the linearity assumption in some way.</p>
</div>
<div id="non-constant-variance-of-the-error-terms" class="section level3">
<h3>Non-constant variance of the error terms</h3>
<p>Another assumption of linear regression is that the error terms <span class="math inline">\(\epsilon_i\)</span> have a constant variance, <span class="math inline">\(\text{Var}(\epsilon_i) = \sigma^2\)</span>. This is called <strong>homoscedasticity</strong>. Remember that the <a href="persp006_resampling.html#estimating_the_accuracy_of_a_linear_regression_model">standard errors directly rely upon the estimate of this value</a>:</p>
<p><span class="math display">\[\widehat{s.e.}(\hat{\beta}_j) = \sqrt{\hat{\sigma}^{2} (X^{T}X)^{-1}_{jj}}\]</span></p>
<p>If the variances of the error terms are non-constant (aka <strong>heteroscedastic</strong>), our estimates of the parameters <span class="math inline">\(\hat{\beta}\)</span> will still be unbiased because they do not depend on <span class="math inline">\(\sigma^2\)</span>. However our estimates of the standard errors will be inaccurate - they will either be inflated or deflated, leading to incorrect inferences about the statistical significance of predictor variables.</p>
<p>We can uncover homo- or heteroscedasticity through the use of the residual plot. Below is data generated from the process:</p>
<p><span class="math display">\[Y = 2 + 3X + \epsilon\]</span></p>
<p>where <span class="math inline">\(\epsilon\)</span> is random error distributed normally <span class="math inline">\(N(0,1)\)</span>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">sim_homo &lt;-<span class="st"> </span><span class="kw">data_frame</span>(<span class="dt">x =</span> <span class="kw">runif</span>(<span class="dv">1000</span>, <span class="dv">0</span>, <span class="dv">10</span>),
                       <span class="dt">y =</span> <span class="dv">2</span> +<span class="st"> </span><span class="dv">3</span> *<span class="st"> </span>x +<span class="st"> </span><span class="kw">rnorm</span>(<span class="dv">1000</span>, <span class="dv">0</span>, <span class="dv">1</span>))
sim_homo_mod &lt;-<span class="st"> </span><span class="kw">glm</span>(y ~<span class="st"> </span>x, <span class="dt">data =</span> sim_homo)

sim_homo %&gt;%
<span class="st">  </span><span class="kw">add_predictions</span>(sim_homo_mod) %&gt;%
<span class="st">  </span><span class="kw">add_residuals</span>(sim_homo_mod) %&gt;%
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(pred, resid)) +
<span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">alpha =</span> .<span class="dv">2</span>) +
<span class="st">  </span><span class="kw">geom_hline</span>(<span class="dt">yintercept =</span> <span class="dv">0</span>, <span class="dt">linetype =</span> <span class="dv">2</span>) +
<span class="st">  </span><span class="kw">geom_quantile</span>(<span class="dt">method =</span> <span class="st">&quot;rqss&quot;</span>, <span class="dt">lambda =</span> <span class="dv">5</span>, <span class="dt">quantiles =</span> <span class="kw">c</span>(.<span class="dv">05</span>, .<span class="dv">95</span>)) +
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;Homoscedastic variance of error terms&quot;</span>,
       <span class="dt">x =</span> <span class="st">&quot;Predicted values&quot;</span>,
       <span class="dt">y =</span> <span class="st">&quot;Residuals&quot;</span>)</code></pre></div>
<p><img src="persp007_nonlinear_files/figure-html/sim-homo-1.png" width="672" /></p>
<p>Compare this to a linear model fit to the data generating process:</p>
<p><span class="math display">\[Y = 2 + 3X + \epsilon\]</span></p>
<p>where <span class="math inline">\(\epsilon\)</span> is random error distributed normally <span class="math inline">\(N(0,\frac{X}{2})\)</span>. Note that the variance for the error term of each observation <span class="math inline">\(\epsilon_i\)</span> is not constant, and is itself a function of <span class="math inline">\(X\)</span>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">sim_hetero &lt;-<span class="st"> </span><span class="kw">data_frame</span>(<span class="dt">x =</span> <span class="kw">runif</span>(<span class="dv">1000</span>, <span class="dv">0</span>, <span class="dv">10</span>),
                       <span class="dt">y =</span> <span class="dv">2</span> +<span class="st"> </span><span class="dv">3</span> *<span class="st"> </span>x +<span class="st"> </span><span class="kw">rnorm</span>(<span class="dv">1000</span>, <span class="dv">0</span>, (x /<span class="st"> </span><span class="dv">2</span>)))
sim_hetero_mod &lt;-<span class="st"> </span><span class="kw">glm</span>(y ~<span class="st"> </span>x, <span class="dt">data =</span> sim_hetero)

sim_hetero %&gt;%
<span class="st">  </span><span class="kw">add_predictions</span>(sim_hetero_mod) %&gt;%
<span class="st">  </span><span class="kw">add_residuals</span>(sim_hetero_mod) %&gt;%
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(pred, resid)) +
<span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">alpha =</span> .<span class="dv">2</span>) +
<span class="st">  </span><span class="kw">geom_hline</span>(<span class="dt">yintercept =</span> <span class="dv">0</span>, <span class="dt">linetype =</span> <span class="dv">2</span>) +
<span class="st">  </span><span class="kw">geom_quantile</span>(<span class="dt">method =</span> <span class="st">&quot;rqss&quot;</span>, <span class="dt">lambda =</span> <span class="dv">5</span>, <span class="dt">quantiles =</span> <span class="kw">c</span>(.<span class="dv">05</span>, .<span class="dv">95</span>)) +
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;Heteroscedastic variance of error terms&quot;</span>,
       <span class="dt">x =</span> <span class="st">&quot;Predicted values&quot;</span>,
       <span class="dt">y =</span> <span class="st">&quot;Residuals&quot;</span>)</code></pre></div>
<p><img src="persp007_nonlinear_files/figure-html/sim-hetero-1.png" width="672" /></p>
<p>We see a distinct funnel-shape to the relationship between the predicted values and the residuals. This is because by assuming the variance is constant, we substantially over or underestimate the actual response <span class="math inline">\(Y_i\)</span> as <span class="math inline">\(X_i\)</span> increases.</p>
</div>
</div>
<div id="how-to-relax-the-assumption" class="section level2">
<h2>How to relax the assumption</h2>
<p>We have already seen how to do this by adding <a href="persp003_linear_regression.html#non-linear_relationships">quadratic</a> and <a href="persp004_logistic_regression.html#interactive_terms">interactive</a> terms. Here we will review adding other forms of monotonic transformations and explore alternative approaches to introducing non-linearity in both regression and classification problems.</p>
</div>
</div>
<div id="monotonic-transformations" class="section level1">
<h1>Monotonic transformations</h1>
<p>A <strong>monotonic function</strong> is a function for transforming a set of numbers into a different set of numbers so that the rank order of the original set of numbers is preserved. One major family of monotonic functions is the <strong>ladder of powers</strong>.</p>
<table>
<thead>
<tr class="header">
<th>Transformation</th>
<th>Power</th>
<th><span class="math inline">\(f(X)\)</span></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Cube</td>
<td>3</td>
<td><span class="math inline">\(X^3\)</span></td>
</tr>
<tr class="even">
<td>Square</td>
<td>2</td>
<td><span class="math inline">\(X^2\)</span></td>
</tr>
<tr class="odd">
<td>Identity</td>
<td>1</td>
<td><span class="math inline">\(X\)</span></td>
</tr>
<tr class="even">
<td>Square root</td>
<td><span class="math inline">\(\frac{1}{2}\)</span></td>
<td><span class="math inline">\(\sqrt{X}\)</span></td>
</tr>
<tr class="odd">
<td>Cube root</td>
<td><span class="math inline">\(\frac{1}{3}\)</span></td>
<td><span class="math inline">\(\sqrt[3]{X}\)</span></td>
</tr>
<tr class="even">
<td>Log</td>
<td>0 (sort of)</td>
<td><span class="math inline">\(\ln(X)\)</span></td>
</tr>
</tbody>
</table>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">data_frame</span>(<span class="dt">x =</span> <span class="kw">runif</span>(<span class="dv">1000</span>, <span class="dv">0</span>, <span class="dv">10</span>),
           <span class="dt">cube =</span> x^<span class="dv">3</span>,
           <span class="dt">square =</span> x^<span class="dv">2</span>,
           <span class="dt">identity =</span> x,
           <span class="dt">sqrt =</span> <span class="kw">sqrt</span>(x),
           <span class="dt">cubert =</span> x ^<span class="st"> </span>(<span class="dv">1</span>/<span class="dv">3</span>),
           <span class="dt">log =</span> <span class="kw">log</span>(x)) %&gt;%
<span class="st">  </span><span class="kw">gather</span>(transform, value, -x) %&gt;%
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">transform =</span> <span class="kw">factor</span>(transform,
                            <span class="dt">levels =</span> <span class="kw">c</span>(<span class="st">&quot;cube&quot;</span>, <span class="st">&quot;square&quot;</span>, <span class="st">&quot;identity&quot;</span>, <span class="st">&quot;sqrt&quot;</span>, <span class="st">&quot;cubert&quot;</span>, <span class="st">&quot;log&quot;</span>),
                            <span class="dt">labels =</span> <span class="kw">c</span>(<span class="st">&quot;X^3&quot;</span>, <span class="st">&quot;X^2&quot;</span>, <span class="st">&quot;X&quot;</span>, <span class="st">&quot;sqrt(X)&quot;</span>, <span class="st">&quot;sqrt(X, 3)&quot;</span>, <span class="st">&quot;ln(X)&quot;</span>))) %&gt;%
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(x, value)) +
<span class="st">  </span><span class="kw">geom_line</span>() +
<span class="st">  </span><span class="kw">facet_wrap</span>( ~<span class="st"> </span>transform, <span class="dt">scales =</span> <span class="st">&quot;free_y&quot;</span>, <span class="dt">labeller =</span> label_parsed) +
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;Ladder of powers transformations&quot;</span>,
       <span class="dt">x =</span> <span class="st">&quot;X&quot;</span>,
       <span class="dt">y =</span> <span class="st">&quot;Transformed X&quot;</span>)</code></pre></div>
<p><img src="persp007_nonlinear_files/figure-html/power-ladder-1.png" width="672" /></p>
<ul>
<li>Higher-order power transformations “inflate” large values and “compress” small ones</li>
<li>Lower-order power transformations “compress” large values and “inflate” small ones</li>
</ul>
<p>In order for power transformations to “work”, all the values of <span class="math inline">\(X\)</span> need to be <strong>positive</strong> (remember that $(0) is undefined). If you need to, you can adjust <span class="math inline">\(X\)</span> first to ensure it only contains positive values by adding the absolute value of the lowest (negative) value of <span class="math inline">\(X\)</span> (call it <span class="math inline">\(X_l\)</span>), plus some small additional value <span class="math inline">\(\epsilon\)</span> to <span class="math inline">\(X\)</span> itself:</p>
<p><span class="math display">\[X^* = X + (|X_l| + \epsilon)\]</span></p>
<div id="which-transformation-should-i-use" class="section level2">
<h2>Which transformation should I use?</h2>
<p>This depends on the situation. Typically we use these transformations to induce linearity between <span class="math inline">\(Y\)</span> and one or more predictors <span class="math inline">\(X\)</span>. Tukey and Mosteller suggest a “bulging rule” for power transformations to make things more linear:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># from http://freakonometrics.hypotheses.org/14967</span>
fakedataMT &lt;-<span class="st"> </span>function(<span class="dt">p =</span> <span class="dv">1</span>, <span class="dt">q =</span> <span class="dv">1</span>, <span class="dt">n =</span> <span class="dv">500</span>, <span class="dt">s =</span> .<span class="dv">1</span>) {
  X &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="dv">1</span> /<span class="st"> </span>(n +<span class="st"> </span><span class="dv">1</span>), <span class="dv">1</span> -<span class="st"> </span><span class="dv">1</span> /<span class="st"> </span>(n +<span class="st"> </span><span class="dv">1</span>), <span class="dt">length =</span> n)
  Y &lt;-<span class="st"> </span>(<span class="dv">5</span> +<span class="st"> </span><span class="dv">2</span> *<span class="st"> </span>X ^<span class="st"> </span>p +<span class="st"> </span><span class="kw">rnorm</span>(n, <span class="dt">sd =</span> s)) ^<span class="st"> </span>(<span class="dv">1</span> /<span class="st"> </span>q)
  <span class="kw">return</span>(<span class="kw">data_frame</span>(<span class="dt">x =</span> X, <span class="dt">y =</span> Y))
}

<span class="kw">bind_rows</span>(<span class="st">`</span><span class="dt">1</span><span class="st">`</span> =<span class="st"> </span><span class="kw">fakedataMT</span>(<span class="dt">p =</span> .<span class="dv">5</span>, <span class="dt">q =</span> <span class="dv">2</span>),
          <span class="st">`</span><span class="dt">2</span><span class="st">`</span> =<span class="st"> </span><span class="kw">fakedataMT</span>(<span class="dt">p =</span> <span class="dv">3</span>, <span class="dt">q =</span> -<span class="dv">5</span>),
          <span class="st">`</span><span class="dt">3</span><span class="st">`</span> =<span class="st"> </span><span class="kw">fakedataMT</span>(<span class="dt">p =</span> .<span class="dv">5</span>, <span class="dt">q =</span> -<span class="dv">1</span>),
          <span class="st">`</span><span class="dt">4</span><span class="st">`</span> =<span class="st"> </span><span class="kw">fakedataMT</span>(<span class="dt">p =</span> <span class="dv">3</span>, <span class="dt">q =</span> <span class="dv">5</span>),
          <span class="dt">.id =</span> <span class="st">&quot;id&quot;</span>) %&gt;%
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">id =</span> <span class="kw">factor</span>(id, <span class="dt">levels =</span> <span class="dv">1</span>:<span class="dv">4</span>,
                     <span class="dt">labels =</span> <span class="kw">c</span>(<span class="st">&quot;Log X or Square Y&quot;</span>, <span class="st">&quot;Square X or Y&quot;</span>,
                                <span class="st">&quot;Log X or Y&quot;</span>, <span class="st">&quot;Square X or Log Y&quot;</span>))) %&gt;%
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(x, y)) +
<span class="st">  </span><span class="kw">geom_point</span>() +
<span class="st">  </span><span class="kw">facet_wrap</span>(~<span class="st"> </span>id, <span class="dt">scales =</span> <span class="st">&quot;free_y&quot;</span>) +
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&#39;Tukey and Mosteller</span><span class="ch">\&#39;</span><span class="st">s &quot;Bulging Rule&quot; for monotone transformations to linearity&#39;</span>,
       <span class="dt">x =</span> <span class="st">&quot;X&quot;</span>,
       <span class="dt">y =</span> <span class="st">&quot;Y&quot;</span>) +
<span class="st">  </span><span class="kw">theme_bw</span>() +
<span class="st">  </span><span class="kw">theme</span>(<span class="dt">axis.ticks =</span> <span class="kw">element_blank</span>(),
        <span class="dt">axis.text =</span> <span class="kw">element_blank</span>(),
        <span class="dt">panel.grid =</span> <span class="kw">element_blank</span>())</code></pre></div>
<p><img src="persp007_nonlinear_files/figure-html/bulge-rule-1.png" width="672" /></p>
<p>Notice that you are not limited to transforming your predictors <span class="math inline">\(X\)</span> - <strong>you can also transform the response variable <span class="math inline">\(Y\)</span></strong>. You can use simple scatterplots and residual plots to help determine if a transformation is necessary, but these are not a substitute for <strong>good theory</strong>. Is there a theoretical reason why the relationship should be curvilinear rather than strictly linear? If so, use that as a guide to determine an appropriate transformation.</p>
</div>
<div id="interpreting-transformed-variables" class="section level2">
<h2>Interpreting transformed variables</h2>
<div id="log-transformations" class="section level3">
<h3>Log transformations</h3>
<p>Interpreting the transformed variables is relatively straightforward. For instance, let’s use the example of a one-sided log transformation of <span class="math inline">\(Y\)</span>:</p>
<p><span class="math display">\[\ln(Y_i) = \beta_0 + \beta_{1}X_i + \epsilon_i\]</span></p>
<p>The expected value for <span class="math inline">\(Y\)</span> is therefore:</p>
<p><span class="math display">\[E(Y) = e^{\beta_0 + \beta_{1}X_i}\]</span></p>
<p>This means that the effect of a one-unit increase in <span class="math inline">\(X\)</span> on the expected value of <span class="math inline">\(Y\)</span> is:</p>
<p><span class="math display">\[\frac{\vartheta E(Y)}{\vartheta X} = e^{\beta_1}\]</span></p>
<p>What used to be a strictly linear relationship is now multiplicative (and non-linear). So for instance if <span class="math inline">\(\beta_1 = 0.69\)</span> then <span class="math inline">\(e^{\beta_1} = 2\)</span>. So for every one-unit change in <span class="math inline">\(X\)</span>, we believe the expected value of <span class="math inline">\(Y\)</span> will double. Conversely, if <span class="math inline">\(\beta_1 = -0.69\)</span> then <span class="math inline">\(e^{\beta_1} = 0.5\)</span>, meaning a one-unit increase in <span class="math inline">\(X\)</span> is associated with a decrease in <span class="math inline">\(\hat{Y}\)</span> by about <span class="math inline">\(50\%\)</span>.</p>
<p>The same thing holds true for a regression where <span class="math inline">\(X\)</span> is the transformed variable:</p>
<p><span class="math display">\[Y_i = \beta_0 + \beta_{1} \ln(X_i) + \epsilon_i\]</span></p>
<p>Now the expected value of <span class="math inline">\(Y\)</span> varies linearly with the natural log of <span class="math inline">\(X\)</span>. Substantively, this is also a multiplicative relationship but in the “opposite direction”. That is, a multiplicative increase in <span class="math inline">\(X\)</span> has a linear increase on <span class="math inline">\(Y\)</span> of <span class="math inline">\(\beta_1\)</span> magnitude.</p>
<div id="log-log-regressions" class="section level4">
<h4>Log-log regressions</h4>
<p>A special case is the instance where both <span class="math inline">\(X\)</span> and <span class="math inline">\(Y\)</span> are logarithmically transformed:</p>
<p><span class="math display">\[\ln(Y_i) = \beta_0 + \beta_{1} \ln(X_i) + \dots + \epsilon_i\]</span></p>
<p>The parameter <span class="math inline">\(\beta_1\)</span> can be interpreted as the <strong>elasticity</strong> of <span class="math inline">\(Y\)</span> with respect to <span class="math inline">\(X\)</span>:</p>
<p><span class="math display">\[\text{Elasticity}_{YX} = \frac{\% \Delta Y}{\% \Delta X}\]</span></p>
<p>This can be interpreted a few different ways:</p>
<ul>
<li>A direct means of interpreting a nonlinear effect: a one-percent change in <span class="math inline">\(X\)</span> leads to a <span class="math inline">\(\hat{\beta}_1\)</span>-percent change in <span class="math inline">\(Y\)</span>.</li>
<li>A double multiplicative relationship: an increase in <span class="math inline">\(X\)</span> of some multiplicative factor <span class="math inline">\(\delta\)</span> leads to a multiplicative increase in <span class="math inline">\(Y\)</span> equal to <span class="math inline">\(\delta^{\beta_1}\)</span>.</li>
<li>If we have an estimate of <span class="math inline">\(\hat{\beta}_1 = 0.5\)</span> in a log-log regression, and you want to know the effect on the predicted value of <span class="math inline">\(Y\)</span> of tripling <span class="math inline">\(X\)</span>, that effect is equal to <span class="math inline">\(3^{0.5} \approx = 1.73\)</span>. That is, tripling <span class="math inline">\(X\)</span> is associated with an increase in the expected value of <span class="math inline">\(Y\)</span> by a factor of 1.73 (i.e. increase it by 73 percent).</li>
</ul>
</div>
</div>
</div>
<div id="polynomial-regressions" class="section level2">
<h2>Polynomial regressions</h2>
<p><strong>Polynomial regression</strong> is a technique we have already discussed at length and is just a special case of monotonic transformations. Rather than fitting the standard linear model:</p>
<p><span class="math display">\[y_i = \beta_0 + \beta_{1}x_{i} + \epsilon_{i}\]</span></p>
<p>we instead fit a polynomial function:</p>
<p><span class="math display">\[y_i = \beta_0 + \beta_{1}x_{i} + \beta_{2}x_i^2 + \beta_{3}x_i^3 + \dots + \beta_{d}x_i^d + \epsilon_i\]</span></p>
<p>As <span class="math inline">\(d\)</span> increases, the linear model’s flexibility increases. We still use ordinary least squares (OLS) regression (or a Normal GLM) to estimate the parameters, which are also interpreted in the same way.</p>
<div id="biden-and-age" class="section level3">
<h3>Biden and age</h3>
<p>Let’s take a look at the <a href="https://github.com/UC-MACSS/persp-model/blob/master/assignments/PS5/ps5-linear-regression.md">Joe Biden feeling thermometer data</a> again and estimate a polynomial regression of the relationship between age and attitudes towards Biden:</p>
<p><span class="math display">\[\text{Biden}_i = \beta_0 + \beta_1 \text{Age} + \beta_2 \text{Age}^2 + \beta_3 \text{Age}^3 + \beta_4 \text{Age}^4\]</span></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># get data</span>
biden &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">&quot;data/biden.csv&quot;</span>)

<span class="co"># estimate model</span>
biden_age &lt;-<span class="st"> </span><span class="kw">glm</span>(biden ~<span class="st"> </span><span class="kw">I</span>(age^<span class="dv">1</span>) +<span class="st"> </span><span class="kw">I</span>(age^<span class="dv">2</span>) +<span class="st"> </span><span class="kw">I</span>(age^<span class="dv">3</span>) +<span class="st"> </span><span class="kw">I</span>(age^<span class="dv">4</span>), <span class="dt">data =</span> biden)
<span class="kw">tidy</span>(biden_age)</code></pre></div>
<pre><code>##          term  estimate std.error statistic p.value
## 1 (Intercept)  3.75e+01  2.49e+01      1.50   0.133
## 2    I(age^1)  2.37e+00  2.28e+00      1.04   0.299
## 3    I(age^2) -8.33e-02  7.30e-02     -1.14   0.254
## 4    I(age^3)  1.22e-03  9.76e-04      1.25   0.211
## 5    I(age^4) -6.22e-06  4.64e-06     -1.34   0.180</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># estimate the predicted values and confidence interval</span>
biden_pred &lt;-<span class="st"> </span><span class="kw">augment</span>(biden_age, <span class="dt">newdata =</span> <span class="kw">data_grid</span>(biden, age)) %&gt;%
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">pred_low =</span> .fitted -<span class="st"> </span><span class="fl">1.96</span> *<span class="st"> </span>.se.fit,
         <span class="dt">pred_high =</span> .fitted +<span class="st"> </span><span class="fl">1.96</span> *<span class="st"> </span>.se.fit)

<span class="co"># plot the curve</span>
<span class="kw">ggplot</span>(biden_pred, <span class="kw">aes</span>(age)) +
<span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">data =</span> biden, <span class="kw">aes</span>(age, biden), <span class="dt">alpha =</span> .<span class="dv">05</span>) +
<span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">y =</span> .fitted)) +
<span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">y =</span> pred_low), <span class="dt">linetype =</span> <span class="dv">2</span>) +
<span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">y =</span> pred_high), <span class="dt">linetype =</span> <span class="dv">2</span>) +
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;Polynomial regression of Biden feeling thermometer&quot;</span>,
       <span class="dt">subtitle =</span> <span class="st">&quot;With 95% confidence interval&quot;</span>,
       <span class="dt">x =</span> <span class="st">&quot;Age&quot;</span>,
       <span class="dt">y =</span> <span class="st">&quot;Predicted Biden thermometer rating&quot;</span>)</code></pre></div>
<p><img src="persp007_nonlinear_files/figure-html/biden-age-1.png" width="672" /></p>
<p>When interpreting the model, we don’t look to any individual parameters since they are all based on the same variable. Instead we fit the function to the full range of potential values for age (hence the use of <code>data_grid()</code>) and examine the relationship.</p>
<p>In the figure above I graphed the predicted values with 95% confidence intervals. In the case of ordinary linear regression, this is easy to estimate. The <strong>standard error</strong> is a measure of variance for the estimated parameter and defined by the square root of the diagonal of the variance-covariance matrix:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">vcov</span>(biden_age) %&gt;%
<span class="st">  </span><span class="kw">kable</span>(<span class="dt">caption =</span> <span class="st">&quot;Variance-covariance matrix of Biden polynomial regression&quot;</span>,
        <span class="dt">digits =</span> <span class="dv">5</span>)</code></pre></div>
<table>
<caption>Variance-covariance matrix of Biden polynomial regression</caption>
<thead>
<tr class="header">
<th></th>
<th align="right">(Intercept)</th>
<th align="right">I(age^1)</th>
<th align="right">I(age^2)</th>
<th align="right">I(age^3)</th>
<th align="right">I(age^4)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>(Intercept)</td>
<td align="right">620.00316</td>
<td align="right">-56.31558</td>
<td align="right">1.76432</td>
<td align="right">-0.02291</td>
<td align="right">0.00011</td>
</tr>
<tr class="even">
<td>I(age^1)</td>
<td align="right">-56.31558</td>
<td align="right">5.20765</td>
<td align="right">-0.16556</td>
<td align="right">0.00218</td>
<td align="right">-0.00001</td>
</tr>
<tr class="odd">
<td>I(age^2)</td>
<td align="right">1.76432</td>
<td align="right">-0.16556</td>
<td align="right">0.00533</td>
<td align="right">-0.00007</td>
<td align="right">0.00000</td>
</tr>
<tr class="even">
<td>I(age^3)</td>
<td align="right">-0.02291</td>
<td align="right">0.00218</td>
<td align="right">-0.00007</td>
<td align="right">0.00000</td>
<td align="right">0.00000</td>
</tr>
<tr class="odd">
<td>I(age^4)</td>
<td align="right">0.00011</td>
<td align="right">-0.00001</td>
<td align="right">0.00000</td>
<td align="right">0.00000</td>
<td align="right">0.00000</td>
</tr>
</tbody>
</table>
<p>Confidence intervals are typically plus/minus 1.96 times the standard error for the parameter. However for polynomial regression, this is more complicated. Suppose we compute the fit at a particular value of age, <span class="math inline">\(x_0\)</span>:</p>
<p><span class="math display">\[\hat{f}(x_0) = \hat{\beta}_0 + \hat{\beta}_1 x_{0} + \hat{\beta}_2 x_{0}^2 + \hat{\beta}_3 x_{0}^3 + \hat{\beta}_4 x_{0}^4\]</span></p>
<p>What is the variance of the fit for this point, i.e. <span class="math inline">\(\text{Var}(\hat{f}(x_o))\)</span>. The variance is now a function not only of <span class="math inline">\(\hat{\beta}_1\)</span>, but the variance of each of the estimated parameters <span class="math inline">\(\hat{\beta}_j\)</span> as well as the covariances between the pairs of estimated parameters (i.e. the off-diagonal elements). We use all of this information to estimate the <strong>pointwise</strong> standard error of <span class="math inline">\(\hat{f}(x_0)\)</span>, which is the square-root of the variance <span class="math inline">\(\text{Var}(\hat{f}(x_o))\)</span>.</p>
</div>
<div id="voter-turnout-and-mental-health" class="section level3">
<h3>Voter turnout and mental health</h3>
<p>Likewise, we can use polynomial regression for classification problems as well. Consider the <a href="https://github.com/UC-MACSS/persp-model/blob/master/assignments/PS6/ps6-glm.md">mental health and voting data</a>. Let’s estimate a logistic regression model of the relationship between mental health and voter turnout:</p>
<p><span class="math display">\[\Pr(\text{Voter turnout} = \text{Yes} | \text{mhealth}) = \frac{\exp[\beta_0 + \beta_1 \text{mhealth} + \beta_2 \text{mhealth}^2 + \beta_3 \text{mhealth}^3 + \beta_4 \text{mhealth}^4]}{1 + \exp[\beta_0 + \beta_1 \text{mhealth} + \beta_2 \text{mhealth}^2 + \beta_3 \text{mhealth}^3 + \beta_4 \text{mhealth}^4]}\]</span></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># load data</span>
mh &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">&quot;data/mental_health.csv&quot;</span>)

<span class="co"># estimate model</span>
mh_mod &lt;-<span class="st"> </span><span class="kw">glm</span>(vote96 ~<span class="st"> </span><span class="kw">poly</span>(mhealth_sum, <span class="dv">4</span>, <span class="dt">raw =</span> <span class="ot">TRUE</span>), <span class="dt">data =</span> mh,
              <span class="dt">family =</span> binomial)
<span class="kw">tidy</span>(mh_mod)</code></pre></div>
<pre><code>##                                term  estimate std.error statistic  p.value
## 1                       (Intercept)  1.084465  0.119372      9.08 1.04e-19
## 2 poly(mhealth_sum, 4, raw = TRUE)1  0.244677  0.160774      1.52 1.28e-01
## 3 poly(mhealth_sum, 4, raw = TRUE)2 -0.169696  0.057135     -2.97 2.98e-03
## 4 poly(mhealth_sum, 4, raw = TRUE)3  0.019607  0.006729      2.91 3.57e-03
## 5 poly(mhealth_sum, 4, raw = TRUE)4 -0.000637  0.000245     -2.60 9.20e-03</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># estimate the predicted values and confidence interval</span>
mh_pred &lt;-<span class="st"> </span><span class="kw">augment</span>(mh_mod, <span class="dt">newdata =</span> <span class="kw">data_grid</span>(mh, mhealth_sum)) %&gt;%
<span class="st">  </span><span class="kw">rename</span>(<span class="dt">pred =</span> .fitted) %&gt;%
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">pred_low =</span> pred -<span class="st"> </span><span class="fl">1.96</span> *<span class="st"> </span>.se.fit,
         <span class="dt">pred_high =</span> pred +<span class="st"> </span><span class="fl">1.96</span> *<span class="st"> </span>.se.fit) 

<span class="co"># plot the log-odds curve</span>
<span class="kw">ggplot</span>(mh_pred, <span class="kw">aes</span>(mhealth_sum, pred, <span class="dt">ymin =</span> pred_low, <span class="dt">ymax =</span> pred_high)) +
<span class="st">  </span><span class="kw">geom_point</span>() +
<span class="st">  </span><span class="kw">geom_errorbar</span>() +
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;Polynomial regression of voter turnout&quot;</span>,
       <span class="dt">subtitle =</span> <span class="st">&quot;With 95% confidence interval&quot;</span>,
       <span class="dt">x =</span> <span class="st">&quot;Mental health score&quot;</span>,
       <span class="dt">y =</span> <span class="st">&quot;Predicted log-odds of voter turnout&quot;</span>)</code></pre></div>
<p><img src="persp007_nonlinear_files/figure-html/mhealth-1.png" width="672" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># plot the probability curve</span>
mh_pred %&gt;%
<span class="st">  </span><span class="kw">mutate_each</span>(<span class="kw">funs</span>(logit2prob), <span class="kw">starts_with</span>(<span class="st">&quot;pred&quot;</span>)) %&gt;%
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(mhealth_sum, pred, <span class="dt">ymin =</span> pred_low, <span class="dt">ymax =</span> pred_high)) +
<span class="st">  </span><span class="kw">geom_point</span>() +
<span class="st">  </span><span class="kw">geom_errorbar</span>() +
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;Polynomial regression of voter turnout&quot;</span>,
       <span class="dt">subtitle =</span> <span class="st">&quot;With 95% confidence interval&quot;</span>,
       <span class="dt">x =</span> <span class="st">&quot;Mental health score&quot;</span>,
       <span class="dt">y =</span> <span class="st">&quot;Predicted probability of voter turnout&quot;</span>)</code></pre></div>
<p><img src="persp007_nonlinear_files/figure-html/mhealth-2.png" width="672" /></p>
<p>With logistic regression we presume the relationship between <span class="math inline">\(X\)</span> and the log-odds of <span class="math inline">\(Y\)</span> is linear, whereas the relationship between <span class="math inline">\(X\)</span> and the probability of <span class="math inline">\(Y\)</span> is curvilinear, defined by the logit function <span class="math inline">\(\ln \left( \frac{\Pr(Y)}{1 - \Pr(Y)} \right)\)</span>. Now with the polynomial terms, even the predicted log-odds relationship is <strong>curvilinear</strong>. Notice that the confidence intervals are narrow for lower mental health scores and larger for higher values. This is because there are fewer individuals with high levels of depression, so the variance is larger around these scores for mental health.</p>
</div>
</div>
</div>
<div id="step-functions" class="section level1">
<h1>Step functions</h1>
<p>Monotonic transformations impose a <strong>global</strong> structure on the non-linear function of <span class="math inline">\(X\)</span>. That is, the function applies across the entire range of <span class="math inline">\(X\)</span>. Instead, we may believe that the non-linear behavior of <span class="math inline">\(X\)</span> is instead a <strong>local</strong> structure that varies across the range of <span class="math inline">\(X\)</span>. We can use <strong>step functions</strong> to avoid imposing a global structure. In step functions, you split the predictor <span class="math inline">\(X\)</span> into <strong>bins</strong> and fit a different constant to each bin. This converts a continuous variable into an <strong>ordered categorical variable</strong>.</p>
<p>We create <span class="math inline">\(c_1, c_2, \dots, c_K\)</span> cutpoints in the range of <span class="math inline">\(X\)</span>, and construct <span class="math inline">\(K + 1\)</span> new variables <span class="math inline">\(C_1(X), C_2(X), \dots, C_K(X)\)</span>. Each of the new variables is an <strong>indicator</strong> or <strong>dummy</strong> variable that returns a 1 if <span class="math inline">\(x_i\)</span> falls within the range of the cutpoints and 0 otherwise. For any given <span class="math inline">\(x_i\)</span>, the sum of these variables will be precisely <span class="math inline">\(1\)</span>. We can then fit the linear regression model to the new indicator variables as predictors:</p>
<p><span class="math display">\[y_i = \beta_0 + \beta_1 C_1 (x_i) + \beta_2 C_2 (x_i) + \dots + \beta_K C_K (x_i) + \epsilon_i\]</span></p>
<div id="biden-and-age-1" class="section level2">
<h2>Biden and age</h2>
<p>We can fit a piecewise constant regression to the Biden data, dividing age into 5 bins.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># estimate model</span>
biden_step &lt;-<span class="st"> </span><span class="kw">glm</span>(biden ~<span class="st"> </span><span class="kw">cut</span>(age, <span class="dv">5</span>), <span class="dt">data =</span> biden)
<span class="kw">tidy</span>(biden_step)</code></pre></div>
<pre><code>##                   term estimate std.error statistic p.value
## 1          (Intercept)    61.68      1.11    55.369   0.000
## 2   cut(age, 5)(33,48]    -1.28      1.52    -0.841   0.400
## 3   cut(age, 5)(48,63]     1.32      1.52     0.869   0.385
## 4   cut(age, 5)(63,78]     2.22      1.82     1.221   0.222
## 5 cut(age, 5)(78,93.1]     3.59      2.91     1.232   0.218</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># estimate the predicted values and confidence interval</span>
biden_step_pred &lt;-<span class="st"> </span><span class="kw">augment</span>(biden_step, <span class="dt">newdata =</span> <span class="kw">data_grid</span>(biden, age)) %&gt;%
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">pred_low =</span> .fitted -<span class="st"> </span><span class="fl">1.96</span> *<span class="st"> </span>.se.fit,
         <span class="dt">pred_high =</span> .fitted +<span class="st"> </span><span class="fl">1.96</span> *<span class="st"> </span>.se.fit)

<span class="co"># plot the curve</span>
<span class="kw">ggplot</span>(biden_step_pred, <span class="kw">aes</span>(age)) +
<span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">data =</span> biden, <span class="kw">aes</span>(age, biden), <span class="dt">alpha =</span> .<span class="dv">05</span>) +
<span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">y =</span> .fitted)) +
<span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">y =</span> pred_low), <span class="dt">linetype =</span> <span class="dv">2</span>) +
<span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">y =</span> pred_high), <span class="dt">linetype =</span> <span class="dv">2</span>) +
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;Piecewise constant regression of Biden feeling thermometer&quot;</span>,
       <span class="dt">subtitle =</span> <span class="st">&quot;With 95% confidence interval&quot;</span>,
       <span class="dt">x =</span> <span class="st">&quot;Age&quot;</span>,
       <span class="dt">y =</span> <span class="st">&quot;Predicted Biden thermometer rating&quot;</span>)</code></pre></div>
<p><img src="persp007_nonlinear_files/figure-html/biden-step-1.png" width="672" /></p>
</div>
</div>
<div id="regression-splines" class="section level1">
<h1>Regression splines</h1>
<p><strong>Regression splines</strong> extend monotonic transformations and piecewise constant regression by fitting separate polynomial functions over different regions of <span class="math inline">\(X\)</span>.</p>
<div id="piecewise-polynomials" class="section level2">
<h2>Piecewise polynomials</h2>
<p><strong>Piecewise polynomial regression</strong> fits separate low-degree polynomials for different regions of <span class="math inline">\(X\)</span>. For instance, a cubic piecewise polynomial regression model takes the form:</p>
<p><span class="math display">\[y_i = \beta_0 + \beta_1 x_i + \beta_2 x_i^2 + \beta_3 x_i^3 + \epsilon_i\]</span></p>
<p>where the <span class="math inline">\(\beta\)</span>s are now vectors with different values for different parts of the range of <span class="math inline">\(X\)</span>. The points where the parameters change are called <strong>knots</strong>.</p>
<p>The special case of a piecewise cubic polynomial with 0 knots is just an ordinary cubic polynomial:</p>
<p><span class="math display">\[y_i = \beta_0 + \beta_1 x_i + \beta_2 x_i^2 + \beta_3 x_i^3 + \epsilon_i\]</span></p>
<p>Likewise, the special case of a piecewise constant polynomial (i.e. polynomial with degree <span class="math inline">\(0\)</span>) is piecewise constant regression.</p>
<p>A piecewise cubic polynomial with a single knot at point <span class="math inline">\(c\)</span> takes the form:</p>
<p><span class="math display">\[y_i = \begin{cases} 
      \beta_{01} + \beta_{11}x_i^2 + \beta_{21}x_i^2 + \beta_{31}x_i^3 + \epsilon_i &amp; \text{if } x_i &lt; c \\
      \beta_{02} + \beta_{12}x_i^2 + \beta_{22}x_i^2 + \beta_{32}x_i^3 + \epsilon_i &amp; \text{if } x_i \geq c
   \end{cases}\]</span></p>
<p>In essence, we fit two separate polynomial functions to the data. Each function is estimated using least squares applied to the individual functions and subsets of data. The more knots <span class="math inline">\(K\)</span> used, the more flexible the piecewise polynomial.</p>
<p>Of course this leads to a somewhat odd and discontinuous function:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># simulate data</span>
sim_piece &lt;-<span class="st"> </span><span class="kw">data_frame</span>(<span class="dt">x =</span> <span class="kw">runif</span>(<span class="dv">100</span>, <span class="dv">0</span>, <span class="dv">10</span>),
                        <span class="dt">y =</span> <span class="kw">ifelse</span>(x &lt;<span class="st"> </span><span class="dv">5</span>,
                                   .<span class="dv">05</span> *<span class="st"> </span>x +<span class="st"> </span>.<span class="dv">05</span> *<span class="st"> </span>x^<span class="dv">2</span> +<span class="st"> </span>.<span class="dv">05</span> *<span class="st"> </span>x^<span class="dv">3</span> +<span class="st"> </span><span class="kw">rnorm</span>(<span class="dv">100</span>, <span class="dv">0</span>, <span class="dv">3</span>),
                                   .<span class="dv">1</span> *<span class="st"> </span>x +<span class="st"> </span>.<span class="dv">1</span> *<span class="st"> </span>x^<span class="dv">2</span> -<span class="st"> </span>.<span class="dv">05</span> *<span class="st"> </span>x^<span class="dv">3</span> +<span class="st"> </span><span class="kw">rnorm</span>(<span class="dv">100</span>, <span class="dv">0</span>, <span class="dv">3</span>)))

<span class="co"># estimate models</span>
sim_piece_mod1 &lt;-<span class="st"> </span><span class="kw">glm</span>(y ~<span class="st"> </span><span class="kw">poly</span>(x, <span class="dv">3</span>, <span class="dt">raw =</span> <span class="ot">TRUE</span>), <span class="dt">data =</span> sim_piece, <span class="dt">subset =</span> x &lt;<span class="st"> </span><span class="dv">5</span>)
sim_piece_mod2 &lt;-<span class="st"> </span><span class="kw">glm</span>(y ~<span class="st"> </span><span class="kw">poly</span>(x, <span class="dv">3</span>, <span class="dt">raw =</span> <span class="ot">TRUE</span>), <span class="dt">data =</span> sim_piece, <span class="dt">subset =</span> x &gt;=<span class="st"> </span><span class="dv">5</span>)

<span class="co"># draw the plot</span>
sim_piece %&gt;%
<span class="st">  </span><span class="kw">data_grid</span>(<span class="dt">x =</span> <span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">10</span>, <span class="dt">by =</span> .<span class="dv">001</span>)) %&gt;%
<span class="st">  </span><span class="kw">gather_predictions</span>(sim_piece_mod1, sim_piece_mod2) %&gt;%
<span class="st">  </span><span class="kw">filter</span>((x &lt;<span class="st"> </span><span class="dv">5</span> &amp;<span class="st"> </span>model ==<span class="st"> &quot;sim_piece_mod1&quot;</span>) |
<span class="st">           </span>(x &gt;=<span class="dv">5</span> &amp;<span class="st"> </span>model ==<span class="st"> &quot;sim_piece_mod2&quot;</span>)) %&gt;%
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(x, y)) +
<span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">data =</span> sim_piece) +
<span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">y =</span> pred, <span class="dt">color =</span> model), <span class="dt">size =</span> <span class="dv">1</span>) +
<span class="st">  </span><span class="kw">geom_vline</span>(<span class="dt">xintercept =</span> <span class="dv">5</span>, <span class="dt">linetype =</span> <span class="dv">2</span>, <span class="dt">color =</span> <span class="st">&quot;grey&quot;</span>) +
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;Piecewise cubic regression&quot;</span>,
       <span class="dt">x =</span> <span class="st">&quot;X&quot;</span>,
       <span class="dt">y =</span> <span class="st">&quot;Y&quot;</span>) +
<span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">&quot;none&quot;</span>)</code></pre></div>
<p><img src="persp007_nonlinear_files/figure-html/sim-piecewise-1.png" width="672" /></p>
</div>
<div id="constraints-and-splines" class="section level2">
<h2>Constraints and splines</h2>
<p>Instead of a discontinuous piecewise function, we’d rather have something continuous. That is, we impose the <strong>constraint</strong> that the fitted curve must be continuous.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">###### very hackish implementation
<span class="co"># simulate data</span>
sim_piece_cont &lt;-<span class="st"> </span>sim_piece %&gt;%
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">y =</span> <span class="kw">ifelse</span>(x &lt;<span class="st"> </span><span class="dv">5</span>,
                    <span class="dv">15</span> +<span class="st"> </span>.<span class="dv">05</span> *<span class="st"> </span>x -<span class="st"> </span>.<span class="dv">5</span> *<span class="st"> </span>x^<span class="dv">2</span> -<span class="st"> </span>.<span class="dv">05</span> *<span class="st"> </span>x^<span class="dv">3</span>,
                    .<span class="dv">05</span> *<span class="st"> </span>x +<span class="st"> </span>.<span class="dv">1</span> *<span class="st"> </span>x^<span class="dv">2</span> -<span class="st"> </span>.<span class="dv">05</span> *<span class="st"> </span>x^<span class="dv">3</span>))

<span class="co"># estimate models</span>
sim_piece_cont_mod1 &lt;-<span class="st"> </span><span class="kw">glm</span>(y ~<span class="st"> </span><span class="kw">poly</span>(x, <span class="dv">3</span>, <span class="dt">raw =</span> <span class="ot">TRUE</span>), <span class="dt">data =</span> sim_piece_cont, <span class="dt">subset =</span> x &lt;<span class="st"> </span><span class="dv">5</span>)
sim_piece_cont_mod2 &lt;-<span class="st"> </span><span class="kw">glm</span>(y ~<span class="st"> </span><span class="kw">poly</span>(x, <span class="dv">3</span>, <span class="dt">raw =</span> <span class="ot">TRUE</span>), <span class="dt">data =</span> sim_piece_cont, <span class="dt">subset =</span> x &gt;=<span class="st"> </span><span class="dv">5</span>)

<span class="co"># draw the plot</span>
sim_piece_cont %&gt;%
<span class="st">  </span><span class="kw">data_grid</span>(<span class="dt">x =</span> <span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">10</span>, <span class="dt">by =</span> .<span class="dv">001</span>)) %&gt;%
<span class="st">  </span><span class="kw">gather_predictions</span>(sim_piece_cont_mod1, sim_piece_cont_mod2) %&gt;%
<span class="st">  </span><span class="kw">filter</span>((x &lt;<span class="st"> </span><span class="dv">5</span> &amp;<span class="st"> </span>model ==<span class="st"> &quot;sim_piece_cont_mod1&quot;</span>) |
<span class="st">           </span>(x &gt;=<span class="dv">5</span> &amp;<span class="st"> </span>model ==<span class="st"> &quot;sim_piece_cont_mod2&quot;</span>)) %&gt;%
<span class="st">  </span><span class="kw">ggplot</span>() +
<span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">data =</span> sim_piece %&gt;%
<span class="st">               </span><span class="kw">mutate</span>(<span class="dt">y =</span> <span class="kw">ifelse</span>(x &lt;<span class="st"> </span><span class="dv">5</span>,
                                 <span class="dv">15</span> +<span class="st"> </span>.<span class="dv">05</span> *<span class="st"> </span>x -<span class="st"> </span>.<span class="dv">5</span> *<span class="st"> </span>x^<span class="dv">2</span> -<span class="st"> </span>.<span class="dv">05</span> *<span class="st"> </span>x^<span class="dv">3</span> +<span class="st"> </span><span class="kw">rnorm</span>(<span class="dv">100</span>, <span class="dv">0</span>, <span class="dv">3</span>),
                                 .<span class="dv">05</span> *<span class="st"> </span>x +<span class="st"> </span>.<span class="dv">1</span> *<span class="st"> </span>x^<span class="dv">2</span> -<span class="st"> </span>.<span class="dv">05</span> *<span class="st"> </span>x^<span class="dv">3</span>) +<span class="st"> </span><span class="kw">rnorm</span>(<span class="dv">100</span>, <span class="dv">0</span>, <span class="dv">3</span>)), <span class="kw">aes</span>(x, y)) +
<span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(x, pred, <span class="dt">color =</span> model), <span class="dt">size =</span> <span class="dv">1</span>) +
<span class="st">  </span><span class="kw">geom_vline</span>(<span class="dt">xintercept =</span> <span class="dv">5</span>, <span class="dt">linetype =</span> <span class="dv">2</span>, <span class="dt">color =</span> <span class="st">&quot;grey&quot;</span>) +
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;Continuous piecewise cubic regression&quot;</span>,
       <span class="dt">x =</span> <span class="st">&quot;X&quot;</span>,
       <span class="dt">y =</span> <span class="st">&quot;Y&quot;</span>) +
<span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">&quot;none&quot;</span>)</code></pre></div>
<p><img src="persp007_nonlinear_files/figure-html/sim-spline-1.png" width="672" /></p>
<p>But notice that this constraint is insufficient. Now the function is continuous, but still looks unnatural because of the V-shaped join. We should add two additional constraints: not only should the fitted curve be continuous, but the first and second <strong>derivatives</strong> should also be continuous at the knot. This will generate a fitted curve that is continuous and <strong>smooth</strong>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># estimate models</span>
sim_piece_smooth &lt;-<span class="st"> </span><span class="kw">glm</span>(y ~<span class="st"> </span><span class="kw">bs</span>(x, <span class="dt">knots =</span> <span class="kw">c</span>(<span class="dv">5</span>)), <span class="dt">data =</span> sim_piece)

<span class="co"># draw the plot</span>
sim_piece %&gt;%
<span class="st">  </span><span class="kw">add_predictions</span>(sim_piece_smooth) %&gt;%
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(x)) +
<span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">y =</span> y)) +
<span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">y =</span> pred), <span class="dt">size =</span> <span class="dv">1</span>) +
<span class="st">  </span><span class="kw">geom_vline</span>(<span class="dt">xintercept =</span> <span class="dv">5</span>, <span class="dt">linetype =</span> <span class="dv">2</span>, <span class="dt">color =</span> <span class="st">&quot;grey&quot;</span>) +
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;Cubic spline&quot;</span>,
       <span class="dt">x =</span> <span class="st">&quot;X&quot;</span>,
       <span class="dt">y =</span> <span class="st">&quot;Y&quot;</span>) +
<span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">&quot;none&quot;</span>)</code></pre></div>
<p><img src="persp007_nonlinear_files/figure-html/sim-spline-smooth-1.png" width="672" /></p>
<p>By increasing the number of knots, we will increase the flexibility of the resulting spline:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">data_frame</span>(<span class="dt">terms =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">5</span>, <span class="dv">10</span>),
           <span class="dt">models =</span> <span class="kw">map</span>(terms, ~<span class="st"> </span><span class="kw">glm</span>(y ~<span class="st"> </span><span class="kw">bs</span>(x, <span class="dt">df =</span> . +<span class="st"> </span><span class="dv">3</span>), <span class="dt">data =</span> sim_piece)),
           <span class="dt">pred =</span> <span class="kw">map</span>(models, ~<span class="st"> </span><span class="kw">add_predictions</span>(sim_piece, .))) %&gt;%
<span class="st">  </span><span class="kw">unnest</span>(pred) %&gt;%
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(x, y)) +
<span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">data =</span> sim_piece, <span class="dt">alpha =</span> .<span class="dv">2</span>) +
<span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">y =</span> pred, <span class="dt">color =</span> <span class="kw">factor</span>(terms))) +
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;Cubic spline&quot;</span>,
       <span class="dt">x =</span> <span class="st">&quot;X&quot;</span>,
       <span class="dt">y =</span> <span class="st">&quot;Y&quot;</span>,
       <span class="dt">color =</span> <span class="st">&quot;Knots&quot;</span>)</code></pre></div>
<p><img src="persp007_nonlinear_files/figure-html/sim-spline-smooth-5-1.png" width="672" /></p>
</div>
<div id="choosing-the-number-and-location-of-knots" class="section level2">
<h2>Choosing the number and location of knots</h2>
<p>Typically knots are placed in a uniform fashion; that is, the cutpoints <span class="math inline">\(c\)</span> are determined by first identifying the number of knots <span class="math inline">\(K\)</span> for the model, then partitioning <span class="math inline">\(X\)</span> into uniform quantiles. So if we fit a cubic regression spline with 5 knots on the Biden feeling thermometer regression, it would divide <code>age</code> into 5 equal quantiles and estimate the cubic spline function for each quantile:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># estimate model</span>
biden_spline &lt;-<span class="st"> </span><span class="kw">glm</span>(biden ~<span class="st"> </span><span class="kw">bs</span>(age, <span class="dt">df =</span> <span class="dv">8</span>), <span class="dt">data =</span> biden)

<span class="co"># estimate the predicted values and confidence interval</span>
biden_spline_pred &lt;-<span class="st"> </span><span class="kw">augment</span>(biden_spline, <span class="dt">newdata =</span> <span class="kw">data_grid</span>(biden, age)) %&gt;%
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">pred_low =</span> .fitted -<span class="st"> </span><span class="fl">1.96</span> *<span class="st"> </span>.se.fit,
         <span class="dt">pred_high =</span> .fitted +<span class="st"> </span><span class="fl">1.96</span> *<span class="st"> </span>.se.fit)

<span class="co"># plot the curve</span>
<span class="kw">ggplot</span>(biden_spline_pred, <span class="kw">aes</span>(age)) +
<span class="st">  </span><span class="co"># geom_point(data = biden, aes(age, biden), alpha = .05) +</span>
<span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">y =</span> .fitted)) +
<span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">y =</span> pred_low), <span class="dt">linetype =</span> <span class="dv">2</span>) +
<span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">y =</span> pred_high), <span class="dt">linetype =</span> <span class="dv">2</span>) +
<span class="st">  </span><span class="kw">geom_vline</span>(<span class="dt">xintercept =</span> <span class="kw">attr</span>(<span class="kw">bs</span>(biden$age, <span class="dt">df =</span> <span class="dv">8</span>), <span class="st">&quot;knots&quot;</span>),
             <span class="dt">linetype =</span> <span class="dv">2</span>, <span class="dt">color =</span> <span class="st">&quot;blue&quot;</span>) +
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;Cubic spline regression of Biden feeling thermometer&quot;</span>,
       <span class="dt">subtitle =</span> <span class="st">&quot;5 knots, with 95% confidence interval&quot;</span>,
       <span class="dt">x =</span> <span class="st">&quot;Age&quot;</span>,
       <span class="dt">y =</span> <span class="st">&quot;Predicted Biden thermometer rating&quot;</span>)</code></pre></div>
<p><img src="persp007_nonlinear_files/figure-html/biden-spline-1.png" width="672" /></p>
<p>But this still leaves unaddressed the matter of how many knots should we use? Or how many degrees should each polynomial be? While theory should still be our guide, we can also use <a href="persp006_resampling.html">cross-validation</a> to determine the optimal number of knots and/or polynomial degrees.</p>
<p>Let’s apply this approach to the running <code>Wage</code> example in ISL.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">wage &lt;-<span class="st"> </span><span class="kw">as_tibble</span>(Wage)

<span class="kw">ggplot</span>(wage, <span class="kw">aes</span>(age, wage)) +
<span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">alpha =</span> .<span class="dv">2</span>) +
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;Age&quot;</span>,
       <span class="dt">y =</span> <span class="st">&quot;Wage&quot;</span>)</code></pre></div>
<p><img src="persp007_nonlinear_files/figure-html/wage-1.png" width="672" /></p>
<p>We can estimate <span class="math inline">\(10\)</span>-fold CV MSE for varying numbers of polynomial degrees and knots.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># function to simplify things</span>
wage_spline_cv &lt;-<span class="st"> </span>function(data, <span class="dt">degree =</span> <span class="dv">3</span>, <span class="dt">df =</span> <span class="ot">NULL</span>){
  <span class="co"># estimate the model on each fold</span>
  models &lt;-<span class="st"> </span><span class="kw">map</span>(data$train, ~<span class="st"> </span><span class="kw">glm</span>(wage ~<span class="st"> </span><span class="kw">bs</span>(age, <span class="dt">df =</span> df, <span class="dt">degree =</span> degree),
                                  <span class="dt">data =</span> .))
  
  <span class="co"># calculate mse for each test fold</span>
  models_mse &lt;-<span class="st"> </span><span class="kw">map2_dbl</span>(models, data$test, mse)
  
  <span class="kw">return</span>(<span class="kw">mean</span>(models_mse, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>))
}

<span class="co"># fold the data</span>
wage_kfold &lt;-<span class="st"> </span><span class="kw">crossv_kfold</span>(wage, <span class="dt">k =</span> <span class="dv">10</span>)

<span class="co"># estimate mse for polynomial degrees in 1:10</span>
wage_degree_mse &lt;-<span class="st"> </span><span class="kw">data_frame</span>(<span class="dt">degrees =</span> <span class="dv">1</span>:<span class="dv">10</span>,
                              <span class="dt">mse =</span> <span class="kw">map_dbl</span>(degrees, ~<span class="st"> </span><span class="kw">wage_spline_cv</span>(wage_kfold, <span class="dt">degree =</span> .,
                                                                      <span class="dt">df =</span> <span class="dv">3</span> +<span class="st"> </span>.)))

<span class="co"># estimate mse for degrees of freedom (aka knots)</span>
wage_df_mse &lt;-<span class="st"> </span><span class="kw">data_frame</span>(<span class="dt">df =</span> <span class="dv">1</span>:<span class="dv">10</span>,
                          <span class="dt">mse =</span> <span class="kw">map_dbl</span>(df, ~<span class="st"> </span><span class="kw">wage_spline_cv</span>(wage_kfold, <span class="dt">df =</span> <span class="dv">3</span> +<span class="st"> </span>.)))

<span class="co"># graph the results</span>
<span class="kw">ggplot</span>(wage_degree_mse, <span class="kw">aes</span>(degrees, mse)) +
<span class="st">  </span><span class="kw">geom_point</span>() +
<span class="st">  </span><span class="kw">geom_line</span>() +
<span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="dt">breaks =</span> <span class="dv">1</span>:<span class="dv">10</span>) +
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;Optimal number of degrees for wage spline regression&quot;</span>,
       <span class="dt">subtitle =</span> <span class="st">&quot;Knots = 3&quot;</span>,
       <span class="dt">x =</span> <span class="st">&quot;Highest-order polynomial&quot;</span>,
       <span class="dt">y =</span> <span class="st">&quot;10-fold CV MSE&quot;</span>)</code></pre></div>
<p><img src="persp007_nonlinear_files/figure-html/wage-cv-1.png" width="672" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(wage_df_mse, <span class="kw">aes</span>(df, mse)) +
<span class="st">  </span><span class="kw">geom_point</span>() +
<span class="st">  </span><span class="kw">geom_line</span>() +
<span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="dt">breaks =</span> <span class="dv">1</span>:<span class="dv">10</span>) +
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;Optimal number of knots for wage spline regression&quot;</span>,
       <span class="dt">subtitle =</span> <span class="st">&quot;Highest-order polynomial = 3&quot;</span>,
       <span class="dt">x =</span> <span class="st">&quot;Knots&quot;</span>,
       <span class="dt">y =</span> <span class="st">&quot;10-fold CV MSE&quot;</span>)</code></pre></div>
<p><img src="persp007_nonlinear_files/figure-html/wage-cv-2.png" width="672" /></p>
<p>These results suggest the optimal number of polynomial degrees is 6, while the optimal number of knots is 2. The resulting model produced by these parameters is:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">wage_optim &lt;-<span class="st"> </span><span class="kw">glm</span>(wage ~<span class="st"> </span><span class="kw">bs</span>(age, <span class="dt">df =</span> <span class="dv">8</span>, <span class="dt">degree =</span> <span class="dv">6</span>), <span class="dt">data =</span> wage)

<span class="kw">augment</span>(wage_optim, <span class="dt">newdata =</span> <span class="kw">data_grid</span>(wage, age)) %&gt;%
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">.fitted_low =</span> .fitted -<span class="st"> </span><span class="fl">1.96</span> *<span class="st"> </span>.se.fit,
         <span class="dt">.fitted_high =</span> .fitted +<span class="st"> </span><span class="fl">1.96</span> *<span class="st"> </span>.se.fit) %&gt;%
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(age, .fitted)) +
<span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">data =</span> wage, <span class="kw">aes</span>(<span class="dt">y =</span> wage), <span class="dt">alpha =</span> .<span class="dv">05</span>) +
<span class="st">  </span><span class="kw">geom_line</span>() +
<span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">y =</span> .fitted_low), <span class="dt">linetype =</span> <span class="dv">2</span>) +
<span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">y =</span> .fitted_high), <span class="dt">linetype =</span> <span class="dv">2</span>) +
<span class="st">  </span><span class="kw">geom_vline</span>(<span class="dt">xintercept =</span> <span class="kw">attr</span>(<span class="kw">bs</span>(wage$age, <span class="dt">df =</span> <span class="dv">8</span>, <span class="dt">degree =</span> <span class="dv">6</span>), <span class="st">&quot;knots&quot;</span>),
             <span class="dt">linetype =</span> <span class="dv">2</span>, <span class="dt">color =</span> <span class="st">&quot;blue&quot;</span>) +
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;Sixth-order polynomial spline of wage&quot;</span>,
       <span class="dt">subtitle =</span> <span class="st">&quot;Knots = 2&quot;</span>,
       <span class="dt">x =</span> <span class="st">&quot;Age&quot;</span>,
       <span class="dt">y =</span> <span class="st">&quot;Wage&quot;</span>)</code></pre></div>
<p><img src="persp007_nonlinear_files/figure-html/wage-optimal-mod-1.png" width="672" /></p>
</div>
</div>
<div id="local-regression" class="section level1">
<h1>Local regression</h1>
<p><strong>Locally weighted scatterplot smoothing</strong> (local regression, LOWESS, or LOESS) fits a separate non-linear function at each target point <span class="math inline">\(x_0\)</span> using only the nearby training observations. This method estimates a regression line based on localized subsets of the data, building up the global function <span class="math inline">\(f\)</span> point-by-point.</p>
<div id="algorithm-for-local-linear-regression" class="section level2">
<h2>Algorithm for local linear regression</h2>
<ol style="list-style-type: decimal">
<li>Gather the fraction <span class="math inline">\(s = \frac{k}{n}\)</span> of training points whose <span class="math inline">\(x_i\)</span> are closest to <span class="math inline">\(x_0\)</span>.</li>
<li>Assign a weight <span class="math inline">\(K_{i0} = K(x_i, x_0)\)</span> to each point in the neighborhood, so that the point furthest from <span class="math inline">\(x_0\)</span> has a weight of 0, and the closest has the highest weight. All but these <span class="math inline">\(k\)</span> nearest neighbors get a weight of 0.</li>
<li>Fit a <strong>weighted least squares regression</strong> of the <span class="math inline">\(y_i\)</span> on the <span class="math inline">\(x_i\)</span> using the aformentioned weights. Weighted least squares allows us to adjust the variance for each observation <span class="math inline">\(\sigma_i^2\)</span> by weights <span class="math inline">\(w_i\)</span>. This is useful in correcting for heteroscedasticity in OLS, and also allows us to estimate the local regression.</li>
<li>The fitted value at <span class="math inline">\(x_0\)</span> is given by <span class="math inline">\(\hat{f}(x_0) = \hat{\beta}_0 + \hat{\beta}_1 x_0\)</span></li>
</ol>
<p>To obtain the local regression fit at a new value of <span class="math inline">\(x_0\)</span>, we have to perform this same procedure again adjusting the weights for the new region of data.</p>
<p>Here is an example of a local linear regression on the <code>ethanol</code> dataset in the <code>lattice</code> package:</p>
<p><img src="persp007_nonlinear_files/figure-html/loess-1.png" width="672" /></p>
<p>The LOESS is built up point-by-point:</p>
<video width="672"  controls loop>
<source src="persp007_nonlinear_files/figure-html/loess_buildup-.webm" />
<p>
video of chunk loess_buildup
</p>
</video>
<p>One important argument you can control with LOESS is the <strong>span</strong>, or how smooth the LOESS function will become. A larger span will result in a smoother curve, but may not be as accurate. A smaller span will be more local and wiggly, but improve our fit to the training data.</p>
<video width="672"  controls loop>
<source src="persp007_nonlinear_files/figure-html/loess_span-.webm" />
<p>
video of chunk loess_span
</p>
</video>
</div>
</div>
<div id="generalized-additive-models" class="section level1">
<h1>Generalized additive models</h1>
<p>So far each of these nonlinear methods has been implemented for a single predictor <span class="math inline">\(X\)</span>. To generalize this approach to multiple predictors <span class="math inline">\(X_1, X_2, \dots, X_p\)</span>, we need to utilize a <strong>generalized additive model</strong> (GAM). GAMs extend the linear model by allowing non-linear functions of each of the variables, while also maintaining the <strong>additive assumption</strong> that each variable independently and additively shapes the response variable <span class="math inline">\(Y\)</span>. GAMs work for both quantitative and qualitative responses.</p>
<div id="gams-for-regression-problems" class="section level2">
<h2>GAMs for regression problems</h2>
<p>To extend the multiple linear regression model</p>
<p><span class="math display">\[y_i = \beta_0 + \beta_{1} X_{i1} + \beta_{2} X_{i2} + \dots + \beta_{p} X_{ip} + \epsilon_i\]</span></p>
<p>and allow for non-linear relationships between each predictor and the response variable, we replace each linear component <span class="math inline">\(\beta_{j} x_{ij}\)</span> with a smooth, non-linear function <span class="math inline">\(f_j(x_{ij})\)</span>:</p>
<p><span class="math display">\[y_i = \beta_0 + \sum_{j = 1}^p f_j(x_{ij}) + \epsilon_i\]</span></p>
<p><span class="math display">\[y_i = \beta_0 + f_1(x_{i1}) + \beta_{2} f_2(x_{i2}) + \dots + f_p(x_{ip}) + \epsilon_i\]</span></p>
<p>As you can see, each <span class="math inline">\(f_j\)</span> provides an <strong>additive</strong> component to the overall model of <span class="math inline">\(y_i\)</span>. We estimate each <span class="math inline">\(f_j\)</span> then add together all of their contributions. Importantly, each functional component is estimated <strong>simultaneously</strong> so that it is truly still a multiple variable regression model. Let’s estimate a GAM for the Biden dataset using the model</p>
<p><span class="math display">\[\text{Biden} = \beta_0 + f_1(\text{Age}) + f_2(\text{Education}) + f_3(\text{Gender}) + \epsilon\]</span></p>
<p>Where <span class="math inline">\(f_1\)</span> and <span class="math inline">\(f_2\)</span> are cubic splines with 2 knots and <span class="math inline">\(f_3\)</span> generates a separate constant for males and females using traditional dummy variables.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(gam)

<span class="co"># estimate model for splines on age and education plus dichotomous female</span>
biden_gam &lt;-<span class="st"> </span><span class="kw">gam</span>(biden ~<span class="st"> </span><span class="kw">bs</span>(age, <span class="dt">df =</span> <span class="dv">5</span>) +<span class="st"> </span><span class="kw">bs</span>(educ, <span class="dt">df =</span> <span class="dv">5</span>) +<span class="st"> </span>female, <span class="dt">data =</span> biden)
<span class="kw">summary</span>(biden_gam)</code></pre></div>
<pre><code>## 
## Call: gam(formula = biden ~ bs(age, df = 5) + bs(educ, df = 5) + female, 
##     data = biden)
## Deviance Residuals:
##     Min      1Q  Median      3Q     Max 
## -67.499 -13.522   0.548  17.953  46.582 
## 
## (Dispersion Parameter for gaussian family taken to be 532)
## 
##     Null Deviance: 994144 on 1806 degrees of freedom
## Residual Deviance: 955772 on 1795 degrees of freedom
## AIC: 16485 
## 
## Number of Local Scoring Iterations: 2 
## 
## Anova for Parametric Effects
##                    Df Sum Sq Mean Sq F value  Pr(&gt;F)    
## bs(age, df = 5)     5   4038     808    1.52    0.18    
## bs(educ, df = 5)    5  16660    3332    6.26 9.2e-06 ***
## female              1  17673   17673   33.19 9.8e-09 ***
## Residuals        1795 955772     532                    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># get graphs of each term</span>
biden_gam_terms &lt;-<span class="st"> </span><span class="kw">preplot</span>(biden_gam, <span class="dt">se =</span> <span class="ot">TRUE</span>, <span class="dt">rug =</span> <span class="ot">FALSE</span>)

## age
<span class="kw">data_frame</span>(<span class="dt">x =</span> biden_gam_terms$<span class="st">`</span><span class="dt">bs(age, df = 5)</span><span class="st">`</span>$x,
           <span class="dt">y =</span> biden_gam_terms$<span class="st">`</span><span class="dt">bs(age, df = 5)</span><span class="st">`</span>$y,
           <span class="dt">se.fit =</span> biden_gam_terms$<span class="st">`</span><span class="dt">bs(age, df = 5)</span><span class="st">`</span>$se.y) %&gt;%
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">y_low =</span> y -<span class="st"> </span><span class="fl">1.96</span> *<span class="st"> </span>se.fit,
         <span class="dt">y_high =</span> y +<span class="st"> </span><span class="fl">1.96</span> *<span class="st"> </span>se.fit) %&gt;%
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(x, y)) +
<span class="st">  </span><span class="kw">geom_line</span>() +
<span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">y =</span> y_low), <span class="dt">linetype =</span> <span class="dv">2</span>) +
<span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">y =</span> y_high), <span class="dt">linetype =</span> <span class="dv">2</span>) +
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;GAM of Biden feeling thermometer&quot;</span>,
       <span class="dt">subtitle =</span> <span class="st">&quot;Cubic spline&quot;</span>,
       <span class="dt">x =</span> <span class="st">&quot;Age&quot;</span>,
       <span class="dt">y =</span> <span class="kw">expression</span>(f[<span class="dv">1</span>](age)))</code></pre></div>
<p><img src="persp007_nonlinear_files/figure-html/biden-gam-1.png" width="672" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## education
<span class="kw">data_frame</span>(<span class="dt">x =</span> biden_gam_terms$<span class="st">`</span><span class="dt">bs(educ, df = 5)</span><span class="st">`</span>$x,
           <span class="dt">y =</span> biden_gam_terms$<span class="st">`</span><span class="dt">bs(educ, df = 5)</span><span class="st">`</span>$y,
           <span class="dt">se.fit =</span> biden_gam_terms$<span class="st">`</span><span class="dt">bs(educ, df = 5)</span><span class="st">`</span>$se.y) %&gt;%
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">y_low =</span> y -<span class="st"> </span><span class="fl">1.96</span> *<span class="st"> </span>se.fit,
         <span class="dt">y_high =</span> y +<span class="st"> </span><span class="fl">1.96</span> *<span class="st"> </span>se.fit) %&gt;%
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(x, y)) +
<span class="st">  </span><span class="kw">geom_line</span>() +
<span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">y =</span> y_low), <span class="dt">linetype =</span> <span class="dv">2</span>) +
<span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">y =</span> y_high), <span class="dt">linetype =</span> <span class="dv">2</span>) +
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;GAM of Biden feeling thermometer&quot;</span>,
       <span class="dt">subtitle =</span> <span class="st">&quot;Cubic spline&quot;</span>,
       <span class="dt">x =</span> <span class="st">&quot;Education&quot;</span>,
       <span class="dt">y =</span> <span class="kw">expression</span>(f[<span class="dv">2</span>](education)))</code></pre></div>
<p><img src="persp007_nonlinear_files/figure-html/biden-gam-2.png" width="672" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## gender
<span class="kw">data_frame</span>(<span class="dt">x =</span> biden_gam_terms$female$x,
           <span class="dt">y =</span> biden_gam_terms$female$y,
           <span class="dt">se.fit =</span> biden_gam_terms$female$se.y) %&gt;%
<span class="st">  </span>unique %&gt;%
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">y_low =</span> y -<span class="st"> </span><span class="fl">1.96</span> *<span class="st"> </span>se.fit,
         <span class="dt">y_high =</span> y +<span class="st"> </span><span class="fl">1.96</span> *<span class="st"> </span>se.fit,
         <span class="dt">x =</span> <span class="kw">factor</span>(x, <span class="dt">levels =</span> <span class="dv">0</span>:<span class="dv">1</span>, <span class="dt">labels =</span> <span class="kw">c</span>(<span class="st">&quot;Male&quot;</span>, <span class="st">&quot;Female&quot;</span>))) %&gt;%
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(x, y, <span class="dt">ymin =</span> y_low, <span class="dt">ymax =</span> y_high)) +
<span class="st">  </span><span class="kw">geom_errorbar</span>() +
<span class="st">  </span><span class="kw">geom_point</span>() +
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;GAM of Biden feeling thermometer&quot;</span>,
       <span class="dt">x =</span> <span class="ot">NULL</span>,
       <span class="dt">y =</span> <span class="kw">expression</span>(f[<span class="dv">3</span>](gender)))</code></pre></div>
<p><img src="persp007_nonlinear_files/figure-html/biden-gam-3.png" width="672" /></p>
<p>For age, there does not appear to be a substantial or significant relationship with Biden feeling thermometers after controlling for education and gender. The cubic spline is relatively flat and the 95% confidence interval is wide. For education, the effect appears substantial and statistically significant; as education increases, predicted Biden feeling thermometer ratings decrease until approximately 15 years of formal education, then increase again for those with college or post-graduate degrees. Finally, for gender the difference between males and females is substantial and statistically distinguishable from 0.</p>
<p>Instead of cubic splines, we could use local regression. At this point we can no longer use OLS to fit the model, but instead uses a <strong>backfitting</strong> process to model each predictor simultaneously.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># estimate model for splines on age and education plus dichotomous female</span>
biden_gam_local &lt;-<span class="st"> </span><span class="kw">gam</span>(biden ~<span class="st"> </span><span class="kw">lo</span>(age) +<span class="st"> </span><span class="kw">lo</span>(educ) +<span class="st"> </span>female, <span class="dt">data =</span> biden)
<span class="kw">summary</span>(biden_gam_local)</code></pre></div>
<pre><code>## 
## Call: gam(formula = biden ~ lo(age) + lo(educ) + female, data = biden)
## Deviance Residuals:
##    Min     1Q Median     3Q    Max 
## -66.66 -13.92   1.28  18.97  44.03 
## 
## (Dispersion Parameter for gaussian family taken to be 534)
## 
##     Null Deviance: 994144 on 1806 degrees of freedom
## Residual Deviance: 959708 on 1798 degrees of freedom
## AIC: 16488 
## 
## Number of Local Scoring Iterations: 2 
## 
## Anova for Parametric Effects
##             Df Sum Sq Mean Sq F value  Pr(&gt;F)    
## lo(age)      1   1406    1406    2.63     0.1    
## lo(educ)     1   8338    8338   15.62 8.1e-05 ***
## female       1  17750   17750   33.25 9.5e-09 ***
## Residuals 1798 959708     534                    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Anova for Nonparametric Effects
##             Npar Df Npar F  Pr(F)   
## (Intercept)                         
## lo(age)         2.4   0.83 0.4544   
## lo(educ)        3.1   3.87 0.0085 **
## female                              
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># get graphs of each term</span>
biden_gam_local_terms &lt;-<span class="st"> </span><span class="kw">preplot</span>(biden_gam_local, <span class="dt">se =</span> <span class="ot">TRUE</span>, <span class="dt">rug =</span> <span class="ot">FALSE</span>)

## age
<span class="kw">data_frame</span>(<span class="dt">x =</span> biden_gam_local_terms$<span class="st">`</span><span class="dt">lo(age)</span><span class="st">`</span>$x,
           <span class="dt">y =</span> biden_gam_local_terms$<span class="st">`</span><span class="dt">lo(age)</span><span class="st">`</span>$y,
           <span class="dt">se.fit =</span> biden_gam_local_terms$<span class="st">`</span><span class="dt">lo(age)</span><span class="st">`</span>$se.y) %&gt;%
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">y_low =</span> y -<span class="st"> </span><span class="fl">1.96</span> *<span class="st"> </span>se.fit,
         <span class="dt">y_high =</span> y +<span class="st"> </span><span class="fl">1.96</span> *<span class="st"> </span>se.fit) %&gt;%
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(x, y)) +
<span class="st">  </span><span class="kw">geom_line</span>() +
<span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">y =</span> y_low), <span class="dt">linetype =</span> <span class="dv">2</span>) +
<span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">y =</span> y_high), <span class="dt">linetype =</span> <span class="dv">2</span>) +
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;GAM of Biden feeling thermometer&quot;</span>,
       <span class="dt">subtitle =</span> <span class="st">&quot;Local regression&quot;</span>,
       <span class="dt">x =</span> <span class="st">&quot;Age&quot;</span>,
       <span class="dt">y =</span> <span class="kw">expression</span>(f[<span class="dv">1</span>](age)))</code></pre></div>
<p><img src="persp007_nonlinear_files/figure-html/biden-gam-local-1.png" width="672" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## education
<span class="kw">data_frame</span>(<span class="dt">x =</span> biden_gam_local_terms$<span class="st">`</span><span class="dt">lo(educ)</span><span class="st">`</span>$x,
           <span class="dt">y =</span> biden_gam_local_terms$<span class="st">`</span><span class="dt">lo(educ)</span><span class="st">`</span>$y,
           <span class="dt">se.fit =</span> biden_gam_local_terms$<span class="st">`</span><span class="dt">lo(educ)</span><span class="st">`</span>$se.y) %&gt;%
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">y_low =</span> y -<span class="st"> </span><span class="fl">1.96</span> *<span class="st"> </span>se.fit,
         <span class="dt">y_high =</span> y +<span class="st"> </span><span class="fl">1.96</span> *<span class="st"> </span>se.fit) %&gt;%
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(x, y)) +
<span class="st">  </span><span class="kw">geom_line</span>() +
<span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">y =</span> y_low), <span class="dt">linetype =</span> <span class="dv">2</span>) +
<span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">y =</span> y_high), <span class="dt">linetype =</span> <span class="dv">2</span>) +
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;GAM of Biden feeling thermometer&quot;</span>,
       <span class="dt">subtitle =</span> <span class="st">&quot;Local regression&quot;</span>,
       <span class="dt">x =</span> <span class="st">&quot;Education&quot;</span>,
       <span class="dt">y =</span> <span class="kw">expression</span>(f[<span class="dv">2</span>](education)))</code></pre></div>
<p><img src="persp007_nonlinear_files/figure-html/biden-gam-local-2.png" width="672" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## gender
<span class="kw">data_frame</span>(<span class="dt">x =</span> biden_gam_local_terms$female$x,
           <span class="dt">y =</span> biden_gam_local_terms$female$y,
           <span class="dt">se.fit =</span> biden_gam_local_terms$female$se.y) %&gt;%
<span class="st">  </span>unique %&gt;%
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">y_low =</span> y -<span class="st"> </span><span class="fl">1.96</span> *<span class="st"> </span>se.fit,
         <span class="dt">y_high =</span> y +<span class="st"> </span><span class="fl">1.96</span> *<span class="st"> </span>se.fit,
         <span class="dt">x =</span> <span class="kw">factor</span>(x, <span class="dt">levels =</span> <span class="dv">0</span>:<span class="dv">1</span>, <span class="dt">labels =</span> <span class="kw">c</span>(<span class="st">&quot;Male&quot;</span>, <span class="st">&quot;Female&quot;</span>))) %&gt;%
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(x, y, <span class="dt">ymin =</span> y_low, <span class="dt">ymax =</span> y_high)) +
<span class="st">  </span><span class="kw">geom_errorbar</span>() +
<span class="st">  </span><span class="kw">geom_point</span>() +
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;GAM of Biden feeling thermometer&quot;</span>,
       <span class="dt">x =</span> <span class="ot">NULL</span>,
       <span class="dt">y =</span> <span class="kw">expression</span>(f[<span class="dv">3</span>](gender)))</code></pre></div>
<p><img src="persp007_nonlinear_files/figure-html/biden-gam-local-3.png" width="672" /></p>
<p>The results are pretty similar to the cubic splines.</p>
<p>We can also use GAMs for classification problems, like the Titanic example.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(titanic)

<span class="co"># estimate model for splines on age and education plus dichotomous female</span>
titanic_gam &lt;-<span class="st"> </span><span class="kw">gam</span>(Survived ~<span class="st"> </span><span class="kw">bs</span>(Age, <span class="dt">df =</span> <span class="dv">5</span>) +<span class="st"> </span><span class="kw">bs</span>(Fare, <span class="dt">df =</span> <span class="dv">5</span>) +<span class="st"> </span>Sex, <span class="dt">data =</span> titanic_train,
                   <span class="dt">family =</span> binomial)
<span class="kw">summary</span>(titanic_gam)</code></pre></div>
<pre><code>## 
## Call: gam(formula = Survived ~ bs(Age, df = 5) + bs(Fare, df = 5) + 
##     Sex, family = binomial, data = titanic_train)
## Deviance Residuals:
##    Min     1Q Median     3Q    Max 
## -2.743 -0.605 -0.491  0.735  2.230 
## 
## (Dispersion Parameter for binomial family taken to be 1)
## 
##     Null Deviance: 965 on 713 degrees of freedom
## Residual Deviance: 684 on 702 degrees of freedom
## AIC: 708 
## 177 observations deleted due to missingness 
## 
## Number of Local Scoring Iterations: 9 
## 
## Anova for Parametric Effects
##                   Df Sum Sq Mean Sq F value  Pr(&gt;F)    
## bs(Age, df = 5)    5      8     1.7    1.60    0.16    
## bs(Fare, df = 5)   5     41     8.2    7.79 3.8e-07 ***
## Sex                1    142   141.6  135.01 &lt; 2e-16 ***
## Residuals        702    736     1.0                    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># get graphs of each term</span>
titanic_gam_terms &lt;-<span class="st"> </span><span class="kw">preplot</span>(titanic_gam, <span class="dt">se =</span> <span class="ot">TRUE</span>, <span class="dt">rug =</span> <span class="ot">FALSE</span>)

## age
<span class="kw">data_frame</span>(<span class="dt">x =</span> titanic_gam_terms$<span class="st">`</span><span class="dt">bs(Age, df = 5)</span><span class="st">`</span>$x,
           <span class="dt">y =</span> titanic_gam_terms$<span class="st">`</span><span class="dt">bs(Age, df = 5)</span><span class="st">`</span>$y,
           <span class="dt">se.fit =</span> titanic_gam_terms$<span class="st">`</span><span class="dt">bs(Age, df = 5)</span><span class="st">`</span>$se.y) %&gt;%
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">y_low =</span> y -<span class="st"> </span><span class="fl">1.96</span> *<span class="st"> </span>se.fit,
         <span class="dt">y_high =</span> y +<span class="st"> </span><span class="fl">1.96</span> *<span class="st"> </span>se.fit) %&gt;%
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(x, y)) +
<span class="st">  </span><span class="kw">geom_line</span>() +
<span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">y =</span> y_low), <span class="dt">linetype =</span> <span class="dv">2</span>) +
<span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">y =</span> y_high), <span class="dt">linetype =</span> <span class="dv">2</span>) +
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;GAM of Titanic survival&quot;</span>,
       <span class="dt">subtitle =</span> <span class="st">&quot;Cubic spline&quot;</span>,
       <span class="dt">x =</span> <span class="st">&quot;Age&quot;</span>,
       <span class="dt">y =</span> <span class="kw">expression</span>(f[<span class="dv">1</span>](age)))</code></pre></div>
<p><img src="persp007_nonlinear_files/figure-html/titanic-gam-1.png" width="672" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## fare
<span class="kw">data_frame</span>(<span class="dt">x =</span> titanic_gam_terms$<span class="st">`</span><span class="dt">bs(Fare, df = 5)</span><span class="st">`</span>$x,
           <span class="dt">y =</span> titanic_gam_terms$<span class="st">`</span><span class="dt">bs(Fare, df = 5)</span><span class="st">`</span>$y,
           <span class="dt">se.fit =</span> titanic_gam_terms$<span class="st">`</span><span class="dt">bs(Fare, df = 5)</span><span class="st">`</span>$se.y) %&gt;%
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">y_low =</span> y -<span class="st"> </span><span class="fl">1.96</span> *<span class="st"> </span>se.fit,
         <span class="dt">y_high =</span> y +<span class="st"> </span><span class="fl">1.96</span> *<span class="st"> </span>se.fit) %&gt;%
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(x, y)) +
<span class="st">  </span><span class="kw">geom_line</span>() +
<span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">y =</span> y_low), <span class="dt">linetype =</span> <span class="dv">2</span>) +
<span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">y =</span> y_high), <span class="dt">linetype =</span> <span class="dv">2</span>) +
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;GAM of Titanic survival&quot;</span>,
       <span class="dt">subtitle =</span> <span class="st">&quot;Cubic spline&quot;</span>,
       <span class="dt">x =</span> <span class="st">&quot;Fare&quot;</span>,
       <span class="dt">y =</span> <span class="kw">expression</span>(f[<span class="dv">2</span>](fare)))</code></pre></div>
<p><img src="persp007_nonlinear_files/figure-html/titanic-gam-2.png" width="672" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## gender
<span class="kw">data_frame</span>(<span class="dt">x =</span> titanic_gam_terms$Sex$x,
           <span class="dt">y =</span> titanic_gam_terms$Sex$y,
           <span class="dt">se.fit =</span> titanic_gam_terms$Sex$se.y) %&gt;%
<span class="st">  </span>unique %&gt;%
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">y_low =</span> y -<span class="st"> </span><span class="fl">1.96</span> *<span class="st"> </span>se.fit,
         <span class="dt">y_high =</span> y +<span class="st"> </span><span class="fl">1.96</span> *<span class="st"> </span>se.fit,
         <span class="dt">x =</span> <span class="kw">factor</span>(x, <span class="dt">levels =</span> <span class="kw">c</span>(<span class="st">&quot;male&quot;</span>, <span class="st">&quot;female&quot;</span>), <span class="dt">labels =</span> <span class="kw">c</span>(<span class="st">&quot;Male&quot;</span>, <span class="st">&quot;Female&quot;</span>))) %&gt;%
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(x, y, <span class="dt">ymin =</span> y_low, <span class="dt">ymax =</span> y_high)) +
<span class="st">  </span><span class="kw">geom_errorbar</span>() +
<span class="st">  </span><span class="kw">geom_point</span>() +
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;GAM of Titanic survival&quot;</span>,
       <span class="dt">x =</span> <span class="ot">NULL</span>,
       <span class="dt">y =</span> <span class="kw">expression</span>(f[<span class="dv">3</span>](gender)))</code></pre></div>
<p><img src="persp007_nonlinear_files/figure-html/titanic-gam-3.png" width="672" /></p>
</div>
</div>
<div id="acknowledgements" class="section level1 toc-ignore">
<h1>Acknowledgements</h1>
<ul>
<li>Bootstrap standard error of the mean example derived from <a href="http://t-redactyl.io/blog/2015/09/a-gentle-introduction-to-bootstrapping.html">A gentle introduction to bootstrapping</a>.</li>
<li>“Why use the bootstrap?” reproduced from <a href="http://stats.stackexchange.com/a/26093">Explaining to laypeople why bootstrapping works - Stack Overflow</a>, licensed under the <a href="https://creativecommons.org/licenses/by-sa/3.0/">CC BY-SA 3.0 Creative Commons License</a>.</li>
</ul>
</div>
<div id="session-info" class="section level1 toc-ignore">
<h1>Session Info</h1>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">devtools::<span class="kw">session_info</span>()</code></pre></div>
<pre><code>##  setting  value                       
##  version  R version 3.3.3 (2017-03-06)
##  system   x86_64, darwin13.4.0        
##  ui       RStudio (1.0.136)           
##  language (EN)                        
##  collate  en_US.UTF-8                 
##  tz       America/Chicago             
##  date     2017-05-30                  
## 
##  package        * version    date       source                            
##  animation        2.5        2017-03-30 CRAN (R 3.3.2)                    
##  assertthat       0.2.0      2017-04-11 cran (@0.2.0)                     
##  backports        1.1.0      2017-05-22 CRAN (R 3.3.2)                    
##  base           * 3.3.3      2017-03-07 local                             
##  base64enc        0.1-3      2015-07-28 CRAN (R 3.3.0)                    
##  bigrquery      * 0.3.0      2016-06-28 CRAN (R 3.3.0)                    
##  bitops           1.0-6      2013-08-17 CRAN (R 3.3.0)                    
##  boot           * 1.3-19     2017-04-21 CRAN (R 3.3.2)                    
##  broom          * 0.4.2      2017-02-13 CRAN (R 3.3.2)                    
##  car              2.1-4      2016-12-02 CRAN (R 3.3.2)                    
##  caret          * 6.0-76     2017-04-18 CRAN (R 3.3.2)                    
##  cellranger       1.1.0      2016-07-27 CRAN (R 3.3.0)                    
##  class            7.3-14     2015-08-30 CRAN (R 3.3.3)                    
##  codetools        0.2-15     2016-10-05 CRAN (R 3.3.3)                    
##  colorspace       1.3-2      2016-12-14 CRAN (R 3.3.2)                    
##  config           0.2        2016-08-02 CRAN (R 3.3.0)                    
##  curl           * 2.6        2017-04-27 CRAN (R 3.3.2)                    
##  datasets       * 3.3.3      2017-03-07 local                             
##  DBI              0.6-1      2017-04-01 CRAN (R 3.3.2)                    
##  devtools         1.13.1     2017-05-13 CRAN (R 3.3.2)                    
##  digest           0.6.12     2017-01-27 CRAN (R 3.3.2)                    
##  dplyr          * 0.5.0      2016-06-24 CRAN (R 3.3.0)                    
##  e1071          * 1.6-8      2017-02-02 CRAN (R 3.3.2)                    
##  evaluate         0.10       2016-10-11 CRAN (R 3.3.0)                    
##  FNN            * 1.1        2013-07-31 CRAN (R 3.3.0)                    
##  forcats        * 0.2.0      2017-01-23 CRAN (R 3.3.2)                    
##  foreach        * 1.4.3      2015-10-13 CRAN (R 3.3.0)                    
##  foreign          0.8-68     2017-04-24 CRAN (R 3.3.2)                    
##  gam            * 1.14-4     2017-04-25 CRAN (R 3.3.2)                    
##  gapminder      * 0.2.0      2015-12-31 CRAN (R 3.3.0)                    
##  gbm            * 2.1.3      2017-03-21 CRAN (R 3.3.2)                    
##  geosphere        1.5-5      2016-06-15 CRAN (R 3.3.0)                    
##  gganimate      * 0.1.0.9000 2017-05-26 Github (dgrtwo/gganimate@bf82002) 
##  ggmap          * 2.7        2016-12-07 Github (dkahle/ggmap@c6b7579)     
##  ggplot2        * 2.2.1.9000 2017-05-12 Github (tidyverse/ggplot2@f4398b6)
##  ggrepel        * 0.6.5      2016-11-24 CRAN (R 3.3.2)                    
##  ggstance       * 0.3        2016-11-16 CRAN (R 3.3.2)                    
##  graphics       * 3.3.3      2017-03-07 local                             
##  grDevices      * 3.3.3      2017-03-07 local                             
##  grid             3.3.3      2017-03-07 local                             
##  gridExtra      * 2.2.1      2016-02-29 cran (@2.2.1)                     
##  gtable           0.2.0      2016-02-26 CRAN (R 3.3.0)                    
##  haven          * 1.0.0      2016-09-23 cran (@1.0.0)                     
##  here           * 0.0-6      2017-02-04 Github (krlmlr/here@007bfd9)      
##  hexbin         * 1.27.1     2015-08-19 CRAN (R 3.3.0)                    
##  highr            0.6        2016-05-09 CRAN (R 3.3.0)                    
##  hms              0.3        2016-11-22 CRAN (R 3.3.2)                    
##  htmltools        0.3.6      2017-04-28 cran (@0.3.6)                     
##  htmlwidgets      0.8        2016-11-09 CRAN (R 3.3.1)                    
##  httpuv           1.3.3      2015-08-04 CRAN (R 3.3.0)                    
##  httr           * 1.2.1      2016-07-03 CRAN (R 3.3.0)                    
##  igraph           1.0.1      2015-06-26 CRAN (R 3.3.0)                    
##  ISLR           * 1.0        2013-06-11 CRAN (R 3.3.0)                    
##  iterators        1.0.8      2015-10-13 CRAN (R 3.3.0)                    
##  janeaustenr      0.1.4      2016-10-26 CRAN (R 3.3.0)                    
##  jpeg             0.1-8      2014-01-23 cran (@0.1-8)                     
##  jsonlite       * 1.4        2017-04-08 cran (@1.4)                       
##  kknn           * 1.3.1      2016-03-26 CRAN (R 3.3.0)                    
##  knitr          * 1.16       2017-05-18 CRAN (R 3.3.2)                    
##  labeling         0.3        2014-08-23 CRAN (R 3.3.0)                    
##  lattice        * 0.20-35    2017-03-25 CRAN (R 3.3.2)                    
##  lazyeval         0.2.0      2016-06-12 CRAN (R 3.3.0)                    
##  lme4             1.1-13     2017-04-19 cran (@1.1-13)                    
##  lubridate      * 1.6.0      2016-09-13 CRAN (R 3.3.0)                    
##  lvplot         * 0.2.0.9000 2017-01-06 Github (hadley/lvplot@8ce61c7)    
##  magrittr         1.5        2014-11-22 CRAN (R 3.3.0)                    
##  mapproj          1.2-4      2015-08-03 CRAN (R 3.3.0)                    
##  maps           * 3.1.1      2016-07-27 CRAN (R 3.3.0)                    
##  MASS             7.3-47     2017-04-21 CRAN (R 3.3.2)                    
##  Matrix           1.2-10     2017-04-28 CRAN (R 3.3.2)                    
##  MatrixModels   * 0.4-1      2015-08-22 CRAN (R 3.3.0)                    
##  memoise          1.1.0      2017-04-21 CRAN (R 3.3.2)                    
##  methods        * 3.3.3      2017-03-07 local                             
##  mgcv             1.8-17     2017-02-08 CRAN (R 3.3.3)                    
##  microbenchmark * 1.4-2.1    2015-11-25 CRAN (R 3.3.0)                    
##  mime             0.5        2016-07-07 CRAN (R 3.3.0)                    
##  minqa            1.2.4      2014-10-09 cran (@1.2.4)                     
##  mnormt           1.5-5      2016-10-15 CRAN (R 3.3.0)                    
##  ModelMetrics     1.1.0      2016-08-26 CRAN (R 3.3.0)                    
##  modelr         * 0.1.0      2016-08-31 CRAN (R 3.3.0)                    
##  modeltools       0.2-21     2013-09-02 CRAN (R 3.3.0)                    
##  munsell          0.4.3      2016-02-13 CRAN (R 3.3.0)                    
##  nlme             3.1-131    2017-02-06 CRAN (R 3.3.3)                    
##  nloptr           1.0.4      2014-08-04 cran (@1.0.4)                     
##  NLP              0.1-10     2017-02-21 CRAN (R 3.3.2)                    
##  nnet           * 7.3-12     2016-02-02 CRAN (R 3.3.3)                    
##  nycflights13   * 0.2.2      2017-01-27 CRAN (R 3.3.2)                    
##  parallel       * 3.3.3      2017-03-07 local                             
##  pbkrtest         0.4-7      2017-03-15 CRAN (R 3.3.2)                    
##  plyr             1.8.4      2016-06-08 CRAN (R 3.3.0)                    
##  png              0.1-7      2013-12-03 cran (@0.1-7)                     
##  pROC           * 1.9.1      2017-02-05 CRAN (R 3.3.2)                    
##  profvis        * 0.3.3      2017-01-14 CRAN (R 3.3.2)                    
##  proto            1.0.0      2016-10-29 CRAN (R 3.3.0)                    
##  psych            1.7.5      2017-05-03 CRAN (R 3.3.3)                    
##  purrr          * 0.2.2.2    2017-05-11 CRAN (R 3.3.3)                    
##  quantreg       * 5.33       2017-04-18 CRAN (R 3.3.2)                    
##  R6               2.2.1      2017-05-10 CRAN (R 3.3.2)                    
##  randomForest   * 4.6-12     2015-10-07 CRAN (R 3.3.0)                    
##  rappdirs         0.3.1      2016-03-28 CRAN (R 3.3.0)                    
##  rcfss          * 0.1.4      2017-02-28 local                             
##  Rcpp             0.12.11    2017-05-22 CRAN (R 3.3.2)                    
##  readr          * 1.1.1      2017-05-16 CRAN (R 3.3.2)                    
##  readxl         * 1.0.0      2017-04-18 CRAN (R 3.3.2)                    
##  rebird         * 0.4.0      2017-04-26 CRAN (R 3.3.2)                    
##  reshape2         1.4.2      2016-10-22 CRAN (R 3.3.0)                    
##  RgoogleMaps      1.4.1      2016-09-18 cran (@1.4.1)                     
##  rjson            0.2.15     2014-11-03 cran (@0.2.15)                    
##  rlang            0.1.9000   2017-05-12 Github (hadley/rlang@c17568e)     
##  rmarkdown        1.5        2017-04-26 CRAN (R 3.3.2)                    
##  rprojroot        1.2        2017-01-16 CRAN (R 3.3.2)                    
##  rsconnect        0.8        2017-05-08 CRAN (R 3.3.2)                    
##  RSQLite        * 1.1-2      2017-01-08 CRAN (R 3.3.2)                    
##  rstudioapi       0.6        2016-06-27 CRAN (R 3.3.0)                    
##  rvest          * 0.3.2      2016-06-17 CRAN (R 3.3.0)                    
##  scales         * 0.4.1      2016-11-09 CRAN (R 3.3.1)                    
##  shiny          * 1.0.3      2017-04-26 CRAN (R 3.3.2)                    
##  slam             0.1-40     2016-12-01 CRAN (R 3.3.2)                    
##  SnowballC        0.5.1      2014-08-09 cran (@0.5.1)                     
##  sp               1.2-4      2016-12-22 CRAN (R 3.3.2)                    
##  sparklyr       * 0.5.5      2017-05-26 CRAN (R 3.3.3)                    
##  SparseM        * 1.77       2017-04-23 CRAN (R 3.3.2)                    
##  splines        * 3.3.3      2017-03-07 local                             
##  stats          * 3.3.3      2017-03-07 local                             
##  stats4           3.3.3      2017-03-07 local                             
##  stringi          1.1.5      2017-04-07 CRAN (R 3.3.2)                    
##  stringr        * 1.2.0      2017-02-18 CRAN (R 3.3.2)                    
##  survival       * 2.41-3     2017-04-04 CRAN (R 3.3.2)                    
##  tibble         * 1.3.1      2017-05-17 CRAN (R 3.3.2)                    
##  tidyr          * 0.6.3      2017-05-15 CRAN (R 3.3.2)                    
##  tidytext       * 0.1.2      2016-10-28 CRAN (R 3.3.0)                    
##  tidyverse      * 1.1.1      2017-01-27 CRAN (R 3.3.2)                    
##  titanic        * 0.1.0      2015-08-31 CRAN (R 3.3.0)                    
##  tm               0.7-1      2017-03-02 CRAN (R 3.3.2)                    
##  tokenizers       0.1.4      2016-08-29 CRAN (R 3.3.0)                    
##  tools            3.3.3      2017-03-07 local                             
##  topicmodels    * 0.2-6      2017-04-18 CRAN (R 3.3.2)                    
##  tree           * 1.0-37     2016-01-21 CRAN (R 3.3.0)                    
##  tweenr         * 0.1.5      2016-10-10 CRAN (R 3.3.0)                    
##  utils          * 3.3.3      2017-03-07 local                             
##  withr            1.0.2      2016-06-20 CRAN (R 3.3.0)                    
##  XML            * 3.98-1.7   2017-05-03 CRAN (R 3.3.2)                    
##  xml2           * 1.1.1      2017-01-24 CRAN (R 3.3.2)                    
##  xtable           1.8-2      2016-02-05 CRAN (R 3.3.0)                    
##  yaml             2.1.14     2016-11-12 cran (@2.1.14)</code></pre>
</div>

<p>This work is licensed under the  <a href="http://creativecommons.org/licenses/by-nc/4.0/">CC BY-NC 4.0 Creative Commons License</a>.</p>


</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
