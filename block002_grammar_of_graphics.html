<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />




<title>Visualizations and the grammar of graphics</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/readable.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-45631879-2', 'auto');
  ga('send', 'pageview');

</script>


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>


<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>


</head>

<body>

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
button.code-folding-btn:focus {
  outline: none;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 66px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 71px;
  margin-top: -71px;
}

.section h2 {
  padding-top: 71px;
  margin-top: -71px;
}
.section h3 {
  padding-top: 71px;
  margin-top: -71px;
}
.section h4 {
  padding-top: 71px;
  margin-top: -71px;
}
.section h5 {
  padding-top: 71px;
  margin-top: -71px;
}
.section h6 {
  padding-top: 71px;
  margin-top: -71px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>


<div class="container-fluid main-container">

<!-- tabsets -->
<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});
</script>

<!-- code folding -->




<script>
$(document).ready(function ()  {

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_').toLowerCase();
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}


.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
  padding-left: 25px;
  text-indent: 0;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>

<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row-fluid">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Computing for the Social Sciences</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">Home</a>
</li>
<li>
  <a href="faq.html">FAQ</a>
</li>
<li>
  <a href="syllabus.html">Syllabus</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">Visualizations and the grammar of graphics</h1>

</div>


<div id="objectives" class="section level1">
<h1>Objectives</h1>
<ul>
<li>Identify the importance of graphics in communicating information</li>
<li>Define the layered grammar of graphics</li>
<li>Practice generating layered graphics using <a href="https://github.com/hadley/ggplot2"><code>ggplot2</code></a></li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(tidyverse)
<span class="kw">library</span>(forcats)
<span class="kw">library</span>(knitr)
<span class="kw">library</span>(broom)
<span class="kw">library</span>(stringr)
<span class="kw">library</span>(tweenr)
<span class="kw">library</span>(gganimate)</code></pre></div>
</div>
<div id="identify-the-importance-of-graphics-in-communicating-information" class="section level1">
<h1>Identify the importance of graphics in communicating information</h1>
<p>Research methods classes in graduate school generally teach important skills such as probability and statistical theory, regression, analysis of variance (ANOVA), maximum likelihood estimation (MLE), etc. While these are important methods for analyzing data and assessing research questions, sometimes drawing a picture (aka <strong>visualization</strong>) can be more precise than conventional statistical computations.<a href="#fn1" class="footnoteRef" id="fnref1"><sup>1</sup></a></p>
<p>Consider the following 13 data sets. What are the corresponding relationships between <span class="math inline">\(X\)</span> and <span class="math inline">\(Y\)</span>? Using traditional metrics, the relationships appear identical across the samples:</p>
<table>
<caption>Summary statistics of 12 datasets</caption>
<thead>
<tr class="header">
<th align="right">ID</th>
<th align="right"><span class="math inline">\(N\)</span></th>
<th align="right"><span class="math inline">\(\bar{X}\)</span></th>
<th align="right"><span class="math inline">\(\bar{Y}\)</span></th>
<th align="right"><span class="math inline">\(\sigma_{X}\)</span></th>
<th align="right"><span class="math inline">\(\sigma_{Y}\)</span></th>
<th align="right"><span class="math inline">\(R\)</span></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="right">142</td>
<td align="right">54.3</td>
<td align="right">47.8</td>
<td align="right">16.8</td>
<td align="right">26.9</td>
<td align="right">-0.064</td>
</tr>
<tr class="even">
<td align="right">2</td>
<td align="right">142</td>
<td align="right">54.3</td>
<td align="right">47.8</td>
<td align="right">16.8</td>
<td align="right">26.9</td>
<td align="right">-0.064</td>
</tr>
<tr class="odd">
<td align="right">3</td>
<td align="right">142</td>
<td align="right">54.3</td>
<td align="right">47.8</td>
<td align="right">16.8</td>
<td align="right">26.9</td>
<td align="right">-0.062</td>
</tr>
<tr class="even">
<td align="right">4</td>
<td align="right">142</td>
<td align="right">54.3</td>
<td align="right">47.8</td>
<td align="right">16.8</td>
<td align="right">26.9</td>
<td align="right">-0.069</td>
</tr>
<tr class="odd">
<td align="right">5</td>
<td align="right">142</td>
<td align="right">54.3</td>
<td align="right">47.8</td>
<td align="right">16.8</td>
<td align="right">26.9</td>
<td align="right">-0.066</td>
</tr>
<tr class="even">
<td align="right">6</td>
<td align="right">142</td>
<td align="right">54.3</td>
<td align="right">47.8</td>
<td align="right">16.8</td>
<td align="right">26.9</td>
<td align="right">-0.063</td>
</tr>
<tr class="odd">
<td align="right">7</td>
<td align="right">142</td>
<td align="right">54.3</td>
<td align="right">47.8</td>
<td align="right">16.8</td>
<td align="right">26.9</td>
<td align="right">-0.069</td>
</tr>
<tr class="even">
<td align="right">8</td>
<td align="right">142</td>
<td align="right">54.3</td>
<td align="right">47.8</td>
<td align="right">16.8</td>
<td align="right">26.9</td>
<td align="right">-0.060</td>
</tr>
<tr class="odd">
<td align="right">9</td>
<td align="right">142</td>
<td align="right">54.3</td>
<td align="right">47.8</td>
<td align="right">16.8</td>
<td align="right">26.9</td>
<td align="right">-0.068</td>
</tr>
<tr class="even">
<td align="right">10</td>
<td align="right">142</td>
<td align="right">54.3</td>
<td align="right">47.8</td>
<td align="right">16.8</td>
<td align="right">26.9</td>
<td align="right">-0.069</td>
</tr>
<tr class="odd">
<td align="right">11</td>
<td align="right">142</td>
<td align="right">54.3</td>
<td align="right">47.8</td>
<td align="right">16.8</td>
<td align="right">26.9</td>
<td align="right">-0.069</td>
</tr>
<tr class="even">
<td align="right">12</td>
<td align="right">142</td>
<td align="right">54.3</td>
<td align="right">47.8</td>
<td align="right">16.8</td>
<td align="right">26.9</td>
<td align="right">-0.069</td>
</tr>
<tr class="odd">
<td align="right">13</td>
<td align="right">142</td>
<td align="right">54.3</td>
<td align="right">47.8</td>
<td align="right">16.8</td>
<td align="right">26.9</td>
<td align="right">-0.067</td>
</tr>
</tbody>
</table>
<p><span class="math inline">\(X\)</span> and <span class="math inline">\(Y\)</span> have the same mean and standard deviation in each dataset, and the correlation coefficient (Pearson’s <span class="math inline">\(r\)</span>) is virtually identical. If we estimated linear regression models for each dataset, we would obtain virtually identical coefficients (again suggesting the relationships are identical):</p>
<p><img src="block002_grammar_of_graphics_files/figure-html/datasaurus-lm-1.png" width="672" /></p>
<p>But what happens if we draw a picture?<a href="#fn2" class="footnoteRef" id="fnref2"><sup>2</sup></a></p>
<video width="672"  controls loop>
<source src="block002_grammar_of_graphics_files/figure-html/datasaurus-graph.webm" />
</video>
<p><img src="block002_grammar_of_graphics_files/figure-html/datasaurus-graph-static-1.png" width="768" /></p>
<p>Remarkably each of the datasets have the same summary statistics and linear relationships, yet they are drastically different in appearance! A good picture tells the reader much more than any table or text can provide.</p>
</div>
<div id="the-layered-grammar-of-graphics" class="section level1">
<h1>The layered grammar of graphics</h1>
<p>Google defines a <strong>grammar</strong> as “the whole system and structure of a language or of languages in general, usually taken as consisting of syntax and morphology (including inflections) and sometimes also phonology and semantics”.<a href="#fn3" class="footnoteRef" id="fnref3"><sup>3</sup></a> Others consider a grammar to be “the fundamental principles or rules of an art or science”.<a href="#fn4" class="footnoteRef" id="fnref4"><sup>4</sup></a> Applied to visualizations, a <strong>grammar of graphics</strong> is a grammar used to describe and create a wide range of statistical graphics.<a href="#fn5" class="footnoteRef" id="fnref5"><sup>5</sup></a></p>
<p>The <strong>layered grammar of graphics</strong> approach is implemented in <a href="https://cran.r-project.org/web/packages/ggplot2/index.html"><code>ggplot2</code></a>, a widely used graphics library for R. All graphics in this library are built using a layered approach, building layers up to create the final graphic.</p>
</div>
<div id="components-of-the-layered-grammar-of-graphics" class="section level1">
<h1>Components of the layered grammar of graphics</h1>
<ul>
<li>Layer
<ul>
<li>Data</li>
<li>Mapping</li>
<li>Statistical transformation (stat)</li>
<li>Geometric object (geom)</li>
<li>Position adjustment (position)</li>
</ul></li>
<li>Scale</li>
<li>Coordinate system (coord)</li>
<li>Faceting (facet)</li>
<li>Defaults
<ul>
<li>Data</li>
<li>Mapping</li>
</ul></li>
</ul>
<div id="layer" class="section level2">
<h2>Layer</h2>
<p><strong>Layers</strong> are used to create the objects on a plot. They are defined by five basic parts:</p>
<ol style="list-style-type: decimal">
<li>Data</li>
<li>Mapping</li>
<li>Statistical transformation (stat)</li>
<li>Geometric object (geom)</li>
<li>Position adjustment (position)</li>
</ol>
<p>Layers are typically related to one another and share many common features. For instance, multiple layers can be built using the same underlying data. An example would be a scattterplot overlayed with a smoothed regression line to summarize the relationship between the variables:</p>
<p><img src="block002_grammar_of_graphics_files/figure-html/layers-1.png" width="672" /></p>
<div id="data-and-mapping" class="section level3">
<h3>Data and mapping</h3>
<p><strong>Data</strong> defines the source of the information to be visualized, but is independent from the other elements. So a layered graphic can be built which can utilize different data sources while keeping the other components the same. Here is a portion of a dataset contained in the <code>ggplot2</code> package: <code>mpg</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(mpg) %&gt;%
<span class="st">  </span><span class="kw">kable</span>(<span class="dt">caption =</span> <span class="st">&quot;Dataset of automobiles&quot;</span>)</code></pre></div>
<table>
<caption>Dataset of automobiles</caption>
<thead>
<tr class="header">
<th align="left">manufacturer</th>
<th align="left">model</th>
<th align="right">displ</th>
<th align="right">year</th>
<th align="right">cyl</th>
<th align="left">trans</th>
<th align="left">drv</th>
<th align="right">cty</th>
<th align="right">hwy</th>
<th align="left">fl</th>
<th align="left">class</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">audi</td>
<td align="left">a4</td>
<td align="right">1.8</td>
<td align="right">1999</td>
<td align="right">4</td>
<td align="left">auto(l5)</td>
<td align="left">f</td>
<td align="right">18</td>
<td align="right">29</td>
<td align="left">p</td>
<td align="left">compact</td>
</tr>
<tr class="even">
<td align="left">audi</td>
<td align="left">a4</td>
<td align="right">1.8</td>
<td align="right">1999</td>
<td align="right">4</td>
<td align="left">manual(m5)</td>
<td align="left">f</td>
<td align="right">21</td>
<td align="right">29</td>
<td align="left">p</td>
<td align="left">compact</td>
</tr>
<tr class="odd">
<td align="left">audi</td>
<td align="left">a4</td>
<td align="right">2.0</td>
<td align="right">2008</td>
<td align="right">4</td>
<td align="left">manual(m6)</td>
<td align="left">f</td>
<td align="right">20</td>
<td align="right">31</td>
<td align="left">p</td>
<td align="left">compact</td>
</tr>
<tr class="even">
<td align="left">audi</td>
<td align="left">a4</td>
<td align="right">2.0</td>
<td align="right">2008</td>
<td align="right">4</td>
<td align="left">auto(av)</td>
<td align="left">f</td>
<td align="right">21</td>
<td align="right">30</td>
<td align="left">p</td>
<td align="left">compact</td>
</tr>
<tr class="odd">
<td align="left">audi</td>
<td align="left">a4</td>
<td align="right">2.8</td>
<td align="right">1999</td>
<td align="right">6</td>
<td align="left">auto(l5)</td>
<td align="left">f</td>
<td align="right">16</td>
<td align="right">26</td>
<td align="left">p</td>
<td align="left">compact</td>
</tr>
<tr class="even">
<td align="left">audi</td>
<td align="left">a4</td>
<td align="right">2.8</td>
<td align="right">1999</td>
<td align="right">6</td>
<td align="left">manual(m5)</td>
<td align="left">f</td>
<td align="right">18</td>
<td align="right">26</td>
<td align="left">p</td>
<td align="left">compact</td>
</tr>
</tbody>
</table>
<p><strong>Mapping</strong> defines how the variables are applied to the graphic. So if we were graphing information from <code>mpg</code>, we might map a car’s engine displacement to the <span class="math inline">\(x\)</span> position and highway mileage to the <span class="math inline">\(y\)</span> position.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">mpg %&gt;%
<span class="st">  </span><span class="kw">select</span>(displ, hwy) %&gt;%
<span class="st">  </span><span class="kw">rename</span>(<span class="dt">x =</span> displ,
         <span class="dt">y =</span> hwy)</code></pre></div>
<pre><code>## # A tibble: 234 × 2
##        x     y
##    &lt;dbl&gt; &lt;int&gt;
## 1    1.8    29
## 2    1.8    29
## 3    2.0    31
## 4    2.0    30
## 5    2.8    26
## 6    2.8    26
## 7    3.1    27
## 8    1.8    26
## 9    1.8    25
## 10   2.0    28
## # ... with 224 more rows</code></pre>
</div>
<div id="statistical-transformation" class="section level3">
<h3>Statistical transformation</h3>
<p>A <strong>statistical transformation</strong> (<em>stat</em>) transforms the data, generally by summarizing the information. For instance, in a bar graph you typically are not trying to graph the raw data because this doesn’t make any inherent sense. Instead, you might summarize the data by graphing the total number of observations within a set of categories. Or if you have a dataset with many observations, you might transform the data into a smoothing line which summarizes the overall pattern of the relationship between variables.</p>
<p>A stat takes a dataset as input and returns a dataset as output, and so a stat can add new variables to the original dataset. So instead of graphing this data in its raw form:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">mpg %&gt;%
<span class="st">  </span><span class="kw">select</span>(cyl)</code></pre></div>
<pre><code>## # A tibble: 234 × 1
##      cyl
##    &lt;int&gt;
## 1      4
## 2      4
## 3      4
## 4      4
## 5      6
## 6      6
## 7      6
## 8      4
## 9      4
## 10     4
## # ... with 224 more rows</code></pre>
<p>You would transform it to:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">mpg %&gt;%
<span class="st">  </span><span class="kw">count</span>(cyl)</code></pre></div>
<pre><code>## # A tibble: 4 × 2
##     cyl     n
##   &lt;int&gt; &lt;int&gt;
## 1     4    81
## 2     5     4
## 3     6    79
## 4     8    70</code></pre>
<blockquote>
<p>Sometimes you don’t need to make a statistical transformation. For example, in a scatterplot you use the raw values for the <span class="math inline">\(x\)</span> and <span class="math inline">\(y\)</span> variables to map onto the graph. In these situations, the statistical transformation is an <em>identity</em> transformation - the stat simply passes in the original dataset and exports the exact same dataset.</p>
</blockquote>
</div>
<div id="geometric-objects" class="section level3">
<h3>Geometric objects</h3>
<p><strong>Geometric objects</strong> (<em>geoms</em>) control the type of plot you create. Geoms are classified by their dimensionality:</p>
<ul>
<li>0 dimensions - point, text</li>
<li>1 dimension - path, line</li>
<li>2 dimensions - polygon, interval</li>
</ul>
<p>Each geom can only display certain aesthetics. For example, a point geom has position, color, shape, and size aesthetics.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(mpg, <span class="kw">aes</span>(displ, hwy, <span class="dt">color =</span> class)) +
<span class="st">  </span><span class="kw">geom_point</span>() +
<span class="st">  </span><span class="kw">ggtitle</span>(<span class="st">&quot;A point geom with position and color aesthetics&quot;</span>)</code></pre></div>
<p><img src="block002_grammar_of_graphics_files/figure-html/geom_point-1.png" width="672" /></p>
<p>A bar geom has position, height, width, and fill color.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(mpg, <span class="kw">aes</span>(cyl)) +
<span class="st">  </span><span class="kw">geom_bar</span>() +
<span class="st">  </span><span class="kw">ggtitle</span>(<span class="st">&quot;A bar geom with position and height aesthetics&quot;</span>)</code></pre></div>
<p><img src="block002_grammar_of_graphics_files/figure-html/geom_bar-1.png" width="672" /></p>
</div>
<div id="position-adjustment" class="section level3">
<h3>Position adjustment</h3>
<p>Sometimes with dense data we need to adjust the position of elements on the plot, otherwise data points might obscure one another. Bar plots frequently stack or dodge the bars to avoid overlap:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">count</span>(mpg, class, cyl) %&gt;%
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(cyl, n, <span class="dt">fill =</span> class)) +
<span class="st">  </span><span class="kw">geom_bar</span>(<span class="dt">stat =</span> <span class="st">&quot;identity&quot;</span>) +
<span class="st">  </span><span class="kw">ggtitle</span>(<span class="st">&quot;A stacked bar chart&quot;</span>)</code></pre></div>
<p><img src="block002_grammar_of_graphics_files/figure-html/position_dodge-1.png" width="672" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">count</span>(mpg, class, cyl) %&gt;%
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(cyl, n, <span class="dt">fill =</span> class)) +
<span class="st">  </span><span class="kw">geom_bar</span>(<span class="dt">stat =</span> <span class="st">&quot;identity&quot;</span>, <span class="dt">position =</span> <span class="st">&quot;dodge&quot;</span>) +
<span class="st">  </span><span class="kw">ggtitle</span>(<span class="st">&quot;A dodged bar chart&quot;</span>)</code></pre></div>
<p><img src="block002_grammar_of_graphics_files/figure-html/position_dodge-2.png" width="672" /></p>
<p>Sometimes scatterplots with few unique <span class="math inline">\(x\)</span> and <span class="math inline">\(y\)</span> values are <strong>jittered</strong> (random noise is added) to reduce overplotting.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(mpg, <span class="kw">aes</span>(cyl, hwy)) +
<span class="st">  </span><span class="kw">geom_point</span>() +
<span class="st">  </span><span class="kw">ggtitle</span>(<span class="st">&quot;A point geom with obscured data points&quot;</span>)</code></pre></div>
<p><img src="block002_grammar_of_graphics_files/figure-html/position-1.png" width="672" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(mpg, <span class="kw">aes</span>(cyl, hwy)) +
<span class="st">  </span><span class="kw">geom_jitter</span>() +
<span class="st">  </span><span class="kw">ggtitle</span>(<span class="st">&quot;A point geom with jittered data points&quot;</span>)</code></pre></div>
<p><img src="block002_grammar_of_graphics_files/figure-html/position-2.png" width="672" /></p>
</div>
</div>
<div id="scale" class="section level2">
<h2>Scale</h2>
<p>A <strong>scale</strong> controls how data is mapped to aesthetic attributes, so we need one scale for every aesthetic property employed in a layer. For example, this graph defines a scale for color:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(mpg, <span class="kw">aes</span>(displ, hwy, <span class="dt">color =</span> class)) +
<span class="st">  </span><span class="kw">geom_point</span>() +
<span class="st">  </span><span class="kw">guides</span>(<span class="dt">color =</span> <span class="kw">guide_legend</span>(<span class="dt">override.aes =</span> <span class="kw">list</span>(<span class="dt">size =</span> <span class="dv">4</span>)))</code></pre></div>
<p><img src="block002_grammar_of_graphics_files/figure-html/scale_color-1.png" width="672" /></p>
<p>Note that the scale is consistent - every point for a compact car is drawn in tan, whereas SUVs are drawn in pink. The scale can be changed to use a different color palette:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(mpg, <span class="kw">aes</span>(displ, hwy, <span class="dt">color =</span> class)) +
<span class="st">  </span><span class="kw">geom_point</span>() +
<span class="st">  </span><span class="kw">scale_color_brewer</span>(<span class="dt">palette =</span> <span class="st">&quot;Dark2&quot;</span>) +
<span class="st">  </span><span class="kw">guides</span>(<span class="dt">color =</span> <span class="kw">guide_legend</span>(<span class="dt">override.aes =</span> <span class="kw">list</span>(<span class="dt">size =</span> <span class="dv">4</span>)))</code></pre></div>
<p><img src="block002_grammar_of_graphics_files/figure-html/scale_color_palette-1.png" width="672" /></p>
<p>Now we are using a different palette, but the scale is still consistent: all compact cars utilize the same color, whereas SUVs use a different color <strong>but each SUV uses the same color</strong>.</p>
</div>
<div id="coordinate-system" class="section level2">
<h2>Coordinate system</h2>
<p>A <strong>coordinate system</strong> (<em>coord</em>) maps the position of objects onto the plane of the plot, and control how the axes and grid lines are drawn. Plots typically use two coordinates (<span class="math inline">\(x, y\)</span>), but could use any number of coordinates. Most plots are drawn using the <a href="https://en.wikipedia.org/wiki/Cartesian_coordinate_system"><strong>Cartesian coordinate system</strong></a>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">x1 &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">10</span>)
y1 &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">5</span>)
p &lt;-<span class="st"> </span><span class="kw">qplot</span>(x1, y1, <span class="dt">geom =</span> <span class="st">&quot;blank&quot;</span>, <span class="dt">xlab =</span> <span class="ot">NULL</span>, <span class="dt">ylab =</span> <span class="ot">NULL</span>) +
<span class="st">  </span><span class="kw">theme_bw</span>()
p </code></pre></div>
<p><img src="block002_grammar_of_graphics_files/figure-html/coord_cart-1.png" width="672" /></p>
<p>This system requires a fixed and equal spacing between values on the axes. That is, the graph draws the same distance between 1 and 2 as it does between 5 and 6. The graph could be drawn using a <a href="https://en.wikipedia.org/wiki/Semi-log_plot"><strong>semi-log coordinate system</strong></a> which logarithmically compresses the distance on an axis:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">p +<span class="st"> </span><span class="kw">coord_trans</span>(<span class="dt">y =</span> <span class="st">&quot;log10&quot;</span>)</code></pre></div>
<p><img src="block002_grammar_of_graphics_files/figure-html/coord_semi_log-1.png" width="672" /></p>
<p>Or could even be drawn using <a href="https://en.wikipedia.org/wiki/Polar_coordinate_system"><strong>polar coordinates</strong></a>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">p +<span class="st"> </span><span class="kw">coord_polar</span>()</code></pre></div>
<p><img src="block002_grammar_of_graphics_files/figure-html/coord_polar-1.png" width="672" /></p>
</div>
<div id="faceting" class="section level2">
<h2>Faceting</h2>
<p><strong>Faceting</strong> can be used to split the data up into subsets of the entire dataset. This is a powerful tool when investigating whether patterns are the same or different across conditions, and allows the subsets to be visualized on the same plot (known as <strong>conditioned</strong> or <strong>trellis</strong> plots). The faceting specification describes which variables should be used to split up the data, and how they should be arranged.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(mpg, <span class="kw">aes</span>(displ, hwy)) +
<span class="st">  </span><span class="kw">geom_point</span>() +
<span class="st">  </span><span class="kw">facet_wrap</span>(~class)</code></pre></div>
<p><img src="block002_grammar_of_graphics_files/figure-html/facet-1.png" width="672" /></p>
</div>
<div id="defaults" class="section level2">
<h2>Defaults</h2>
<p>Rather than explicitly declaring each component of a layered graphic (which will use more code and introduces opportunities for errors), we can establish intelligent defaults for specific geoms and scales. For instance, whenever we want to use a bar geom, we can default to using a stat that counts the number of observations in each group of our variable in the <span class="math inline">\(x\)</span> position.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>() +
<span class="st">  </span><span class="kw">layer</span>(
    <span class="dt">data =</span> mpg, <span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> displ, <span class="dt">y =</span> hwy),
    <span class="dt">geom =</span> <span class="st">&quot;point&quot;</span>, <span class="dt">stat =</span> <span class="st">&quot;identity&quot;</span>, <span class="dt">position =</span> <span class="st">&quot;identity&quot;</span>
  ) +
<span class="st">  </span><span class="kw">scale_x_continuous</span>() +
<span class="st">  </span><span class="kw">scale_y_continuous</span>() +
<span class="st">  </span><span class="kw">coord_cartesian</span>()</code></pre></div>
<p><img src="block002_grammar_of_graphics_files/figure-html/default-1.png" width="672" /></p>
<p>The above code:</p>
<ul>
<li>Creates a new plot object (<code>ggplot</code>)</li>
<li>Adds a layer (<code>layer</code>)
<ul>
<li>Specifies the data (<code>mpg</code>)</li>
<li>Maps engine displacement to the <span class="math inline">\(x\)</span> position and highway mileage to the <span class="math inline">\(y\)</span> position (<code>mapping</code>)</li>
<li>Uses the point geometric transformation (<code>geom = &quot;point&quot;</code>)</li>
<li>Implements an identity transformation and position (<code>stat = &quot;identity&quot;</code> and <code>position = &quot;identity&quot;</code>)</li>
</ul></li>
<li>Establishes two continuous position scales (<code>scale_x_continuous</code> and <code>scale_y_continuous</code>)</li>
<li>Declares a cartesian coordinate system (<code>coord_cartesian</code>)</li>
</ul>
<p>How can we simplify this using intelligent defaults?</p>
<ol style="list-style-type: decimal">
<li>We only need to specify one geom and stat, since each geom has a default stat.</li>
<li>Cartesian coordinate systems are most commonly used, so it is the default.</li>
<li>Default scales can be added based on the aesthetic and type of variables.
<ul>
<li>Continuous values are transformed with a linear scaling.</li>
<li>Discrete values are mapped to integers.</li>
<li>Scales for aesthetics such as color, fill, and size can also be intelligently defaulted.</li>
</ul></li>
</ol>
<p>Using these defaults, we can rewrite the above code as:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>() +
<span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">data =</span> mpg, <span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> displ, <span class="dt">y =</span> hwy))</code></pre></div>
<p><img src="block002_grammar_of_graphics_files/figure-html/default2-1.png" width="672" /></p>
<p>Because multiple layers can use the same components (data, mapping, etc.), we can specify that information in the <code>ggplot</code> function rather than in the <code>layer</code> function:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(<span class="dt">data =</span> mpg, <span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> displ, <span class="dt">y =</span> hwy)) +
<span class="st">  </span><span class="kw">geom_point</span>()</code></pre></div>
<p><img src="block002_grammar_of_graphics_files/figure-html/default3-1.png" width="672" /></p>
<p>And as we will learn, function arguments in R use specific ordering, so we can omit the explicit call to <code>data</code> and <code>mapping</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(mpg, <span class="kw">aes</span>(displ, hwy)) +
<span class="st">  </span><span class="kw">geom_point</span>()</code></pre></div>
<p><img src="block002_grammar_of_graphics_files/figure-html/default4-1.png" width="672" /></p>
<p>With this specification, it is easy to build the graphic up with additional layers, without modifying the original code:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(mpg, <span class="kw">aes</span>(displ, hwy)) +
<span class="st">  </span><span class="kw">geom_point</span>() +
<span class="st">  </span><span class="kw">geom_smooth</span>()</code></pre></div>
<pre><code>## `geom_smooth()` using method = &#39;loess&#39;</code></pre>
<p><img src="block002_grammar_of_graphics_files/figure-html/default5-1.png" width="672" /></p>
<p>Because we called <code>aes(x = displ, y = hwy)</code> within the <code>ggplot</code> function, it is automatically passed along to both <code>geom_point()</code> and <code>geom_smooth()</code>. If we fail to do this, we get an error:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(mpg) +
<span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(displ, hwy)) +
<span class="st">  </span><span class="kw">geom_smooth</span>()</code></pre></div>
<pre><code>## `geom_smooth()` using method = &#39;loess&#39;</code></pre>
<pre><code>## Error: stat_smooth requires the following missing aesthetics: x, y</code></pre>
<p><img src="block002_grammar_of_graphics_files/figure-html/default6-1.png" width="672" /></p>
</div>
</div>
<div id="how-to-build-a-complicated-layered-graphic" class="section level1">
<h1>How to build a complicated, layered graphic</h1>
<div id="charles-minards-map-of-napoleons-disastrous-russian-campaign-of-1812" class="section level2">
<h2>Charles Minard’s map of Napoleon’s disastrous Russian campaign of 1812</h2>
<div class="figure">
<img src="https://upload.wikimedia.org/wikipedia/commons/2/29/Minard.png" alt="Carte figurative des pertes successives en hommes de l’Armee Français dans la campagne de Russe 1812–1813 by Charles Joseph Minard" />
<p class="caption"><a href="https://en.wikipedia.org/wiki/Charles_Joseph_Minard">“Carte figurative des pertes successives en hommes de l’Armee Français dans la campagne de Russe 1812–1813” by Charles Joseph Minard</a></p>
</div>
<p>The graphic is notable for its representation in two dimensions of six types of data: the number of Napoleon’s troops; distance; temperature; the latitude and longitude; direction of travel; and location relative to specific dates.<a href="#fn6" class="footnoteRef" id="fnref6"><sup>6</sup></a></p>
</div>
<div id="building-minards-map-in-r" class="section level2">
<h2>Building Minard’s map in R</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># get data on troop movements and city names</span>
troops &lt;-<span class="st"> </span><span class="kw">read_table</span>(<span class="st">&quot;data/minard-troops.txt&quot;</span>)
cities &lt;-<span class="st"> </span><span class="kw">read_table</span>(<span class="st">&quot;data/minard-cities.txt&quot;</span>)
troops</code></pre></div>
<pre><code>## # A tibble: 51 × 5
##     long   lat survivors direction group
##    &lt;dbl&gt; &lt;dbl&gt;     &lt;int&gt;     &lt;chr&gt; &lt;int&gt;
## 1   24.0  54.9    340000         A     1
## 2   24.5  55.0    340000         A     1
## 3   25.5  54.5    340000         A     1
## 4   26.0  54.7    320000         A     1
## 5   27.0  54.8    300000         A     1
## 6   28.0  54.9    280000         A     1
## 7   28.5  55.0    240000         A     1
## 8   29.0  55.1    210000         A     1
## 9   30.0  55.2    180000         A     1
## 10  30.3  55.3    175000         A     1
## # ... with 41 more rows</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">cities</code></pre></div>
<pre><code>## # A tibble: 20 × 3
##     long   lat           city
##    &lt;dbl&gt; &lt;dbl&gt;          &lt;chr&gt;
## 1   24.0  55.0          Kowno
## 2   25.3  54.7          Wilna
## 3   26.4  54.4       Smorgoni
## 4   26.8  54.3      Moiodexno
## 5   27.7  55.2      Gloubokoe
## 6   27.6  53.9          Minsk
## 7   28.5  54.3     Studienska
## 8   28.7  55.5        Polotzk
## 9   29.2  54.4           Bobr
## 10  30.2  55.3        Witebsk
## 11  30.4  54.5         Orscha
## 12  30.4  53.9        Mohilow
## 13  32.0  54.8       Smolensk
## 14  33.2  54.9    Dorogobouge
## 15  34.3  55.2          Wixma
## 16  34.4  55.5          Chjat
## 17  36.0  55.5        Mojaisk
## 18  37.6  55.8         Moscou
## 19  36.6  55.3      Tarantino
## 20  36.5  55.0 Malo-Jarosewii</code></pre>
<div id="grammar-of-minards-graphic" class="section level3">
<h3>Grammar of Minard’s graphic</h3>
<p><strong>Exercise: Write out what the grammar of graphics will look for this graph.</strong></p>
<details> <summary><strong>Click here for solution</strong></summary>
<p>
<ul>
<li>Layer
<ul>
<li>Data - <code>troops</code></li>
<li>Mapping
<ul>
<li><span class="math inline">\(x\)</span> and <span class="math inline">\(y\)</span> - troop position (<code>lat</code> and <code>long</code>)</li>
<li>Size - <code>survivors</code></li>
<li>Color - <code>direction</code></li>
</ul></li>
<li>Statistical transformation (stat) - <code>identity</code></li>
<li>Geometric object (geom) - <code>path</code></li>
<li>Position adjustment (position) - none</li>
</ul></li>
<li>Layer
<ul>
<li>Data - <code>cities</code></li>
<li>Mapping
<ul>
<li><span class="math inline">\(x\)</span> and <span class="math inline">\(y\)</span> - city position (<code>lat</code> and <code>long</code>)</li>
<li>Label - <code>city</code></li>
</ul></li>
<li>Statistical transformation (stat) - <code>identity</code></li>
<li>Geometric object (geom) - <code>text</code></li>
<li>Position adjustment (position) - none</li>
</ul></li>
<li>Scale
<ul>
<li>Size - range of widths for troop <code>path</code></li>
<li>Color - colors to indicate advancing or retreating troops</li>
</ul></li>
<li>Coordinate system - map projection (Mercator or something else)</li>
<li>Faceting - none
</p>
</details></li>
</ul>
</div>
<div id="write-the-r-code" class="section level3">
<h3>Write the R code</h3>
<p>First we want to build the layer for the troop movement:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">plot_troops &lt;-<span class="st"> </span><span class="kw">ggplot</span>(troops, <span class="kw">aes</span>(long, lat)) +
<span class="st">  </span><span class="kw">geom_path</span>(<span class="kw">aes</span>(<span class="dt">size =</span> survivors,
                <span class="dt">color =</span> direction,
                <span class="dt">group =</span> group))
plot_troops</code></pre></div>
<p><img src="block002_grammar_of_graphics_files/figure-html/plot_troops-1.png" width="672" /></p>
<p>Next let’s add the cities layer:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">plot_both &lt;-<span class="st"> </span>plot_troops +<span class="st"> </span>
<span class="st">  </span><span class="kw">geom_text</span>(<span class="dt">data =</span> cities, <span class="kw">aes</span>(<span class="dt">label =</span> city), <span class="dt">size =</span> <span class="dv">4</span>)
plot_both</code></pre></div>
<p><img src="block002_grammar_of_graphics_files/figure-html/plot_cities-1.png" width="672" /></p>
<p>Now that the basic information is on there, we want to clean up the graph and polish the visualization by:</p>
<ul>
<li>Adjusting the size scale aesthetics for troop movement to better highlight the loss of troops over the campaign.</li>
<li>Change the default colors to mimic Minard’s original grey and tan palette.</li>
<li>Change the coordinate system to a map-based system that draws the <span class="math inline">\(x\)</span> and <span class="math inline">\(y\)</span> axes at equal intervals.</li>
<li>Give the map a title and remove the axis labels.</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">plot_polished &lt;-<span class="st"> </span>plot_both +
<span class="st">  </span><span class="kw">scale_size</span>(<span class="dt">range =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">12</span>),
             <span class="dt">breaks =</span> <span class="kw">c</span>(<span class="dv">10000</span>, <span class="dv">20000</span>, <span class="dv">30000</span>),
             <span class="dt">labels =</span> <span class="kw">c</span>(<span class="st">&quot;10,000&quot;</span>, <span class="st">&quot;20,000&quot;</span>, <span class="st">&quot;30,000&quot;</span>)) +<span class="st"> </span>
<span class="st">  </span><span class="kw">scale_color_manual</span>(<span class="dt">values =</span> <span class="kw">c</span>(<span class="st">&quot;tan&quot;</span>, <span class="st">&quot;grey50&quot;</span>)) +
<span class="st">  </span><span class="kw">coord_map</span>() +
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;Map of Napoleon&#39;s Russian campaign of 1812&quot;</span>,
       <span class="dt">x =</span> <span class="ot">NULL</span>,
       <span class="dt">y =</span> <span class="ot">NULL</span>)
plot_polished</code></pre></div>
<p><img src="block002_grammar_of_graphics_files/figure-html/plot_clean-1.png" width="672" /></p>
<p>Finally we can change the default <code>ggplot</code> theme to remove the background and grid lines, as well as the legend:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">plot_polished +
<span class="st">  </span><span class="kw">theme_void</span>() +
<span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">&quot;none&quot;</span>)</code></pre></div>
<p><img src="block002_grammar_of_graphics_files/figure-html/plot_final-1.png" width="672" /></p>
</div>
</div>
</div>
<div id="practice-generating-layered-graphics-using-ggplot2" class="section level1">
<h1>Practice generating layered graphics using <code>ggplot2</code></h1>
<p>Now let’s practice generating layered graphics in R using the data from <a href="https://www.gapminder.org/data/">Gapminder World</a>, which compiles country-level data on quality-of-life measures.</p>
<div id="load-the-gapminder-dataset" class="section level2">
<h2>Load the <code>gapminder</code> dataset</h2>
<p>If you have not already installed the <code>gapminder</code> package and you try to load it using the following code, you will get an error:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(gapminder)</code></pre></div>
<pre><code>Error in library(gapminder) : there is no package called ‘gapminder’</code></pre>
<p>If this happens, install the gapminder package by running <code>install.packages(&quot;gapminder&quot;)</code> in your console.</p>
<p>Once you’ve done this, run the following code to load the gapminder dataset, the <code>ggplot2</code> library, and a helper library for printing the contents of <code>gapminder</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(ggplot2)
<span class="kw">library</span>(tibble)
<span class="kw">library</span>(gapminder)

<span class="kw">str</span>(gapminder)</code></pre></div>
<pre><code>## Classes &#39;tbl_df&#39;, &#39;tbl&#39; and &#39;data.frame&#39;:    1704 obs. of  6 variables:
##  $ country  : Factor w/ 142 levels &quot;Afghanistan&quot;,..: 1 1 1 1 1 1 1 1 1 1 ...
##  $ continent: Factor w/ 5 levels &quot;Africa&quot;,&quot;Americas&quot;,..: 3 3 3 3 3 3 3 3 3 3 ...
##  $ year     : int  1952 1957 1962 1967 1972 1977 1982 1987 1992 1997 ...
##  $ lifeExp  : num  28.8 30.3 32 34 36.1 ...
##  $ pop      : int  8425333 9240934 10267083 11537966 13079460 14880372 12881816 13867957 16317921 22227415 ...
##  $ gdpPercap: num  779 821 853 836 740 ...</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">gapminder</code></pre></div>
<pre><code>## # A tibble: 1,704 × 6
##        country continent  year lifeExp      pop gdpPercap
##         &lt;fctr&gt;    &lt;fctr&gt; &lt;int&gt;   &lt;dbl&gt;    &lt;int&gt;     &lt;dbl&gt;
## 1  Afghanistan      Asia  1952    28.8  8425333       779
## 2  Afghanistan      Asia  1957    30.3  9240934       821
## 3  Afghanistan      Asia  1962    32.0 10267083       853
## 4  Afghanistan      Asia  1967    34.0 11537966       836
## 5  Afghanistan      Asia  1972    36.1 13079460       740
## 6  Afghanistan      Asia  1977    38.4 14880372       786
## 7  Afghanistan      Asia  1982    39.9 12881816       978
## 8  Afghanistan      Asia  1987    40.8 13867957       852
## 9  Afghanistan      Asia  1992    41.7 16317921       649
## 10 Afghanistan      Asia  1997    41.8 22227415       635
## # ... with 1,694 more rows</code></pre>
<blockquote>
<p>Run <code>?gapminder</code> in the console to open the help file for the data and definitions for each of the columns.</p>
</blockquote>
<p>Using the grammar of graphics and your knowledge of the <code>ggplot2</code> library, generate a series of graphs that explore the relationships between specific variables.</p>
</div>
<div id="exercises" class="section level2">
<h2>Exercises</h2>
<p><strong>What is the average life expectancy, per continent?</strong></p>
<details> <summary>Click for the solution</summary>
<p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(gapminder, <span class="kw">aes</span>(continent, lifeExp)) +
<span class="st">  </span><span class="kw">geom_boxplot</span>()</code></pre></div>
<img src="block002_grammar_of_graphics_files/figure-html/lifeexp-1.png" width="672" />
</p>
<p></details></p>
<p><strong>What is the relationship between GDP and life expectancy?</strong></p>
<details> <summary>Click for the solution</summary>
<p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(gapminder, <span class="kw">aes</span>(gdpPercap, lifeExp)) +
<span class="st">  </span><span class="kw">geom_point</span>() +
<span class="st">  </span><span class="kw">geom_smooth</span>()</code></pre></div>
<pre><code>## `geom_smooth()` using method = &#39;gam&#39;</code></pre>
<img src="block002_grammar_of_graphics_files/figure-html/gdp_lifeexp-1.png" width="672" />
</p>
<p></details></p>
<p><strong>How is this relationship moderated by continent?</strong></p>
<details> <summary>Click for the solution</summary>
<p>
<p>With the <code>color</code> aesthetic:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(gapminder, <span class="kw">aes</span>(gdpPercap, lifeExp, <span class="dt">color =</span> continent)) +
<span class="st">  </span><span class="kw">geom_point</span>() +
<span class="st">  </span><span class="kw">geom_smooth</span>()</code></pre></div>
<pre><code>## `geom_smooth()` using method = &#39;loess&#39;</code></pre>
<p><img src="block002_grammar_of_graphics_files/figure-html/lifeexp_continent_color-1.png" width="672" /></p>
<p>With a facet:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(gapminder, <span class="kw">aes</span>(gdpPercap, lifeExp, <span class="dt">color =</span> continent)) +
<span class="st">  </span><span class="kw">geom_point</span>() +
<span class="st">  </span><span class="kw">geom_smooth</span>() +
<span class="st">  </span><span class="kw">facet_grid</span>(. ~<span class="st"> </span>continent)</code></pre></div>
<pre><code>## `geom_smooth()` using method = &#39;loess&#39;</code></pre>
<img src="block002_grammar_of_graphics_files/figure-html/lifeexp_continent_facet-1.png" width="672" />
</p>
<p></details></p>
<p><strong>What is causing the outliers in <code>gdpPercap</code>?</strong></p>
<details> <summary>Click for the solution</summary>
<p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(gapminder, <span class="kw">aes</span>(gdpPercap, lifeExp)) +
<span class="st">  </span><span class="kw">geom_point</span>() +
<span class="st">  </span><span class="kw">geom_smooth</span>() +
<span class="st">  </span><span class="kw">geom_text</span>(<span class="kw">aes</span>(<span class="dt">label =</span> country))</code></pre></div>
<pre><code>## `geom_smooth()` using method = &#39;gam&#39;</code></pre>
<img src="block002_grammar_of_graphics_files/figure-html/lifeexp_outlier-1.png" width="672" />
</p>
<p></details></p>
</div>
</div>
<div id="session-info" class="section level1 toc-ignore">
<h1>Session Info</h1>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">devtools::<span class="kw">session_info</span>()</code></pre></div>
<pre><code>## Session info -------------------------------------------------------------</code></pre>
<pre><code>##  setting  value                       
##  version  R version 3.3.3 (2017-03-06)
##  system   x86_64, darwin13.4.0        
##  ui       X11                         
##  language (EN)                        
##  collate  en_US.UTF-8                 
##  tz       America/Chicago             
##  date     2017-05-26</code></pre>
<pre><code>## Packages -----------------------------------------------------------------</code></pre>
<pre><code>##  package      * version    date       source                            
##  assertthat     0.2.0      2017-04-11 cran (@0.2.0)                     
##  backports      1.1.0      2017-05-22 CRAN (R 3.3.2)                    
##  base         * 3.3.3      2017-03-07 local                             
##  base64enc      0.1-3      2015-07-28 CRAN (R 3.3.0)                    
##  broom        * 0.4.2      2017-02-13 CRAN (R 3.3.2)                    
##  cellranger     1.1.0      2016-07-27 CRAN (R 3.3.0)                    
##  codetools      0.2-15     2016-10-05 CRAN (R 3.3.3)                    
##  colorspace     1.3-2      2016-12-14 CRAN (R 3.3.2)                    
##  datasets     * 3.3.3      2017-03-07 local                             
##  DBI            0.6-1      2017-04-01 CRAN (R 3.3.2)                    
##  devtools       1.13.1     2017-05-13 CRAN (R 3.3.2)                    
##  digest         0.6.12     2017-01-27 CRAN (R 3.3.2)                    
##  dplyr        * 0.5.0      2016-06-24 CRAN (R 3.3.0)                    
##  evaluate       0.10       2016-10-11 CRAN (R 3.3.0)                    
##  forcats      * 0.2.0      2017-01-23 CRAN (R 3.3.2)                    
##  foreign        0.8-68     2017-04-24 CRAN (R 3.3.2)                    
##  gapminder    * 0.2.0      2015-12-31 CRAN (R 3.3.0)                    
##  gganimate    * 0.1.0.9000 2017-05-26 Github (dgrtwo/gganimate@bf82002) 
##  ggplot2      * 2.2.1.9000 2017-05-12 Github (tidyverse/ggplot2@f4398b6)
##  ggstance     * 0.3        2016-11-16 CRAN (R 3.3.2)                    
##  graphics     * 3.3.3      2017-03-07 local                             
##  grDevices    * 3.3.3      2017-03-07 local                             
##  grid           3.3.3      2017-03-07 local                             
##  gtable         0.2.0      2016-02-26 CRAN (R 3.3.0)                    
##  haven          1.0.0      2016-09-23 cran (@1.0.0)                     
##  hexbin       * 1.27.1     2015-08-19 CRAN (R 3.3.0)                    
##  hms            0.3        2016-11-22 CRAN (R 3.3.2)                    
##  htmltools      0.3.6      2017-04-28 cran (@0.3.6)                     
##  httpuv         1.3.3      2015-08-04 CRAN (R 3.3.0)                    
##  httr           1.2.1      2016-07-03 CRAN (R 3.3.0)                    
##  jsonlite       1.4        2017-04-08 cran (@1.4)                       
##  knitr        * 1.16       2017-05-18 CRAN (R 3.3.2)                    
##  labeling       0.3        2014-08-23 CRAN (R 3.3.0)                    
##  lattice        0.20-35    2017-03-25 CRAN (R 3.3.2)                    
##  lazyeval       0.2.0      2016-06-12 CRAN (R 3.3.0)                    
##  lubridate    * 1.6.0      2016-09-13 CRAN (R 3.3.0)                    
##  lvplot       * 0.2.0.9000 2017-01-06 Github (hadley/lvplot@8ce61c7)    
##  magrittr       1.5        2014-11-22 CRAN (R 3.3.0)                    
##  memoise        1.1.0      2017-04-21 CRAN (R 3.3.2)                    
##  methods      * 3.3.3      2017-03-07 local                             
##  mime           0.5        2016-07-07 CRAN (R 3.3.0)                    
##  mnormt         1.5-5      2016-10-15 CRAN (R 3.3.0)                    
##  modelr         0.1.0      2016-08-31 CRAN (R 3.3.0)                    
##  modeltools     0.2-21     2013-09-02 CRAN (R 3.3.0)                    
##  munsell        0.4.3      2016-02-13 CRAN (R 3.3.0)                    
##  nlme           3.1-131    2017-02-06 CRAN (R 3.3.3)                    
##  NLP            0.1-10     2017-02-21 CRAN (R 3.3.2)                    
##  nycflights13 * 0.2.2      2017-01-27 CRAN (R 3.3.2)                    
##  parallel       3.3.3      2017-03-07 local                             
##  plyr           1.8.4      2016-06-08 CRAN (R 3.3.0)                    
##  psych          1.7.5      2017-05-03 CRAN (R 3.3.3)                    
##  purrr        * 0.2.2.2    2017-05-11 CRAN (R 3.3.3)                    
##  R6             2.2.1      2017-05-10 CRAN (R 3.3.2)                    
##  rcfss        * 0.1.4      2017-02-28 local                             
##  Rcpp           0.12.11    2017-05-22 CRAN (R 3.3.2)                    
##  readr        * 1.1.1      2017-05-16 CRAN (R 3.3.2)                    
##  readxl       * 1.0.0      2017-04-18 CRAN (R 3.3.2)                    
##  reshape2       1.4.2      2016-10-22 CRAN (R 3.3.0)                    
##  rlang          0.1.9000   2017-05-12 Github (hadley/rlang@c17568e)     
##  rmarkdown      1.5        2017-04-26 CRAN (R 3.3.2)                    
##  rprojroot      1.2        2017-01-16 CRAN (R 3.3.2)                    
##  rstudioapi     0.6        2016-06-27 CRAN (R 3.3.0)                    
##  rvest          0.3.2      2016-06-17 CRAN (R 3.3.0)                    
##  scales         0.4.1      2016-11-09 CRAN (R 3.3.1)                    
##  shiny          1.0.3      2017-04-26 CRAN (R 3.3.2)                    
##  slam           0.1-40     2016-12-01 CRAN (R 3.3.2)                    
##  sparklyr     * 0.5.5      2017-05-26 CRAN (R 3.3.3)                    
##  stats        * 3.3.3      2017-03-07 local                             
##  stats4         3.3.3      2017-03-07 local                             
##  stringi        1.1.5      2017-04-07 CRAN (R 3.3.2)                    
##  stringr      * 1.2.0      2017-02-18 CRAN (R 3.3.2)                    
##  tibble       * 1.3.1      2017-05-17 CRAN (R 3.3.2)                    
##  tidyr        * 0.6.3      2017-05-15 CRAN (R 3.3.2)                    
##  tidyverse    * 1.1.1      2017-01-27 CRAN (R 3.3.2)                    
##  titanic      * 0.1.0      2015-08-31 CRAN (R 3.3.0)                    
##  tm             0.7-1      2017-03-02 CRAN (R 3.3.2)                    
##  tools          3.3.3      2017-03-07 local                             
##  topicmodels  * 0.2-6      2017-04-18 CRAN (R 3.3.2)                    
##  tweenr       * 0.1.5      2016-10-10 CRAN (R 3.3.0)                    
##  utils        * 3.3.3      2017-03-07 local                             
##  withr          1.0.2      2016-06-20 CRAN (R 3.3.0)                    
##  xml2           1.1.1      2017-01-24 CRAN (R 3.3.2)                    
##  xtable         1.8-2      2016-02-05 CRAN (R 3.3.0)                    
##  yaml           2.1.14     2016-11-12 cran (@2.1.14)</code></pre>
</div>
<div class="footnotes">
<hr />
<ol>
<li id="fn1"><p>Example drawn from <a href="https://www.autodeskresearch.com/publications/samestats"><em>The Datasaurus Dozen</em> by Justin Matejka and George Fitzmaurice</a>.<a href="#fnref1">↩</a></p></li>
<li id="fn2"><p>Source code from <a href="https://wjakethompson.github.io/post/datasaurus-dozen/">Recreating the Datasaurus Dozen Using <code>tweenr</code> and <code>ggplot2</code></a>.<a href="#fnref2">↩</a></p></li>
<li id="fn3"><p><a href="https://www.google.com/search?q=grammar">Google</a><a href="#fnref3">↩</a></p></li>
<li id="fn4"><p><a href="http://www.jstor.org.proxy.uchicago.edu/stable/25651297">Wickham, Hadley. (2010) “A Layered Grammar of Graphics”. <em>Journal of Computational and Graphical Statistics</em>, 19(1).</a><a href="#fnref4">↩</a></p></li>
<li id="fn5"><p><a href="http://link.springer.com.proxy.uchicago.edu/book/10.1007%2F0-387-28695-0">Wilkinson, Leland. (2005). <em>The Grammar of Graphics</em>. (UChicago authentication required)</a><a href="#fnref5">↩</a></p></li>
<li id="fn6"><p>This exercise is drawn from <a href="http://www.jstor.org.proxy.uchicago.edu/stable/25651297">Wickham, Hadley. (2010) “A Layered Grammar of Graphics”. <em>Journal of Computational and Graphical Statistics</em>, 19(1).</a><a href="#fnref6">↩</a></p></li>
</ol>
</div>

<p>This work is licensed under the  <a href="http://creativecommons.org/licenses/by-nc/4.0/">CC BY-NC 4.0 Creative Commons License</a>.</p>


</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
