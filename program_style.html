<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />




<title>Bugs and styling code</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/readable.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-45631879-2', 'auto');
  ga('send', 'pageview');

</script>


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>


<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>


</head>

<body>

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
button.code-folding-btn:focus {
  outline: none;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 66px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 71px;
  margin-top: -71px;
}

.section h2 {
  padding-top: 71px;
  margin-top: -71px;
}
.section h3 {
  padding-top: 71px;
  margin-top: -71px;
}
.section h4 {
  padding-top: 71px;
  margin-top: -71px;
}
.section h5 {
  padding-top: 71px;
  margin-top: -71px;
}
.section h6 {
  padding-top: 71px;
  margin-top: -71px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>


<div class="container-fluid main-container">

<!-- tabsets -->
<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});
</script>

<!-- code folding -->




<script>
$(document).ready(function ()  {

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_').toLowerCase();
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}


.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
  padding-left: 25px;
  text-indent: 0;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>

<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row-fluid">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Computing for the Social Sciences</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">Home</a>
</li>
<li>
  <a href="faq.html">FAQ</a>
</li>
<li>
  <a href="syllabus.html">Syllabus</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">Bugs and styling code</h1>

</div>


<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(tidyverse)</code></pre></div>
<pre><code>## + ggplot2 2.2.1          Date: 2017-08-08
## + tibble  1.3.3             R: 3.4.1
## + tidyr   0.6.3            OS: macOS Sierra 10.12.6
## + readr   1.1.1           GUI: X11
## + purrr   0.2.2.2      Locale: en_US.UTF-8
## + dplyr   0.7.2            TZ: America/Chicago
## + stringr 1.2.0        
## + forcats 0.2.0</code></pre>
<pre><code>## ── Conflicts ────────────────────────────────────────────────────</code></pre>
<pre><code>## * filter(),  from dplyr, masks stats::filter()
## * lag(),     from dplyr, masks stats::lag()</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">set.seed</span>(<span class="dv">1234</span>)</code></pre></div>
<div class="figure">
<img src="images/bugs.jpg" alt="Not the kind of bugs we’re looking for" />
<p class="caption">Not the kind of bugs we’re looking for</p>
</div>
<p>A <strong>software bug</strong> is “an error, flaw, failure or fault in a computer program or system that causes it to produce an incorrect or unexpected result, or to behave in unintended ways.”<a href="#fn1" class="footnoteRef" id="fnref1"><sup>1</sup></a> In an ideal world, the computer will warn you when it encounters a bug. R has the ability to do this in some situations (see our discussion below of errors, warnings, and messages). However bugs also arise because you expect the program to do one thing but provide it the ability to perform different from expectations.</p>
<p>As I have repeatedly emphasized in class, <strong>computers are powerful tools that are incredibly stupid</strong>. They will do exactly what you tell them to, nothing more and nothing less. If you write your code in a way that allows it to behave in an unintended way, this is your fault. The first goal of debugging should be to prevent unintended behaviors before they strike. However, when such bugs occur we need the tools and knowledge to track down these unintended behaviors and correct them in our code.</p>
<p>The most important step to debugging is to prevent bugs in the first place. There are several methods we can employ to do that. Some of them are simple such as styling our code so that we follow consistent practices when writing scripts and programs. Consistency will prevent silly and minor mistakes such as typos. Good styles also make our code more <strong>readable</strong> for the human eye and allow us to isolate and detect errors merely by looking at the screen. Others are more advanced and focus on the concept of <strong>failing fast</strong> - as soon as something goes wrong, stop executing the program and announce an error.</p>
<div id="writing-code" class="section level1">
<h1>Writing code</h1>
<p>Think back to <a href="http://cfss.uchicago.edu/setup00.html#introduction">the analogy of programming languages to human languages</a>. Programming languages adhere to a specific grammar and syntax, they contain a vocabulary, etymology, cultural conventions, word roots (prefixes and suffixes), just like English or any other written or spoken language. We can therefore equate different components of a program to their language counterparts:</p>
<table>
<thead>
<tr class="header">
<th>Programming</th>
<th>Language</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Scripts</td>
<td>Essays</td>
</tr>
<tr class="even">
<td>Sections</td>
<td>Paragraphs</td>
</tr>
<tr class="odd">
<td>Lines Breaks</td>
<td>Sentences</td>
</tr>
<tr class="even">
<td>Parentheses</td>
<td>Punctuation</td>
</tr>
<tr class="odd">
<td>Functions</td>
<td>Verbs</td>
</tr>
<tr class="even">
<td>Variables</td>
<td>Nouns</td>
</tr>
</tbody>
</table>
<p>Now think about how you write a document in English. In 1987, <a href="https://en.wikipedia.org/wiki/Space_Shuttle_Challenger_disaster">the Challenger space shuttle exploded just 73 seconds after takeoff</a>. The deaths of seven crewmembers were seen live by millions of American schoolchildren watching around the country. A few hours after the tragedy, President Ronald Reagan gave a national address. Here is an excerpt of that address:</p>
<blockquote>
<p>weve grown used to wonders in this century its hard to dazzle us but for 25 years the united states space program has been doing just that weve grown used to the idea of space and perhaps we forget that weve only just begun were still pioneers they the members of the Challenger crew were pioneers and i want to say something to the school children of America who were watching the live coverage of the shuttles takeoff i know it is hard to understand but sometimes painful things like this happen its all part of the process of exploration and discovery its all part of taking a chance and expanding mans horizons the future doesnt belong to the fainthearted it belongs to the brave the challenger crew was pulling us into the future and well continue to follow them the crew of the space shuttle challenger honored us by the manner in which they lived their lives we will never forget them nor the last time we saw them this morning as they prepared for the journey and waved goodbye and slipped the surly bonds of earth to touch the face of god</p>
</blockquote>
<p>Wait a minute, this doesn’t look right. What happened to the punctuation? The capitalization? Where are all the sentences and paragraph breaks? Isn’t this hard to read and understand? Do you feel any of the emotions of the moment? Probably not, because the normal rules of grammar and syntax have been destroyed. Here’s the same excerpt, but properly styled:</p>
<blockquote>
<p>We’ve grown used to wonders in this century. It’s hard to dazzle us. But for 25 years the United States space program has been doing just that. We’ve grown used to the idea of space, and perhaps we forget that we’ve only just begun. We’re still pioneers. They, the members of the Challenger crew, were pioneers.</p>
</blockquote>
<blockquote>
<p>And I want to say something to the school children of America who were watching the live coverage of the shuttle’s takeoff. I know it is hard to understand, but sometimes painful things like this happen. It’s all part of the process of exploration and discovery. It’s all part of taking a chance and expanding man’s horizons. The future doesn’t belong to the fainthearted; it belongs to the brave. The Challenger crew was pulling us into the future, and we’ll continue to follow them….</p>
</blockquote>
<blockquote>
<p>The crew of the space shuttle Challenger honoured us by the manner in which they lived their lives. We will never forget them, nor the last time we saw them, this morning, as they prepared for the journey and waved goodbye and ‘slipped the surly bonds of earth’ to ‘touch the face of God.’</p>
</blockquote>
<p>That makes much more sense. Adhering to standard rules of style make the text more legible and interpretable. This is what we should aim for when writing programs in R.<a href="#fn2" class="footnoteRef" id="fnref2"><sup>2</sup></a></p>
</div>
<div id="style-guide" class="section level1">
<h1>Style guide</h1>
<p>Here are some common rules you should adopt when writing code in R, adapted from Hadley Wickham’s <a href="http://adv-r.had.co.nz/Style.html">style guide</a>.</p>
<div id="notation-and-naming" class="section level2">
<h2>Notation and naming</h2>
<div id="file-names" class="section level3">
<h3>File names</h3>
<p>Files should have intuitive and meaningful names. Avoid spaces or non-standard characters in your file names. R scripts should always end in <code>.R</code>; R Markdown documents should always end in <code>.Rmd</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Good</span>
fit<span class="op">-</span>models.R
utility<span class="op">-</span>functions.R
gun<span class="op">-</span>deaths.Rmd

<span class="co"># Bad</span>
foo.r
stuff.r
gun deaths.rmd</code></pre></div>
</div>
<div id="object-names" class="section level3">
<h3>Object names</h3>
<p>Variables refer to data objects such as vectors, lists, or data frames. Variable and function names should be lowercase. Use an underscore (<code>_</code>) to separate words within a name. Avoid using periods (<code>.</code>).<a href="#fn3" class="footnoteRef" id="fnref3"><sup>3</sup></a> Variable names should generally be nouns and function names should be verbs. Try to pick names that are concise and meaningful.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Good</span>
day_one
day_<span class="dv">1</span>

<span class="co"># Bad</span>
first_day_of_the_month
DayOne
dayone
djm1</code></pre></div>
<p>Where possible, avoid using names of existing functions and variables. Doing so will cause confusion for the readers of your code, not to mention make it difficult to access the existing functions and variables.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Bad</span>
T &lt;-<span class="st"> </span><span class="ot">FALSE</span>
c &lt;-<span class="st"> </span><span class="dv">10</span></code></pre></div>
<p>For instance, what would happen if I created a new <code>mean()</code> function?</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">x &lt;-<span class="st"> </span><span class="dv">1</span><span class="op">:</span><span class="dv">10</span>
<span class="kw">mean</span>(x)</code></pre></div>
<pre><code>## [1] 5.5</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># create new mean function</span>
mean &lt;-<span class="st"> </span><span class="cf">function</span>(x) <span class="kw">sum</span>(x)
<span class="kw">mean</span>(x)</code></pre></div>
<pre><code>[1] 55</code></pre>
<div class="figure">
<img src="http://i.giphy.com/BxWTWalKTUAdq.gif" />

</div>
</div>
</div>
<div id="syntax" class="section level2">
<h2>Syntax</h2>
<div id="spacing" class="section level3">
<h3>Spacing</h3>
<p>Place spaces around all <a href="https://www.programiz.com/r-programming/infix-operator">infix</a> operators (=, +, -, &lt;-, etc.). The same rule applies when using <code>=</code> in function calls.</p>
<blockquote>
<p>Always put a space after a comma, and never before (just like in regular English).</p>
</blockquote>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Good</span>
average &lt;-<span class="st"> </span><span class="kw">mean</span>(feet <span class="op">/</span><span class="st"> </span><span class="dv">12</span> <span class="op">+</span><span class="st"> </span>inches, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)

<span class="co"># Bad</span>
average&lt;-<span class="kw">mean</span>(feet<span class="op">/</span><span class="dv">12</span><span class="op">+</span>inches,<span class="dt">na.rm=</span><span class="ot">TRUE</span>)</code></pre></div>
<p>Place a space before left parentheses, except in a function call.</p>
<blockquote>
<p>Note: I’m terrible at remembering to do this for <code>if-else</code> or <code>for</code> loops. I typically never place a space before left parentheses, but it is supposed to be good practice. Just remember to be consistent whatever approach you choose.</p>
</blockquote>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Good</span>
<span class="cf">if</span> (debug) <span class="kw">do</span>(x)
<span class="kw">plot</span>(x, y)

<span class="co"># Bad</span>
<span class="cf">if</span>(debug)<span class="kw">do</span>(x)
<span class="kw">plot</span> (x, y)</code></pre></div>
<p>Do not place spaces around code in parentheses or square brackets (unless there’s a comma, in which case see above).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Good</span>
<span class="cf">if</span> (debug) <span class="kw">do</span>(x)
diamonds[<span class="dv">5</span>, ]

<span class="co"># Bad</span>
<span class="cf">if</span> ( debug ) <span class="kw">do</span>(x)  <span class="co"># No spaces around debug</span>
x[<span class="dv">1</span>,]   <span class="co"># Needs a space after the comma</span>
x[<span class="dv">1</span> ,]  <span class="co"># Space goes after comma not before</span></code></pre></div>
</div>
<div id="curly-braces" class="section level3">
<h3>Curly braces</h3>
<p>An opening curly brace should never go on its own line and should always be followed by a new line. A closing curly brace should always go on its own line, unless it’s followed by else.</p>
<p>Always indent the code inside curly braces.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Good</span>

<span class="cf">if</span> (y <span class="op">&lt;</span><span class="st"> </span><span class="dv">0</span> <span class="op">&amp;&amp;</span><span class="st"> </span>debug) {
  <span class="kw">message</span>(<span class="st">&quot;Y is negative&quot;</span>)
}

<span class="cf">if</span> (y <span class="op">==</span><span class="st"> </span><span class="dv">0</span>) {
  <span class="kw">log</span>(x)
} <span class="cf">else</span> {
  y <span class="op">^</span><span class="st"> </span>x
}

<span class="co"># Bad</span>

<span class="cf">if</span> (y <span class="op">&lt;</span><span class="st"> </span><span class="dv">0</span> <span class="op">&amp;&amp;</span><span class="st"> </span>debug)
<span class="kw">message</span>(<span class="st">&quot;Y is negative&quot;</span>)

<span class="cf">if</span> (y <span class="op">==</span><span class="st"> </span><span class="dv">0</span>) {
  <span class="kw">log</span>(x)
} 
<span class="cf">else</span> {
  y <span class="op">^</span><span class="st"> </span>x
}</code></pre></div>
<p>It’s ok to leave very short statements on the same line:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="cf">if</span> (y <span class="op">&lt;</span><span class="st"> </span><span class="dv">0</span> <span class="op">&amp;&amp;</span><span class="st"> </span>debug) <span class="kw">message</span>(<span class="st">&quot;Y is negative&quot;</span>)</code></pre></div>
</div>
<div id="line-length" class="section level3">
<h3>Line length</h3>
<p>Strive to limit your code to 80 characters per line. This fits comfortably on a printed page with a reasonably sized font. For instance, if I wanted to convert the <code>chief</code> column to a <a href="http://r4ds.had.co.nz/factors.html">factor</a> for building a <a href="https://github.com/uc-cfss/hw03/blob/master/demo/scotus_solution.md#solution-using-facets-and-showing-whole-data-on-each-facet-getting-harder">faceted graph</a>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Good</span>
scdbv &lt;-<span class="st"> </span><span class="kw">mutate</span>(scdbv,
                <span class="dt">chief =</span> <span class="kw">factor</span>(chief, <span class="dt">levels =</span> <span class="kw">c</span>(<span class="st">&quot;Jay&quot;</span>, <span class="st">&quot;Rutledge&quot;</span>, <span class="st">&quot;Ellsworth&quot;</span>,
                                                 <span class="st">&quot;Marshall&quot;</span>, <span class="st">&quot;Taney&quot;</span>, <span class="st">&quot;Chase&quot;</span>,
                                                 <span class="st">&quot;Waite&quot;</span>, <span class="st">&quot;Fuller&quot;</span>, <span class="st">&quot;White&quot;</span>,
                                                 <span class="st">&quot;Taft&quot;</span>, <span class="st">&quot;Hughes&quot;</span>, <span class="st">&quot;Stone&quot;</span>,
                                                 <span class="st">&quot;Vinson&quot;</span>, <span class="st">&quot;Warren&quot;</span>, <span class="st">&quot;Burger&quot;</span>,
                                                 <span class="st">&quot;Rehnquist&quot;</span>, <span class="st">&quot;Roberts&quot;</span>)))

<span class="co"># Bad</span>
scdbv &lt;-<span class="st"> </span><span class="kw">mutate</span>(scdbv, <span class="dt">chief =</span> <span class="kw">factor</span>(chief, <span class="dt">levels =</span> <span class="kw">c</span>(<span class="st">&quot;Jay&quot;</span>, <span class="st">&quot;Rutledge&quot;</span>, <span class="st">&quot;Ellsworth&quot;</span>, <span class="st">&quot;Marshall&quot;</span>, <span class="st">&quot;Taney&quot;</span>, <span class="st">&quot;Chase&quot;</span>, <span class="st">&quot;Waite&quot;</span>, <span class="st">&quot;Fuller&quot;</span>, <span class="st">&quot;White&quot;</span>, <span class="st">&quot;Taft&quot;</span>, <span class="st">&quot;Hughes&quot;</span>, <span class="st">&quot;Stone&quot;</span>, <span class="st">&quot;Vinson&quot;</span>, <span class="st">&quot;Warren&quot;</span>, <span class="st">&quot;Burger&quot;</span>, <span class="st">&quot;Rehnquist&quot;</span>, <span class="st">&quot;Roberts&quot;</span>)))</code></pre></div>
</div>
<div id="indentation" class="section level3">
<h3>Indentation</h3>
<p>When indenting your code, use two spaces. Never use tabs or mix tabs and spaces.</p>
<blockquote>
<p>By default, RStudio automatically converts tabs to two spaces in your code. So if you use the tab button in R Studio, you’re good to go.</p>
</blockquote>
<div class="figure">
<img src="images/tab_indent.png" alt="Insert spaces for tab setting in RStudio" />
<p class="caption">“Insert spaces for tab” setting in RStudio</p>
</div>
<p>The only exception is if a function definition runs over multiple lines. In that case, indent the second line to where the definition starts:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># pure function</span>
long_function_name &lt;-<span class="st"> </span><span class="cf">function</span>(<span class="dt">a =</span> <span class="st">&quot;a long argument&quot;</span>, 
                               <span class="dt">b =</span> <span class="st">&quot;another argument&quot;</span>,
                               <span class="dt">c =</span> <span class="st">&quot;another long argument&quot;</span>) {
  <span class="co"># As usual code is indented by two spaces.</span>
}

<span class="co"># in a mutate() function</span>
scdbv &lt;-<span class="st"> </span>scdbv <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">majority =</span> majority <span class="op">-</span><span class="st"> </span><span class="dv">1</span>,
         <span class="dt">chief =</span> <span class="kw">factor</span>(chief, <span class="dt">levels =</span> <span class="kw">c</span>(<span class="st">&quot;Jay&quot;</span>, <span class="st">&quot;Rutledge&quot;</span>, <span class="st">&quot;Ellsworth&quot;</span>,
                                          <span class="st">&quot;Marshall&quot;</span>, <span class="st">&quot;Taney&quot;</span>, <span class="st">&quot;Chase&quot;</span>,
                                          <span class="st">&quot;Waite&quot;</span>, <span class="st">&quot;Fuller&quot;</span>, <span class="st">&quot;White&quot;</span>,
                                          <span class="st">&quot;Taft&quot;</span>, <span class="st">&quot;Hughes&quot;</span>, <span class="st">&quot;Stone&quot;</span>,
                                          <span class="st">&quot;Vinson&quot;</span>, <span class="st">&quot;Warren&quot;</span>, <span class="st">&quot;Burger&quot;</span>,
                                          <span class="st">&quot;Rehnquist&quot;</span>, <span class="st">&quot;Roberts&quot;</span>)))</code></pre></div>
</div>
<div id="assignment" class="section level3">
<h3>Assignment</h3>
<p>Use <code>&lt;-</code>, not <code>=</code>, for assignment. Why? Because I said so. <a href="http://stackoverflow.com/a/1742550">Or read more here</a>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Good</span>
x &lt;-<span class="st"> </span><span class="dv">5</span>
<span class="co"># Bad</span>
x =<span class="st"> </span><span class="dv">5</span></code></pre></div>
</div>
</div>
<div id="comments" class="section level2">
<h2>Comments</h2>
<p>Comment your code. Each line of a comment should begin with the comment symbol and a single space: <code>#</code>. Comments should explain the why, not the what.</p>
<p>To take advantage of RStudio’s <a href="https://support.rstudio.com/hc/en-us/articles/200484568-Code-Folding-and-Sections">code folding feature</a>, add at least four trailing dashes (-), equal signs (=), or pound signs (#) after the comment text</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Section One ---------------------------------</span>
 
<span class="co"># Section Two =================================</span>
 
### Section Three #############################</code></pre></div>
</div>
</div>
<div id="auto-formatting-in-rstudio" class="section level1">
<h1>Auto-formatting in RStudio</h1>
<p>There are two built-in methods of using RStudio to automatically format and clean up your code. They are not perfect, but can help in some circumstances.</p>
<div id="format-code" class="section level2">
<h2>Format code</h2>
<p><strong>Code &gt; Reformat Code</strong> (Shift + Cmd/Ctrl + A)</p>
<div id="bad-code" class="section level5">
<h5>Bad code</h5>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># comments are retained</span>
<span class="dv">1</span><span class="op">+</span><span class="dv">1</span>

<span class="cf">if</span>(<span class="ot">TRUE</span>){
x=<span class="dv">1</span>  <span class="co"># inline comments</span>
}<span class="cf">else</span>{
x=<span class="dv">2</span>;<span class="kw">print</span>(<span class="st">&#39;Oh no... ask the right bracket to go away!&#39;</span>)}
<span class="dv">1</span><span class="op">*</span><span class="dv">3</span> <span class="co"># one space before this comment will become two!</span>
<span class="dv">2</span><span class="op">+</span><span class="dv">2</span><span class="op">+</span><span class="dv">2</span>    <span class="co"># only &#39;single quotes&#39; are allowed in comments</span>

diamonds <span class="op">%&gt;%</span>
<span class="kw">filter</span>(color <span class="op">==</span><span class="st"> &quot;I&quot;</span>) <span class="op">%&gt;%</span>
<span class="kw">group_by</span>(cut) <span class="op">%&gt;%</span>
<span class="kw">summarize</span>(<span class="dt">price =</span> <span class="kw">mean</span>(price))

<span class="kw">lm</span>(y<span class="op">~</span>x1<span class="op">+</span>x2, <span class="dt">data=</span><span class="kw">data.frame</span>(<span class="dt">y=</span><span class="kw">rnorm</span>(<span class="dv">100</span>),<span class="dt">x1=</span><span class="kw">rnorm</span>(<span class="dv">100</span>),<span class="dt">x2=</span><span class="kw">rnorm</span>(<span class="dv">100</span>)))  ### a linear model

<span class="dv">1</span><span class="op">+</span><span class="dv">1</span><span class="op">+</span><span class="dv">1</span><span class="op">+</span><span class="dv">1</span><span class="op">+</span><span class="dv">1</span><span class="op">+</span><span class="dv">1</span><span class="op">+</span><span class="dv">1</span><span class="op">+</span><span class="dv">1</span><span class="op">+</span><span class="dv">1</span><span class="op">+</span><span class="dv">1</span><span class="op">+</span><span class="dv">1</span><span class="op">+</span><span class="dv">1</span><span class="op">+</span><span class="dv">1</span><span class="op">+</span><span class="dv">1</span><span class="op">+</span><span class="dv">1</span><span class="op">+</span><span class="dv">1</span><span class="op">+</span><span class="dv">1</span><span class="op">+</span><span class="dv">1</span><span class="op">+</span><span class="dv">1</span><span class="op">+</span><span class="dv">1</span><span class="op">+</span><span class="dv">1</span><span class="op">+</span><span class="dv">1</span><span class="op">+</span><span class="dv">1</span>  ## comments after a long line
## here is a long long long long long long long long long long long long long long long long long long long comment</code></pre></div>
</div>
<div id="better-code" class="section level5">
<h5>Better code</h5>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># comments are retained</span>
<span class="dv">1</span> <span class="op">+</span><span class="st"> </span><span class="dv">1</span>

<span class="cf">if</span> (<span class="ot">TRUE</span>) {
x =<span class="st"> </span><span class="dv">1</span>  <span class="co"># inline comments</span>
} <span class="cf">else</span>{
x =<span class="st"> </span><span class="dv">2</span>
<span class="kw">print</span>(<span class="st">&#39;Oh no... ask the right bracket to go away!&#39;</span>)
}
<span class="dv">1</span> <span class="op">*</span><span class="st"> </span><span class="dv">3</span> <span class="co"># one space before this comment will become two!</span>
<span class="dv">2</span> <span class="op">+</span><span class="st"> </span><span class="dv">2</span> <span class="op">+</span><span class="st"> </span><span class="dv">2</span>    <span class="co"># only &#39;single quotes&#39; are allowed in comments</span>

diamonds <span class="op">%&gt;%</span>
<span class="kw">filter</span>(color <span class="op">==</span><span class="st"> &quot;I&quot;</span>) <span class="op">%&gt;%</span>
<span class="kw">group_by</span>(cut) <span class="op">%&gt;%</span>
<span class="kw">summarize</span>(<span class="dt">price =</span> <span class="kw">mean</span>(price))

<span class="kw">lm</span>(y <span class="op">~</span><span class="st"> </span>x1 <span class="op">+</span><span class="st"> </span>x2, <span class="dt">data =</span> <span class="kw">data.frame</span>(
<span class="dt">y =</span> <span class="kw">rnorm</span>(<span class="dv">100</span>),
<span class="dt">x1 =</span> <span class="kw">rnorm</span>(<span class="dv">100</span>),
<span class="dt">x2 =</span> <span class="kw">rnorm</span>(<span class="dv">100</span>)
))  ### a linear model

<span class="dv">1</span> <span class="op">+</span><span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span><span class="dv">1</span> <span class="op">+</span>
<span class="dv">1</span> <span class="op">+</span><span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span><span class="dv">1</span>  ## comments after a long line
## here is a long long long long long long long long long long long long long long long long long long long comment</code></pre></div>
<p><strong>Format code</strong> will attempt to adjust the source code formatting to adhere to the style guide specified above. It doesn’t look perfect, but is more readable than the original. We should still clean up some of this manually, such as the comment on the last line that flows over.</p>
</div>
</div>
<div id="reindent-lines" class="section level2">
<h2>Reindent lines</h2>
<p><strong>Code &gt; Reindent Lines</strong> (Cmd/Ctrl + I)</p>
<div id="bad-code-1" class="section level5">
<h5>Bad code</h5>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># comments are retained</span>
<span class="dv">1</span> <span class="op">+</span><span class="st"> </span><span class="dv">1</span>

<span class="cf">if</span> (<span class="ot">TRUE</span>) {
x =<span class="st"> </span><span class="dv">1</span>  <span class="co"># inline comments</span>
} <span class="cf">else</span>{
x =<span class="st"> </span><span class="dv">2</span>
<span class="kw">print</span>(<span class="st">&#39;Oh no... ask the right bracket to go away!&#39;</span>)
}
<span class="dv">1</span> <span class="op">*</span><span class="st"> </span><span class="dv">3</span> <span class="co"># one space before this comment will become two!</span>
<span class="dv">2</span> <span class="op">+</span><span class="st"> </span><span class="dv">2</span> <span class="op">+</span><span class="st"> </span><span class="dv">2</span>    <span class="co"># only &#39;single quotes&#39; are allowed in comments</span>

diamonds <span class="op">%&gt;%</span>
<span class="kw">filter</span>(color <span class="op">==</span><span class="st"> &quot;I&quot;</span>) <span class="op">%&gt;%</span>
<span class="kw">group_by</span>(cut) <span class="op">%&gt;%</span>
<span class="kw">summarize</span>(<span class="dt">price =</span> <span class="kw">mean</span>(price))

<span class="kw">lm</span>(y <span class="op">~</span><span class="st"> </span>x1 <span class="op">+</span><span class="st"> </span>x2, <span class="dt">data =</span> <span class="kw">data.frame</span>(
<span class="dt">y =</span> <span class="kw">rnorm</span>(<span class="dv">100</span>),
<span class="dt">x1 =</span> <span class="kw">rnorm</span>(<span class="dv">100</span>),
<span class="dt">x2 =</span> <span class="kw">rnorm</span>(<span class="dv">100</span>)
))  ### a linear model

<span class="dv">1</span> <span class="op">+</span><span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span><span class="dv">1</span> <span class="op">+</span>
<span class="dv">1</span> <span class="op">+</span><span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span><span class="dv">1</span>  ## comments after a long line
## here is a long long long long long long long long long long long long long long long long long long long comment</code></pre></div>
</div>
<div id="better-code-1" class="section level5">
<h5>Better code</h5>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># comments are retained</span>
<span class="dv">1</span> <span class="op">+</span><span class="st"> </span><span class="dv">1</span>

<span class="cf">if</span> (<span class="ot">TRUE</span>) {
  x =<span class="st"> </span><span class="dv">1</span>  <span class="co"># inline comments</span>
} <span class="cf">else</span>{
  x =<span class="st"> </span><span class="dv">2</span>
  <span class="kw">print</span>(<span class="st">&#39;Oh no... ask the right bracket to go away!&#39;</span>)
}
<span class="dv">1</span> <span class="op">*</span><span class="st"> </span><span class="dv">3</span> <span class="co"># one space before this comment will become two!</span>
<span class="dv">2</span> <span class="op">+</span><span class="st"> </span><span class="dv">2</span> <span class="op">+</span><span class="st"> </span><span class="dv">2</span>    <span class="co"># only &#39;single quotes&#39; are allowed in comments</span>

diamonds <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(color <span class="op">==</span><span class="st"> &quot;I&quot;</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(cut) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summarize</span>(<span class="dt">price =</span> <span class="kw">mean</span>(price))

<span class="kw">lm</span>(y <span class="op">~</span><span class="st"> </span>x1 <span class="op">+</span><span class="st"> </span>x2, <span class="dt">data =</span> <span class="kw">data.frame</span>(
  <span class="dt">y =</span> <span class="kw">rnorm</span>(<span class="dv">100</span>),
  <span class="dt">x1 =</span> <span class="kw">rnorm</span>(<span class="dv">100</span>),
  <span class="dt">x2 =</span> <span class="kw">rnorm</span>(<span class="dv">100</span>)
))  ### a linear model

<span class="dv">1</span> <span class="op">+</span><span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span><span class="dv">1</span> <span class="op">+</span>
<span class="st">  </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span><span class="dv">1</span>  ## comments after a long line
## here is a long long long long long long long long long long long long long long long long long long long comment</code></pre></div>
<p><strong>Reindent lines</strong> will add spacing to conditional expression blocks, multi-line functions, expressions which run over multiple lines, and piped operations. Again, it is not perfect but it does some of the formatting work for us.</p>
</div>
</div>
</div>
<div id="exercise-style-this-code" class="section level1">
<h1>Exercise: style this code</h1>
<p>Here’s a chunk of code from an exercise in another class. It is formatted terribly, but as you can see it does work - the computer can interpret it. Use the style guide to clean it up and make it readable.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(tidyverse)
<span class="kw">set.seed</span>(<span class="dv">1234</span>)
<span class="co"># function to calculate growth in annual income ####</span>
annual_income&lt;-<span class="cf">function</span>(base_inc,p,g,sigma,n_years,<span class="dt">start_year=</span><span class="dv">2018</span>){
errors&lt;-<span class="kw">rnorm</span>(n_years,<span class="dt">mean=</span><span class="dv">0</span>,<span class="dt">sd=</span>sigma)
annual_income_log&lt;-<span class="kw">vector</span>(<span class="st">&quot;numeric&quot;</span>,n_years)
<span class="cf">for</span>(year <span class="cf">in</span> <span class="kw">seq_len</span>(n_years)){<span class="cf">if</span>(year <span class="op">==</span><span class="st"> </span><span class="dv">1</span>){annual_income_log[[year]] &lt;-<span class="st"> </span><span class="kw">log</span>(base_inc) <span class="op">+</span><span class="st"> </span>errors[[year]]}
<span class="cf">else</span>{annual_income_log[[year]]&lt;-(<span class="dv">1</span><span class="op">-</span>p)<span class="op">*</span>(<span class="kw">log</span>(base_inc)<span class="op">+</span>g<span class="op">*</span>(year<span class="op">-</span><span class="dv">1</span>))<span class="op">+</span>p<span class="op">*</span>annual_income_log[[year<span class="op">-</span><span class="dv">1</span>]]<span class="op">+</span>errors[[year]]}
}
<span class="kw">data_frame</span>(<span class="dt">inc=</span><span class="kw">exp</span>(annual_income_log),<span class="dt">year=</span><span class="dv">2018</span><span class="op">+</span><span class="kw">seq_len</span>(n_years)<span class="op">-</span><span class="dv">1</span>)}
<span class="co"># part 1 - simulate 1000 times ####</span>
n_sims&lt;-<span class="dv">1000</span>
n_years&lt;-<span class="dv">40</span>
<span class="co"># simulate the data, then coerce into a data frame ####</span>
sim_income &lt;-<span class="st"> </span>n_sims <span class="op">%&gt;%</span>
<span class="kw">rerun</span>(<span class="kw">annual_income</span>(<span class="dt">base_inc =</span> <span class="dv">80000</span>, <span class="dt">p =</span> .<span class="dv">2</span>,<span class="dt">g =</span> .<span class="dv">03</span>, <span class="dt">sigma =</span> .<span class="dv">1</span>,<span class="dt">n_years =</span> n_years, <span class="dt">start_year =</span> <span class="dv">2018</span>)) <span class="op">%&gt;%</span><span class="kw">bind_rows</span>(<span class="dt">.id =</span> <span class="st">&quot;id&quot;</span>) <span class="op">%&gt;%</span><span class="kw">select</span>(id, year, inc)
## plot the first income path ####
sim_income <span class="op">%&gt;%</span><span class="kw">filter</span>(id <span class="op">==</span><span class="st"> </span><span class="dv">1</span>) <span class="op">%&gt;%</span>
<span class="kw">ggplot</span>(<span class="kw">aes</span>(year, inc)) <span class="op">+</span>
<span class="kw">geom_line</span>() <span class="op">+</span>
<span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;Simulated income growth over time (one simulation)&quot;</span>,<span class="dt">x =</span> <span class="st">&quot;Year&quot;</span>,<span class="dt">y =</span> <span class="st">&quot;Annual Income&quot;</span>) <span class="op">+</span><span class="kw">scale_y_continuous</span>(<span class="dt">labels =</span> scales<span class="op">::</span>dollar)</code></pre></div>
<p><img src="program_style_files/figure-html/exercise_bad-1.png" width="672" /></p>
<details> <summary>Click for the solution</summary>
<p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(tidyverse)
<span class="kw">set.seed</span>(<span class="dv">1234</span>)

<span class="co"># function to calculate growth in annual income ####</span>
annual_income &lt;-<span class="st"> </span><span class="cf">function</span>(base_inc, p, g, sigma, n_years, <span class="dt">start_year =</span> <span class="dv">2018</span>) {
  errors &lt;-<span class="st"> </span><span class="kw">rnorm</span>(n_years, <span class="dt">mean =</span> <span class="dv">0</span>, <span class="dt">sd =</span> sigma)
  
  annual_income_log &lt;-<span class="st"> </span><span class="kw">vector</span>(<span class="st">&quot;numeric&quot;</span>, n_years)
  
  <span class="cf">for</span> (year <span class="cf">in</span> <span class="kw">seq_len</span>(n_years)) {
    <span class="cf">if</span> (year <span class="op">==</span><span class="st"> </span><span class="dv">1</span>) {
      annual_income_log[[year]] &lt;-<span class="st"> </span><span class="kw">log</span>(base_inc) <span class="op">+</span><span class="st"> </span>errors[[year]]
    } <span class="cf">else</span> {
      annual_income_log[[year]] &lt;-
<span class="st">        </span>(<span class="dv">1</span> <span class="op">-</span><span class="st"> </span>p) <span class="op">*</span><span class="st"> </span>(<span class="kw">log</span>(base_inc) <span class="op">+</span><span class="st"> </span>g <span class="op">*</span><span class="st"> </span>(year <span class="op">-</span><span class="st"> </span><span class="dv">1</span>)) <span class="op">+</span>
<span class="st">        </span>p <span class="op">*</span><span class="st"> </span>annual_income_log[[year <span class="op">-</span><span class="st"> </span><span class="dv">1</span>]] <span class="op">+</span><span class="st"> </span>errors[[year]]
    }
  }
  
  <span class="kw">data_frame</span>(<span class="dt">inc =</span> <span class="kw">exp</span>(annual_income_log),
             <span class="dt">year =</span> <span class="dv">2018</span> <span class="op">+</span><span class="st"> </span><span class="kw">seq_len</span>(n_years) <span class="op">-</span><span class="st"> </span><span class="dv">1</span>)
}

<span class="co"># part 1 - simulate 1000 times ####</span>
n_sims &lt;-<span class="st"> </span><span class="dv">10000</span>
n_years &lt;-<span class="st"> </span><span class="dv">40</span>

<span class="co"># simulate the data, then coerce into a data frame ####</span>
sim_income &lt;-<span class="st"> </span>n_sims <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">rerun</span>(
    <span class="kw">annual_income</span>(
      <span class="dt">base_inc =</span> <span class="dv">80000</span>,
      <span class="dt">p =</span> .<span class="dv">2</span>,
      <span class="dt">g =</span> .<span class="dv">03</span>,
      <span class="dt">sigma =</span> .<span class="dv">1</span>,
      <span class="dt">n_years =</span> n_years,
      <span class="dt">start_year =</span> <span class="dv">2018</span>
    )
  ) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">bind_rows</span>(<span class="dt">.id =</span> <span class="st">&quot;id&quot;</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">select</span>(id, year, inc)

## plot the first income path ####
sim_income <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(id <span class="op">==</span><span class="st"> </span><span class="dv">1</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(year, inc)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_line</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;Simulated income growth over time (one simulation)&quot;</span>,
       <span class="dt">x =</span> <span class="st">&quot;Year&quot;</span>,
       <span class="dt">y =</span> <span class="st">&quot;Annual Income&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="dt">labels =</span> scales<span class="op">::</span>dollar)</code></pre></div>
</p>
<p></details></p>
</div>
<div id="session-info" class="section level1 toc-ignore">
<h1>Session Info</h1>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">devtools<span class="op">::</span><span class="kw">session_info</span>()</code></pre></div>
<pre><code>## Session info -------------------------------------------------------------</code></pre>
<pre><code>##  setting  value                       
##  version  R version 3.4.1 (2017-06-30)
##  system   x86_64, darwin15.6.0        
##  ui       X11                         
##  language (EN)                        
##  collate  en_US.UTF-8                 
##  tz       America/Chicago             
##  date     2017-08-08</code></pre>
<pre><code>## Packages -----------------------------------------------------------------</code></pre>
<pre><code>##  package    * version    date       source                              
##  assertthat   0.2.0      2017-04-11 CRAN (R 3.4.0)                      
##  backports    1.1.0      2017-05-22 CRAN (R 3.4.0)                      
##  base       * 3.4.1      2017-07-07 local                               
##  bindr        0.1        2016-11-13 CRAN (R 3.4.0)                      
##  bindrcpp     0.2        2017-06-17 CRAN (R 3.4.0)                      
##  boxes        0.0.0.9000 2017-07-19 Github (r-pkgs/boxes@03098dc)       
##  broom        0.4.2      2017-02-13 CRAN (R 3.4.0)                      
##  cellranger   1.1.0      2016-07-27 CRAN (R 3.4.0)                      
##  clisymbols   1.2.0      2017-05-21 cran (@1.2.0)                       
##  colorspace   1.3-2      2016-12-14 CRAN (R 3.4.0)                      
##  compiler     3.4.1      2017-07-07 local                               
##  crayon       1.3.2.9000 2017-07-19 Github (gaborcsardi/crayon@750190f) 
##  datasets   * 3.4.1      2017-07-07 local                               
##  devtools     1.13.2     2017-06-02 CRAN (R 3.4.0)                      
##  digest       0.6.12     2017-01-27 CRAN (R 3.4.0)                      
##  dplyr      * 0.7.2      2017-07-20 CRAN (R 3.4.1)                      
##  evaluate     0.10.1     2017-06-24 CRAN (R 3.4.1)                      
##  forcats    * 0.2.0      2017-01-23 CRAN (R 3.4.0)                      
##  foreign      0.8-69     2017-06-22 CRAN (R 3.4.1)                      
##  ggplot2    * 2.2.1      2016-12-30 CRAN (R 3.4.0)                      
##  glue         1.1.1      2017-06-21 CRAN (R 3.4.1)                      
##  graphics   * 3.4.1      2017-07-07 local                               
##  grDevices  * 3.4.1      2017-07-07 local                               
##  grid         3.4.1      2017-07-07 local                               
##  gtable       0.2.0      2016-02-26 CRAN (R 3.4.0)                      
##  haven        1.1.0      2017-07-09 CRAN (R 3.4.1)                      
##  hms          0.3        2016-11-22 CRAN (R 3.4.0)                      
##  htmltools    0.3.6      2017-04-28 CRAN (R 3.4.0)                      
##  httr         1.2.1      2016-07-03 CRAN (R 3.4.0)                      
##  jsonlite     1.5        2017-06-01 CRAN (R 3.4.0)                      
##  knitr        1.16       2017-05-18 CRAN (R 3.4.0)                      
##  lattice      0.20-35    2017-03-25 CRAN (R 3.4.1)                      
##  lazyeval     0.2.0      2016-06-12 CRAN (R 3.4.0)                      
##  lubridate    1.6.0      2016-09-13 CRAN (R 3.4.0)                      
##  magrittr     1.5        2014-11-22 CRAN (R 3.4.0)                      
##  memoise      1.1.0      2017-04-21 CRAN (R 3.4.0)                      
##  methods    * 3.4.1      2017-07-07 local                               
##  mnormt       1.5-5      2016-10-15 CRAN (R 3.4.0)                      
##  modelr       0.1.1      2017-07-24 CRAN (R 3.4.1)                      
##  munsell      0.4.3      2016-02-13 CRAN (R 3.4.0)                      
##  nlme         3.1-131    2017-02-06 CRAN (R 3.4.1)                      
##  parallel     3.4.1      2017-07-07 local                               
##  pkgconfig    2.0.1      2017-03-21 CRAN (R 3.4.0)                      
##  plyr         1.8.4      2016-06-08 CRAN (R 3.4.0)                      
##  psych        1.7.5      2017-05-03 CRAN (R 3.4.1)                      
##  purrr      * 0.2.2.2    2017-05-11 CRAN (R 3.4.0)                      
##  R6           2.2.2      2017-06-17 CRAN (R 3.4.0)                      
##  Rcpp         0.12.12    2017-07-15 CRAN (R 3.4.1)                      
##  readr      * 1.1.1      2017-05-16 CRAN (R 3.4.0)                      
##  readxl       1.0.0      2017-04-18 CRAN (R 3.4.0)                      
##  reshape2     1.4.2      2016-10-22 CRAN (R 3.4.0)                      
##  rlang        0.1.1      2017-05-18 CRAN (R 3.4.0)                      
##  rmarkdown    1.6        2017-06-15 CRAN (R 3.4.0)                      
##  rprojroot    1.2        2017-01-16 CRAN (R 3.4.0)                      
##  rstudioapi   0.6        2016-06-27 CRAN (R 3.4.0)                      
##  rvest        0.3.2      2016-06-17 CRAN (R 3.4.0)                      
##  scales       0.4.1      2016-11-09 CRAN (R 3.4.0)                      
##  stats      * 3.4.1      2017-07-07 local                               
##  stringi      1.1.5      2017-04-07 CRAN (R 3.4.0)                      
##  stringr    * 1.2.0      2017-02-18 CRAN (R 3.4.0)                      
##  tibble     * 1.3.3      2017-05-28 CRAN (R 3.4.0)                      
##  tidyr      * 0.6.3      2017-05-15 CRAN (R 3.4.0)                      
##  tidyverse  * 1.1.1.9000 2017-07-19 Github (tidyverse/tidyverse@a028619)
##  tools        3.4.1      2017-07-07 local                               
##  utils      * 3.4.1      2017-07-07 local                               
##  withr        2.0.0      2017-07-28 CRAN (R 3.4.1)                      
##  xml2         1.1.1      2017-01-24 CRAN (R 3.4.0)                      
##  yaml         2.1.14     2016-11-12 CRAN (R 3.4.0)</code></pre>
</div>
<div class="footnotes">
<hr />
<ol>
<li id="fn1"><p>Source: <a href="https://en.wikipedia.org/wiki/Software_bug">Wikipedia</a><a href="#fnref1">↩</a></p></li>
<li id="fn2"><p>And for that matter, in any other programming language as well. Note however that these style rules are specific to R; other languages by necessity may use different rules and conventions.<a href="#fnref2">↩</a></p></li>
<li id="fn3"><p>These are useful for writing functions for <a href="http://adv-r.had.co.nz/OO-essentials.html">generic methods</a>.<a href="#fnref3">↩</a></p></li>
</ol>
</div>

<p>This work is licensed under the  <a href="http://creativecommons.org/licenses/by-nc/4.0/">CC BY-NC 4.0 Creative Commons License</a>.</p>


</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
