<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />




<title>Getting data from the web: scraping</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/readable.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-45631879-2', 'auto');
  ga('send', 'pageview');

</script>


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>


<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>


</head>

<body>

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
button.code-folding-btn:focus {
  outline: none;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 66px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 71px;
  margin-top: -71px;
}

.section h2 {
  padding-top: 71px;
  margin-top: -71px;
}
.section h3 {
  padding-top: 71px;
  margin-top: -71px;
}
.section h4 {
  padding-top: 71px;
  margin-top: -71px;
}
.section h5 {
  padding-top: 71px;
  margin-top: -71px;
}
.section h6 {
  padding-top: 71px;
  margin-top: -71px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>


<div class="container-fluid main-container">

<!-- tabsets -->
<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});
</script>

<!-- code folding -->




<script>
$(document).ready(function ()  {

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_').toLowerCase();
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}


.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
  padding-left: 25px;
  text-indent: 0;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>

<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row-fluid">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Computing for the Social Sciences</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">Home</a>
</li>
<li>
  <a href="faq.html">FAQ</a>
</li>
<li>
  <a href="syllabus.html">Syllabus</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">Getting data from the web: scraping</h1>

</div>


<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(tidyverse)
<span class="kw">library</span>(rvest)

<span class="kw">theme_set</span>(<span class="kw">theme_minimal</span>())</code></pre></div>
<div id="web-scraping" class="section level1">
<h1>Web scraping</h1>
<p>What if data is present on a website, but isn’t provided in an API at all? It is possible to grab that information too. How easy that is to do depends a lot on the quality of the website that we are using.</p>
</div>
<div id="html" class="section level1">
<h1>HTML</h1>
<p>HTML is a structured way of displaying information. It is very similar in structure to XML (in fact many modern html sites are actually XHTML5, <a href="http://www.w3.org/TR/html5/the-xhtml-syntax.html">which is also valid XML</a>)</p>
<div class="figure">
<img src="http://imgs.xkcd.com/comics/tags.png" alt="tags" />
<p class="caption"><a href="https://xkcd.com/1144/">tags</a></p>
</div>
<div id="process" class="section level2">
<h2>Process</h2>
<p><strong>HyperText Markup Language</strong> (HTML) is the basic building block of the World Wide Web. It defines the structure and format of content on web pages. The HTML code is stored on a server and retrieved by your computer when you visit a web page.</p>
<ol style="list-style-type: decimal">
<li>The web browser sends a request to the server that hosts the website.</li>
<li>The server sends the browser an HTML document.</li>
<li>The browser uses instructions in the HTML to render the website.</li>
</ol>
</div>
<div id="components-of-html-code" class="section level2">
<h2>Components of HTML code</h2>
<p>HTML code looks something like this:</p>
<div class="sourceCode"><pre class="sourceCode html"><code class="sourceCode html"><span class="kw">&lt;html&gt;</span>
  <span class="kw">&lt;head&gt;</span>
    <span class="kw">&lt;title&gt;</span>Title<span class="kw">&lt;/title&gt;</span>
    <span class="kw">&lt;link</span><span class="ot"> rel=</span><span class="st">&quot;icon&quot;</span><span class="ot"> type=</span><span class="st">&quot;icon&quot;</span><span class="ot"> href=</span><span class="st">&quot;http://a&quot;</span> <span class="kw">/&gt;</span>
    <span class="kw">&lt;link</span><span class="ot"> rel=</span><span class="st">&quot;icon&quot;</span><span class="ot"> type=</span><span class="st">&quot;icon&quot;</span><span class="ot"> href=</span><span class="st">&quot;http://b&quot;</span> <span class="kw">/&gt;</span>
    <span class="kw">&lt;script</span><span class="ot"> src=</span><span class="st">&quot;https://c.js&quot;</span><span class="kw">&gt;&lt;/script&gt;</span>
  <span class="kw">&lt;/head&gt;</span>
  <span class="kw">&lt;body&gt;</span>
    <span class="kw">&lt;div&gt;</span>
      <span class="kw">&lt;p&gt;</span>Click <span class="kw">&lt;b&gt;</span>here<span class="kw">&lt;/b&gt;</span> now.<span class="kw">&lt;/p&gt;</span>
      <span class="kw">&lt;span&gt;</span>Frozen<span class="kw">&lt;/span&gt;</span>
    <span class="kw">&lt;/div&gt;</span>
    <span class="kw">&lt;table</span><span class="ot"> style=</span><span class="st">&quot;width:100%&quot;</span><span class="kw">&gt;</span>
      <span class="kw">&lt;tr&gt;</span>
        <span class="kw">&lt;td&gt;</span>Kristen<span class="kw">&lt;/td&gt;</span>
        <span class="kw">&lt;td&gt;</span>Bell<span class="kw">&lt;/td&gt;</span>
      <span class="kw">&lt;/tr&gt;</span>
      <span class="kw">&lt;tr&gt;</span>
        <span class="kw">&lt;td&gt;</span>Idina<span class="kw">&lt;/td&gt;</span>
        <span class="kw">&lt;td&gt;</span>Menzel<span class="kw">&lt;/td&gt;</span>
      <span class="kw">&lt;/tr&gt;</span>
    <span class="kw">&lt;/table&gt;</span>
  <span class="kw">&lt;img</span><span class="ot"> src=</span><span class="st">&quot;http://ia.media-imdb.com/images.png&quot;</span><span class="kw">/&gt;</span>
  <span class="kw">&lt;/body&gt;</span>
<span class="kw">&lt;/html&gt;</span></code></pre></div>
<p>HTML code consists of <strong>markup</strong> code used to annotate text, images, and other content for display in a web browswer. As you can see, the code above consists of HTML <strong>elements</strong> which are created by a tag <code>&lt;&gt;</code>. Elements can also have <strong>attributes</strong> that configure the elements or adjust their behavior.</p>
<blockquote>
<p>You can think of elements as R functions, and attributes are the arguments to functions. Not all functions require arguments, or they use default arguments.</p>
</blockquote>
<div class="sourceCode"><pre class="sourceCode html"><code class="sourceCode html"><span class="kw">&lt;a</span><span class="ot"> href=</span><span class="st">&quot;http://github.com&quot;</span><span class="kw">&gt;</span>GitHub<span class="kw">&lt;/a&gt;</span></code></pre></div>
<ul>
<li><code>&lt;a&gt;&lt;/a&gt;</code> - tag name</li>
<li><code>href</code> - attribute (name)</li>
<li><code>&quot;http://github.com&quot;</code> - attribute (value)</li>
<li><code>GitHub</code> - content</li>
</ul>
<p>HTML code utilizes a nested structure. The above tags can be represented as:</p>
<ul>
<li><code>html</code>
<ul>
<li><code>head</code>
<ul>
<li><code>title</code></li>
<li><code>link</code></li>
<li><code>link</code></li>
<li><code>script</code></li>
</ul></li>
<li><code>body</code>
<ul>
<li><code>div</code>
<ul>
<li><code>p</code>
<ul>
<li><code>b</code></li>
</ul></li>
<li><code>span</code></li>
</ul></li>
<li><code>table</code>
<ul>
<li><code>tr</code>
<ul>
<li><code>td</code></li>
<li><code>td</code></li>
</ul></li>
<li><code>tr</code>
<ul>
<li><code>td</code></li>
<li><code>td</code></li>
</ul></li>
</ul></li>
<li><code>img</code></li>
</ul></li>
</ul></li>
</ul>
<p>Let’s say we want to find the content “here”. Which tag in our sample HTML code contains that content?</p>
<ul>
<li><code>html</code>
<ul>
<li><code>head</code>
<ul>
<li><code>title</code></li>
<li><code>link</code></li>
<li><code>link</code></li>
<li><code>script</code></li>
</ul></li>
<li><code>body</code>
<ul>
<li><code>div</code>
<ul>
<li><code>p</code>
<ul>
<li><span style="color:red"><strong><code>b</code></strong></span></li>
</ul></li>
<li><code>span</code></li>
</ul></li>
<li><code>table</code>
<ul>
<li><code>tr</code>
<ul>
<li><code>td</code></li>
<li><code>td</code></li>
</ul></li>
<li><code>tr</code>
<ul>
<li><code>td</code></li>
<li><code>td</code></li>
</ul></li>
</ul></li>
<li><code>img</code></li>
</ul></li>
</ul></li>
</ul>
<div id="find-the-source-code" class="section level4">
<h4>Find the source code</h4>
<p>Navigate to <a href="http://www.imdb.com/title/tt2294629/">the IMDB page for <em>Frozen</em></a> and open the source code. Locate the piece of HTML that inserts “Kristen Bell” into the cast section. Which HTML tag surrounds her name?</p>
<div class="figure">
<img src="images/frozen_bell.png" alt="IMDB page for Frozen" />
<p class="caption">IMDB page for <em>Frozen</em></p>
</div>
<details> <summary>Click for the solution</summary>
<p>
<div class="figure">
<img src="images/frozen_span.png" alt="HTML tag for Kristen Bell" />
<p class="caption">HTML tag for “Kristen Bell”</p>
</div>
<p>“Kristen Bell” is enclosed in the <code>span</code> tag. But look through the some of the other source code. <code>span</code> is used many times throughout the page. How can we select just the element containing “Kristen Bell”, or all the cast member names but nothing else?</p>
</p>
<p></details></p>
</div>
</div>
</div>
<div id="css-selectors" class="section level1">
<h1>CSS selectors</h1>
<p><strong>Cascading Style Sheets</strong> (CSS) are a flexible framework for customizing the appearance of elements in a web page. They work in conjunction with HTML to format the appearance of content on the web.</p>
<div id="html-1" class="section level5">
<h5>HTML</h5>
<div class="figure">
<img src="images/shiny-css-none.png" alt="HTML only" />
<p class="caption">HTML only</p>
</div>
</div>
<div id="html-css" class="section level5">
<h5>HTML + CSS</h5>
<div class="figure">
<img src="images/shiny-css.png" alt="HTML + CSS" />
<p class="caption">HTML + CSS</p>
</div>
</div>
<div id="css-code" class="section level2">
<h2>CSS code</h2>
<div class="sourceCode"><pre class="sourceCode css"><code class="sourceCode css">span <span class="kw">{</span>
  <span class="kw">color:</span> <span class="dt">#ffffff</span><span class="kw">;</span>
<span class="kw">}</span>

<span class="fl">.num</span> <span class="kw">{</span>
  <span class="kw">color:</span> <span class="dt">#a8660d</span><span class="kw">;</span>
<span class="kw">}</span>

table<span class="fl">.data</span> <span class="kw">{</span>
  <span class="kw">width:</span> <span class="dt">auto</span><span class="kw">;</span>
<span class="kw">}</span>

<span class="fl">#firstname</span> <span class="kw">{</span>
  <span class="kw">background-color:</span> <span class="dt">yellow</span><span class="kw">;</span>
<span class="kw">}</span></code></pre></div>
<p>CSS uses <strong>selectors</strong> and <strong>styles</strong>. Selectors define to which elements of the HTML code the styles apply. A CSS script describes an element by its <strong>tag</strong>, <strong>class</strong>, and/or <strong>ID</strong>. Class and ID are defined in the HTML code as attributes of the element.</p>
<div class="sourceCode"><pre class="sourceCode html"><code class="sourceCode html"><span class="kw">&lt;span</span><span class="ot"> class=</span><span class="st">&quot;bigname&quot;</span><span class="ot"> id=</span><span class="st">&quot;shiny&quot;</span><span class="kw">&gt;</span>Shiny<span class="kw">&lt;/span&gt;</span></code></pre></div>
<ul>
<li><code>&lt;span&gt;&lt;/span&gt;</code> - tag name</li>
<li><code>bigname</code> - class (optional)</li>
<li><code>shiny</code> - id (optional)</li>
</ul>
<p>So a CSS selector of</p>
<div class="sourceCode"><pre class="sourceCode css"><code class="sourceCode css">span</code></pre></div>
<p>would select all elements with the <code>span</code> tag. Likewise, a CSS selector of</p>
<div class="sourceCode"><pre class="sourceCode css"><code class="sourceCode css"><span class="fl">.bigname</span></code></pre></div>
<p>selects all elements with the <code>bigname</code> class (note the use of a <code>.</code> to select based on class). A CSS selector of</p>
<div class="sourceCode"><pre class="sourceCode css"><code class="sourceCode css">span<span class="fl">.bigname</span></code></pre></div>
<p>selects all elements with the <code>span</code> tag <strong>and</strong> the <code>bigname</code> class. Finally,</p>
<div class="sourceCode"><pre class="sourceCode css"><code class="sourceCode css"><span class="fl">#shiny</span></code></pre></div>
<p>selects all elements with the <code>shiny</code> id.</p>
<table>
<thead>
<tr class="header">
<th>Prefix</th>
<th>Matches</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>none</td>
<td>tag</td>
</tr>
<tr class="even">
<td>.</td>
<td>class</td>
</tr>
<tr class="odd">
<td>#</td>
<td>id</td>
</tr>
</tbody>
</table>
<blockquote>
<p><a href="http://flukeout.github.io">CSS diner</a> is a JavaScript-based interactive game for learning and practicing CSS selectors. Take some time to play and learn more about CSS selector combinations.</p>
</blockquote>
<div id="find-the-css-selector" class="section level4">
<h4>Find the CSS selector</h4>
<p>Which CSS identifiers are associated with Kristen Bell’s name in the <em>Frozen</em> page? Write a CSS selector that targets them.</p>
<div class="figure">
<img src="images/frozen_css.png" />

</div>
<details> <summary>Click for the solution</summary>
<p>
<ul>
<li><code>span</code> - the element</li>
<li><code>itemprop</code> - the class</li>
</ul>
<p>Therefore the CSS selector would be <code>span.itemprop</code>.</p>
</p>
<p></details></p>
</div>
</div>
</div>
<div id="rvest" class="section level1">
<h1><code>rvest</code></h1>
<p><code>rvest</code> is a package that contains functions to easily extract information from a webpage. The basic workflow is:</p>
<ol style="list-style-type: decimal">
<li>Download the HTML and turn it into an XML file with <code>read_html()</code></li>
<li>Extract specific nodes with <code>html_nodes()</code></li>
<li>Extract content from nodes with various functions</li>
</ol>
<div id="download-the-html" class="section level2">
<h2>Download the HTML</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(rvest)
frozen &lt;-<span class="st"> </span><span class="kw">read_html</span>(<span class="st">&quot;http://www.imdb.com/title/tt2294629/&quot;</span>)
frozen</code></pre></div>
<pre><code>## {xml_document}
## &lt;html xmlns:og=&quot;http://ogp.me/ns#&quot; xmlns:fb=&quot;http://www.facebook.com/2008/fbml&quot;&gt;
## [1] &lt;head&gt;\n&lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html; charset= ...
## [2] &lt;body id=&quot;styleguide-v2&quot; class=&quot;fixed&quot;&gt;\n&lt;script&gt;\n    if (typeof ue ...</code></pre>
<blockquote>
<p>It is always a good practice when web scraping to store the output of <code>read_html()</code> in an object immediately, then apply further functions to the stored HTML file. Otherwise you send a request to the server every time you extract information from the HTML. For longer-term projects, you can store <code>read_html()</code> objects locally on your computer using <code>readr::write_rds()</code> and retrieve them using <code>readr::read_rds()</code>. This caches a local copy of the file so you always have a copy preserved, in case the webpage’s underlying HTML code is modified (or the website is taken offline).</p>
</blockquote>
</div>
<div id="extract-nodes" class="section level2">
<h2>Extract nodes</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">itals &lt;-<span class="st"> </span><span class="kw">html_nodes</span>(frozen, <span class="st">&quot;em&quot;</span>)
itals</code></pre></div>
<pre><code>## {xml_nodeset (1)}
## [1] &lt;em class=&quot;nobr&quot;&gt;Written by\n&lt;a href=&quot;/search/title?plot_author=DeAl ...</code></pre>
<ul>
<li>The first argument to <code>html_nodes()</code> is the HTML document or a node previously extracted from the document</li>
<li>The second argument is a CSS selector to identify which nodes to select</li>
</ul>
</div>
<div id="extract-content-from-nodes" class="section level2">
<h2>Extract content from nodes</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">itals</code></pre></div>
<pre><code>## {xml_nodeset (1)}
## [1] &lt;em class=&quot;nobr&quot;&gt;Written by\n&lt;a href=&quot;/search/title?plot_author=DeAl ...</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">html_text</span>(itals)</code></pre></div>
<pre><code>## [1] &quot;Written by\nDeAlan Wilson for ComedyE.com&quot;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">html_name</span>(itals)</code></pre></div>
<pre><code>## [1] &quot;em&quot;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">html_children</span>(itals)</code></pre></div>
<pre><code>## {xml_nodeset (1)}
## [1] &lt;a href=&quot;/search/title?plot_author=DeAlan%20Wilson%20for%20ComedyE.c ...</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">html_attr</span>(itals, <span class="st">&quot;class&quot;</span>)</code></pre></div>
<pre><code>## [1] &quot;nobr&quot;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">html_attrs</span>(itals)</code></pre></div>
<pre><code>## [[1]]
##  class 
## &quot;nobr&quot;</code></pre>
<div id="extract-content" class="section level4">
<h4>Extract content</h4>
<p>Now it’s your turn to practice.</p>
<ol style="list-style-type: decimal">
<li>Read in the <em>Frozen</em> HTML</li>
<li>Select the nodes that are both <code>span</code>s and <code>class = &quot;itemprop&quot;</code></li>
<li>Extract the text from the nodes</li>
</ol>
<details> <summary>Click for the solution</summary>
<p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(rvest)
frozen &lt;-<span class="st"> </span><span class="kw">read_html</span>(<span class="st">&quot;http://www.imdb.com/title/tt2294629/&quot;</span>)
cast &lt;-<span class="st"> </span><span class="kw">html_nodes</span>(frozen, <span class="st">&quot;span.itemprop&quot;</span>)
<span class="kw">html_text</span>(cast)</code></pre></div>
<pre><code>##  [1] &quot;Animation&quot;                     &quot;Adventure&quot;                    
##  [3] &quot;Comedy&quot;                        &quot;Chris Buck&quot;                   
##  [5] &quot;Jennifer Lee&quot;                  &quot;Jennifer Lee&quot;                 
##  [7] &quot;Hans Christian Andersen&quot;       &quot;Kristen Bell&quot;                 
##  [9] &quot;Idina Menzel&quot;                  &quot;Jonathan Groff&quot;               
## [11] &quot;Kristen Bell&quot;                  &quot;Idina Menzel&quot;                 
## [13] &quot;Jonathan Groff&quot;                &quot;Josh Gad&quot;                     
## [15] &quot;Santino Fontana&quot;               &quot;Alan Tudyk&quot;                   
## [17] &quot;Ciarán Hinds&quot;                  &quot;Chris Williams&quot;               
## [19] &quot;Stephen J. Anderson&quot;           &quot;Maia Wilson&quot;                  
## [21] &quot;Edie McClurg&quot;                  &quot;Robert Pine&quot;                  
## [23] &quot;Maurice LaMarche&quot;              &quot;Livvy Stubenrauch&quot;            
## [25] &quot;Eva Bella&quot;                     &quot;female protagonist&quot;           
## [27] &quot;snowman&quot;                       &quot;sister sister relationship&quot;   
## [29] &quot;magic&quot;                         &quot;sister love&quot;                  
## [31] &quot;Walt Disney Animation Studios&quot; &quot;Walt Disney Pictures&quot;</code></pre>
</p>
<p></details></p>
<p>Do you collect the cast names and only the cast names? We’ve scraped too much. The problem is that our CSS selector is not specific enough for our needs. We need an easy way to identify CSS selector combinations to extract only the content we want, and nothing more.</p>
</div>
</div>
</div>
<div id="selectorgadget" class="section level1">
<h1>SelectorGadget</h1>
<p><strong>SelectorGadget</strong> is a GUI tool used to identify CSS selector combinations from a webpage.</p>
<div id="install-selectorgadget" class="section level2">
<h2>Install SelectorGadget</h2>
<ol style="list-style-type: decimal">
<li>Run <code>vignette(&quot;selectorgadget&quot;)</code></li>
<li>Drag <strong>SelectorGadget</strong> link into your browser’s bookmark bar</li>
</ol>
</div>
<div id="using-selectorgadget" class="section level2">
<h2>Using SelectorGadget</h2>
<ol style="list-style-type: decimal">
<li>Navigate to a webpage</li>
<li>Open the SelectorGadget bookmark</li>
<li>Click on the item to scrape</li>
<li>Click on yellow items you do not want to scrape</li>
<li>Click on additional items that you do want to scrape</li>
<li>Rinse and repeat until only the items you want to scrape are highlighted in yellow</li>
<li>Copy the selector to use with <code>html_nodes()</code></li>
</ol>
<blockquote>
<p>When using SelectorGadget, always make sure to scroll up and down the web page to make sure you have properly selected only the content you want.</p>
</blockquote>
</div>
<div id="practice-using-selectorgadget" class="section level2">
<h2>Practice using SelectorGadget</h2>
<ol style="list-style-type: decimal">
<li>Install SelectorGadget in your browser</li>
<li>Use SelectorGadget to find a CSS selector combination that identifies just the cast member names</li>
</ol>
<details> <summary>Click for the solution</summary>
<p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">cast2 &lt;-<span class="st"> </span><span class="kw">html_nodes</span>(frozen, <span class="st">&quot;#titleCast span.itemprop&quot;</span>)
<span class="kw">html_text</span>(cast2)</code></pre></div>
<pre><code>##  [1] &quot;Kristen Bell&quot;        &quot;Idina Menzel&quot;        &quot;Jonathan Groff&quot;     
##  [4] &quot;Josh Gad&quot;            &quot;Santino Fontana&quot;     &quot;Alan Tudyk&quot;         
##  [7] &quot;Ciarán Hinds&quot;        &quot;Chris Williams&quot;      &quot;Stephen J. Anderson&quot;
## [10] &quot;Maia Wilson&quot;         &quot;Edie McClurg&quot;        &quot;Robert Pine&quot;        
## [13] &quot;Maurice LaMarche&quot;    &quot;Livvy Stubenrauch&quot;   &quot;Eva Bella&quot;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">cast3 &lt;-<span class="st"> </span><span class="kw">html_nodes</span>(frozen, <span class="st">&quot;.itemprop .itemprop&quot;</span>)
<span class="kw">html_text</span>(cast3)</code></pre></div>
<pre><code>##  [1] &quot;Kristen Bell&quot;        &quot;Idina Menzel&quot;        &quot;Jonathan Groff&quot;     
##  [4] &quot;Josh Gad&quot;            &quot;Santino Fontana&quot;     &quot;Alan Tudyk&quot;         
##  [7] &quot;Ciarán Hinds&quot;        &quot;Chris Williams&quot;      &quot;Stephen J. Anderson&quot;
## [10] &quot;Maia Wilson&quot;         &quot;Edie McClurg&quot;        &quot;Robert Pine&quot;        
## [13] &quot;Maurice LaMarche&quot;    &quot;Livvy Stubenrauch&quot;   &quot;Eva Bella&quot;</code></pre>
</p>
<p></details></p>
</div>
</div>
<div id="practice-scraping-data" class="section level1">
<h1>Practice scraping data</h1>
<p>Look up the cost of living for your hometown on <a href="http://www.bestplaces.net/">Sperling’s Best Places</a>. Then extract it with <code>html_nodes()</code> and <code>html_text()</code>.</p>
<details> <summary>Click for the solution</summary>
<p>
<p>For me, this means I need to obtain information on <a href="http://www.bestplaces.net/cost_of_living/city/virginia/sterling">Sterling, Virginia</a>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">sterling &lt;-<span class="st"> </span><span class="kw">read_html</span>(<span class="st">&quot;http://www.bestplaces.net/cost_of_living/city/virginia/sterling&quot;</span>)

col &lt;-<span class="st"> </span><span class="kw">html_nodes</span>(sterling, <span class="dt">css =</span> <span class="st">&quot;#mainContent_dgCostOfLiving tr:nth-child(2) td:nth-child(2)&quot;</span>)
<span class="kw">html_text</span>(col)</code></pre></div>
<pre><code>## [1] &quot;136&quot;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># or use a piped operation</span>
sterling <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">html_nodes</span>(<span class="dt">css =</span> <span class="st">&quot;#mainContent_dgCostOfLiving tr:nth-child(2) td:nth-child(2)&quot;</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">html_text</span>()</code></pre></div>
<pre><code>## [1] &quot;136&quot;</code></pre>
</p>
<p></details></p>
<div id="tables" class="section level2">
<h2>Tables</h2>
<p>Use <code>html_table()</code> to scrape whole tables of data as a data frame.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">tables &lt;-<span class="st"> </span><span class="kw">html_nodes</span>(sterling, <span class="dt">css =</span> <span class="st">&quot;table&quot;</span>)

tables <span class="op">%&gt;%</span>
<span class="st">  </span><span class="co"># get the second table</span>
<span class="st">  </span><span class="kw">nth</span>(<span class="dv">2</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="co"># convert to data frame</span>
<span class="st">  </span><span class="kw">html_table</span>(<span class="dt">header =</span> <span class="ot">TRUE</span>)</code></pre></div>
<pre><code>##   COST OF LIVING Sterling, Virginia United States
## 1        Overall              136.0           100
## 2        Grocery              113.9           100
## 3         Health              101.0           100
## 4        Housing              203.0           100
## 5      Utilities              107.0           100
## 6 Transportation              108.0           100
## 7  Miscellaneous               98.0           100</code></pre>
<div id="extract-climate-statistics" class="section level4">
<h4>Extract climate statistics</h4>
<p>Visit the climate tab for your home town. Extract the climate statistics of your hometown as a data frame with useful column names.</p>
<details> <summary>Click for the solution</summary>
<p>
<p>For me, this means I need to obtain information on <a href="http://www.bestplaces.net/cost_of_living/city/virginia/sterling">Sterling, Virginia</a>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">sterling_climate &lt;-<span class="st"> </span><span class="kw">read_html</span>(<span class="st">&quot;http://www.bestplaces.net/climate/city/virginia/sterling&quot;</span>)

climate &lt;-<span class="st"> </span><span class="kw">html_nodes</span>(sterling_climate, <span class="dt">css =</span> <span class="st">&quot;table&quot;</span>)
<span class="kw">html_table</span>(climate, <span class="dt">header =</span> <span class="ot">TRUE</span>, <span class="dt">fill =</span> <span class="ot">TRUE</span>)[[<span class="dv">2</span>]]</code></pre></div>
<pre><code>##                         CLIMATE Sterling, Virginia United States
## 1                Rainfall (in.)            42.0447          39.2
## 2                Snowfall (in.)            21.5351          25.8
## 3            Precipitation Days            74.1000           102
## 4                    Sunny Days           197.0000           205
## 5                Avg. July High            87.4170          86.1
## 6                 Avg. Jan. Low            23.9660          22.6
## 7 Comfort Index (higher=better)            47.0000            54
## 8                      UV Index             4.0000           4.3
## 9                 Elevation ft.           457.0000         1,443</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">sterling_climate <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">html_nodes</span>(<span class="dt">css =</span> <span class="st">&quot;table&quot;</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">nth</span>(<span class="dv">2</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">html_table</span>(<span class="dt">header =</span> <span class="ot">TRUE</span>)</code></pre></div>
<pre><code>##                         CLIMATE Sterling, Virginia United States
## 1                Rainfall (in.)            42.0447          39.2
## 2                Snowfall (in.)            21.5351          25.8
## 3            Precipitation Days            74.1000           102
## 4                    Sunny Days           197.0000           205
## 5                Avg. July High            87.4170          86.1
## 6                 Avg. Jan. Low            23.9660          22.6
## 7 Comfort Index (higher=better)            47.0000            54
## 8                      UV Index             4.0000           4.3
## 9                 Elevation ft.           457.0000         1,443</code></pre>
</p>
<p></details></p>
</div>
</div>
</div>
<div id="acknowledgments" class="section level1 toc-ignore">
<h1>Acknowledgments</h1>
<ul>
<li>Web scraping lesson drawn from <a href="https://github.com/ropensci/user2016-tutorial">Extracting data from the web APIs and beyond</a></li>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/HTML">HTML| Mozilla Developer Network</a></li>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/CSS">CSS | Mozilla Developer Network</a></li>
</ul>
</div>
<div id="session-info" class="section level1 toc-ignore">
<h1>Session Info</h1>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">devtools<span class="op">::</span><span class="kw">session_info</span>()</code></pre></div>
<pre><code>## Session info -------------------------------------------------------------</code></pre>
<pre><code>##  setting  value                       
##  version  R version 3.4.1 (2017-06-30)
##  system   x86_64, darwin15.6.0        
##  ui       X11                         
##  language (EN)                        
##  collate  en_US.UTF-8                 
##  tz       America/Chicago             
##  date     2017-11-14</code></pre>
<pre><code>## Packages -----------------------------------------------------------------</code></pre>
<pre><code>##  package    * version    date       source                              
##  assertthat   0.2.0      2017-04-11 CRAN (R 3.4.0)                      
##  backports    1.1.0      2017-05-22 CRAN (R 3.4.0)                      
##  base       * 3.4.1      2017-07-07 local                               
##  bindr        0.1        2016-11-13 CRAN (R 3.4.0)                      
##  bindrcpp     0.2        2017-06-17 CRAN (R 3.4.0)                      
##  boxes        0.0.0.9000 2017-07-19 Github (r-pkgs/boxes@03098dc)       
##  broom        0.4.2      2017-08-09 local                               
##  cellranger   1.1.0      2016-07-27 CRAN (R 3.4.0)                      
##  clisymbols   1.2.0      2017-05-21 cran (@1.2.0)                       
##  colorspace   1.3-2      2016-12-14 CRAN (R 3.4.0)                      
##  compiler     3.4.1      2017-07-07 local                               
##  crayon       1.3.4      2017-10-03 Github (gaborcsardi/crayon@b5221ab) 
##  datasets   * 3.4.1      2017-07-07 local                               
##  devtools     1.13.3     2017-08-02 CRAN (R 3.4.1)                      
##  digest       0.6.12     2017-01-27 CRAN (R 3.4.0)                      
##  dplyr      * 0.7.4.9000 2017-10-03 Github (tidyverse/dplyr@1a0730a)    
##  evaluate     0.10.1     2017-06-24 CRAN (R 3.4.1)                      
##  forcats    * 0.2.0      2017-01-23 CRAN (R 3.4.0)                      
##  foreign      0.8-69     2017-06-22 CRAN (R 3.4.1)                      
##  ggplot2    * 2.2.1      2016-12-30 CRAN (R 3.4.0)                      
##  glue         1.1.1      2017-06-21 CRAN (R 3.4.1)                      
##  graphics   * 3.4.1      2017-07-07 local                               
##  grDevices  * 3.4.1      2017-07-07 local                               
##  grid         3.4.1      2017-07-07 local                               
##  gtable       0.2.0      2016-02-26 CRAN (R 3.4.0)                      
##  haven        1.1.0      2017-07-09 CRAN (R 3.4.1)                      
##  hms          0.3        2016-11-22 CRAN (R 3.4.0)                      
##  htmltools    0.3.6      2017-04-28 CRAN (R 3.4.0)                      
##  httr         1.3.1      2017-08-20 CRAN (R 3.4.1)                      
##  jsonlite     1.5        2017-06-01 CRAN (R 3.4.0)                      
##  knitr        1.17       2017-08-10 cran (@1.17)                        
##  lattice      0.20-35    2017-03-25 CRAN (R 3.4.1)                      
##  lazyeval     0.2.0      2016-06-12 CRAN (R 3.4.0)                      
##  lubridate    1.6.0      2016-09-13 CRAN (R 3.4.0)                      
##  magrittr     1.5        2014-11-22 CRAN (R 3.4.0)                      
##  memoise      1.1.0      2017-04-21 CRAN (R 3.4.0)                      
##  methods    * 3.4.1      2017-07-07 local                               
##  mnormt       1.5-5      2016-10-15 CRAN (R 3.4.0)                      
##  modelr       0.1.1      2017-08-10 local                               
##  munsell      0.4.3      2016-02-13 CRAN (R 3.4.0)                      
##  nlme         3.1-131    2017-02-06 CRAN (R 3.4.1)                      
##  parallel     3.4.1      2017-07-07 local                               
##  pkgconfig    2.0.1      2017-03-21 CRAN (R 3.4.0)                      
##  plyr         1.8.4      2016-06-08 CRAN (R 3.4.0)                      
##  psych        1.7.5      2017-05-03 CRAN (R 3.4.1)                      
##  purrr      * 0.2.3      2017-08-02 CRAN (R 3.4.1)                      
##  R6           2.2.2      2017-06-17 CRAN (R 3.4.0)                      
##  Rcpp         0.12.13    2017-09-28 cran (@0.12.13)                     
##  readr      * 1.1.1      2017-05-16 CRAN (R 3.4.0)                      
##  readxl       1.0.0      2017-04-18 CRAN (R 3.4.0)                      
##  reshape2     1.4.2      2016-10-22 CRAN (R 3.4.0)                      
##  rlang        0.1.2      2017-08-09 CRAN (R 3.4.1)                      
##  rmarkdown    1.6        2017-06-15 CRAN (R 3.4.0)                      
##  rprojroot    1.2        2017-01-16 CRAN (R 3.4.0)                      
##  rstudioapi   0.6        2016-06-27 CRAN (R 3.4.0)                      
##  rvest      * 0.3.2      2016-06-17 CRAN (R 3.4.0)                      
##  scales       0.4.1      2016-11-09 CRAN (R 3.4.0)                      
##  stats      * 3.4.1      2017-07-07 local                               
##  stringi      1.1.5      2017-04-07 CRAN (R 3.4.0)                      
##  stringr    * 1.2.0      2017-02-18 CRAN (R 3.4.0)                      
##  tibble     * 1.3.4      2017-08-22 CRAN (R 3.4.1)                      
##  tidyr      * 0.7.0      2017-08-16 CRAN (R 3.4.1)                      
##  tidyverse  * 1.1.1.9000 2017-07-19 Github (tidyverse/tidyverse@a028619)
##  tools        3.4.1      2017-07-07 local                               
##  utils      * 3.4.1      2017-07-07 local                               
##  withr        2.0.0      2017-07-28 CRAN (R 3.4.1)                      
##  xml2       * 1.1.1      2017-01-24 CRAN (R 3.4.0)                      
##  yaml         2.1.14     2016-11-12 CRAN (R 3.4.0)</code></pre>
</div>

<p>This work is licensed under the  <a href="http://creativecommons.org/licenses/by-nc/4.0/">CC BY-NC 4.0 Creative Commons License</a>.</p>


</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
