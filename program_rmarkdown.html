<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />




<title>A dive into R Markdown</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/readable.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-45631879-2', 'auto');
  ga('send', 'pageview');

</script>


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>


<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>


</head>

<body>

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
button.code-folding-btn:focus {
  outline: none;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 66px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 71px;
  margin-top: -71px;
}

.section h2 {
  padding-top: 71px;
  margin-top: -71px;
}
.section h3 {
  padding-top: 71px;
  margin-top: -71px;
}
.section h4 {
  padding-top: 71px;
  margin-top: -71px;
}
.section h5 {
  padding-top: 71px;
  margin-top: -71px;
}
.section h6 {
  padding-top: 71px;
  margin-top: -71px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>


<div class="container-fluid main-container">

<!-- tabsets -->
<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});
</script>

<!-- code folding -->




<script>
$(document).ready(function ()  {

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_').toLowerCase();
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}


.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
  padding-left: 25px;
  text-indent: 0;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>

<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row-fluid">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Computing for the Social Sciences</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">Home</a>
</li>
<li>
  <a href="faq.html">FAQ</a>
</li>
<li>
  <a href="syllabus.html">Syllabus</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">A dive into R Markdown</h1>

</div>


<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(tidyverse)
<span class="kw">library</span>(rcfss)
<span class="kw">set.seed</span>(<span class="dv">1234</span>)</code></pre></div>
<div id="reproducibility-in-scientific-research" class="section level1">
<h1>Reproducibility in scientific research</h1>
<div class="figure">
<img src="images/data-science/base.png" />

</div>
<p><strong>Reproducibility</strong> is “the idea that data analyses, and more generally, scientific claims, are published with their data and software code so that others may verify the findings and build upon them.”<a href="#fn1" class="footnoteRef" id="fnref1"><sup>1</sup></a> Scholars who implement reproducibility in their projects can quickly and easily reproduce the original results and trace back to determine how they were derived. This easily enables verification and replication, and allows the researcher to precisely replicate his or her analysis. This is extremely important when writing a paper, submiting it to a journal, then coming back months later for a revise and resubmit because you won’t remember how all the code/analysis works together when completing your revisions.</p>
<p>Reproducibility is also key for communicating findings with other researchers and decision makers; it allows them to verify your results, assess your assumptions, and understand how your answers were formed rather than solely relying on your claims. In the data science framework employed in <a href="http://r4ds.had.co.nz">R for Data Science</a>, reproducibility is infused throughout the entire workflow.</p>
<p><a href="http://rmarkdown.rstudio.com/">R Markdown</a> is one approach to ensuring reproducibility by providing a single cohesive authoring framework. It allows you to combine code, output, and analysis into a single document, are easily reproducible, and can be output to many different file formats. R Markdown is just one tool for enabling reproducibility. Another tool is <a href="https://git-scm.com/">Git</a> for <strong>version control</strong>, which is crucial for collaboration and tracking changes to code and analysis.</p>
<div id="jupyter-notebooks" class="section level3">
<h3>Jupyter Notebooks</h3>
<p>In the data science realm, another popular unified authoring framework is the <a href="http://jupyter.org/">Jupyter Notebook</a>. The Jupyter Notebook (originally called <em>iPython Notebook</em>) is a web application that incorporates text, code, and output into a single document. Originally created for the Python programming language, Jupyter Notebooks are now multi-language and support over 40 programming languages, including R. You have probably seen or used them before.</p>
<p>There is nothing wrong with Jupyter Notebooks, but I prefer R Markdown because it is integrated into RStudio, arguably the best integrated development environment (IDE) for R. Furthermore, as you will see an R Markdown file is a <strong>plain-text file</strong>. This means the content of the file can be read by any text-editor, and is easily tracked by Git. Jupyter Notebooks are stored as JSON documents, a different and more complex file format. JSON is a useful format as we will see when we get to our modules on obtaining data from the web, but they are also much more difficult to track for revisions using Git. For this reason, in this course we will exclusively use R Markdown for reproducible documents.</p>
</div>
</div>
<div id="r-markdown-basics" class="section level1">
<h1>R Markdown basics</h1>
<p>An R Markdown file is a plain text file that uses the extension <code>.Rmd</code>:</p>
<pre><code>---
title: &quot;Gun deaths&quot;
date: 2017-02-01
output: html_document
---

```{r setup, include = FALSE}
library(tidyverse)
library(rcfss)

youth &lt;- gun_deaths %&gt;%
  filter(age &lt;= 65)
```

We have data about `r nrow(gun_deaths)` individuals killed by guns. Only `r nrow(gun_deaths) - nrow(youth)` are older than 65. The distribution of the remainder is shown below:

```{r youth-dist, echo = FALSE}
youth %&gt;% 
  ggplot(aes(age)) + 
  geom_freqpoly(binwidth = 1)
```</code></pre>
<p>R Markdown documents contain 3 major components:</p>
<ol style="list-style-type: decimal">
<li>A <strong>YAML header</strong> surrounded by <code>---</code>s</li>
<li><strong>Chunks</strong> of R code surounded by <code>```</code></li>
<li>Text mixed with simple text formatting using the <a href="hw01-edit-README.html">Markdown syntax</a></li>
</ol>
<p>Code chunks are interspersed with text throughout the document. To complete the document, you “Knit” or “render” the document. Most of you proably knit the document by clicking the “Knit” button in the script editor panel. You can also do this programmatically from the console by running the command <code>rmarkdown::render(&quot;example.Rmd&quot;)</code>.</p>
<p>When you <strong>knit</strong> the document you send your <code>.Rmd</code> file to <code>knitr</code>, a package for R that executes all the code chunks and creates a second <strong>markdown</strong> document (<code>.md</code>). That markdown document is then passed onto <a href="http://pandoc.org/"><strong>pandoc</strong></a>, a document rendering software program independent from R. Pandoc allows users to convert back and forth between many different document formats such as HTML, <span class="math inline">\(\LaTeX\)</span>, Microsoft Word, etc. By splitting the workflow up, you can convert your R Markdown document into a wide range of output formats.</p>
<div class="figure">
<img src="http://r4ds.had.co.nz/images/RMarkdownFlow.png" />

</div>
<div id="text-formatting-with-markdown" class="section level2">
<h2>Text formatting with Markdown</h2>
<p><a href="hw01-edit-README.html">We have previously practiced formatting text using the Markdown syntax.</a> I will not go into it further, but do note that there is a quick reference guide to Markdown built-in to RStudio. To access it, go to <strong>Help</strong> &gt; <strong>Markdown Quick Reference</strong>.</p>
<div id="exercise" class="section level3">
<h3>Exercise</h3>
<p>Copy and paste the contents of <code>gun-deaths.Rmd</code> (the file demonstrated above) and save it in a local R Markdown document. Check that you can run it, then add text after the frequency polygon that describes its most striking features.</p>
</div>
</div>
<div id="code-chunks" class="section level2">
<h2>Code chunks</h2>
<p><strong>Code chunks</strong> are where you store R code that will be executed. You can name a code chunk using the syntax <code>```{r name-here}</code>. Naming chunks is a good practice to get into for several reasons. First, it makes navigating an R Markdown document using the drop-down code navigator in the bottom-left of the script editor easier since your chunks will have <strong>intuitive</strong> names. Second, it generates meaningful file names for any graphs created within the chunk, rather than unhelpful names such as <code>unnamed-chunk-1.png</code>. Finally, once you start <strong>caching</strong> your results (more on that below), using consistent names for chunks avoids having to repeat computationally intensive calculations.</p>
<div id="customizing-chunks" class="section level3">
<h3>Customizing chunks</h3>
<p>Code chunks can be customized to adjust the output of the chunk. Some important and useful options are:</p>
<ul>
<li><code>eval = FALSE</code> - prevents code from being evaluated. I use this in my notes for class when I want to show how to write a specific function but don’t need to actually use it.</li>
<li><code>include = FALSE</code> - runs the code but doesn’t show the code or results in the final document. This is useful when you have setup code at the beginning of your document (loading packages, adjusting options, etc.) that may generate a lot of messages that are not really necessary to include in the final report.</li>
<li><code>echo = FALSE</code> - prevents code from showing in the final output, but does show the results of the code. Use this if you are writing a paper or document for someone who cares more about the substantive results and less about the programming used to obtain them.</li>
<li><code>message = FALSE</code> or <code>warning = FALSE</code> - prevents messages or warnings from appearing in the final document.</li>
<li><code>results = 'hide'</code> - hides printed output.</li>
<li><code>error = TRUE</code> - causes the document to continue knitting and rendering even if the code generates a fatal error. I use this a lot when I want to <a href="program_condition_handle.html#fatal_errors">intentionally demonstrate an error in class</a>. If you’re debugging your code, you might want to use this option. However for the final version of your document, you probably do not want to allow errors to pass through unnoticed.</li>
</ul>
</div>
<div id="caching" class="section level3">
<h3>Caching</h3>
<p>Remember the R Markdown workflow?</p>
<div class="figure">
<img src="http://r4ds.had.co.nz/images/RMarkdownFlow.png" />

</div>
<p>By default, every time you knit a document R starts completely fresh. None of the previous results are saved. If you have code chunks that run computationally intensive tasks, you might want to store these results to be more efficient and save time. If you use <code>cache = TRUE</code>, R will do exactly this. The output of the chunk will be saved to a specially named file on disk. If your <code>.gitignore</code> file is setup correctly, this cached file will not be tracked by Git. This is in fact preferable since the cached file could be hundreds of megabytes in size. Now, every time you knit the document the cached results will be used instead of running the code fresh.</p>
<div id="dependencies" class="section level4">
<h4>Dependencies</h4>
<p>This could be problematic when chunks rely on the output of previous chunks. Take this example from <a href="http://r4ds.had.co.nz/r-markdown.html#caching">R for Data Science</a></p>
<pre><code>```{r raw_data}
rawdata &lt;- readr::read_csv(&quot;a_very_large_file.csv&quot;)
```

```{r processed_data, cache = TRUE}
processed_data &lt;- rawdata %&gt;% 
  filter(!is.na(import_var)) %&gt;% 
  mutate(new_variable = complicated_transformation(x, y, z))
```</code></pre>
<p><code>processed_data</code> relies on the <code>rawdata</code> file created in the <code>raw_data</code> chunk. If you change your code in <code>raw_data</code>, <code>processed_data</code> will continue to rely on the older cached results. This means even if <code>rawdata</code> is altered, the cached results will continue to erroneously be used. To prevent this, use the <code>dependson</code> option to declare any chunks the cached chunk relies upon:</p>
<pre><code>```{r processed_data, cache = TRUE, dependson = &quot;raw_data&quot;}
processed_data &lt;- rawdata %&gt;% 
  filter(!is.na(import_var)) %&gt;% 
  mutate(new_variable = complicated_transformation(x, y, z))
```</code></pre>
<p>Now if the code in the <code>raw_data</code> chunk is changed, <code>processed_data</code> will be run and the cache updated.</p>
</div>
</div>
<div id="global-options" class="section level3">
<h3>Global options</h3>
<p>Rather than setting these options for each individual chunk, you can make them the default options for <strong>all chunks</strong> by using <code>knitr::opts_chunk$set()</code>. Just include this in a code chunk (typically in the first code chunk in the document). So for example,</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">knitr<span class="op">::</span>opts_chunk<span class="op">$</span><span class="kw">set</span>(
  <span class="dt">echo =</span> <span class="ot">FALSE</span>
)</code></pre></div>
<p>hides the code by default in all code chunks. To override this new default, you can still declare <code>echo = TRUE</code> for individual chunks.</p>
</div>
<div id="inline-code" class="section level3">
<h3>Inline code</h3>
<p>Until now, you have only run code in a specially designated chunk. However you can also run R code <strong>in-line</strong> by using the <code>`r `</code> syntax. For example, look at the text from the example document earlier:</p>
<blockquote>
<p>We have data about <code>`r nrow(gun_deaths)`</code> individuals killed by guns. Only <code>`r nrow(gun_deaths) - nrow(youth)`</code> are older than 65. The distribution of the remainder is shown below:</p>
</blockquote>
<p>When you knit the document, the R code is executed:</p>
<blockquote>
<p>We have data about 100798 individuals killed by guns. Only 15687 are older than 65. The distribution of the remainder is shown below:</p>
</blockquote>
</div>
<div id="exercise-practice-chunk-options" class="section level3">
<h3>Exercise: practice chunk options</h3>
<p>Add a section that explores how gun deaths vary by race.</p>
<ol style="list-style-type: decimal">
<li>Assume you’re writing a report for someone who doesn’t know R, and instead of setting <code>echo = FALSE</code> on each chunk, set a global option.</li>
<li>Enable caching as a global option and render the document. Look at the file structure for the cache. Now render the document again. Does it run faster? Modify some code in one of the chunks? What happens now?</li>
<li>Test out some of the other chunk options. Which do you find most useful? In what context would you use them?</li>
</ol>
</div>
</div>
<div id="yaml-header" class="section level2">
<h2>YAML header</h2>
<p><strong>Y</strong>et <strong>A</strong>nother <strong>M</strong>arkup <strong>L</strong>anguage, or <strong>YAML</strong> (rhymes with <em>camel</em>) is a standardized format for storing hierarchical data in a human-readable syntax. The YAML header controls how <code>rmarkdown</code> renders your <code>.Rmd</code> file. A YAML header is a section of <code>key: value</code> pairs surrounded by <code>---</code> marks.</p>
<pre><code>---
title: &quot;Gun deaths&quot;
author: &quot;Benjamin Soltoff&quot;
date: 2017-02-01
output: html_document
---</code></pre>
<p>The most important option is <code>output</code>, as this determines the final document format. However there are other common options such as providing a <code>title</code> and <code>author</code> for your document and specifying the <code>date</code> of publication.</p>
</div>
</div>
<div id="output-formats" class="section level1">
<h1>Output formats</h1>
<div id="html-document" class="section level2">
<h2>HTML document</h2>
<p>For your homework assignments, we have used <code>github_document</code> to generate a <a href="http://rmarkdown.rstudio.com/markdown_document_format.html">Markdown document</a>. However there are other document formats that are more commonly used.</p>
<pre><code>---
title: &quot;Untitled&quot;
author: &quot;Benjamin Soltoff&quot;
date: &quot;February 1, 2017&quot;
output: html_document
---</code></pre>
<p><a href="http://rmarkdown.rstudio.com/html_document_format.html"><code>output: html_document</code></a> produces an HTML document. The nice feature of this document is that all images are embedded in the HTML file itself, so you can email just the <code>.html</code> file to someone and they will be able to open and read it.</p>
<div id="table-of-contents" class="section level3">
<h3>Table of contents</h3>
<p>Each output format has various options to customize the appearance of the final document. One option for HTML documents is to add a table of contents through the <code>toc</code> option. To add any option for an output format, just add it in a hierarchical format like this:</p>
<pre><code>---
title: &quot;Untitled&quot;
author: &quot;Benjamin Soltoff&quot;
date: &quot;February 1, 2017&quot;
output:
  html_document:
    toc: true
    toc_depth: 2</code></pre>
<p>You can explicitly set the number of levels included in the table of contents with <code>toc_depth</code> (the default is 3).</p>
</div>
<div id="appearance-and-style" class="section level3">
<h3>Appearance and style</h3>
<p>There are several options that control the visual appearance of HTML documents.</p>
<ul>
<li><code>theme</code> specifies the Bootstrap theme to use for the page (themes are drawn from the <a href="http://bootswatch.com/">Bootswatch</a> theme library). Valid themes include <code>&quot;default&quot;</code>, <code>&quot;cerulean&quot;</code>, <code>&quot;journal&quot;</code>, <code>&quot;flatly&quot;</code>, <code>&quot;readable&quot;</code>, <code>&quot;spacelab&quot;</code>, <code>&quot;united&quot;</code>, <code>&quot;cosmo&quot;</code>, <code>&quot;lumen&quot;</code>, <code>&quot;paper&quot;</code>, <code>&quot;sandstone&quot;</code>, <code>&quot;simplex&quot;</code>, and <code>&quot;yeti&quot;</code>.</li>
<li><code>highlight</code> specifies the syntax highlighting style for code chunks. Supported styles include <code>&quot;default&quot;</code>, <code>&quot;tango&quot;</code>, <code>&quot;pygments&quot;</code>, <code>&quot;kate&quot;</code>, <code>&quot;monochrome&quot;</code>, <code>&quot;espresso&quot;</code>, <code>&quot;zenburn&quot;</code>, <code>&quot;haddock&quot;</code>, and <code>&quot;textmate&quot;</code>.</li>
</ul>
<blockquote>
<p><a href="http://cfss.uchicago.edu">This course site</a> uses the <a href="http://rmarkdown.rstudio.com/rmarkdown_websites.html">R Markdown Websites</a> format to render multiple <code>.Rmd</code> documents in a single website. It uses the <code>readable</code> theme and <code>pygments</code> highlighting.</p>
</blockquote>
<pre><code>---
title: &quot;Untitled&quot;
author: &quot;Benjamin Soltoff&quot;
date: &quot;February 1, 2017&quot;
output:
  html_document:
    theme: readable
    highlight: pygments
---</code></pre>
</div>
<div id="code-folding" class="section level3">
<h3>Code folding</h3>
<p>Sometimes when knitting an R Markdown document you want to include your R source code (<code>echo = TRUE</code>) but you may want to include it but not make it visible by default. The <code>code_folding: hide</code> options allows you to include your R code but hide it. Users can then decide whether or not they want to see specific chunks or all chunks in the document. This strikes a good balance between readability and reproducibility.</p>
<pre><code>---
title: &quot;Untitled&quot;
author: &quot;Benjamin Soltoff&quot;
date: &quot;February 1, 2017&quot;
output:
  html_document:
    code_folding: hide
---</code></pre>
</div>
<div id="keeping-markdown" class="section level3">
<h3>Keeping Markdown</h3>
<p>When <code>knitr</code> processes your <code>.Rmd</code> document, it creates a Markdown (<code>.md</code>) file that is subsequently deleted. If you want to keep a copy of the Markdown file use the <code>keep_md</code> option:</p>
<pre><code>---
title: &quot;Untitled&quot;
author: &quot;Benjamin Soltoff&quot;
date: &quot;February 1, 2017&quot;
output:
  html_document:
    keep_md: true
---</code></pre>
</div>
<div id="exercise-test-html-options" class="section level3">
<h3>Exercise: test HTML options</h3>
<p>Use the <code>gun-deaths.Rmd</code> file you saved on your computer and test some of the document options outlined above. There are far more customization options than I outlined above. Read the <a href="http://rmarkdown.rstudio.com/html_document_format.html">help file for HTML documents</a> to learn about more of the available options.</p>
</div>
</div>
<div id="pdf-document" class="section level2">
<h2>PDF document</h2>
<p><a href="http://rmarkdown.rstudio.com/pdf_document_format.html"><code>pdf_document</code></a> converts the <code>.Rmd</code> file to a <span class="math inline">\(\LaTeX\)</span> file which is used to generate a PDF.</p>
<pre><code>---
title: &quot;Gun deaths&quot;
date: 2017-02-01
output: pdf_document
---</code></pre>
<p>You do need to have a full installation of TeX on your computer to generate PDF output. However the nice thing is that because it uses the <span class="math inline">\(\LaTeX\)</span> rendering engine, you can use raw <span class="math inline">\(\LaTeX\)</span> code in your <code>.Rmd</code> file (if you know how to use it).</p>
<div id="table-of-contents-1" class="section level3">
<h3>Table of contents</h3>
<p>Many options for HTML documents also work for PDFs. For instance, you create a table of contents the same way:</p>
<pre><code>---
title: &quot;Untitled&quot;
author: &quot;Benjamin Soltoff&quot;
date: &quot;February 1, 2017&quot;
output:
  pdf_document:
    toc: true
    toc_depth: 2</code></pre>
</div>
<div id="syntax-highlighting" class="section level3">
<h3>Syntax highlighting</h3>
<p>You cannot customize the <code>theme</code> of a <code>pdf_document</code> (at least not in the same way as HTML files), but you can still customize the syntax highlighting.</p>
<pre><code>---
title: &quot;Untitled&quot;
author: &quot;Benjamin Soltoff&quot;
date: &quot;February 1, 2017&quot;
output:
  pdf_document:
    highlight: pygments
---</code></pre>
</div>
<div id="latex-options" class="section level3">
<h3><span class="math inline">\(\LaTeX\)</span> options</h3>
<p>You can also directly control options in the <span class="math inline">\(\LaTeX\)</span> template itself via the YAML options. Note that these options are passed as top-level YAML metadata, not underneath the <code>output</code> section:</p>
<pre><code>---
title: &quot;Untitled&quot;
author: &quot;Benjamin Soltoff&quot;
date: &quot;February 1, 2017&quot;
output: pdf_document
fontsize: 11pt
geometry: margin=1in
---</code></pre>
</div>
<div id="keep-intermediate-tex" class="section level3">
<h3>Keep intermediate TeX</h3>
<p>R Markdown documents are converted first to a <code>.tex</code> file, and then use the <span class="math inline">\(\LaTeX\)</span> engine to convert to PDF. To keep the <code>.tex</code> file, use the <code>keep_tex</code> option:</p>
<pre><code>---
title: &quot;Untitled&quot;
author: &quot;Benjamin Soltoff&quot;
date: &quot;February 1, 2017&quot;
output:
  pdf_document:
    keep_tex: true
---</code></pre>
</div>
<div id="exercise-test-pdf-options" class="section level3">
<h3>Exercise: test PDF options</h3>
<p>Use the <code>gun-deaths.Rmd</code> file you saved on your computer and test some of the PDF document options outlined above. Be sure to first change the output format to <code>pdf_document</code>. There are far more customization options than I outlined above. Read the <a href="http://rmarkdown.rstudio.com/pdf_document_format.html">help file for PDF documents</a> to learn about more of the available options.</p>
</div>
</div>
<div id="presentations" class="section level2">
<h2>Presentations</h2>
<p>You can use R Markdown not only to generate full documents, but also slide presentations. There are four major presentation formats:</p>
<ul>
<li><a href="http://rmarkdown.rstudio.com/ioslides_presentation_format.html">ioslides</a> - HTML presentation with ioslides</li>
<li><a href="http://rmarkdown.rstudio.com/revealjs_presentation_format.html">reveal.js</a> - HTML presentation with reveal.js</li>
<li><a href="http://rmarkdown.rstudio.com/slidy_presentation_format.html">Slidy</a> - HTML presentation with W3C Slidy</li>
<li><a href="http://rmarkdown.rstudio.com/beamer_presentation_format.html">Beamer</a> - PDF presentation with <span class="math inline">\(\LaTeX\)</span> Beamer</li>
</ul>
<p>Each as their own strengths and weaknesses. ioslides and Slidy are probably the easiest to use initially, but are more difficult to customize. reveal.js is more complex, but allows for more customization (this is the format I use for my slides in this class). Beamer is the only presentation format that creates a PDF document and is probably a smoother transition for those already used to Beamer.</p>
<div id="exercise-build-a-presentation" class="section level3">
<h3>Exercise: build a presentation</h3>
<p>Choose one of the presentation formats and convert <code>gun-deaths.Rmd</code> into a slide presentation. Save this new document as <code>gun-deaths-slides.Rmd</code>. Test out some of the associated options for your chosen presentation format.</p>
</div>
</div>
<div id="multiple-formats" class="section level2">
<h2>Multiple formats</h2>
<p>You can even render your document into multiple output formats by supplying a list of formats:</p>
<pre><code>output:
  html_document:
    toc: true
    toc_float: true
  pdf_document: default</code></pre>
<p>If you don’t want to change any of the default options for a format, use the <code>default</code> option. You cannot specify multiple formats like this:</p>
<pre><code>output:
  html_document:
    toc: true
    toc_float: true
  pdf_document</code></pre>
<p>You <strong>must</strong> assign some value to the second output format, hence the use of <code>default</code>.</p>
<div id="rendering-multiple-outputs-programmatically" class="section level3">
<h3>Rendering multiple outputs programmatically</h3>
<p>When rendering multiple output formats, you cannot just click the “Knit” button. Doing so will only render the first output format listed in the YAML. To render all output formats, you need to programmatically render the document using <code>rmarkdown::render(&quot;my-document.Rmd&quot;, output_format = &quot;all&quot;)</code>. Type <code>?render</code> in the console to look up the help file for <code>render()</code> and see the different arguments the function can accept.</p>
</div>
<div id="exercise-render-in-multiple-formats" class="section level3">
<h3>Exercise: render in multiple formats</h3>
<p>Render <code>gun-deaths.Rmd</code> as both an HTML document and a PDF document. If you do not have <span class="math inline">\(\LaTeX\)</span> installed on your computer, render <code>gun-deaths.Rmd</code> as both an HTML document and a <a href="http://rmarkdown.rstudio.com/word_document_format.html">Word document</a>. And at some point <a href="https://www.latex-project.org/get/">install <span class="math inline">\(\LaTeX\)</span> on your computer</a> so you can create PDF documents.</p>
</div>
</div>
</div>
<div id="r-scripts" class="section level1">
<h1>R scripts</h1>
<p>So far we’ve done a lot of our work in R Markdown documents, knitting together code chunks, output, and Markdown text. However we don’t have to use R Markdown documents for all our work. In many instances, using a <strong>script</strong> might be preferable.</p>
<div id="what-is-a-script" class="section level2">
<h2>What is a script?</h2>
<p>A script is a plain-text file with a <code>.R</code> file extension. It contains R code. You can add comments using the <code>#</code> symbol. For example, <code>gun-deaths.R</code> would look something like this:</p>
<pre><code># gun-deaths.R
# 2017-02-01
# Examine the distribution of age of victims in gun_deaths


# load packages
library(tidyverse)
library(rcfss)

# filter data for under 65
youth &lt;- gun_deaths %&gt;%
  filter(age &lt;= 65)

# number of individuals under 65 killed
nrow(gun_deaths) - nrow(youth)

# graph the distribution of youth
youth %&gt;% 
  ggplot(aes(age)) + 
  geom_freqpoly(binwidth = 1)</code></pre>
<p>You edit scripts in the editor panel in R Studio.</p>
<div class="figure">
<img src="http://r4ds.had.co.nz/diagrams/rstudio-editor.png" />

</div>
</div>
<div id="when-to-use-a-script" class="section level2">
<h2>When to use a script?</h2>
<p><a href="http://r4ds.had.co.nz/r-markdown.html#troubleshooting">Scripts are much easier to troubleshoot than R Markdown documents</a> because your code is not split across chunks and you can run everything interactively. When you first begin a project, you may find it useful to use scripts initially to build and debug code, then convert it to an R Markdown document once you begin the substantive analysis and writeup. Or you may use a mix of scripts and R Markdown documents depending on the size and complexity of your project. For instance, you could use a <strong>reproducible pipeline</strong> which uses a sequence of R scripts to download, import, and transform your data, then use an R Markdown document to produce a final report.</p>
<blockquote>
<p>Check out <a href="https://github.com/uc-cfss/pipeline-example">this example</a> for how one could use a pipeline in this fashion.</p>
</blockquote>
<p>In this class while the final product is generally submitted as an R Markdown document, <strong>it is fine to do your initial work in an R script.</strong> If you find it easier to write and debug code there, then use that approach. Or if you prefer the <a href="http://r4ds.had.co.nz/r-markdown-workflow.html">R Markdown lab notebook workflow</a>, then use that. By this point you have enough competence in R to decide what works for you and what does not. <strong>Find what works best for you and do that.</strong></p>
</div>
<div id="running-scripts-interactively" class="section level2">
<h2>Running scripts interactively</h2>
<p>You can run sections of your script by highlighting the appropriate code and typing Cmd/Ctrl + Enter. You can also run code expression-by-expression by placing your cursor at the appropriate expression in the script and typing Cmd/Ctrl + Enter. To run the entire script at once, type Cmd/Ctrl + Shift + S or press “Run” at the top of the script editor panel.</p>
</div>
<div id="running-scripts-programmatically" class="section level2">
<h2>Running scripts programmatically</h2>
<p>To run a script saved on your computer, use the <code>source()</code> function in the console. As in <code>source(&quot;gun-deaths.R&quot;)</code>. You can also include this command in a second script. By doing this you can execute a sequence of related scripts all in order, rather than having to run each one manually in the console. See <a href="https://github.com/uc-cfss/pipeline-example/blob/master/runfile.R"><code>runfile.R</code></a> from the <code>pipeline-example</code> repo to see this in action. Remember that R scripts (<code>.R</code>) are executed via the <code>source()</code> function, whereas R Markdown files (<code>.Rmd</code>) are executed via the <code>rmarkdown::render()</code> function.</p>
<blockquote>
<p>Want to create a report from an R script? Just call <code>rmarkdown::render(&quot;gun-deaths.R&quot;)</code> to author an R Markdown document based on the R script. It will never be as fully featured as if you originally wrote it in an R Markdown document, but can sometimes be handy. Read <a href="http://rmarkdown.rstudio.com/articles_report_from_r_script.html">this overview</a> for more details on this procedure.</p>
</blockquote>
</div>
<div id="running-scripts-via-the-shell" class="section level2">
<h2>Running scripts via the shell</h2>
<p>You can also run scripts directly from the <a href="shell.html">shell</a> using <code>Rscript</code>:</p>
<div class="sourceCode"><pre class="sourceCode bash"><code class="sourceCode bash"><span class="ex">Rscript</span> gun-deaths.R</code></pre></div>
<p>To render an R Markdown document from the shell, we use the syntax:</p>
<div class="sourceCode"><pre class="sourceCode bash"><code class="sourceCode bash"><span class="ex">Rscript</span> -e <span class="st">&quot;rmarkdown::render(&#39;gun-deaths.Rmd&#39;)&quot;</span></code></pre></div>
<p>This creates a temporary R script which contains the single command <code>rmarkdown::render('gun-deaths.Rmd')</code> and executes it via <code>Rscript</code>.</p>
</div>
<div id="exercise-execute-r-scripts" class="section level2">
<h2>Exercise: execute R scripts</h2>
<ol style="list-style-type: decimal">
<li>Convert your revised <code>gun-deaths.Rmd</code> document into an R script called <code>gun-deaths.R</code>.</li>
<li>Practice running segments of code interactively</li>
<li>Run the entire script via the <code>source()</code> function</li>
<li>Use the shell to run <code>gun-deaths.R</code></li>
</ol>
</div>
</div>
<div id="session-info" class="section level1 toc-ignore">
<h1>Session Info</h1>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">devtools<span class="op">::</span><span class="kw">session_info</span>()</code></pre></div>
<pre><code>## Session info -------------------------------------------------------------</code></pre>
<pre><code>##  setting  value                       
##  version  R version 3.4.1 (2017-06-30)
##  system   x86_64, darwin15.6.0        
##  ui       X11                         
##  language (EN)                        
##  collate  en_US.UTF-8                 
##  tz       America/Chicago             
##  date     2017-08-08</code></pre>
<pre><code>## Packages -----------------------------------------------------------------</code></pre>
<pre><code>##  package    * version    date       source                              
##  assertthat   0.2.0      2017-04-11 CRAN (R 3.4.0)                      
##  backports    1.1.0      2017-05-22 CRAN (R 3.4.0)                      
##  base       * 3.4.1      2017-07-07 local                               
##  bindr        0.1        2016-11-13 CRAN (R 3.4.0)                      
##  bindrcpp     0.2        2017-06-17 CRAN (R 3.4.0)                      
##  boxes        0.0.0.9000 2017-07-19 Github (r-pkgs/boxes@03098dc)       
##  broom        0.4.2      2017-02-13 CRAN (R 3.4.0)                      
##  cellranger   1.1.0      2016-07-27 CRAN (R 3.4.0)                      
##  clisymbols   1.2.0      2017-05-21 cran (@1.2.0)                       
##  colorspace   1.3-2      2016-12-14 CRAN (R 3.4.0)                      
##  compiler     3.4.1      2017-07-07 local                               
##  crayon       1.3.2.9000 2017-07-19 Github (gaborcsardi/crayon@750190f) 
##  datasets   * 3.4.1      2017-07-07 local                               
##  devtools     1.13.2     2017-06-02 CRAN (R 3.4.0)                      
##  digest       0.6.12     2017-01-27 CRAN (R 3.4.0)                      
##  dplyr      * 0.7.2      2017-07-20 CRAN (R 3.4.1)                      
##  evaluate     0.10.1     2017-06-24 CRAN (R 3.4.1)                      
##  forcats    * 0.2.0      2017-01-23 CRAN (R 3.4.0)                      
##  foreign      0.8-69     2017-06-22 CRAN (R 3.4.1)                      
##  ggplot2    * 2.2.1      2016-12-30 CRAN (R 3.4.0)                      
##  glue         1.1.1      2017-06-21 CRAN (R 3.4.1)                      
##  graphics   * 3.4.1      2017-07-07 local                               
##  grDevices  * 3.4.1      2017-07-07 local                               
##  grid         3.4.1      2017-07-07 local                               
##  gtable       0.2.0      2016-02-26 CRAN (R 3.4.0)                      
##  haven        1.1.0      2017-07-09 CRAN (R 3.4.1)                      
##  hms          0.3        2016-11-22 CRAN (R 3.4.0)                      
##  htmltools    0.3.6      2017-04-28 CRAN (R 3.4.0)                      
##  httr         1.2.1      2016-07-03 CRAN (R 3.4.0)                      
##  jsonlite     1.5        2017-06-01 CRAN (R 3.4.0)                      
##  knitr        1.16       2017-05-18 CRAN (R 3.4.0)                      
##  lattice      0.20-35    2017-03-25 CRAN (R 3.4.1)                      
##  lazyeval     0.2.0      2016-06-12 CRAN (R 3.4.0)                      
##  lubridate    1.6.0      2016-09-13 CRAN (R 3.4.0)                      
##  magrittr     1.5        2014-11-22 CRAN (R 3.4.0)                      
##  memoise      1.1.0      2017-04-21 CRAN (R 3.4.0)                      
##  methods    * 3.4.1      2017-07-07 local                               
##  mnormt       1.5-5      2016-10-15 CRAN (R 3.4.0)                      
##  modelr       0.1.1      2017-07-24 CRAN (R 3.4.1)                      
##  munsell      0.4.3      2016-02-13 CRAN (R 3.4.0)                      
##  nlme         3.1-131    2017-02-06 CRAN (R 3.4.1)                      
##  parallel     3.4.1      2017-07-07 local                               
##  pkgconfig    2.0.1      2017-03-21 CRAN (R 3.4.0)                      
##  plyr         1.8.4      2016-06-08 CRAN (R 3.4.0)                      
##  psych        1.7.5      2017-05-03 CRAN (R 3.4.1)                      
##  purrr      * 0.2.2.2    2017-05-11 CRAN (R 3.4.0)                      
##  R6           2.2.2      2017-06-17 CRAN (R 3.4.0)                      
##  rcfss      * 0.1.5      2017-07-31 local                               
##  Rcpp         0.12.12    2017-07-15 CRAN (R 3.4.1)                      
##  readr      * 1.1.1      2017-05-16 CRAN (R 3.4.0)                      
##  readxl       1.0.0      2017-04-18 CRAN (R 3.4.0)                      
##  reshape2     1.4.2      2016-10-22 CRAN (R 3.4.0)                      
##  rlang        0.1.1      2017-05-18 CRAN (R 3.4.0)                      
##  rmarkdown    1.6        2017-06-15 CRAN (R 3.4.0)                      
##  rprojroot    1.2        2017-01-16 CRAN (R 3.4.0)                      
##  rstudioapi   0.6        2016-06-27 CRAN (R 3.4.0)                      
##  rvest        0.3.2      2016-06-17 CRAN (R 3.4.0)                      
##  scales       0.4.1      2016-11-09 CRAN (R 3.4.0)                      
##  stats      * 3.4.1      2017-07-07 local                               
##  stringi      1.1.5      2017-04-07 CRAN (R 3.4.0)                      
##  stringr    * 1.2.0      2017-02-18 CRAN (R 3.4.0)                      
##  tibble     * 1.3.3      2017-05-28 CRAN (R 3.4.0)                      
##  tidyr      * 0.6.3      2017-05-15 CRAN (R 3.4.0)                      
##  tidyverse  * 1.1.1.9000 2017-07-19 Github (tidyverse/tidyverse@a028619)
##  tools        3.4.1      2017-07-07 local                               
##  utils      * 3.4.1      2017-07-07 local                               
##  withr        2.0.0      2017-07-28 CRAN (R 3.4.1)                      
##  xml2         1.1.1      2017-01-24 CRAN (R 3.4.0)                      
##  yaml         2.1.14     2016-11-12 CRAN (R 3.4.0)</code></pre>
</div>
<div class="footnotes">
<hr />
<ol>
<li id="fn1"><p><a href="https://www.coursera.org/learn/reproducible-research">Coursera: Reproducible Research</a><a href="#fnref1">↩</a></p></li>
</ol>
</div>

<p>This work is licensed under the  <a href="http://creativecommons.org/licenses/by-nc/4.0/">CC BY-NC 4.0 Creative Commons License</a>.</p>


</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
