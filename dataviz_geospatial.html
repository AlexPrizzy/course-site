<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />




<title>Geospatial visualization</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/readable.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-45631879-2', 'auto');
  ga('send', 'pageview');

</script>


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>


<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>


</head>

<body>

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
button.code-folding-btn:focus {
  outline: none;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 66px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 71px;
  margin-top: -71px;
}

.section h2 {
  padding-top: 71px;
  margin-top: -71px;
}
.section h3 {
  padding-top: 71px;
  margin-top: -71px;
}
.section h4 {
  padding-top: 71px;
  margin-top: -71px;
}
.section h5 {
  padding-top: 71px;
  margin-top: -71px;
}
.section h6 {
  padding-top: 71px;
  margin-top: -71px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>


<div class="container-fluid main-container">

<!-- tabsets -->
<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});
</script>

<!-- code folding -->




<script>
$(document).ready(function ()  {

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_').toLowerCase();
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}


.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
  padding-left: 25px;
  text-indent: 0;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>

<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row-fluid">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Computing for the Social Sciences</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">Home</a>
</li>
<li>
  <a href="faq.html">FAQ</a>
</li>
<li>
  <a href="syllabus.html">Syllabus</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">Geospatial visualization</h1>

</div>


<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(tidyverse)
<span class="kw">library</span>(knitr)
<span class="kw">library</span>(broom)
<span class="kw">library</span>(stringr)
<span class="kw">library</span>(modelr)
<span class="kw">library</span>(forcats)
<span class="kw">library</span>(ggmap)

<span class="kw">options</span>(<span class="dt">digits =</span> <span class="dv">3</span>)
<span class="kw">set.seed</span>(<span class="dv">1234</span>)
<span class="kw">theme_set</span>(<span class="kw">theme_minimal</span>())</code></pre></div>
<div id="geospatial-visualization" class="section level1">
<h1>Geospatial visualization</h1>
<p>Geospatial visualizations are some of the oldest data visualization methods in human existence. Data maps were first popularized in the seventeenth century and have grown in complexity and detail since then. Consider <a href="https://www.google.com/maps">Google Maps</a>, the sheer volume of data depicted, and the analytical pathways available to its users.</p>
<p>Geometric visualizations are used to depict spatial features, and with the incorporation of data reveal additional attributes and information. The main features of a map are defined by its <strong>scale</strong> (the proportion between distances and sizes on the map), its <strong>projection</strong> (how the three-dimensional Earth is represented on a two-dimensional surface), and its <strong>symbols</strong> (how data is depicted and visualized on the map).</p>
</div>
<div id="map-boundaries" class="section level1">
<h1>Map boundaries</h1>
<p>Drawing maps in R is a layer-like process. Typically you start by drawing the boundaries of the geographic regions you wish to visualize, then you add additional layers defined by other variables:</p>
<ul>
<li>Points</li>
<li>Symbols</li>
<li>Fills (choropleths)</li>
</ul>
<p>Let’s start by first drawing a map’s boundaries. Later on we will fill these in with data and turn them into data visualizations.</p>
<div id="storing-map-boundaries" class="section level2">
<h2>Storing map boundaries</h2>
<p>A <strong>geographic information system</strong> (GIS) is software that is “designed to capture, store, manipulate, analyze, manage, and present spatial or geographic data”.<a href="#fn1" class="footnoteRef" id="fnref1"><sup>1</sup></a> There are many specialized software packages for spatial data analysis, many of which are commercial or proprietary software. For serious spatial data analysis tasks, you probably want to learn how to use these products. However for casual usage, R has a number of tools for drawing maps, most importantly <code>ggplot2</code>.</p>
</div>
<div id="using-maps-boundaries" class="section level2">
<h2>Using <code>maps</code> boundaries</h2>
<p>The <code>maps</code> package includes the <code>map()</code> function for drawing maps based on bundled geodatabases using the <code>graphics</code> package:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(maps)

<span class="co"># map of the world</span>
<span class="kw">map</span>()</code></pre></div>
<p><img src="dataviz_geospatial_files/figure-html/maps-1.png" width="672" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># usa boundaries</span>
<span class="kw">map</span>(<span class="st">&quot;usa&quot;</span>)</code></pre></div>
<p><img src="dataviz_geospatial_files/figure-html/maps-2.png" width="672" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">map</span>(<span class="st">&quot;state&quot;</span>)</code></pre></div>
<p><img src="dataviz_geospatial_files/figure-html/maps-3.png" width="672" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># county map of illinois</span>
<span class="kw">map</span>(<span class="st">&quot;county&quot;</span>, <span class="st">&quot;illinois&quot;</span>)</code></pre></div>
<p><img src="dataviz_geospatial_files/figure-html/maps-4.png" width="672" /></p>
<p>These are fine, but we’d rather use them with our friendly <code>ggplot2</code> library. We can do this by converting the geodatabases into data frames for plotting with <code>ggplot2</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># map of the world</span>
<span class="kw">map_data</span>(<span class="st">&quot;world&quot;</span>) <span class="op">%&gt;%</span>
<span class="st">  </span>as_tibble</code></pre></div>
<pre><code>## # A tibble: 99,338 x 6
##     long   lat group order region subregion
##  * &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt;  &lt;chr&gt;     &lt;chr&gt;
##  1 -69.9  12.5     1     1  Aruba      &lt;NA&gt;
##  2 -69.9  12.4     1     2  Aruba      &lt;NA&gt;
##  3 -69.9  12.4     1     3  Aruba      &lt;NA&gt;
##  4 -70.0  12.5     1     4  Aruba      &lt;NA&gt;
##  5 -70.1  12.5     1     5  Aruba      &lt;NA&gt;
##  6 -70.1  12.6     1     6  Aruba      &lt;NA&gt;
##  7 -70.0  12.6     1     7  Aruba      &lt;NA&gt;
##  8 -70.0  12.6     1     8  Aruba      &lt;NA&gt;
##  9 -69.9  12.5     1     9  Aruba      &lt;NA&gt;
## 10 -69.9  12.5     1    10  Aruba      &lt;NA&gt;
## # ... with 99,328 more rows</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># usa boundaries</span>
<span class="kw">map_data</span>(<span class="st">&quot;usa&quot;</span>) <span class="op">%&gt;%</span>
<span class="st">  </span>as_tibble</code></pre></div>
<pre><code>## # A tibble: 7,243 x 6
##     long   lat group order region subregion
##  * &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt;  &lt;chr&gt;     &lt;chr&gt;
##  1  -101  29.7     1     1   main      &lt;NA&gt;
##  2  -101  29.7     1     2   main      &lt;NA&gt;
##  3  -101  29.7     1     3   main      &lt;NA&gt;
##  4  -101  29.6     1     4   main      &lt;NA&gt;
##  5  -101  29.6     1     5   main      &lt;NA&gt;
##  6  -101  29.6     1     6   main      &lt;NA&gt;
##  7  -101  29.6     1     7   main      &lt;NA&gt;
##  8  -101  29.6     1     8   main      &lt;NA&gt;
##  9  -101  29.6     1     9   main      &lt;NA&gt;
## 10  -101  29.6     1    10   main      &lt;NA&gt;
## # ... with 7,233 more rows</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">map_data</span>(<span class="st">&quot;state&quot;</span>) <span class="op">%&gt;%</span>
<span class="st">  </span>as_tibble</code></pre></div>
<pre><code>## # A tibble: 15,537 x 6
##     long   lat group order  region subregion
##  * &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt;   &lt;chr&gt;     &lt;chr&gt;
##  1 -87.5  30.4     1     1 alabama      &lt;NA&gt;
##  2 -87.5  30.4     1     2 alabama      &lt;NA&gt;
##  3 -87.5  30.4     1     3 alabama      &lt;NA&gt;
##  4 -87.5  30.3     1     4 alabama      &lt;NA&gt;
##  5 -87.6  30.3     1     5 alabama      &lt;NA&gt;
##  6 -87.6  30.3     1     6 alabama      &lt;NA&gt;
##  7 -87.6  30.3     1     7 alabama      &lt;NA&gt;
##  8 -87.6  30.3     1     8 alabama      &lt;NA&gt;
##  9 -87.7  30.3     1     9 alabama      &lt;NA&gt;
## 10 -87.8  30.3     1    10 alabama      &lt;NA&gt;
## # ... with 15,527 more rows</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># county map of illinois</span>
<span class="kw">map_data</span>(<span class="st">&quot;county&quot;</span>, <span class="st">&quot;illinois&quot;</span>) <span class="op">%&gt;%</span>
<span class="st">  </span>as_tibble</code></pre></div>
<pre><code>## # A tibble: 1,697 x 6
##     long   lat group order   region subregion
##  * &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt;    &lt;chr&gt;     &lt;chr&gt;
##  1 -91.5  40.2     1     1 illinois     adams
##  2 -90.9  40.2     1     2 illinois     adams
##  3 -90.9  40.2     1     3 illinois     adams
##  4 -90.9  40.1     1     4 illinois     adams
##  5 -90.9  39.8     1     5 illinois     adams
##  6 -90.9  39.8     1     6 illinois     adams
##  7 -91.4  39.8     1     7 illinois     adams
##  8 -91.4  39.8     1     8 illinois     adams
##  9 -91.4  39.9     1     9 illinois     adams
## 10 -91.5  39.9     1    10 illinois     adams
## # ... with 1,687 more rows</code></pre>
<p><code>map_data()</code> converts the geodatabases into data frames where each row is a single point on the map. The resulting data frame contains the following variables:</p>
<ul>
<li><code>long</code> - longitude. Things to the west of the prime meridian are negative</li>
<li><code>lat</code> - latitude</li>
<li><code>order</code> - this identifies the order <code>ggplot()</code> should follow to “connect the dots” and draw the borders</li>
<li><code>region</code> and <code>subregion</code> identify what region or subregion a set of points surrounds</li>
<li><p><code>group</code> - this is perhaps the most important variable in the data frame. <code>ggplot()</code> uses the <code>group</code> aesthetic to determine whether adjacent points should be connected by a line. If they are in the same group, then the points are connected. If not, then they are not connected. This is the same basic principle for standard <code>geom_line()</code> plots:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(gapminder)

<span class="co"># no group aesthetic</span>
<span class="kw">ggplot</span>(gapminder, <span class="kw">aes</span>(year, lifeExp)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_line</span>()</code></pre></div>
<p><img src="dataviz_geospatial_files/figure-html/group-1.png" width="672" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># with grouping by country</span>
<span class="kw">ggplot</span>(gapminder, <span class="kw">aes</span>(year, lifeExp, <span class="dt">group =</span> country)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_line</span>()</code></pre></div>
<p><img src="dataviz_geospatial_files/figure-html/group-2.png" width="672" /></p>
<p>Note that <code>group</code> is not the same thing as <code>region</code> or <code>subregion</code>. If a region contains landmasses that are discontiguous, there should be multiple groups to properly draw the region:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">map</span>(<span class="st">&quot;state&quot;</span>, <span class="st">&quot;michigan&quot;</span>)</code></pre></div>
<p><img src="dataviz_geospatial_files/figure-html/michigan-1.png" width="672" /></p></li>
</ul>
<div id="drawing-the-united-states" class="section level3">
<h3>Drawing the United States</h3>
<p>Let’s draw a map of the United States. First we need to store the USA map boundaries in a data frame:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">usa &lt;-<span class="st"> </span><span class="kw">as_tibble</span>(<span class="kw">map_data</span>(<span class="st">&quot;usa&quot;</span>))
usa</code></pre></div>
<pre><code>## # A tibble: 7,243 x 6
##     long   lat group order region subregion
##  * &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt;  &lt;chr&gt;     &lt;chr&gt;
##  1  -101  29.7     1     1   main      &lt;NA&gt;
##  2  -101  29.7     1     2   main      &lt;NA&gt;
##  3  -101  29.7     1     3   main      &lt;NA&gt;
##  4  -101  29.6     1     4   main      &lt;NA&gt;
##  5  -101  29.6     1     5   main      &lt;NA&gt;
##  6  -101  29.6     1     6   main      &lt;NA&gt;
##  7  -101  29.6     1     7   main      &lt;NA&gt;
##  8  -101  29.6     1     8   main      &lt;NA&gt;
##  9  -101  29.6     1     9   main      &lt;NA&gt;
## 10  -101  29.6     1    10   main      &lt;NA&gt;
## # ... with 7,233 more rows</code></pre>
<div id="simple-black-map" class="section level4">
<h4>Simple black map</h4>
<ul>
<li>We can use <code>geom_polygon()</code> to draw lines between points and close them up (connect the last point with the first point)</li>
<li><code>x = long</code> and <code>y = lat</code></li>
<li>We map the <code>group</code> aesthetic to the <code>group</code> column</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_polygon</span>(<span class="dt">data =</span> usa, <span class="kw">aes</span>(<span class="dt">x =</span> long, <span class="dt">y =</span> lat, <span class="dt">group =</span> group))</code></pre></div>
<p><img src="dataviz_geospatial_files/figure-html/usa-map-1.png" width="672" /></p>
<p>Ta-da! A few things we want to immediately start thinking about. First, because latitude and longitude have absolute relations to one another, we need to fix the aspect ratio so that we don’t accidentially compress the graph in one dimension. Fixing the aspect ratio also means that even if you change the outer dimensions of the graph (i.e. adjust the window size), then the aspect ratio of the graph itself remains unchanged. We can do this using the <code>coord_fixed()</code> function:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_polygon</span>(<span class="dt">data =</span> usa, <span class="kw">aes</span>(<span class="dt">x =</span> long, <span class="dt">y =</span> lat, <span class="dt">group =</span> group)) <span class="op">+</span>
<span class="st">  </span><span class="kw">coord_fixed</span>()</code></pre></div>
<p><img src="dataviz_geospatial_files/figure-html/coord-fixed-1.png" width="672" /></p>
<p>Now it looks a little squished. You can play around with the aspect ratio to find a better projection:<a href="#fn2" class="footnoteRef" id="fnref2"><sup>2</sup></a></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_polygon</span>(<span class="dt">data =</span> usa, <span class="kw">aes</span>(<span class="dt">x =</span> long, <span class="dt">y =</span> lat, <span class="dt">group =</span> group)) <span class="op">+</span>
<span class="st">  </span><span class="kw">coord_fixed</span>(<span class="fl">1.3</span>)</code></pre></div>
<p><img src="dataviz_geospatial_files/figure-html/coord-fixed-13-1.png" width="672" /></p>
</div>
<div id="change-the-colors" class="section level4">
<h4>Change the colors</h4>
<p>Since this is a <code>ggplot()</code> object, we can change the fill and color aesthetics for the map:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_polygon</span>(<span class="dt">data =</span> usa, <span class="kw">aes</span>(<span class="dt">x =</span> long, <span class="dt">y =</span> lat, <span class="dt">group =</span> group),
               <span class="dt">fill =</span> <span class="ot">NA</span>, <span class="dt">color =</span> <span class="st">&quot;red&quot;</span>) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">coord_fixed</span>(<span class="fl">1.3</span>)</code></pre></div>
<p><img src="dataviz_geospatial_files/figure-html/fill-color-1.png" width="672" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">gg1 &lt;-<span class="st"> </span><span class="kw">ggplot</span>() <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_polygon</span>(<span class="dt">data =</span> usa, <span class="kw">aes</span>(<span class="dt">x =</span> long, <span class="dt">y =</span> lat, <span class="dt">group =</span> group),
               <span class="dt">fill =</span> <span class="st">&quot;violet&quot;</span>, <span class="dt">color =</span> <span class="st">&quot;blue&quot;</span>) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">coord_fixed</span>(<span class="fl">1.3</span>)
gg1</code></pre></div>
<p><img src="dataviz_geospatial_files/figure-html/fill-color-2.png" width="672" /></p>
</div>
<div id="always-remember-to-use-the-group-aesthetic" class="section level4">
<h4>Always remember to use the group aesthetic</h4>
<p>What happens if we plot the map without the group aesthetic?</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>() <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_polygon</span>(<span class="dt">data =</span> usa, <span class="kw">aes</span>(<span class="dt">x =</span> long, <span class="dt">y =</span> lat),
               <span class="dt">fill =</span> <span class="st">&quot;violet&quot;</span>, <span class="dt">color =</span> <span class="st">&quot;blue&quot;</span>) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">coord_fixed</span>(<span class="fl">1.3</span>)</code></pre></div>
<p><img src="dataviz_geospatial_files/figure-html/no-group-1.png" width="672" /></p>
<p>Oops. The map doesn’t connect the dots in the correct order.</p>
</div>
</div>
<div id="state-maps" class="section level3">
<h3>State maps</h3>
<p><code>maps</code> also comes with a state boundaries geodatabase:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">states &lt;-<span class="st"> </span><span class="kw">as_tibble</span>(<span class="kw">map_data</span>(<span class="st">&quot;state&quot;</span>))
states</code></pre></div>
<pre><code>## # A tibble: 15,537 x 6
##     long   lat group order  region subregion
##  * &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt;   &lt;chr&gt;     &lt;chr&gt;
##  1 -87.5  30.4     1     1 alabama      &lt;NA&gt;
##  2 -87.5  30.4     1     2 alabama      &lt;NA&gt;
##  3 -87.5  30.4     1     3 alabama      &lt;NA&gt;
##  4 -87.5  30.3     1     4 alabama      &lt;NA&gt;
##  5 -87.6  30.3     1     5 alabama      &lt;NA&gt;
##  6 -87.6  30.3     1     6 alabama      &lt;NA&gt;
##  7 -87.6  30.3     1     7 alabama      &lt;NA&gt;
##  8 -87.6  30.3     1     8 alabama      &lt;NA&gt;
##  9 -87.7  30.3     1     9 alabama      &lt;NA&gt;
## 10 -87.8  30.3     1    10 alabama      &lt;NA&gt;
## # ... with 15,527 more rows</code></pre>
<p>By default, each state is filled with the same color:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(<span class="dt">data =</span> states) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_polygon</span>(<span class="kw">aes</span>(<span class="dt">x =</span> long, <span class="dt">y =</span> lat, <span class="dt">group =</span> group), <span class="dt">color =</span> <span class="st">&quot;white&quot;</span>) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">coord_fixed</span>(<span class="fl">1.3</span>)</code></pre></div>
<p><img src="dataviz_geospatial_files/figure-html/states-no-fill-1.png" width="672" /></p>
<p>We can adjust this by using the <code>fill</code> aesthetic. Here, let’s map <code>region</code> to fill:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(<span class="dt">data =</span> states) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_polygon</span>(<span class="kw">aes</span>(<span class="dt">x =</span> long, <span class="dt">y =</span> lat, <span class="dt">fill =</span> region, <span class="dt">group =</span> group), <span class="dt">color =</span> <span class="st">&quot;white&quot;</span>) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">coord_fixed</span>(<span class="fl">1.3</span>) <span class="op">+</span>
<span class="st">  </span><span class="co"># turn off color legend</span>
<span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">&quot;none&quot;</span>)</code></pre></div>
<p><img src="dataviz_geospatial_files/figure-html/states-fill-1.png" width="672" /></p>
<p>Here, each state is assigned a different color at random. You can start to imagine how we might build a choropleth by mapping a different variable to <code>fill</code>, but we’ll return to that in a little bit.</p>
<div id="plot-a-subset-of-states" class="section level4">
<h4>Plot a subset of states</h4>
<p>We can use <code>filter()</code> to subset the <code>states</code> data frame and draw a map with only a subset of the states. For example, if we want to only graph states in the Midwest:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">midwest &lt;-<span class="st"> </span><span class="kw">filter</span>(states,
                  region <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;illinois&quot;</span>, <span class="st">&quot;indiana&quot;</span>, <span class="st">&quot;iowa&quot;</span>,
                                <span class="st">&quot;kansas&quot;</span>, <span class="st">&quot;michigan&quot;</span>, <span class="st">&quot;minnesota&quot;</span>,
                                <span class="st">&quot;missouri&quot;</span>, <span class="st">&quot;nebraska&quot;</span>, <span class="st">&quot;north dakota&quot;</span>,
                                <span class="st">&quot;ohio&quot;</span>, <span class="st">&quot;south dakota&quot;</span>, <span class="st">&quot;wisconsin&quot;</span>))

<span class="kw">ggplot</span>(<span class="dt">data =</span> midwest) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_polygon</span>(<span class="kw">aes</span>(<span class="dt">x =</span> long, <span class="dt">y =</span> lat, <span class="dt">group =</span> group),
               <span class="dt">fill =</span> <span class="st">&quot;palegreen&quot;</span>, <span class="dt">color =</span> <span class="st">&quot;black&quot;</span>) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">coord_fixed</span>(<span class="fl">1.3</span>)</code></pre></div>
<p><img src="dataviz_geospatial_files/figure-html/midwest-1.png" width="672" /></p>
</div>
<div id="zoom-in-on-illinois-and-its-counties" class="section level4">
<h4>Zoom in on Illinois and its counties</h4>
<p>First let’s get the Illinois boundaries:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">il_df &lt;-<span class="st"> </span><span class="kw">filter</span>(states, region <span class="op">==</span><span class="st"> &quot;illinois&quot;</span>)</code></pre></div>
<p>Now let’s get the accompanying counties:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">counties &lt;-<span class="st"> </span><span class="kw">as_tibble</span>(<span class="kw">map_data</span>(<span class="st">&quot;county&quot;</span>))
il_county &lt;-<span class="st"> </span><span class="kw">filter</span>(counties, region <span class="op">==</span><span class="st"> &quot;illinois&quot;</span>)
il_county</code></pre></div>
<pre><code>## # A tibble: 1,696 x 6
##     long   lat group order   region subregion
##    &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt;    &lt;chr&gt;     &lt;chr&gt;
##  1 -91.5  40.2   561 21883 illinois     adams
##  2 -90.9  40.2   561 21884 illinois     adams
##  3 -90.9  40.1   561 21885 illinois     adams
##  4 -90.9  39.8   561 21886 illinois     adams
##  5 -90.9  39.8   561 21887 illinois     adams
##  6 -91.4  39.8   561 21888 illinois     adams
##  7 -91.4  39.8   561 21889 illinois     adams
##  8 -91.4  39.9   561 21890 illinois     adams
##  9 -91.5  39.9   561 21891 illinois     adams
## 10 -91.4  39.9   561 21892 illinois     adams
## # ... with 1,686 more rows</code></pre>
<p>Plot the state first. This time, lets’ remove all the axes gridlines and background junk using <code>theme_void()</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">il_base &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> il_df,
                  <span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> long, <span class="dt">y =</span> lat, <span class="dt">group =</span> group)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">coord_fixed</span>(<span class="fl">1.3</span>) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_polygon</span>(<span class="dt">color =</span> <span class="st">&quot;black&quot;</span>, <span class="dt">fill =</span> <span class="st">&quot;gray&quot;</span>)

il_base <span class="op">+</span>
<span class="st">  </span><span class="kw">theme_void</span>()</code></pre></div>
<p><img src="dataviz_geospatial_files/figure-html/il-map-1.png" width="672" /></p>
<p>Now let’s plot the county boundaries in white:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">il_base <span class="op">+</span>
<span class="st">  </span><span class="kw">theme_void</span>() <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_polygon</span>(<span class="dt">data =</span> il_county, <span class="dt">fill =</span> <span class="ot">NA</span>, <span class="dt">color =</span> <span class="st">&quot;white&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="co"># get the state border back on top</span>
<span class="st">  </span><span class="kw">geom_polygon</span>(<span class="dt">color =</span> <span class="st">&quot;black&quot;</span>, <span class="dt">fill =</span> <span class="ot">NA</span>)</code></pre></div>
<p><img src="dataviz_geospatial_files/figure-html/il-county-plot-1.png" width="672" /></p>
</div>
</div>
<div id="but-what-about-alaska-and-hawaii" class="section level3">
<h3>But what about Alaska and Hawaii?</h3>
<p>If you were observant, you noticed <code>map_data(&quot;states&quot;)</code> only includes the 48 contiguous states in the United States. This is because Alaska and Hawaii exist far off from the rest of the states. What happens if you try to draw a map with them in it?</p>
<p><img src="dataviz_geospatial_files/figure-html/all-50-1.png" width="672" /></p>
<p>Yup, that doesn’t look right. Most maps of the United States place Alaska and Hawaii as <strong>insets</strong> to the south of California. Until recently, in R this was an extremely tedious task that required manually changing the latitude and longitude coordinates for these states to place them in the correct location. Fortunately a new package is available that has already done the work for you. <a href="https://cran.r-project.org/web/packages/fiftystater/vignettes/fiftystater.html"><code>fiftystater</code></a> includes the <code>fifty_states</code> data frame which contains adjusted coordinates for Alaska and Hawaii to plot them with the mainland:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(fiftystater)

<span class="kw">data</span>(<span class="st">&quot;fifty_states&quot;</span>)
<span class="kw">as_tibble</span>(fifty_states)</code></pre></div>
<pre><code>## # A tibble: 13,694 x 7
##     long   lat order  hole  piece      id     group
##    &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt; &lt;lgl&gt; &lt;fctr&gt;   &lt;chr&gt;    &lt;fctr&gt;
##  1 -85.1  32.0     1 FALSE      1 alabama Alabama.1
##  2 -85.1  31.9     2 FALSE      1 alabama Alabama.1
##  3 -85.1  31.9     3 FALSE      1 alabama Alabama.1
##  4 -85.1  31.8     4 FALSE      1 alabama Alabama.1
##  5 -85.1  31.8     5 FALSE      1 alabama Alabama.1
##  6 -85.1  31.7     6 FALSE      1 alabama Alabama.1
##  7 -85.1  31.7     7 FALSE      1 alabama Alabama.1
##  8 -85.1  31.7     8 FALSE      1 alabama Alabama.1
##  9 -85.1  31.6     9 FALSE      1 alabama Alabama.1
## 10 -85.0  31.6    10 FALSE      1 alabama Alabama.1
## # ... with 13,684 more rows</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(<span class="dt">data =</span> fifty_states, <span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> long, <span class="dt">y =</span> lat, <span class="dt">group =</span> group)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">coord_fixed</span>(<span class="fl">1.3</span>) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_polygon</span>(<span class="dt">color =</span> <span class="st">&quot;black&quot;</span>, <span class="dt">fill =</span> <span class="st">&quot;gray&quot;</span>)</code></pre></div>
<p><img src="dataviz_geospatial_files/figure-html/fiftystater-1.png" width="672" /></p>
</div>
</div>
<div id="using-shapefiles" class="section level2">
<h2>Using shapefiles</h2>
<p><code>maps</code> contains a very limited number of geodatabases. If you want to import a different country’s borders or some other geographic information, you will likely find the data in a <strong>shapefile</strong>. This is a special file format that encodes points, lines, and polygons in geographic space. Files appear with a <code>.shp</code> extension, sometimes with accompanying files ending in <code>.dbf</code> and <code>.prj</code>.</p>
<ul>
<li><code>.shp</code> stores the geographic coordinates of the geographic features (e.g. country, state, county)</li>
<li><code>.dbf</code> stores data associated with the geographic features (e.g. unemployment rate, crime rates, percentage of votes cast for Donald Trump)</li>
<li><code>.prj</code> stores information about the projection of the coordinates in the shapefile (we’ll handle this shortly)</li>
</ul>
<p>Let’s start with a shapefile for state boundaries in the United States.<a href="#fn3" class="footnoteRef" id="fnref3"><sup>3</sup></a> We’ll use <code>readOGR()</code> from the <code>rgdal</code> package to read in the data file:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(rgdal)

usa &lt;-<span class="st"> </span><span class="kw">readOGR</span>(<span class="st">&quot;data/census_bureau/cb_2013_us_state_20m/cb_2013_us_state_20m.shp&quot;</span>)</code></pre></div>
<pre><code>## OGR data source with driver: ESRI Shapefile 
## Source: &quot;data/census_bureau/cb_2013_us_state_20m/cb_2013_us_state_20m.shp&quot;, layer: &quot;cb_2013_us_state_20m&quot;
## with 52 features
## It has 9 fields
## Integer64 fields read as strings:  ALAND AWATER</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">str</span>(usa, <span class="dt">max.level =</span> <span class="dv">2</span>) <span class="co"># view structure of object</span></code></pre></div>
<pre><code>## Formal class &#39;SpatialPolygonsDataFrame&#39; [package &quot;sp&quot;] with 5 slots
##   ..@ data       :&#39;data.frame&#39;:  52 obs. of  9 variables:
##   ..@ polygons   :List of 52
##   ..@ plotOrder  : int [1:52] 32 48 29 3 18 46 33 22 34 51 ...
##   ..@ bbox       : num [1:2, 1:2] -179.1 17.9 179.8 71.4
##   .. ..- attr(*, &quot;dimnames&quot;)=List of 2
##   ..@ proj4string:Formal class &#39;CRS&#39; [package &quot;sp&quot;] with 1 slot</code></pre>
<p>This is decidedly not a tidy data frame. Once you import the shapefile, it’s best to convert it to a data frame for <code>ggplot()</code>. We can do this using <code>fortify()</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">fortify</span>(usa) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">head</span>()</code></pre></div>
<pre><code>##    long  lat order  hole piece id group
## 1 -88.5 31.9     1 FALSE     1  0   0.1
## 2 -88.5 31.9     2 FALSE     1  0   0.1
## 3 -88.5 31.9     3 FALSE     1  0   0.1
## 4 -88.5 31.9     4 FALSE     1  0   0.1
## 5 -88.5 32.0     5 FALSE     1  0   0.1
## 6 -88.5 32.0     6 FALSE     1  0   0.1</code></pre>
<p>Under this approach, the <code>id</code> variable is just a number assigned to each region (in this case, each state/territory). However the shapefile contains linked data with attributes for each region. We can access this using the <code>@data</code> accessor:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">as_tibble</span>(usa<span class="op">@</span>data)</code></pre></div>
<pre><code>## # A tibble: 52 x 9
##    STATEFP  STATENS    AFFGEOID  GEOID STUSPS        NAME   LSAD
##  *  &lt;fctr&gt;   &lt;fctr&gt;      &lt;fctr&gt; &lt;fctr&gt; &lt;fctr&gt;      &lt;fctr&gt; &lt;fctr&gt;
##  1      01 01779775 0400000US01     01     AL     Alabama     00
##  2      05 00068085 0400000US05     05     AR    Arkansas     00
##  3      06 01779778 0400000US06     06     CA  California     00
##  4      09 01779780 0400000US09     09     CT Connecticut     00
##  5      12 00294478 0400000US12     12     FL     Florida     00
##  6      13 01705317 0400000US13     13     GA     Georgia     00
##  7      16 01779783 0400000US16     16     ID       Idaho     00
##  8      17 01779784 0400000US17     17     IL    Illinois     00
##  9      18 00448508 0400000US18     18     IN     Indiana     00
## 10      20 00481813 0400000US20     20     KS      Kansas     00
## # ... with 42 more rows, and 2 more variables: ALAND &lt;fctr&gt;, AWATER &lt;fctr&gt;</code></pre>
<p>We can keep these variables in the new data frame through parameters to <code>fortify(region = &quot;&quot;)</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># state name</span>
usa <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">fortify</span>(<span class="dt">region =</span> <span class="st">&quot;NAME&quot;</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">head</span>()</code></pre></div>
<pre><code>##    long  lat order  hole piece      id     group
## 1 -88.5 31.9     1 FALSE     1 Alabama Alabama.1
## 2 -88.5 31.9     2 FALSE     1 Alabama Alabama.1
## 3 -88.5 31.9     3 FALSE     1 Alabama Alabama.1
## 4 -88.5 31.9     4 FALSE     1 Alabama Alabama.1
## 5 -88.5 32.0     5 FALSE     1 Alabama Alabama.1
## 6 -88.5 32.0     6 FALSE     1 Alabama Alabama.1</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># FIPS code</span>
usa <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">fortify</span>(<span class="dt">region =</span> <span class="st">&quot;STATEFP&quot;</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">head</span>()</code></pre></div>
<pre><code>##    long  lat order  hole piece id group
## 1 -88.5 31.9     1 FALSE     1 01  01.1
## 2 -88.5 31.9     2 FALSE     1 01  01.1
## 3 -88.5 31.9     3 FALSE     1 01  01.1
## 4 -88.5 31.9     4 FALSE     1 01  01.1
## 5 -88.5 32.0     5 FALSE     1 01  01.1
## 6 -88.5 32.0     6 FALSE     1 01  01.1</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># keep it all</span>
(usa2 &lt;-<span class="st"> </span>usa <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">fortify</span>(<span class="dt">region =</span> <span class="st">&quot;NAME&quot;</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">as_tibble</span>() <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">left_join</span>(usa<span class="op">@</span>data, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;id&quot;</span> =<span class="st"> &quot;NAME&quot;</span>)))</code></pre></div>
<pre><code>## # A tibble: 46,174 x 15
##     long   lat order  hole  piece      id     group STATEFP  STATENS
##    &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt; &lt;lgl&gt; &lt;fctr&gt;   &lt;chr&gt;    &lt;fctr&gt;  &lt;fctr&gt;   &lt;fctr&gt;
##  1 -88.5  31.9     1 FALSE      1 Alabama Alabama.1      01 01779775
##  2 -88.5  31.9     2 FALSE      1 Alabama Alabama.1      01 01779775
##  3 -88.5  31.9     3 FALSE      1 Alabama Alabama.1      01 01779775
##  4 -88.5  31.9     4 FALSE      1 Alabama Alabama.1      01 01779775
##  5 -88.5  32.0     5 FALSE      1 Alabama Alabama.1      01 01779775
##  6 -88.5  32.0     6 FALSE      1 Alabama Alabama.1      01 01779775
##  7 -88.5  32.1     7 FALSE      1 Alabama Alabama.1      01 01779775
##  8 -88.4  32.2     8 FALSE      1 Alabama Alabama.1      01 01779775
##  9 -88.4  32.2     9 FALSE      1 Alabama Alabama.1      01 01779775
## 10 -88.4  32.2    10 FALSE      1 Alabama Alabama.1      01 01779775
## # ... with 46,164 more rows, and 6 more variables: AFFGEOID &lt;fctr&gt;,
## #   GEOID &lt;fctr&gt;, STUSPS &lt;fctr&gt;, LSAD &lt;fctr&gt;, ALAND &lt;fctr&gt;, AWATER &lt;fctr&gt;</code></pre>
<blockquote>
<p><a href="https://www.census.gov/geo/reference/ansi_statetables.html">FIPS codes for each state and outlying territory.</a></p>
</blockquote>
<p>Now we can plot it like normal using <code>ggplot()</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(<span class="dt">data =</span> usa2, <span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> long, <span class="dt">y =</span> lat, <span class="dt">group =</span> group)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">coord_fixed</span>(<span class="fl">1.3</span>) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_polygon</span>(<span class="dt">color =</span> <span class="st">&quot;black&quot;</span>, <span class="dt">fill =</span> <span class="st">&quot;gray&quot;</span>)</code></pre></div>
<p><img src="dataviz_geospatial_files/figure-html/usa2-all-1.png" width="672" /></p>
<p>Because the data file comes from the Census Bureau, we also get boundaries for Alaska, Hawaii, and Puerto Rico. To remove them from the data, just use <code>filter()</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">usa2 &lt;-<span class="st"> </span>usa2 <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(id <span class="op">!=</span><span class="st"> &quot;Alaska&quot;</span>, id <span class="op">!=</span><span class="st"> &quot;Hawaii&quot;</span>, id <span class="op">!=</span><span class="st"> &quot;Puerto Rico&quot;</span>)

<span class="kw">ggplot</span>(<span class="dt">data =</span> usa2, <span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> long, <span class="dt">y =</span> lat, <span class="dt">group =</span> group)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">coord_fixed</span>(<span class="fl">1.3</span>) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_polygon</span>(<span class="dt">color =</span> <span class="st">&quot;black&quot;</span>, <span class="dt">fill =</span> <span class="st">&quot;gray&quot;</span>)</code></pre></div>
<p><img src="dataviz_geospatial_files/figure-html/usa2-filter-1.png" width="672" /></p>
</div>
<div id="ggmap" class="section level2">
<h2><code>ggmap</code></h2>
<p>Rather than relying on geodatabases or shapefiles which store boundaries as numeric data, we can use <code>ggmap</code> to retrieve raster map tiles from online mapping services. The most popular provider of these map tiles is <a href="https://www.google.com/maps">Google Maps</a>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(ggmap)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">get_googlemap</span>(<span class="st">&quot;university of chicago&quot;</span>, <span class="dt">zoom =</span> <span class="dv">12</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ggmap</span>()</code></pre></div>
<p><img src="dataviz_geospatial_files/figure-html/google-maps-1.png" width="672" /></p>
</div>
<div id="changing-map-projections" class="section level2">
<h2>Changing map projections</h2>
<iframe width="560" height="315" src="https://www.youtube.com/embed/vVX-PrBRtTY?rel=0" frameborder="0" allowfullscreen>
</iframe>
<p>Representing portions of the globe on a flat surface can be challenging. Depending on how you project the map, you can distort or emphasize certain features of the map. Fortunately, <code>ggplot()</code> includes the <code>coord_map()</code> function which allows us to easily implement different projection methods.<a href="#fn4" class="footnoteRef" id="fnref4"><sup>4</sup></a> Depending on the projection method, you may need to pass additional arguments to <code>coord_map()</code> to define the standard parallel lines used in projecting the map:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">map_proj_base &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> usa2,
                        <span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> long, <span class="dt">y =</span> lat, <span class="dt">group =</span> group)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_polygon</span>(<span class="dt">color =</span> <span class="st">&quot;black&quot;</span>, <span class="dt">fill =</span> <span class="st">&quot;gray&quot;</span>)

map_proj_base <span class="op">+</span>
<span class="st">  </span><span class="kw">coord_map</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">ggtitle</span>(<span class="st">&quot;Mercator projection (default)&quot;</span>)</code></pre></div>
<p><img src="dataviz_geospatial_files/figure-html/projections-1.png" width="672" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">map_proj_base <span class="op">+</span>
<span class="st">  </span><span class="kw">coord_map</span>(<span class="dt">projection =</span> <span class="st">&quot;albers&quot;</span>, <span class="dt">lat0 =</span> <span class="dv">25</span>, <span class="dt">lat1 =</span> <span class="dv">50</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">ggtitle</span>(<span class="st">&quot;Albers equal-area projection&quot;</span>)</code></pre></div>
<p><img src="dataviz_geospatial_files/figure-html/projections-2.png" width="672" /></p>
</div>
</div>
<div id="adding-data-to-the-map" class="section level1">
<h1>Adding data to the map</h1>
<p>Region boundaries serve as the background in geospatial data visualization - so now we need to add data. Some types of geometric objects (points and symbols) are overlaid on top of the boundaries, whereas other geoms (fill) are incorporated into the region layer itself. Let’s look at the first type of object.</p>
<div id="points" class="section level2">
<h2>Points</h2>
<p>Let’s use our <code>usa2</code> map data to add some points. The <code>airports</code> data frame in the <code>nycflights13</code> package includes geographic info on airports in the United States.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(nycflights13)
airports</code></pre></div>
<pre><code>## # A tibble: 1,458 x 8
##      faa                           name   lat    lon   alt    tz   dst
##    &lt;chr&gt;                          &lt;chr&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;
##  1   04G              Lansdowne Airport  41.1  -80.6  1044    -5     A
##  2   06A  Moton Field Municipal Airport  32.5  -85.7   264    -6     A
##  3   06C            Schaumburg Regional  42.0  -88.1   801    -6     A
##  4   06N                Randall Airport  41.4  -74.4   523    -5     A
##  5   09J          Jekyll Island Airport  31.1  -81.4    11    -5     A
##  6   0A9 Elizabethton Municipal Airport  36.4  -82.2  1593    -5     A
##  7   0G6        Williams County Airport  41.5  -84.5   730    -5     A
##  8   0G7  Finger Lakes Regional Airport  42.9  -76.8   492    -5     A
##  9   0P2   Shoestring Aviation Airfield  39.8  -76.6  1000    -5     U
## 10   0S9          Jefferson County Intl  48.1 -122.8   108    -8     A
## # ... with 1,448 more rows, and 1 more variables: tzone &lt;chr&gt;</code></pre>
<p>Each airport has it’s geographic location encoded through <code>lat</code> and <code>lon</code>. To draw these points on the map, basically we draw a scatterplot with <code>x = lon</code> and <code>y = lat</code>. In fact we could simply do that:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(airports, <span class="kw">aes</span>(lon, lat)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>()</code></pre></div>
<p><img src="dataviz_geospatial_files/figure-html/scatter-1.png" width="672" /></p>
<p>Let’s overlay it with the mapped state borders:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>() <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">coord_map</span>() <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_polygon</span>(<span class="dt">data =</span> usa2, <span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> long, <span class="dt">y =</span> lat, <span class="dt">group =</span> group),
               <span class="dt">color =</span> <span class="st">&quot;black&quot;</span>, <span class="dt">fill =</span> <span class="st">&quot;gray&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">data =</span> airports, <span class="kw">aes</span>(<span class="dt">x =</span> lon, <span class="dt">y =</span> lat), <span class="dt">shape =</span> <span class="dv">1</span>)</code></pre></div>
<p><img src="dataviz_geospatial_files/figure-html/flights-usa-1.png" width="672" /></p>
<p>Slight problem. We have airports listed outside of the continental United States. There are a couple ways to rectify this. Unfortunately <code>airports</code> does not include a variable identifying state so the <code>filter()</code> operation is not that simple. The easiest solution is to crop the limits of the graph to only show the mainland:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>() <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">coord_map</span>(<span class="dt">xlim =</span> <span class="kw">c</span>(<span class="op">-</span><span class="dv">130</span>, <span class="op">-</span><span class="dv">60</span>),
            <span class="dt">ylim =</span> <span class="kw">c</span>(<span class="dv">20</span>, <span class="dv">50</span>)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_polygon</span>(<span class="dt">data =</span> usa2, <span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> long, <span class="dt">y =</span> lat, <span class="dt">group =</span> group),
               <span class="dt">color =</span> <span class="st">&quot;black&quot;</span>, <span class="dt">fill =</span> <span class="st">&quot;gray&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">data =</span> airports, <span class="kw">aes</span>(<span class="dt">x =</span> lon, <span class="dt">y =</span> lat), <span class="dt">shape =</span> <span class="dv">1</span>)</code></pre></div>
<p><img src="dataviz_geospatial_files/figure-html/crop-1.png" width="672" /></p>
<p>If we want to change the projection method, the points will automatically adjust too:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>() <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">coord_map</span>(<span class="dt">projection =</span> <span class="st">&quot;albers&quot;</span>, <span class="dt">lat0 =</span> <span class="dv">25</span>, <span class="dt">lat1 =</span> <span class="dv">50</span>,
            <span class="dt">xlim =</span> <span class="kw">c</span>(<span class="op">-</span><span class="dv">130</span>, <span class="op">-</span><span class="dv">60</span>),
            <span class="dt">ylim =</span> <span class="kw">c</span>(<span class="dv">20</span>, <span class="dv">50</span>)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_polygon</span>(<span class="dt">data =</span> usa2, <span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> long, <span class="dt">y =</span> lat, <span class="dt">group =</span> group),
               <span class="dt">color =</span> <span class="st">&quot;black&quot;</span>, <span class="dt">fill =</span> <span class="st">&quot;gray&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">data =</span> airports, <span class="kw">aes</span>(<span class="dt">x =</span> lon, <span class="dt">y =</span> lat), <span class="dt">shape =</span> <span class="dv">1</span>)</code></pre></div>
<p><img src="dataviz_geospatial_files/figure-html/crop-proj-1.png" width="672" /></p>
</div>
<div id="symbols" class="section level2">
<h2>Symbols</h2>
<p>We can change the size or type of symbols on the map. For instance, we can draw a <strong>bubble plot</strong> (also known as a <strong>proportional symbol map</strong>) and encode the altitude of the airport through the size channel:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>() <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">coord_map</span>(<span class="dt">xlim =</span> <span class="kw">c</span>(<span class="op">-</span><span class="dv">130</span>, <span class="op">-</span><span class="dv">60</span>),
            <span class="dt">ylim =</span> <span class="kw">c</span>(<span class="dv">20</span>, <span class="dv">50</span>)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_polygon</span>(<span class="dt">data =</span> usa2, <span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> long, <span class="dt">y =</span> lat, <span class="dt">group =</span> group),
               <span class="dt">color =</span> <span class="st">&quot;black&quot;</span>, <span class="dt">fill =</span> <span class="st">&quot;white&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">data =</span> airports, <span class="kw">aes</span>(<span class="dt">x =</span> lon, <span class="dt">y =</span> lat, <span class="dt">size =</span> alt),
             <span class="dt">fill =</span> <span class="st">&quot;grey&quot;</span>, <span class="dt">color =</span> <span class="st">&quot;black&quot;</span>, <span class="dt">alpha =</span> .<span class="dv">2</span>) <span class="op">+</span>
<span class="st">  </span><span class="co"># strip out background junk and remove legend</span>
<span class="st">  </span><span class="kw">theme_void</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">&quot;none&quot;</span>)</code></pre></div>
<p><img src="dataviz_geospatial_files/figure-html/airport-alt-1.png" width="672" /></p>
<p>Circle area is proportional to the airport’s altitude (in feet). Or we could scale it based on the number of arriving flights in <code>flights</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">(airports_n &lt;-<span class="st"> </span>flights <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">count</span>(dest) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">left_join</span>(airports, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;dest&quot;</span> =<span class="st"> &quot;faa&quot;</span>)))</code></pre></div>
<pre><code>## # A tibble: 105 x 9
##     dest     n                              name   lat    lon   alt    tz
##    &lt;chr&gt; &lt;int&gt;                             &lt;chr&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;int&gt; &lt;dbl&gt;
##  1   ABQ   254 Albuquerque International Sunport  35.0 -106.6  5355    -7
##  2   ACK   265                     Nantucket Mem  41.3  -70.1    48    -5
##  3   ALB   439                       Albany Intl  42.7  -73.8   285    -5
##  4   ANC     8        Ted Stevens Anchorage Intl  61.2 -150.0   152    -9
##  5   ATL 17215   Hartsfield Jackson Atlanta Intl  33.6  -84.4  1026    -5
##  6   AUS  2439             Austin Bergstrom Intl  30.2  -97.7   542    -6
##  7   AVL   275        Asheville Regional Airport  35.4  -82.5  2165    -5
##  8   BDL   443                      Bradley Intl  41.9  -72.7   173    -5
##  9   BGR   375                       Bangor Intl  44.8  -68.8   192    -5
## 10   BHM   297                   Birmingham Intl  33.6  -86.8   644    -6
## # ... with 95 more rows, and 2 more variables: dst &lt;chr&gt;, tzone &lt;chr&gt;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>() <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">coord_map</span>(<span class="dt">xlim =</span> <span class="kw">c</span>(<span class="op">-</span><span class="dv">130</span>, <span class="op">-</span><span class="dv">60</span>),
            <span class="dt">ylim =</span> <span class="kw">c</span>(<span class="dv">20</span>, <span class="dv">50</span>)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_polygon</span>(<span class="dt">data =</span> usa2, <span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> long, <span class="dt">y =</span> lat, <span class="dt">group =</span> group),
               <span class="dt">color =</span> <span class="st">&quot;black&quot;</span>, <span class="dt">fill =</span> <span class="st">&quot;white&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">data =</span> airports_n, <span class="kw">aes</span>(<span class="dt">x =</span> lon, <span class="dt">y =</span> lat, <span class="dt">size =</span> n),
             <span class="dt">fill =</span> <span class="st">&quot;grey&quot;</span>, <span class="dt">color =</span> <span class="st">&quot;black&quot;</span>, <span class="dt">alpha =</span> .<span class="dv">2</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">theme_void</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">&quot;none&quot;</span>)</code></pre></div>
<p><img src="dataviz_geospatial_files/figure-html/airport-dest-1.png" width="672" /></p>
<blockquote>
<p><code>airports</code> contains a list of virtually all commercial airports in the United States. However <code>flights</code> only contains data on flights departing from New York City airports (JFK, LaGuardia, or Newark) and only services a few airports around the country.</p>
</blockquote>
</div>
</div>
<div id="drawing-choropleth-maps" class="section level1">
<h1>Drawing choropleth maps</h1>
<p><strong>Choropleth maps</strong> encode information by assigning shades of colors to defined areas on a map (e.g. countries, states, counties, zip codes). There are lots of ways to tweak and customize these graphs, which is generally a good idea because decoding and interpreting information conveyed via colorshades is notoriously tricky (if the color palette is a bad choice).</p>
<div id="loading-the-data" class="section level2">
<h2>Loading the data</h2>
<p>We’ll continue to use the <code>usa2</code> shapefile. Let’s reload it and also load and tidy the county shapefile:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># load USA shapefile for map boundaries</span>
usa &lt;-<span class="st"> </span><span class="kw">readOGR</span>(<span class="st">&quot;data/census_bureau/cb_2013_us_state_20m/cb_2013_us_state_20m.shp&quot;</span>)</code></pre></div>
<pre><code>## OGR data source with driver: ESRI Shapefile 
## Source: &quot;data/census_bureau/cb_2013_us_state_20m/cb_2013_us_state_20m.shp&quot;, layer: &quot;cb_2013_us_state_20m&quot;
## with 52 features
## It has 9 fields
## Integer64 fields read as strings:  ALAND AWATER</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># fortify and filter to keep contiguous USA</span>
usa2 &lt;-<span class="st"> </span>usa <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">fortify</span>(<span class="dt">region =</span> <span class="st">&quot;GEOID&quot;</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">as_tibble</span>() <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">left_join</span>(usa<span class="op">@</span>data, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;id&quot;</span> =<span class="st"> &quot;GEOID&quot;</span>)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="co"># filter out Alaska, Hawaii, Puerto Rico via FIPS codes</span>
<span class="st">  </span><span class="kw">filter</span>(<span class="op">!</span>(STATEFP <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;02&quot;</span>, <span class="st">&quot;15&quot;</span>, <span class="st">&quot;72&quot;</span>)))

<span class="co"># do the same thing for the county shapefile</span>
counties &lt;-<span class="st"> </span><span class="kw">readOGR</span>(<span class="st">&quot;data/census_bureau/cb_2013_us_county_20m/cb_2013_us_county_20m.shp&quot;</span>)</code></pre></div>
<pre><code>## OGR data source with driver: ESRI Shapefile 
## Source: &quot;data/census_bureau/cb_2013_us_county_20m/cb_2013_us_county_20m.shp&quot;, layer: &quot;cb_2013_us_county_20m&quot;
## with 3221 features
## It has 9 fields
## Integer64 fields read as strings:  ALAND AWATER</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">counties2 &lt;-<span class="st"> </span>counties <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">fortify</span>(<span class="dt">region =</span> <span class="st">&quot;GEOID&quot;</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">as_tibble</span>() <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">left_join</span>(counties<span class="op">@</span>data, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;id&quot;</span> =<span class="st"> &quot;GEOID&quot;</span>)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="co"># filter out Alaska, Hawaii, Puerto Rico via FIPS codes</span>
<span class="st">  </span><span class="kw">filter</span>(<span class="op">!</span>(STATEFP <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;02&quot;</span>, <span class="st">&quot;15&quot;</span>, <span class="st">&quot;72&quot;</span>)))

<span class="co"># plot county map boundaries</span>
<span class="kw">ggplot</span>(counties2, <span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> long, <span class="dt">y =</span> lat, <span class="dt">group =</span> group)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_polygon</span>(<span class="dt">color =</span> <span class="st">&quot;black&quot;</span>, <span class="dt">fill =</span> <span class="st">&quot;gray&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">coord_map</span>()</code></pre></div>
<p><img src="dataviz_geospatial_files/figure-html/county-shp-1.png" width="672" /></p>
<p>We’ll draw choropleths for the number of foreign-born individuals in each region (state or county). We can get those files from the <code>census_bureau</code> folder. Let’s also normalize our measure by the total population to get the rate of foreign-born individuals in the population:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">(fb_state &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">&quot;data/census_bureau/ACS_13_5YR_B05012_state/ACS_13_5YR_B05012.csv&quot;</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">rate =</span> HD01_VD03 <span class="op">/</span><span class="st"> </span>HD01_VD01))</code></pre></div>
<pre><code>## # A tibble: 51 x 10
##         GEO.id GEO.id2  `GEO.display-label` HD01_VD01 HD02_VD01 HD01_VD02
##          &lt;chr&gt;   &lt;chr&gt;                &lt;chr&gt;     &lt;int&gt;     &lt;chr&gt;     &lt;int&gt;
##  1 0400000US01      01              Alabama   4799277      &lt;NA&gt;   4631045
##  2 0400000US02      02               Alaska    720316      &lt;NA&gt;    669941
##  3 0400000US04      04              Arizona   6479703      &lt;NA&gt;   5609835
##  4 0400000US05      05             Arkansas   2933369      &lt;NA&gt;   2799972
##  5 0400000US06      06           California  37659181      &lt;NA&gt;  27483342
##  6 0400000US08      08             Colorado   5119329      &lt;NA&gt;   4623809
##  7 0400000US09      09          Connecticut   3583561      &lt;NA&gt;   3096374
##  8 0400000US10      10             Delaware    908446      &lt;NA&gt;    831683
##  9 0400000US11      11 District of Columbia    619371      &lt;NA&gt;    534142
## 10 0400000US12      12              Florida  19091156      &lt;NA&gt;  15392410
## # ... with 41 more rows, and 4 more variables: HD02_VD02 &lt;int&gt;,
## #   HD01_VD03 &lt;int&gt;, HD02_VD03 &lt;int&gt;, rate &lt;dbl&gt;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">(fb_county &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">&quot;data/census_bureau/ACS_13_5YR_B05012_county/ACS_13_5YR_B05012.csv&quot;</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">rate =</span> HD01_VD03 <span class="op">/</span><span class="st"> </span>HD01_VD01))</code></pre></div>
<pre><code>## # A tibble: 3,143 x 10
##            GEO.id GEO.id2      `GEO.display-label` HD01_VD01 HD02_VD01
##             &lt;chr&gt;   &lt;chr&gt;                    &lt;chr&gt;     &lt;int&gt;     &lt;int&gt;
##  1 0500000US01001   01001  Autauga County, Alabama     54907        NA
##  2 0500000US01003   01003  Baldwin County, Alabama    187114        NA
##  3 0500000US01005   01005  Barbour County, Alabama     27321        NA
##  4 0500000US01007   01007     Bibb County, Alabama     22754        NA
##  5 0500000US01009   01009   Blount County, Alabama     57623        NA
##  6 0500000US01011   01011  Bullock County, Alabama     10746        NA
##  7 0500000US01013   01013   Butler County, Alabama     20624        NA
##  8 0500000US01015   01015  Calhoun County, Alabama    117714        NA
##  9 0500000US01017   01017 Chambers County, Alabama     34145        NA
## 10 0500000US01019   01019 Cherokee County, Alabama     26034        NA
## # ... with 3,133 more rows, and 5 more variables: HD01_VD02 &lt;int&gt;,
## #   HD02_VD02 &lt;int&gt;, HD01_VD03 &lt;int&gt;, HD02_VD03 &lt;int&gt;, rate &lt;dbl&gt;</code></pre>
</div>
<div id="joining-the-data-to-regions" class="section level2">
<h2>Joining the data to regions</h2>
<p>Now that we have our data, we want to draw it on the map. To do that, we have to join together our data sources - the shapefiles and the CSVs. Normally joining data files requires a <code>_join()</code> operation of some sort. However when using <code>ggplot2</code>, we don’t have to do this. Remember that we can pass different data frames into different layers of a <code>ggplot()</code> object. Rather than using <code>geom_polygon()</code> to draw our maps, now we switch to <code>geom_map()</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(fb_state, <span class="kw">aes</span>(<span class="dt">map_id =</span> GEO.id2)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_map</span>(<span class="kw">aes</span>(<span class="dt">fill =</span> rate), <span class="dt">map =</span> usa2) <span class="op">+</span>
<span class="st">  </span><span class="kw">expand_limits</span>(<span class="dt">x =</span> usa2<span class="op">$</span>long, <span class="dt">y =</span> usa2<span class="op">$</span>lat)</code></pre></div>
<p><img src="dataviz_geospatial_files/figure-html/geom-map-state-1.png" width="672" /></p>
<p>Let’s break down what just happened:</p>
<ul>
<li><code>fb_state</code> is the data frame with the variables we want to visualize</li>
<li><code>map_id = GEO.id2</code> identifies the column in <code>fb_state</code> that uniquely matches each observation to a region in <code>usa2</code></li>
<li><code>geom_map(aes(fill = rate), map = usa2)</code>
<ul>
<li><code>fill = rate</code> identifies the column in <code>fb_state</code> we will use to determine the color of each region</li>
<li><code>map = usa2</code> is the data frame containing the boundary coordinates</li>
</ul></li>
<li><code>expand_limits(x = usa2$long, y = usa2$lat)</code> ensures the graph is drawn to the proper window. Because the default data frame for this <code>ggplot()</code> object is <code>fb_state</code>, it won’t contain the necessary information to size the window</li>
</ul>
<p>We can then tweak this up by adding a title, removing the background (but retaining the legend), and projecting the map using a different method:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(fb_state, <span class="kw">aes</span>(<span class="dt">map_id =</span> GEO.id2)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_map</span>(<span class="kw">aes</span>(<span class="dt">fill =</span> rate), <span class="dt">map =</span> usa2) <span class="op">+</span>
<span class="st">  </span><span class="kw">expand_limits</span>(<span class="dt">x =</span> usa2<span class="op">$</span>long, <span class="dt">y =</span> usa2<span class="op">$</span>lat) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_fill_continuous</span>(<span class="dt">labels =</span> scales<span class="op">::</span>percent) <span class="op">+</span>
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;Rate of foreign-born individuals in the population&quot;</span>,
       <span class="dt">fill =</span> <span class="ot">NULL</span>) <span class="op">+</span>
<span class="st">  </span>ggthemes<span class="op">::</span><span class="kw">theme_map</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">coord_map</span>(<span class="dt">projection =</span> <span class="st">&quot;albers&quot;</span>, <span class="dt">lat0 =</span> <span class="dv">25</span>, <span class="dt">lat1 =</span> <span class="dv">50</span>)</code></pre></div>
<p><img src="dataviz_geospatial_files/figure-html/geom-map-state-neat-1.png" width="672" /></p>
<p>We could do the same thing for the county-level data:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(fb_county, <span class="kw">aes</span>(<span class="dt">map_id =</span> GEO.id2)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_map</span>(<span class="kw">aes</span>(<span class="dt">fill =</span> rate), <span class="dt">map =</span> counties2) <span class="op">+</span>
<span class="st">  </span><span class="kw">expand_limits</span>(<span class="dt">x =</span> counties2<span class="op">$</span>long, <span class="dt">y =</span> counties2<span class="op">$</span>lat) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_fill_continuous</span>(<span class="dt">labels =</span> scales<span class="op">::</span>percent) <span class="op">+</span>
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;Rate of foreign-born individuals in the population&quot;</span>,
       <span class="dt">fill =</span> <span class="ot">NULL</span>) <span class="op">+</span>
<span class="st">  </span>ggthemes<span class="op">::</span><span class="kw">theme_map</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">coord_map</span>(<span class="dt">projection =</span> <span class="st">&quot;albers&quot;</span>, <span class="dt">lat0 =</span> <span class="dv">25</span>, <span class="dt">lat1 =</span> <span class="dv">50</span>)</code></pre></div>
<p><img src="dataviz_geospatial_files/figure-html/geom-map-county-1.png" width="672" /></p>
<div id="binning-data" class="section level3">
<h3>Binning data</h3>
<blockquote>
<p>Remember <code>cut()</code>? There are some <code>ggplot2</code> variants on this function that more explicitly identify how we want to bin the numeric vector (column).</p>
</blockquote>
<ul>
<li><code>cut_interval()</code> - makes <code>n</code> groups with equal range</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">fb_county <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">rate_cut =</span> <span class="kw">cut_interval</span>(rate, <span class="dv">6</span>)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">map_id =</span> GEO.id2)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_map</span>(<span class="kw">aes</span>(<span class="dt">fill =</span> rate_cut), <span class="dt">map =</span> counties2) <span class="op">+</span>
<span class="st">  </span><span class="kw">expand_limits</span>(<span class="dt">x =</span> counties2<span class="op">$</span>long, <span class="dt">y =</span> counties2<span class="op">$</span>lat) <span class="op">+</span>
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;Rate of foreign-born individuals in the population&quot;</span>,
       <span class="dt">fill =</span> <span class="ot">NULL</span>) <span class="op">+</span>
<span class="st">  </span>ggthemes<span class="op">::</span><span class="kw">theme_map</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">coord_map</span>(<span class="dt">projection =</span> <span class="st">&quot;albers&quot;</span>, <span class="dt">lat0 =</span> <span class="dv">25</span>, <span class="dt">lat1 =</span> <span class="dv">50</span>)</code></pre></div>
<p><img src="dataviz_geospatial_files/figure-html/cut-interval-1.png" width="672" /></p>
<ul>
<li><code>cut_number()</code> - makes <code>n</code> groups with (approximately) equal numbers of observations</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">fb_county <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">rate_cut =</span> <span class="kw">cut_number</span>(rate, <span class="dv">6</span>)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">map_id =</span> GEO.id2)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_map</span>(<span class="kw">aes</span>(<span class="dt">fill =</span> rate_cut), <span class="dt">map =</span> counties2) <span class="op">+</span>
<span class="st">  </span><span class="kw">expand_limits</span>(<span class="dt">x =</span> counties2<span class="op">$</span>long, <span class="dt">y =</span> counties2<span class="op">$</span>lat) <span class="op">+</span>
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;Rate of foreign-born individuals in the population&quot;</span>,
       <span class="dt">fill =</span> <span class="ot">NULL</span>) <span class="op">+</span>
<span class="st">  </span>ggthemes<span class="op">::</span><span class="kw">theme_map</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">coord_map</span>(<span class="dt">projection =</span> <span class="st">&quot;albers&quot;</span>, <span class="dt">lat0 =</span> <span class="dv">25</span>, <span class="dt">lat1 =</span> <span class="dv">50</span>)</code></pre></div>
<p><img src="dataviz_geospatial_files/figure-html/cut-number-1.png" width="672" /></p>
</div>
</div>
<div id="defining-colors" class="section level2">
<h2>Defining colors</h2>
<p>Selection of your <strong>color palette</strong> is perhaps the most important decision to make when drawing a choropleth.</p>
<p>By default, <code>ggplot2</code> picks evenly spaced hues around the <a href="https://en.wikipedia.org/wiki/HCL_color_space">Hue-Chroma-Luminance (HCL) color space</a>:<a href="#fn5" class="footnoteRef" id="fnref5"><sup>5</sup></a></p>
<p><img src="dataviz_geospatial_files/figure-html/color-wheel-1.png" width="672" /></p>
<p><code>ggplot2</code> gives you many different ways of defining and customizing your <code>scale_color_</code> and <code>scale_fill_</code> palettes, but will not tell you if they are optimal for your specific usage in the graph.</p>
<div id="rcolorbrewer" class="section level3">
<h3>RColorBrewer</h3>
<p><a href="http://colorbrewer2.org/">Color Brewer</a> is a diagnostic tool for selecting optimal color palettes for maps with discrete variables. The authors have generated different color palettes designed to make differentiating between categories easy depending on the scaling of your variable. All you need to do is define the number of categories in the variable, the nature of your data (sequential, diverging, or qualitative), and a color scheme. There are also options to select palettes that are colorblind safe, print friendly, and photocopy safe. Depending on the combination of options, you may not find any color palette that matches your criteria. In such a case, consider reducing the number of data classes.</p>
<div id="sequential" class="section level4">
<h4>Sequential</h4>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># define ggplot object</span>
seq_plot &lt;-<span class="st"> </span>fb_county <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">rate_cut =</span> <span class="kw">cut_number</span>(rate, <span class="dv">6</span>)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">map_id =</span> GEO.id2)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_map</span>(<span class="kw">aes</span>(<span class="dt">fill =</span> rate_cut), <span class="dt">map =</span> counties2) <span class="op">+</span>
<span class="st">  </span><span class="kw">expand_limits</span>(<span class="dt">x =</span> counties2<span class="op">$</span>long, <span class="dt">y =</span> counties2<span class="op">$</span>lat) <span class="op">+</span>
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;Rate of foreign-born individuals in the population&quot;</span>,
       <span class="dt">fill =</span> <span class="ot">NULL</span>) <span class="op">+</span>
<span class="st">  </span>ggthemes<span class="op">::</span><span class="kw">theme_map</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">coord_map</span>(<span class="dt">projection =</span> <span class="st">&quot;albers&quot;</span>, <span class="dt">lat0 =</span> <span class="dv">25</span>, <span class="dt">lat1 =</span> <span class="dv">50</span>)

seq_plot <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_fill_brewer</span>(<span class="dt">palette =</span> <span class="st">&quot;BuGn&quot;</span>)</code></pre></div>
<p><img src="dataviz_geospatial_files/figure-html/cb-seq-1.png" width="672" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">seq_plot <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_fill_brewer</span>(<span class="dt">palette =</span> <span class="st">&quot;YlGn&quot;</span>)</code></pre></div>
<p><img src="dataviz_geospatial_files/figure-html/cb-seq-2.png" width="672" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">seq_plot <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_fill_brewer</span>(<span class="dt">palette =</span> <span class="st">&quot;Blues&quot;</span>)</code></pre></div>
<p><img src="dataviz_geospatial_files/figure-html/cb-seq-3.png" width="672" /></p>
</div>
</div>
<div id="qualitative" class="section level3">
<h3>Qualitative</h3>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">state_data &lt;-<span class="st"> </span><span class="kw">data_frame</span>(<span class="dt">name =</span> state.name,
                         <span class="dt">region =</span> state.region,
                         <span class="dt">subregion =</span> state.division,
                         <span class="dt">abb =</span> state.abb) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">bind_cols</span>(<span class="kw">as_tibble</span>(state.x77)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="co"># get id variable into data frame</span>
<span class="st">  </span><span class="kw">left_join</span>(usa2 <span class="op">%&gt;%</span>
<span class="st">              </span><span class="kw">select</span>(id, NAME) <span class="op">%&gt;%</span>
<span class="st">              </span><span class="kw">distinct</span>(),
            <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;name&quot;</span> =<span class="st"> &quot;NAME&quot;</span>)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="co"># remove Alaska and Hawaii</span>
<span class="st">  </span><span class="kw">na.omit</span>()

<span class="co"># set region base plot</span>
region_p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(state_data, <span class="kw">aes</span>(<span class="dt">map_id =</span> id)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_map</span>(<span class="kw">aes</span>(<span class="dt">fill =</span> region), <span class="dt">map =</span> usa2) <span class="op">+</span>
<span class="st">  </span><span class="kw">expand_limits</span>(<span class="dt">x =</span> usa2<span class="op">$</span>long, <span class="dt">y =</span> usa2<span class="op">$</span>lat) <span class="op">+</span>
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">fill =</span> <span class="ot">NULL</span>) <span class="op">+</span>
<span class="st">  </span>ggthemes<span class="op">::</span><span class="kw">theme_map</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">coord_map</span>(<span class="dt">projection =</span> <span class="st">&quot;albers&quot;</span>, <span class="dt">lat0 =</span> <span class="dv">25</span>, <span class="dt">lat1 =</span> <span class="dv">50</span>)
region_p</code></pre></div>
<p><img src="dataviz_geospatial_files/figure-html/qual-1.png" width="672" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># try different color brewers</span>
region_p <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_fill_brewer</span>(<span class="dt">palette =</span> <span class="st">&quot;Paired&quot;</span>)</code></pre></div>
<p><img src="dataviz_geospatial_files/figure-html/qual-2.png" width="672" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">region_p <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_fill_brewer</span>(<span class="dt">palette =</span> <span class="st">&quot;Dark2&quot;</span>)</code></pre></div>
<p><img src="dataviz_geospatial_files/figure-html/qual-3.png" width="672" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">region_p <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_fill_brewer</span>(<span class="dt">palette =</span> <span class="st">&quot;Pastel2&quot;</span>)</code></pre></div>
<p><img src="dataviz_geospatial_files/figure-html/qual-4.png" width="672" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># set subregion base plot</span>
subregion_p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(state_data, <span class="kw">aes</span>(<span class="dt">map_id =</span> id)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_map</span>(<span class="kw">aes</span>(<span class="dt">fill =</span> subregion), <span class="dt">map =</span> usa2) <span class="op">+</span>
<span class="st">  </span><span class="kw">expand_limits</span>(<span class="dt">x =</span> usa2<span class="op">$</span>long, <span class="dt">y =</span> usa2<span class="op">$</span>lat) <span class="op">+</span>
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">fill =</span> <span class="ot">NULL</span>) <span class="op">+</span>
<span class="st">  </span>ggthemes<span class="op">::</span><span class="kw">theme_map</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">coord_map</span>(<span class="dt">projection =</span> <span class="st">&quot;albers&quot;</span>, <span class="dt">lat0 =</span> <span class="dv">25</span>, <span class="dt">lat1 =</span> <span class="dv">50</span>)
subregion_p</code></pre></div>
<p><img src="dataviz_geospatial_files/figure-html/qual-5.png" width="672" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">subregion_p <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_fill_brewer</span>(<span class="dt">palette =</span> <span class="st">&quot;Paired&quot;</span>)</code></pre></div>
<p><img src="dataviz_geospatial_files/figure-html/qual-6.png" width="672" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">subregion_p <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_fill_brewer</span>(<span class="dt">palette =</span> <span class="st">&quot;Set1&quot;</span>)</code></pre></div>
<p><img src="dataviz_geospatial_files/figure-html/qual-7.png" width="672" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">subregion_p <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_fill_brewer</span>(<span class="dt">palette =</span> <span class="st">&quot;Pastel1&quot;</span>)</code></pre></div>
<p><img src="dataviz_geospatial_files/figure-html/qual-8.png" width="672" /></p>
</div>
</div>
</div>
<div id="faceting-maps" class="section level1">
<h1>Faceting maps</h1>
<p>If you have geospatial data with a temporal component (i.e. measuring a variable in a country over a period of time) and want to incorporate the temporal data into your visualization, we have a few different options available. Let’s demonstrate using data on world fertility rates and a world map.</p>
<div id="get-world-fertility-rate-data" class="section level2">
<h2>Get world fertility rate data</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># import and fortify world shapefile</span>
world &lt;-<span class="st"> </span><span class="kw">readOGR</span>(<span class="st">&quot;data/nautral_earth/ne_110m_admin_0_countries/ne_110m_admin_0_countries.shp&quot;</span>)</code></pre></div>
<pre><code>## OGR data source with driver: ESRI Shapefile 
## Source: &quot;data/nautral_earth/ne_110m_admin_0_countries/ne_110m_admin_0_countries.shp&quot;, layer: &quot;ne_110m_admin_0_countries&quot;
## with 177 features
## It has 63 fields</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">world2 &lt;-<span class="st"> </span><span class="kw">fortify</span>(world, <span class="dt">region =</span> <span class="st">&quot;iso_a3&quot;</span>)
 
<span class="co"># Country-level data</span>
(fertility &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">&quot;data/API_SP.DYN.TFRT.IN_DS2_en_csv_v2/API_SP.DYN.TFRT.IN_DS2_en_csv_v2.csv&quot;</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">select</span>(<span class="op">-</span>X62) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="co"># tidy the data frame</span>
<span class="st">  </span><span class="kw">gather</span>(year, fertility, <span class="st">`</span><span class="dt">1960</span><span class="st">`</span><span class="op">:</span><span class="st">`</span><span class="dt">2016</span><span class="st">`</span>, <span class="dt">convert =</span> <span class="ot">TRUE</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(year <span class="op">&lt;</span><span class="st"> </span><span class="dv">2015</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">fertility =</span> <span class="kw">as.numeric</span>(fertility),
         <span class="co"># cut into six intervals</span>
         <span class="dt">fertility_rate =</span> <span class="kw">cut_interval</span>(fertility, <span class="dv">6</span>)))</code></pre></div>
<pre><code>## # A tibble: 14,520 x 7
##          `Country Name` `Country Code`
##                   &lt;chr&gt;          &lt;chr&gt;
##  1                Aruba            ABW
##  2              Andorra            AND
##  3          Afghanistan            AFG
##  4               Angola            AGO
##  5              Albania            ALB
##  6           Arab World            ARB
##  7 United Arab Emirates            ARE
##  8            Argentina            ARG
##  9              Armenia            ARM
## 10       American Samoa            ASM
## # ... with 14,510 more rows, and 5 more variables: `Indicator Name` &lt;chr&gt;,
## #   `Indicator Code` &lt;chr&gt;, year &lt;int&gt;, fertility &lt;dbl&gt;,
## #   fertility_rate &lt;fctr&gt;</code></pre>
</div>
<div id="separate-images" class="section level2">
<h2>Separate images</h2>
<p>If we want each map stored in a separate image, we could write a standard iterative operation using techniques we already know.</p>
<div id="for-loop" class="section level3">
<h3><code>For</code> loop</h3>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="cf">for</span>(year <span class="cf">in</span> <span class="kw">seq</span>(<span class="dt">from =</span> <span class="dv">1970</span>, <span class="dt">to =</span> <span class="dv">2010</span>, <span class="dt">by =</span> <span class="dv">5</span>)){
  p &lt;-<span class="st"> </span>fertility <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">filter</span>(year <span class="op">==</span><span class="st"> </span>year) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">map_id =</span> <span class="st">`</span><span class="dt">Country Code</span><span class="st">`</span>)) <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_map</span>(<span class="kw">aes</span>(<span class="dt">fill =</span> fertility_rate), <span class="dt">map =</span> world2) <span class="op">+</span>
<span class="st">    </span><span class="kw">expand_limits</span>(<span class="dt">x =</span> world2<span class="op">$</span>long, <span class="dt">y =</span> world2<span class="op">$</span>lat) <span class="op">+</span>
<span class="st">    </span><span class="kw">scale_fill_brewer</span>(<span class="dt">palette =</span> <span class="st">&quot;BuGn&quot;</span>) <span class="op">+</span>
<span class="st">    </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;Fertility rate&quot;</span>,
         <span class="dt">subtitle =</span> year,
         <span class="dt">fill =</span> <span class="ot">NULL</span>) <span class="op">+</span>
<span class="st">    </span>ggthemes<span class="op">::</span><span class="kw">theme_map</span>() <span class="op">+</span>
<span class="st">    </span><span class="kw">coord_map</span>(<span class="dt">projection =</span> <span class="st">&quot;mollweide&quot;</span>, <span class="dt">xlim =</span> <span class="kw">c</span>(<span class="op">-</span><span class="dv">180</span>, <span class="dv">180</span>))
  <span class="kw">print</span>(p)
}</code></pre></div>
<p><img src="dataviz_geospatial_files/figure-html/world-plot-for-1.png" width="672" /><img src="dataviz_geospatial_files/figure-html/world-plot-for-2.png" width="672" /><img src="dataviz_geospatial_files/figure-html/world-plot-for-3.png" width="672" /><img src="dataviz_geospatial_files/figure-html/world-plot-for-4.png" width="672" /><img src="dataviz_geospatial_files/figure-html/world-plot-for-5.png" width="672" /><img src="dataviz_geospatial_files/figure-html/world-plot-for-6.png" width="672" /><img src="dataviz_geospatial_files/figure-html/world-plot-for-7.png" width="672" /><img src="dataviz_geospatial_files/figure-html/world-plot-for-8.png" width="672" /><img src="dataviz_geospatial_files/figure-html/world-plot-for-9.png" width="672" /></p>
</div>
</div>
<div id="purrrmap" class="section level2">
<h2><code>purrr::map()</code></h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">seq</span>(<span class="dt">from =</span> <span class="dv">1970</span>, <span class="dt">to =</span> <span class="dv">2010</span>, <span class="dt">by =</span> <span class="dv">5</span>) <span class="op">%&gt;%</span>
<span class="st">  </span>purrr<span class="op">::</span><span class="kw">map</span>(<span class="op">~</span><span class="st"> </span>fertility <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">filter</span>(year <span class="op">==</span><span class="st"> </span>.x) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">map_id =</span> <span class="st">`</span><span class="dt">Country Code</span><span class="st">`</span>)) <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_map</span>(<span class="kw">aes</span>(<span class="dt">fill =</span> fertility_rate), <span class="dt">map =</span> world2) <span class="op">+</span>
<span class="st">    </span><span class="kw">expand_limits</span>(<span class="dt">x =</span> world2<span class="op">$</span>long, <span class="dt">y =</span> world2<span class="op">$</span>lat) <span class="op">+</span>
<span class="st">    </span><span class="kw">scale_fill_brewer</span>(<span class="dt">palette =</span> <span class="st">&quot;BuGn&quot;</span>) <span class="op">+</span>
<span class="st">    </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;Fertility rate&quot;</span>,
         <span class="dt">subtitle =</span> .x,
         <span class="dt">fill =</span> <span class="ot">NULL</span>) <span class="op">+</span>
<span class="st">    </span>ggthemes<span class="op">::</span><span class="kw">theme_map</span>() <span class="op">+</span>
<span class="st">    </span><span class="kw">coord_map</span>(<span class="dt">projection =</span> <span class="st">&quot;mollweide&quot;</span>, <span class="dt">xlim =</span> <span class="kw">c</span>(<span class="op">-</span><span class="dv">180</span>, <span class="dv">180</span>)))</code></pre></div>
<pre><code>## [[1]]</code></pre>
<p><img src="dataviz_geospatial_files/figure-html/world-plot-map-1.png" width="672" /></p>
<pre><code>## 
## [[2]]</code></pre>
<p><img src="dataviz_geospatial_files/figure-html/world-plot-map-2.png" width="672" /></p>
<pre><code>## 
## [[3]]</code></pre>
<p><img src="dataviz_geospatial_files/figure-html/world-plot-map-3.png" width="672" /></p>
<pre><code>## 
## [[4]]</code></pre>
<p><img src="dataviz_geospatial_files/figure-html/world-plot-map-4.png" width="672" /></p>
<pre><code>## 
## [[5]]</code></pre>
<p><img src="dataviz_geospatial_files/figure-html/world-plot-map-5.png" width="672" /></p>
<pre><code>## 
## [[6]]</code></pre>
<p><img src="dataviz_geospatial_files/figure-html/world-plot-map-6.png" width="672" /></p>
<pre><code>## 
## [[7]]</code></pre>
<p><img src="dataviz_geospatial_files/figure-html/world-plot-map-7.png" width="672" /></p>
<pre><code>## 
## [[8]]</code></pre>
<p><img src="dataviz_geospatial_files/figure-html/world-plot-map-8.png" width="672" /></p>
<pre><code>## 
## [[9]]</code></pre>
<p><img src="dataviz_geospatial_files/figure-html/world-plot-map-9.png" width="672" /></p>
</div>
<div id="facet_wrap" class="section level2">
<h2><code>facet_wrap()</code></h2>
<p>Or if we want them in a single image, we can use <code>facet_wrap()</code> or <code>facet_grid()</code> to draw the small multiples plot:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(fertility, <span class="kw">aes</span>(<span class="dt">map_id =</span> <span class="st">`</span><span class="dt">Country Code</span><span class="st">`</span>)) <span class="op">+</span>
<span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span><span class="st"> </span>year) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_map</span>(<span class="kw">aes</span>(<span class="dt">fill =</span> fertility_rate), <span class="dt">map =</span> world2) <span class="op">+</span>
<span class="st">  </span><span class="kw">expand_limits</span>(<span class="dt">x =</span> world2<span class="op">$</span>long, <span class="dt">y =</span> world2<span class="op">$</span>lat) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_fill_brewer</span>(<span class="dt">palette =</span> <span class="st">&quot;BuGn&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;Fertility rate&quot;</span>,
       <span class="dt">fill =</span> <span class="ot">NULL</span>) <span class="op">+</span>
<span class="st">  </span>ggthemes<span class="op">::</span><span class="kw">theme_map</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">coord_map</span>(<span class="dt">projection =</span> <span class="st">&quot;mollweide&quot;</span>, <span class="dt">xlim =</span> <span class="kw">c</span>(<span class="op">-</span><span class="dv">180</span>, <span class="dv">180</span>)) <span class="op">+</span>
<span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">&quot;none&quot;</span>)</code></pre></div>
<p><img src="dataviz_geospatial_files/figure-html/world-facet-grid-all-1.png" width="672" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">south_africa &lt;-<span class="st"> </span>world2 <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(id <span class="op">==</span><span class="st"> &quot;ZAF&quot;</span>)

fertility <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(<span class="st">`</span><span class="dt">Country Name</span><span class="st">`</span> <span class="op">==</span><span class="st"> &quot;South Africa&quot;</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">map_id =</span> <span class="st">`</span><span class="dt">Country Code</span><span class="st">`</span>)) <span class="op">+</span>
<span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span><span class="st"> </span>year) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_map</span>(<span class="kw">aes</span>(<span class="dt">fill =</span> fertility_rate), <span class="dt">map =</span> south_africa) <span class="op">+</span>
<span class="st">  </span><span class="kw">expand_limits</span>(<span class="dt">x =</span> south_africa<span class="op">$</span>long, <span class="dt">y =</span> south_africa<span class="op">$</span>lat) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_fill_brewer</span>(<span class="dt">palette =</span> <span class="st">&quot;BuGn&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;Fertility rate&quot;</span>,
       <span class="dt">subtitle =</span> <span class="st">&quot;South Africa&quot;</span>,
       <span class="dt">fill =</span> <span class="ot">NULL</span>) <span class="op">+</span>
<span class="st">  </span>ggthemes<span class="op">::</span><span class="kw">theme_map</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">coord_map</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">&quot;none&quot;</span>)</code></pre></div>
<p><img src="dataviz_geospatial_files/figure-html/world-facet-grid-south-africa-1.png" width="672" /></p>
</div>
<div id="gganimate" class="section level2">
<h2><code>gganimate</code></h2>
<p>Alternatively, we can make an animated visualization using the <a href="https://github.com/dgrtwo/gganimate"><code>gganimate</code></a> package. The major difference is that we now add a <code>frame</code> aesthetic which defines the variable we are using to animate the graph.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(gganimate)

p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(fertility, <span class="kw">aes</span>(<span class="dt">map_id =</span> <span class="st">`</span><span class="dt">Country Code</span><span class="st">`</span>, <span class="dt">frame =</span> year)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_map</span>(<span class="kw">aes</span>(<span class="dt">fill =</span> fertility_rate), <span class="dt">map =</span> world2) <span class="op">+</span>
<span class="st">  </span><span class="kw">expand_limits</span>(<span class="dt">x =</span> world2<span class="op">$</span>long, <span class="dt">y =</span> world2<span class="op">$</span>lat) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_fill_brewer</span>(<span class="dt">palette =</span> <span class="st">&quot;BuGn&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;Fertility rate&quot;</span>,
       <span class="dt">fill =</span> <span class="ot">NULL</span>) <span class="op">+</span>
<span class="st">  </span>ggthemes<span class="op">::</span><span class="kw">theme_map</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">coord_map</span>(<span class="dt">projection =</span> <span class="st">&quot;mollweide&quot;</span>, <span class="dt">xlim =</span> <span class="kw">c</span>(<span class="op">-</span><span class="dv">180</span>, <span class="dv">180</span>)) <span class="op">+</span>
<span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">&quot;none&quot;</span>)
<span class="kw">gganimate</span>(p)</code></pre></div>
<video width="672"  controls loop>
<source src="dataviz_geospatial_files/figure-html/gganimate.webm" />
</video>
</div>
</div>
<div id="acknowledgments" class="section level1 toc-ignore">
<h1>Acknowledgments</h1>
<ul>
<li><a href="http://eriqande.github.io/rep-res-web/lectures/making-maps-with-R.html">Making Maps with R</a></li>
<li><a href="https://flowingdata.com/geographic-r/">Mapping Geographic Data in R</a></li>
</ul>
</div>
<div id="session-info" class="section level1 toc-ignore">
<h1>Session Info</h1>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">devtools<span class="op">::</span><span class="kw">session_info</span>()</code></pre></div>
<pre><code>##  setting  value                       
##  version  R version 3.4.1 (2017-06-30)
##  system   x86_64, darwin15.6.0        
##  ui       X11                         
##  language (EN)                        
##  collate  en_US.UTF-8                 
##  tz       America/Chicago             
##  date     2017-11-07                  
## 
##  package      * version    date       source                              
##  assertthat     0.2.0      2017-04-11 CRAN (R 3.4.0)                      
##  backports      1.1.0      2017-05-22 CRAN (R 3.4.0)                      
##  base         * 3.4.1      2017-07-07 local                               
##  bindr          0.1        2016-11-13 CRAN (R 3.4.0)                      
##  bindrcpp     * 0.2        2017-06-17 CRAN (R 3.4.0)                      
##  boxes          0.0.0.9000 2017-07-19 Github (r-pkgs/boxes@03098dc)       
##  broom        * 0.4.2      2017-08-09 local                               
##  cellranger     1.1.0      2016-07-27 CRAN (R 3.4.0)                      
##  clisymbols     1.2.0      2017-05-21 cran (@1.2.0)                       
##  codetools      0.2-15     2016-10-05 CRAN (R 3.4.1)                      
##  colorspace     1.3-2      2016-12-14 CRAN (R 3.4.0)                      
##  compiler       3.4.1      2017-07-07 local                               
##  crayon         1.3.4      2017-10-03 Github (gaborcsardi/crayon@b5221ab) 
##  data.table     1.10.4     2017-02-01 CRAN (R 3.4.0)                      
##  datasets     * 3.4.1      2017-07-07 local                               
##  devtools       1.13.3     2017-08-02 CRAN (R 3.4.1)                      
##  digest         0.6.12     2017-01-27 CRAN (R 3.4.0)                      
##  dplyr        * 0.7.4.9000 2017-10-03 Github (tidyverse/dplyr@1a0730a)    
##  evaluate       0.10.1     2017-06-24 CRAN (R 3.4.1)                      
##  fiftystater  * 1.0.1      2016-11-14 CRAN (R 3.4.0)                      
##  forcats      * 0.2.0      2017-01-23 CRAN (R 3.4.0)                      
##  foreign        0.8-69     2017-06-22 CRAN (R 3.4.1)                      
##  gapminder    * 0.2.0      2015-12-31 CRAN (R 3.4.0)                      
##  geosphere      1.5-5      2016-06-15 CRAN (R 3.4.0)                      
##  gganimate    * 0.1.0.9000 2017-05-26 Github (dgrtwo/gganimate@bf82002)   
##  ggmap        * 2.6.1      2016-01-23 CRAN (R 3.4.0)                      
##  ggplot2      * 2.2.1      2016-12-30 CRAN (R 3.4.0)                      
##  glue           1.1.1      2017-06-21 CRAN (R 3.4.1)                      
##  graphics     * 3.4.1      2017-07-07 local                               
##  grDevices    * 3.4.1      2017-07-07 local                               
##  grid           3.4.1      2017-07-07 local                               
##  gtable         0.2.0      2016-02-26 CRAN (R 3.4.0)                      
##  haven          1.1.0      2017-07-09 CRAN (R 3.4.1)                      
##  hms            0.3        2016-11-22 CRAN (R 3.4.0)                      
##  htmltools      0.3.6      2017-04-28 CRAN (R 3.4.0)                      
##  htmlwidgets    0.9        2017-07-10 CRAN (R 3.4.1)                      
##  httr           1.3.1      2017-08-20 CRAN (R 3.4.1)                      
##  jpeg           0.1-8      2014-01-23 CRAN (R 3.4.0)                      
##  jsonlite       1.5        2017-06-01 CRAN (R 3.4.0)                      
##  knitr        * 1.17       2017-08-10 cran (@1.17)                        
##  labeling       0.3        2014-08-23 CRAN (R 3.4.0)                      
##  lattice        0.20-35    2017-03-25 CRAN (R 3.4.1)                      
##  lazyeval       0.2.0      2016-06-12 CRAN (R 3.4.0)                      
##  lubridate      1.6.0      2016-09-13 CRAN (R 3.4.0)                      
##  magrittr       1.5        2014-11-22 CRAN (R 3.4.0)                      
##  mapproj        1.2-5      2017-06-08 CRAN (R 3.4.0)                      
##  maps         * 3.2.0      2017-06-08 CRAN (R 3.4.0)                      
##  maptools     * 0.9-2      2017-03-25 CRAN (R 3.4.0)                      
##  memoise        1.1.0      2017-04-21 CRAN (R 3.4.0)                      
##  methods      * 3.4.1      2017-07-07 local                               
##  mnormt         1.5-5      2016-10-15 CRAN (R 3.4.0)                      
##  modelr       * 0.1.1      2017-08-10 local                               
##  munsell        0.4.3      2016-02-13 CRAN (R 3.4.0)                      
##  nlme           3.1-131    2017-02-06 CRAN (R 3.4.1)                      
##  nycflights13 * 0.2.2      2017-01-27 CRAN (R 3.4.0)                      
##  parallel       3.4.1      2017-07-07 local                               
##  pkgconfig      2.0.1      2017-03-21 CRAN (R 3.4.0)                      
##  plotly       * 4.7.1      2017-07-29 CRAN (R 3.4.1)                      
##  plyr           1.8.4      2016-06-08 CRAN (R 3.4.0)                      
##  png            0.1-7      2013-12-03 CRAN (R 3.4.0)                      
##  proto          1.0.0      2016-10-29 CRAN (R 3.4.0)                      
##  psych          1.7.5      2017-05-03 CRAN (R 3.4.1)                      
##  purrr        * 0.2.3      2017-08-02 CRAN (R 3.4.1)                      
##  R6             2.2.2      2017-06-17 CRAN (R 3.4.0)                      
##  Rcpp           0.12.13    2017-09-28 cran (@0.12.13)                     
##  readr        * 1.1.1      2017-05-16 CRAN (R 3.4.0)                      
##  readxl         1.0.0      2017-04-18 CRAN (R 3.4.0)                      
##  reshape2       1.4.2      2016-10-22 CRAN (R 3.4.0)                      
##  rgdal        * 1.2-8      2017-07-01 CRAN (R 3.4.1)                      
##  rgeos        * 0.3-23     2017-04-06 CRAN (R 3.4.0)                      
##  RgoogleMaps    1.4.1      2016-09-18 CRAN (R 3.4.0)                      
##  rjson          0.2.15     2014-11-03 CRAN (R 3.4.0)                      
##  rlang          0.1.2      2017-08-09 CRAN (R 3.4.1)                      
##  rmarkdown      1.6        2017-06-15 CRAN (R 3.4.0)                      
##  rprojroot      1.2        2017-01-16 CRAN (R 3.4.0)                      
##  rstudioapi     0.6        2016-06-27 CRAN (R 3.4.0)                      
##  rvest          0.3.2      2016-06-17 CRAN (R 3.4.0)                      
##  scales         0.4.1      2016-11-09 CRAN (R 3.4.0)                      
##  sp           * 1.2-5      2017-06-29 CRAN (R 3.4.1)                      
##  stats        * 3.4.1      2017-07-07 local                               
##  stringi        1.1.5      2017-04-07 CRAN (R 3.4.0)                      
##  stringr      * 1.2.0      2017-02-18 CRAN (R 3.4.0)                      
##  tibble       * 1.3.4      2017-08-22 CRAN (R 3.4.1)                      
##  tidyr        * 0.7.0      2017-08-16 CRAN (R 3.4.1)                      
##  tidyverse    * 1.1.1.9000 2017-07-19 Github (tidyverse/tidyverse@a028619)
##  tools          3.4.1      2017-07-07 local                               
##  utils        * 3.4.1      2017-07-07 local                               
##  viridisLite    0.2.0      2017-03-24 CRAN (R 3.4.0)                      
##  withr          2.0.0      2017-07-28 CRAN (R 3.4.1)                      
##  xml2           1.1.1      2017-01-24 CRAN (R 3.4.0)                      
##  yaml           2.1.14     2016-11-12 CRAN (R 3.4.0)</code></pre>
</div>
<div class="footnotes">
<hr />
<ol>
<li id="fn1"><p>Source: <a href="https://en.wikipedia.org/wiki/Geographic_information_system">Wikipedia</a>.<a href="#fnref1">↩</a></p></li>
<li id="fn2"><p>Or as we’ll see shortly, apply a map projection to the graph.<a href="#fnref2">↩</a></p></li>
<li id="fn3"><p>Originally obtained from the Census Bureau.<a href="#fnref3">↩</a></p></li>
<li id="fn4"><p>This function replaces <code>coord_fixed()</code>.<a href="#fnref4">↩</a></p></li>
<li id="fn5"><p>Check out chapter 6.6.2 in <em><code>ggplot2</code>: Elegant Graphics for Data Analysis</em> for a much more thorough explanation of the theory behind this selection process<a href="#fnref5">↩</a></p></li>
</ol>
</div>

<p>This work is licensed under the  <a href="http://creativecommons.org/licenses/by-nc/4.0/">CC BY-NC 4.0 Creative Commons License</a>.</p>


</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
